var themeStyleTranslateA=[{style:"opacity",obj:"nOpacity"},{style:"fillopacity",obj:"fillOpacity"},{style:"autoopacity",obj:"autoOpacity"},{style:"shadow",obj:"fOrigShadow"},{style:"blur",obj:"nBlur"},{style:"filter",obj:"szFilter"},{style:"dfilter",obj:"nDeltaFilter"},{style:"filterfield",obj:"szFilterField"},{style:"dbtable",obj:"coTable"},{style:"dbtableUrl",obj:"coTableUrl"},{style:"dbtableType",obj:"coTableType"},{style:"dbtableExt",obj:"coTableExt"},{style:"datacache",obj:"fDataCache"},{style:"itemfield",
obj:"szItemField"},{style:"lookupfield",obj:"szSelectionField"},{style:"lookuptoupper",obj:"fSelectionFieldToUpper"},{style:"lookupsuffix",obj:"szSelectionFieldSuffix"},{style:"showdata",obj:"fShowData"},{style:"datafields",obj:"szDataFieldsA",type:"array"},{style:"userdraw",obj:"userDraw"},{style:"ranges",obj:"szRangesA",type:"array"},{style:"rangecentervalue",obj:"nRangeCenterValue"},{style:"symbols",obj:"szSymbolsA",type:"array"},{style:"values",obj:"szValuesA",type:"array",delimiter:"|"},{style:"label",
obj:"szOrigLabelA",type:"array",delimiter:"|"},{style:"xaxis",obj:"szXaxisA",type:"array"},{style:"units",obj:"szUnits"},{style:"labelunits",obj:"szLabelUnits"},{style:"units100",obj:"szUnits100"},{style:"sizevalueunits",obj:"szSizeValueUnits"},{style:"alphavalueunits",obj:"szAlphaValueUnits"},{style:"legendunits",obj:"szLegendUnits"},{style:"weights",obj:"szWeights"},{style:"align",obj:"szAlign"},{style:"normalsizevalue",obj:"nNormalSizeValue"},{style:"normalsizescale",obj:"szNormalSizeScale"},{style:"scale",
obj:"nScale"},{style:"rangescale",obj:"nRangeScale"},{style:"valuefield",obj:"szValueField"},{style:"labelfield",obj:"szLabelField"},{style:"sizefield",obj:"szSizeField"},{style:"alphafield",obj:"szAlphaField"},{style:"alphafield100",obj:"szAlphaField100"},{style:"dopacitypow",obj:"nDopacityPow"},{style:"dopacityramp",obj:"szDopacityRamp"},{style:"dopacityscale",obj:"nDopacityScale"},{style:"buffersize",obj:"nBufferSize"},{style:"bufferstep",obj:"nBufferSizeStep"},{style:"field100min",obj:"nField100Min"},
{style:"fractionscale",obj:"nFractionScale"},{style:"minvalue",obj:"nMinValue"},{style:"maxvalue",obj:"nMaxValue"},{style:"textfont",obj:"szTextFont"},{style:"textcolor",obj:"szTextColor"},{style:"linecolor",obj:"szLineColor"},{style:"linewidth",obj:"nLineWidth"},{style:"bordercolor",obj:"szBorderColor"},{style:"borderstyle",obj:"szBorderStyle"},{style:"borderwidth",obj:"szBorderWidth"},{style:"borderradius",obj:"nBorderRadius"},{style:"boxcolor",obj:"szBoxColor"},{style:"boxopacity",obj:"nBoxOpacity"},
{style:"boxmargin",obj:"nBoxMargin"},{style:"textplacement",obj:"szTextPlacement"},{style:"infotitle",obj:"szInfoTitle"},{style:"titlefield",obj:"szTitleField"},{style:"snippetfield",obj:"szSnippetField"},{style:"exclude",obj:"szExcludeA",type:"array"},{style:"nodatacolor",obj:"szNoDataColor"},{style:"labelupper",obj:"szLabelUpper"},{style:"valueupper",obj:"szValueUpper"},{style:"glowupper",obj:"szGlowUpper"},{style:"chartupper",obj:"szChartUpper"},{style:"valuescale",obj:"nValueScale"},{style:"minvaluesize",
obj:"nValueSizeMin"},{style:"valuedecimals",obj:"szValueDecimals"},{style:"fadevaluepow",obj:"szFadeValuePow"},{style:"fadenegative",obj:"nFadeNegative"},{style:"centerpart",obj:"szCenterPart"},{style:"clipframes",obj:"nClipFrames"},{style:"cliplegend",obj:"nClipColorLegend"},{style:"clipparts",obj:"nClipParts"},{style:"minchartsize",obj:"nChartSizeMin"},{style:"showparts",obj:"szShowParts"},{style:"gridx",obj:"nGridX"},{style:"gridwidth",obj:"nGridWidth"},{style:"gridmatrix",obj:"nGridMatrix"},{style:"gridwidthpx",
obj:"nGridWidthPx"},{style:"aggregationfield",obj:"szAggregationField"},{style:"aggregationscale",obj:"szAggregationFieldA",type:"array"},{style:"aggregation",obj:"szAggregation"},{style:"minaggregation",obj:"nMinAggregation"},{style:"dominantfilter",obj:"szDominantFilter"},{style:"dominantdfilter",obj:"nDominantDFilter"},{style:"overviewchart",obj:"szOverviewChart"},{style:"evidence",obj:"evidenceMode"},{style:"markclass",obj:"markedClass"},{style:"name",obj:"szName"},{style:"title",obj:"szTitle"},
{style:"snippet",obj:"szSnippet"},{style:"description",obj:"szDescription"}];function __maptheme_getStyleString(f){for(var c="",g=0;g<themeStyleTranslateA.length;g++)c+=__maptheme_getOneStyleProperty(f[themeStyleTranslateA[g].obj],themeStyleTranslateA[g].style,themeStyleTranslateA[g].type,themeStyleTranslateA[g].delimiter);return c}
function __maptheme_getOneStyleProperty(f,c,g,e){e=e?e:",";if("undefined"!=typeof f&&null!=f)if(g&&"undefined"!=typeof g){if("array"==g&&f&&f.length){g="";for(var h=0;h<f.length;h++)g+=(0<h?e:"")+String(f[h]);return c+":"+g+";"}}else return c+":"+String(f)+";";return""}function __getArrayString(f,c){var g="";if(f&&"undefined"!=f&&"undefined"!=typeof f)for(var e=0;e<f.length;e++)g+=(0<e?c:"")+String(f[e]).replace(/\'/gi," ").replace(/\"/gi," ");return g}
function __maptheme_getStyleObj(f){for(var c={},g=0;g<themeStyleTranslateA.length;g++)null!=f[themeStyleTranslateA[g].obj]&&"undefined"!=f[themeStyleTranslateA[g].obj]&&(c[themeStyleTranslateA[g].style]=f[themeStyleTranslateA[g].obj]);return c}
Map.Themes=function(){this.themesA=[];this.themeNodesA=[];this.themeNodesPosA=[];this.themeNodesBoxA=[];this.themeNodes=0;this.activeBuffer=this.activeTheme=null;this.switchedLayerA=[];this.enableMultiChoroplethe=this.enableChartOffset=!1;this.enableSubThemes=!0;this.szChoropletheInfoStyle="histogram";this.nMaxThemeCharts=5E5;this.nMaxShadowCharts=1E3;this.nflushPaintShape=5E3;this.nflushChartDraw=1E3;this.nColorSchemeMaxHeight=120;this.autoHideInfoTools=this.allwaysShowValues=!1;this.themeDataCacheA=
[]};Map.Themes.prototype=new Map;if("string"==typeof thisversion&&map.checkVersion(thisversion)){map.Themes=new Map.Themes;try{HTMLWindow.ixmaps.htmlgui_onInitThemes()}catch(e$$4){}}else alert("Map.Themes incompatible !");Map.Themes.prototype.addTheme=function(f){this.themesA[this.themesA.length]=f;if(!f.szFlag.match(/selection/i))try{HTMLWindow.ixmaps.htmlgui_onNewTheme(f.szId)}catch(c){}};Map.Themes.prototype.getThemeCount=function(){return this.themesA.length};
Map.Themes.prototype.getAllThemes=function(){return this.themesA};Map.Themes.prototype.isTheme=function(f){for(var c=0;c<this.themesA.length;c++)if(this.themesA[c].szIdStr&&this.themesA[c].szIdStr==f)return this.themesA[c];return!1};
Map.Themes.prototype.newTheme=function(f,c,g,e,h,m,q){c=new MapTheme(f,c,g,e,h,m,q);c.parent=this;this.addTheme(c);c.fRealize=!0;if(fLoadExternalData&&!fAllIncluded)for(f=f.split("|"),g=0;g<f.length;g++)this.loadExternalData(f[g],!1);else executeWithMessage("map.Themes.execute()","... processing ...");return c};
Map.Themes.prototype.newTheme2=function(f,c,g,e,h,m){("undefined"!=typeof f&&"string"!=typeof f||"undefined"!=typeof c&&"string"!=typeof c||"undefined"!=typeof g&&"string"!=typeof g||"undefined"!=typeof e&&"string"!=typeof e||"undefined"!=typeof h&&"string"!=typeof h||"undefined"!=typeof m&&"string"!=typeof m)&&alert("ERROR: only string argument allowed !");var q=f+c+g+e+h+m;if(!e.match(/FORCE/)&&this.isTheme(q))return this.removeTheme(null,this.isTheme(q).szId),null;var l=m&&"undefined"!=m?m.split("|"):
null,r=m=null;if(r=(r=e.split("style="))&&1<r.length?__getStyleObj(r[1]):__getStyleObj(e))m=[5,"white","blue"],r.colorscheme&&(m=r.colorscheme.match(/\|/)||r.colorscheme.match(/RGB/)?r.colorscheme.split("|"):r.colorscheme.split(",")),m=new MapTheme(f,c,g,r.type,m,h,l),m.nOrder=this.getThemeCount(),m.szIdStr=q,this.parseStyle(m,r);this.allwaysShowValues&&(m.szFlag+="|VALUES");m.parent=this;this.addTheme(m);m.fRealize=!0;if(m.coTable)return this.loadExternalData(m.coTable,m.nRefreshTimeout,m),m;if(fLoadExternalData){f=
f.split("|");for(c=0;c<f.length;c++)this.loadExternalData(f[c],m.nRefreshTimeout,m);return m}map.Event.doDefaultZoom();executeWithMessage("map.Themes.execute()","... processing ...");return m};Map.Themes.prototype.isArray=function(f){return"[object Array]"===Object.prototype.toString.call(f)};Map.Themes.prototype.toArray=function(f){return this.isArray(f)?f:f.match(/\|/)?f.split("|"):f.split(",")};Map.Themes.prototype.toString=function(f){return this.isArray(f)?f.join("|"):f};
Map.Themes.prototype.newThemeByObj=function(f){if(map.isIdle()){var c=JSON.stringify(f);if(!f.style.type.match(/FORCE/)&&this.isTheme(c))return this.removeTheme(null,this.isTheme(c).szId),null;var g=null,e=f.style;if(!e)return null;if(this.isArray(e.label))var g=e.label,h=e.label.join("|");else g=(h=e.label)&&"undefined"!=h?h.split("|"):null;h=[5,"white","blue"];e.colorscheme&&(h=this.toArray(e.colorscheme));f.layer=this.toString(f.layer);f.field=this.toString(f.field);g=new MapTheme(f.layer,f.field,
f.field100,e.type,h,e.title,g);g.nOrder=this.getThemeCount();g.szIdStr=c;this.parseStyle(g,e);this.allwaysShowValues&&(g.szFlag+="|VALUES");g.parent=this;this.addTheme(g);g.fRealize=!0;if(g.coTable)return this.loadExternalData(g.coTable,g.nRefreshTimeout,g),g;if(fLoadExternalData){f=f.layer.split("|");for(c=0;c<f.length;c++)this.loadExternalData(f[c],g.nRefreshTimeout,g);return g}map.Event.doDefaultZoom();executeWithMessage("map.Themes.execute()","... processing ...");return g}this.newThemeObj=f;
setTimeout("map.Themes.newThemeByObj(map.Themes.newThemeObj)",100)};
Map.Themes.prototype.parseStyle=function(f,c){if(f&&c){if(c.classes){if(isNaN(Number(f.origColorScheme[0]))){var g=f.origColorScheme[f.origColorScheme.length-1];f.origColorScheme[1]=f.origColorScheme[0];f.origColorScheme[2]=g}f.origColorScheme[0]=Number(c.classes)}c.colorstyle&&"spectrum"==f.origColorScheme[1]&&(f.origColorScheme[2]=c.colorstyle);c.dominantdfilter&&(f.nDominantDFilter=Number(c.dominantdfilter));c.dominantfilter&&(f.szDominantFilter=String(c.dominantfilter));c.filter&&(f.szFilter=
String(c.filter));c.filterfield&&(f.szFilterField=String(c.filterfield));c.filtervalue&&(f.szFilterValue=String(c.filtervalue));c.overviewchart&&(f.szOverviewChart=c.overviewchart);c.evidence&&(f.evidenceMode=c.evidence);c.markclass&&(f.markedClass=c.markclass);c.fillopacity&&("auto"==c.fillopacity?(f.autoOpacity=!0,f.fillOpacity=0):f.fillOpacity=Number(c.fillopacity));c.opacity&&("auto"==c.opacity?(f.autoOpacity=!0,f.fillOpacity=0):f.nOpacity=Number(c.opacity));c.autoopacity&&(f.autoOpacity=!0,f.fillOpacity=
0);f.fShadow=c.shadow?f.fOrigShadow="false"==c.shadow?!1:!0:f.fOrigShadow=!1;c.maxshadow&&(f.nMaxShadowCharts=Number(c.maxshadow));c.blur&&(f.nBlur=Number(c.blur));c.dbtable&&(g=c.dbtable.split(" "),f.coTable=g[0],2==g.length&&(f.coTableType="jsonDB",f.coTableUrl=g[1].split("(")[1].split(")")[0]),3==g.length&&(f.coTableType=g[1],f.coTableUrl=g[2].split("(")[1].split(")")[0]),4==g.length&&(f.coTableType=g[1],f.coTableUrl=g[2].split("(")[1].split(")")[0],f.coTableExt=g[3].split("(")[1].split(")")[0]));
c.dbtableType&&(f.coTableType=c.dbtableType);c.dbtableUrl&&(f.coTableUrl=c.dbtableUrl);c.dbtableExt&&(f.coTableExt=c.dbtableExt);c.lookupfield&&(f.szSelectionField=f.szItemField=c.lookupfield);c.lookuptoupper&&(f.fSelectionFieldToUpper="true"==c.lookuptoupper||c.lookuptoupper);c.lookupsuffix&&(f.szSelectionFieldSuffix=c.lookupsuffix);c.lookupprefix&&(f.szSelectionFieldPrefix=c.lookupprefix);c.itemfield&&(f.szItemField=c.itemfield);c.ranges&&(f.szRangesA=this.toArray(c.ranges),f.szRanges=this.toString(c.ranges));
c.symbols&&(f.szSymbolsA=this.toArray(c.symbols));if(c.values&&(f.szValuesA=this.toArray(c.values),c.type.match(/EXACT/)&&f.szValuesA.length))for(g=0;g<f.szValuesA.length;g++)f.getStringValueIndex(f.szValuesA[g],"set");c.align&&(f.szAlign=c.align);c.units&&(f.szUnits=c.units);c.units100&&(f.szUnits100=c.units100);c.sizevalueunits&&(f.szSizeValueUnits=" "+c.sizevalueunits);c.alphavalueunits&&(f.szAlphaValueUnits=" "+c.alphavalueunits);c.legendunits&&(f.szLegendUnits=" "+c.legendunits);c.labelunits&&
(f.szLabelUnits=" "+c.labelunits);c.xaxis&&(f.szXaxisA=this.toArray(c.xaxis));c.name&&(f.szName=unescape(c.name));c.title&&(f.szTitle=unescape(c.title));c.snippet&&(f.szSnippet=unescape(c.snippet));c.description&&(f.szDescription=unescape(c.description));c.label&&(f.szLabelA=f.szOrigLabelA=this.toArray(c.label));c.weights&&(f.szWeightsA=this.toArray(c.weights),f.szWeights=this.toString(c.weights));c.weight&&(f.szWeightsA=[c.weights],f.szWeights=c.weight);c.scale&&(f.nScale=Number(c.scale));c.valuefield&&
(f.szValueField=c.valuefield);c.labelfield&&(f.szLabelField=c.labelfield);c.titlefield&&(f.szTitleField=c.titlefield);c.snippetfield&&(f.szSnippetField=c.snippetfield);c.sizefield&&(f.szSizeField=c.sizefield);c.alphafield&&(f.szAlphaField=c.alphafield);c.alphafield100&&(f.szAlphaField100=c.alphafield100);c.refresh&&(f.nRefreshTimeout=1E3*Number(c.refresh));c.buffersize&&(f.nBufferSize=c.buffersize);c.bufferstep&&(f.nBufferSizeStep=c.bufferstep);c.field100min&&(f.nField100Min=c.field100min);c.fractionscale&&
(f.nFractionScale=c.fractionscale);c.minvalue&&(f.nMinValue=c.minvalue);c.maxvalue&&(f.nMaxValue=c.maxvalue);c.showdata&&(f.fShowData="true"==c.showdata||c.showdata);c.datacache&&(f.fDataCache="true"==c.datacache);c.editor&&(f.fEditor="true"==c.editor);c.datafields&&(f.szDataFieldsA=this.toArray(c.datafields));c.textcolor&&(f.szTextColor=c.textcolor);c.textfont&&(f.szTextFont=c.textfont);c.linecolor&&(f.szLineColor=c.linecolor);c.linewidth&&(f.nLineWidth=c.linewidth);c.bordercolor&&(f.szBorderColor=
c.bordercolor);c.borderstyle&&(f.szBorderStyle=c.borderstyle);c.borderwidth&&(f.szBorderWidth=c.borderwidth);c.borderradius&&(f.nBorderRadius=Number(c.borderradius));c.boxcolor&&(f.szBoxColor=c.boxcolor);c.boxopacity&&(f.nBoxOpacity=c.boxopacity);c.boxmargin&&(f.nBoxMargin=c.boxmargin);c.textplacement&&(f.szTextPlacement=c.textplacement);c.infotitle&&(f.szInfoTitle=c.infotitle);c.exclude&&(f.szExcludeA=this.toArray(c.exclude));c.aggregation&&(f.szAggregation=c.aggregation);c.rangecentervalue&&(f.nRangeCenterValue=
Number(c.rangecentervalue));c.rangescale&&(f.nRangeScale=c.rangescale);c.normalsizevalue&&(f.nNormalSizeValue=c.normalsizevalue);c.normalsizescale&&(f.szNormalSizeScale=c.normalsizescale,f.nNormalSizeScale=Number(f.szNormalSizeScale.split(":")[1]));c.nodatacolor&&(f.szNoDataColor=__getSaveColor(c.nodatacolor));c.labelupper&&(f.szLabelUpper=c.labelupper,f.nLabelUpper=Number(f.szLabelUpper.split(":")[1]));c.valueupper&&(f.szValueUpper=c.valueupper,f.nValueUpper=Number(f.szValueUpper.split(":")[1]));
c.glowupper&&(f.szGlowUpper=c.glowupper,f.nGlowUpper=Number(f.szGlowUpper.split(":")[1]));c.chartupper&&(f.szChartUpper=c.chartupper,f.nChartUpper=Number(f.szChartUpper.split(":")[1]));c.valuescale&&(f.nValueScale=Number(c.valuescale));c.clipframes&&(f.nClipFrames=c.clipframes);c.clipframerate&&(f.nClipTimeout=1/Number(c.clipframerate)*1E3);c.cliplegend&&(f.nClipColorLegend=Number(c.cliplegend));c.clipvaluesize&&(f.nValueSizeMin=Number(c.clipvaluesize));c.minvaluesize&&(f.nValueSizeMin=Number(c.minvaluesize));
c.valuedecimals&&(f.szValueDecimals=c.valuedecimals);c.fadevaluepow&&(f.szFadeValuePow=c.fadevaluepow);c.dopacityscale&&(f.nDopacityScale=c.dopacityscale);c.dopacityramp&&(f.szDopacityRamp=c.dopacityramp);c.dopacitypow&&(f.nDopacityPow=c.dopacitypow);c.fadenegative&&(f.nFadeNegative=Number(c.fadenegative)||.5);c.clipparts&&(f.nClipParts=Number(c.clipparts)||0);c.minsize&&(f.nChartSizeMin=Number(c.minsize)||0);c.minchartsize&&(f.nChartSizeMin=Number(c.minchartsize)||0);c.clipsize&&(f.nChartSizeMin=
Number(c.clipsize)||0);c.showparts&&(f.szShowParts=this.toString(c.showparts),f.szShowPartsA=this.toArray(c.showparts));c.gridx&&(f.nGridX=Number(c.gridx)||1);c.gridwidth&&(String(c.gridwidth).match(/px/)&&(f.nGridWidthPx=parseFloat(c.gridwidth)||50,map.Themes.doChangeThemeStyle(f.szId,"AUTOGRID","add")),f.nGridWidth=Number(c.gridwidth)||0);c.gridmatrix&&(f.nGridMatrix=Number(c.gridmatrix)||20,map.Themes.doChangeThemeStyle(f.szId,"AUTOGRID","add"));c.gridwidthpx&&(f.nGridWidthPx=Number(c.gridwidthpx)||
50,map.Themes.doChangeThemeStyle(f.szId,"AUTOGRID","add"));c.aggregationfield&&(f.szAggregationField=c.aggregationfield);c.aggregationscale&&(f.szAggregationFieldA=this.toArray(c.aggregationscale));c.minaggregation&&(f.nMinAggregation=Number(c.minaggregation)||0);c.userdraw&&(f.userDraw=c.userdraw);c.centerpart&&(f.szCenterPart=this.toString(c.centerpart))}};
Map.Themes.prototype.getAllThemeDefinitionStrings=function(){for(var f=[],c=0;c<this.themesA.length;c++)f.push(this.getThemeDefinitionString(this.themesA[c]));return f};__toRGB=function(f){var c,g;c=parseInt(f.substr(1,2),16);g=parseInt(f.substr(3,2),16);f=parseInt(f.substr(5,2),16);return"RGB("+c+","+g+","+f+")"};__getSaveColor=function(f){try{if("#"==f.charAt(0))return __toRGB(f)}catch(c){}return f};__getSaveColorScheme=function(f){for(var c=0;c<f.length;c++)f[c]=__getSaveColor(f[c]);return f.join("|")};
Map.Themes.prototype.getThemeDefinitionString=function(f){return'map.Api.newMapTheme("'+f.szThemes+'","'+(f.szFields||"")+'","'+(f.szField100||"")+'","type:'+f.szFlag+";colorscheme:"+__getSaveColorScheme(f.origColorScheme)+";"+__maptheme_getStyleString(f)+'");'};Map.Themes.prototype.getMapThemeStyleString=function(f){return(f=this.getTheme(f)||this.activeTheme)&&f.colorScheme?"type:"+f.szFlag+";colorscheme:"+f.colorScheme+";"+__maptheme_getStyleString(f)+"":null};
Map.Themes.prototype.getMapThemeDefinitionObj=function(f){var c=this.getTheme(f)||this.activeTheme;f={};f.layer=c.szThemes;f.field=c.szFields||"";f.field100=c.szField100||"";var g={type:c.szFlag,colorscheme:c.origColorScheme},c=__maptheme_getStyleObj(c);for(a in c)g[a]=c[a];f.style=g;return f};Map.Themes.prototype.getTheme=function(f){for(var c=0;c<this.themesA.length;c++)if(this.themesA[c].szId==f)return this.themesA[c];return this.activeTheme};
Map.Themes.prototype.getThemeIndex=function(f){for(var c=0;c<this.themesA.length;c++)if(this.themesA[c].szId==f)return c};Map.Themes.prototype.refreshTheme=function(f){if(f=this.getTheme(f.split(":")[0])){f.fRealize=!0;if(!fAllIncluded){if(f.coTable){this.loadExternalData(f.coTable,!0,f);return}if(fLoadExternalData){for(var c=szThemes.split("|"),g=0;g<c.length;g++)this.loadExternalData(c[g],!0,f);return}}executeWithMessage("map.Themes.execute()","... processing ...")}};
Map.Themes.prototype.nextClipFrame=function(f){(f=this.getTheme(f.split(":")[0]))&&f.realizeNextClipFrame()};Map.Themes.prototype.setClipFrame=function(f,c){var g=f?this.getTheme(f.split(":")[0]):this.activeTheme;g&&g.setClipFrame(c)};Map.Themes.prototype.pauseClip=function(f){(f=this.getTheme(f.split(":")[0]))&&f.pauseClip()};Map.Themes.prototype.startClip=function(f){(f=this.getTheme(f.split(":")[0]))&&f.startClip()};
Map.Themes.prototype.loadExternalData=function(f,c,g){this.coTableExt||(this.coTableExt=[]);if(f){var e=map.Dictionary.getLocalText("... creating theme ...");c&&(eval(f+".table = null"),e=map.Dictionary.getLocalText("... refreshing theme ..."));this.__test=null;try{eval("this.__test = "+f+".table")}catch(h){try{eval("this.__test = "+f+"_table")}catch(m){}}var q=g.fEditor||!1;this.themeDataCacheA[f]&&((this.themeDataCacheA[f].coTableUrl||g.coTableUrl)&&this.themeDataCacheA[f].coTableUrl!=g.coTableUrl||
(this.themeDataCacheA[f].coTableExt||g.coTableExt)&&this.themeDataCacheA[f].coTableExt!=g.coTableExt||(q=!0));if(this.__test&&q&&0!=g.fDataCache)executeWithMessage("map.Themes.execute()",e),g&&g.coTableExt&&(g.coTableExt=this.coTableExt[g.coTable]);else{if(g&&(g.coTableUrl||g.coTableExt))try{this.themeDataCacheA[f]={coTableUrl:g.coTableUrl,coTableExt:g.coTableExt};this.fWaitingforData=!0;HTMLWindow.ixmaps.htmlgui_loadExternalData(g.coTableUrl,{theme:g,type:g.coTableType,name:g.coTable,ext:g.coTableExt});
this.coTableExt[g.coTable]=g.coTableExt;return}catch(l){}fLocalHost?this.loadExternalDataDefault(f,c,e):this.loadExternalDataZipped(f,c,e)}}};
Map.Themes.prototype.loadExternalDataUrlZipped=function(f,c,g,e){this.fWaitingforData=!0;displayMessage(map.Dictionary.getLocalText("... loading data ..."));var h=new JSLoader;h.finishedCallback="map.Themes.loadExternalDataFinish('"+e+"')";h.errorCallback="map.Themes.loadExternalDataUrl('"+f+"','"+c+"',"+g+",'"+e+"')";h.szMessage=map.Dictionary.getLocalText("... loading data ...");h.loadScript(c+".gz",g)};
Map.Themes.prototype.loadExternalDataUrl=function(f,c,g,e){this.fWaitingforData=!0;displayMessage(map.Dictionary.getLocalText("... loading data ..."));var h=new JSLoader;h.finishedCallback="map.Themes.loadExternalDataFinish('"+e+"')";h.errorCallback="map.Themes.loadExternalDataDefault('"+f+"',"+g+",'"+e+"')";h.szMessage=map.Dictionary.getLocalText("... loading data ...");h.loadScript(c,g)};
Map.Themes.prototype.loadExternalDataZipped=function(f,c,g){this.fWaitingforData=!0;displayMessage(map.Dictionary.getLocalText("... loading data ..."));var e=new JSLoader;e.finishedCallback="map.Themes.loadExternalDataFinish('"+g+"')";e.errorCallback="map.Themes.loadExternalDataDefault('"+f+"',"+c+",'"+g+"')";e.szMessage=map.Dictionary.getLocalText("... loading data ...");e.loadScript(f+".js.gz",c)};
Map.Themes.prototype.loadExternalDataDefault=function(f,c,g){this.fWaitingforData=!0;displayMessage(map.Dictionary.getLocalText("... loading data ..."));var e=new JSLoader;e.finishedCallback="map.Themes.loadExternalDataFinish('"+g+"')";e.errorCallback="map.Themes.loadExternalDataFinish('"+g+"')";e.szMessage=map.Dictionary.getLocalText("... loading data ...");e.loadScript(f+".js",c)};
Map.Themes.prototype.loadExternalDataFinish=function(f){this.fWaitingforData=!1;executeWithMessage("map.Themes.execute()",f)};Map.Themes.prototype.activateTheme=function(f,c){var g=this.getTheme(c.split(":")[0]);g&&(g.fRedraw=!0,executeWithMessage("map.Themes.execute()","... processing ..."));f.stopPropagation();f.preventDefault()};
Map.Themes.prototype.removeTheme=function(f,c){var g=this.getTheme(c.split(":")[0]);g&&(g.szFlag.match(/CHART/)&&(g.fToggle=!0),g.fRemove=!0,executeWithMessage("map.Themes.execute()","... processing ..."));f&&(f.stopPropagation(),f.preventDefault())};
Map.Themes.prototype.removeAll=function(f){for(var c=0;c<this.themesA.length;c++)this.themesA[c].szFlag.match(/LOCKED/)||(this.themesA[c].fRemove=!this.themesA[c].fRealize);executeWithMessage("map.Themes.execute()","... processing ...");f&&(f.stopPropagation(),f.preventDefault())};
Map.Themes.prototype.removeAllCharts=function(f){for(var c=0;c<this.themesA.length;c++)this.themesA[c].szFlag.match(/CHART/)&&!this.themesA[c].szFlag.match(/LOCKED/)&&(this.themesA[c].fRemove=!this.themesA[c].fRealize);executeWithMessage("map.Themes.execute()","... processing ...");f&&(f.stopPropagation(),f.preventDefault())};
Map.Themes.prototype.removeAllChoroplethe=function(f){for(var c=0;c<this.themesA.length;c++)this.themesA[c].szFlag.match(/CHOROPLETHE/)&&!this.themesA[c].szFlag.match(/LOCKED/)&&(this.themesA[c].fRemove=!this.themesA[c].fRealize);executeWithMessage("map.Themes.execute()","... processing ...");f&&(f.stopPropagation(),f.preventDefault())};
Map.Themes.prototype.removeAllSelections=function(f){for(var c=0;c<this.themesA.length;c++)this.themesA[c].szFlag.match(/SELECTION/)&&(this.themesA[c].fRemove=!0);executeWithMessage("map.Themes.execute()","... processing ...");f&&(f.stopPropagation(),f.preventDefault())};Map.Themes.prototype.redrawInfoAll=function(f){for(var c=0;c<this.themesA.length;c++)this.themesA[c].fRedrawInfo=!0;executeWithMessage("map.Themes.execute()","... processing ...");f&&(f.stopPropagation(),f.preventDefault())};
Map.Themes.prototype.reformat=function(f){for(var c=this.minY=this.minX=0;c<this.themesA.length;c++)this.themesA[c].fRepositionInfo=!0,this.themesA[c].fRedrawInfo=!0;executeWithMessage("map.Themes.execute()","... processing ...");f&&(f.stopPropagation(),f.preventDefault())};
Map.Themes.prototype.execute=function(){var f=!1,c=0;if(!this.fWaitingforData)if(map.Tiles.isLoading())setTimeout("map.Themes.execute()",250),this.fExecuteDelayed=!0;else if(this.fExecuteDelayed)this.fExecuteDelayed=!1,executeWithMessage("map.Themes.execute()","... processing ...");else{for(c=0;c<this.themesA.length;c++)(this.themesA[c].fRealize||this.themesA[c].fRedraw||this.themesA[c].fToFront)&&this.themesA[c].szFlag.match(/CHOROPLETHE/)&&!this.themesA[c].szFlag.match(/SUBTHEME/)&&(f=this.themesA[c].szShapeType);
if(f&&this.enableMultiChoroplethe)for(c=0;c<this.themesA.length;c++)this.themesA[c].szFlag&&this.themesA[c].szFlag.match(/CHOROPLETHE/)&&this.themesA[c].szShapeType==f&&(this.themesA[c].disable(),this.themesA[c].isVisible=!1,this.themesA[c].fRedrawInfo=!1);if(f&&!this.enableMultiChoroplethe)for(c=0;c<this.themesA.length;c++)!this.themesA[c].szFlag||!this.themesA[c].szFlag.match(/CHOROPLETHE/)||this.themesA[c].szShapeType!=f||this.themesA[c].fRealize||this.themesA[c].fRedraw||this.themesA[c].fToFront||
(this.themesA[c].fRemove=!0);for(c=0;c<this.themesA.length;c++){if(this.themesA[c].fToggle){this.themesA[c].toggle();this.themesA[c].fToggle=!1;this.execute();break}if(this.themesA[c].fRemove){1<this.themesA.length&&!this.themesA[c].szFlag.match(/SELECTION/)&&!this.themesA[c].szFlag.match(/CHART/)&&this.activateNextPaint(this.themesA[c]);this.themesA[c].removeElements();this.remove(this.themesA[c]);this.reformat();this.execute();break}if(this.themesA[c].fRealize)this.themesA[c].fRedraw=!1,this.themesA[c].fEnableProgressBar=
!0,setTimeout("map.Themes.showProgressBar()",5E3),this.themesA[c].fRealize=!1,this.themesA[c].realize();else if(this.themesA[c].fRedraw)this.themesA[c].checkHiddenLayerState&&this.themesA[c].checkHiddenLayerState()?(this.themesA[c].fRealize=!0,this.themesA[c].fRedraw=!1,this.themesA[c].fReload=!1,this.themesA[c].unpaintMap(),map.Themes.execute()):(this.themesA[c].fEnableProgressBar=!0,this.themesA[c].redraw(!1));else if(this.themesA[c].fActualize)this.themesA[c].fActualize=!1,this.themesA[c].checkHiddenLayerState&&
this.themesA[c].checkHiddenLayerState()?(this.themesA[c].fRealize=!0,this.themesA[c].fRedraw=!1,this.themesA[c].fReload=!1,this.themesA[c].unpaintMap(),map.Themes.execute()):(this.themesA[c].fEnableProgressBar=!0,this.themesA[c].redraw(!1));else if(this.themesA[c].fToFront)this.themesA[c].fEnableProgressBar=!1,this.themesA[c].toFront(),this.themesA[c].fToFront=!1;else if(this.themesA[c].fResize)this.themesA[c].resize(this.themesA[c].fResize),this.themesA[c].fResize=!1;else if(this.themesA[c].fOpacity)this.themesA[c].opacity(this.themesA[c].fOpacity),
this.themesA[c].fOpacity=!1;else if(this.themesA[c].fBlur)this.themesA[c].blur(this.themesA[c].nBlur),this.themesA[c].fBlur=!1;else if(this.themesA[c].fOffset)this.themesA[c].offset(this.themesA[c].fOffset),this.themesA[c].fOffset=!1;else if(this.themesA[c].fRedrawInfo)this.themesA[c].widgetNode&&this.themesA[c].showInfo(),this.themesA[c].fRedrawInfo=!1;else if(this.themesA[c].fResort){try{this.themesA[c].sortChartObjects()}catch(g){}this.themesA[c].fResort=!1}}this.executeCallback&&(eval(this.executeCallback),
this.executeCallback=null);clearMessage(100);clearMessage(1E3)}};Map.Themes.prototype.continueExecute=function(){for(var f=0;f<this.themesA.length;f++)this.themesA[f].fAggregate?(this.themesA[f].fAggregate=!1,this.themesA[f].realize_aggregate()):this.themesA[f].fDraw?(this.themesA[f].fDraw=!1,this.themesA[f].realize_draw()):this.themesA[f].fContinue&&(this.themesA[f].fContinue=!1,this.themesA[f].realizeContinue(this.themesA[f].continueIndex))};
Map.Themes.prototype.realizeDone=function(f){for(var c=0;c<this.themesA.length;c++)this.themesA[c].szFlag.match(/SELECTION/)&&(this.themesA[c].fRealize=!0);f.fRealizeDone=!0;try{HTMLWindow.ixmaps.htmlgui_onDrawTheme(f.szId)}catch(g){}f.szFlag.match(/TEXTONLY/)&&setTimeout("map.Layer.adaptLabel()",10)};
Map.Themes.prototype.showProgressBar=function(){for(var f=0;f<this.themesA.length;f++)(this.themesA[f].fRealize||this.themesA[f].fContinue||this.themesA[f].fAggregate||this.themesA[f].fDraw)&&2<this.themesA[f].nCount/this.themesA[f].nDoneCount&&this.themesA[f].mapSleep?this.themesA[f].mapSleep.fShowProgressBar=!0:(this.themesA[f].fRealize||this.themesA[f].fContinue||this.themesA[f].fAggregate||this.themesA[f].fDraw)&&setTimeout("map.Themes.showProgressBar()",1E3)};
Map.Themes.prototype.remove=function(f){f==this.activeTheme&&(this.activeTheme=null);f==this.activeBuffer&&(this.activeBuffer=null);for(var c=0;c<this.themesA.length;c++)if(this.themesA[c]==f){for(;c<this.themesA.length-1;c++)this.themesA[c]=this.themesA[c+1];this.themesA.length--}};Map.Themes.prototype.cancelExecute=function(){this.activeTheme.fCancel=!0};Map.Themes.prototype.sequence=function(){this.sequenceNr=0;this.sequenceNext()};
Map.Themes.prototype.sequenceNext=function(){this.sequenceNr<this.themesA.length&&(this.themesA[this.sequenceNr].fRedraw=!0,map.Themes.executeCallback="setTimeout('map.Themes.sequenceNext()',500)",map.Themes.execute(),this.sequenceNr++)};
Map.Themes.prototype.activateNextPaint=function(f){f=this.getThemeIndex(f.szId);for(var c=f-1;c!=f;c--){0>c&&(c=this.themesA.length-1);if(c==f)break;if(this.themesA[c].isChecked&&!this.themesA[c].szFlag.match(/CHART/))return this.themesA[c].fRedraw=!0,this.themesA[c].fRedrawInfo=!1,!0}return!1};Map.Themes.prototype.toggleThemeValues=function(f,c){this.toggleValueDisplay(f,this.activeTheme.szId,!this.activeTheme.szFlag.match(/VALUES/))};
Map.Themes.prototype.toggleThemeLegends=function(f,c){SVGThemeGroup.style.setProperty("display",c?"inline":"none","")};Map.Themes.prototype.minimizeThemeLegends=function(f){this.fMinimizedLegends=!0;for(var c=0;c<this.themesA.length;c++)this.minimizeInfo(f,this.themesA[c].szId)};Map.Themes.prototype.changeAllChartScaling=function(f,c){for(var g=0;g<this.themesA.length;g++)this.themesA[g].fResize=999,executeWithMessage("map.Themes.execute()","... processing ...");f.stopPropagation();f.preventDefault()};
Map.Themes.prototype.changeChartScaling=function(f,c,g){if(c=this.getTheme(c.split(":")[0]))c.fResize=g,executeWithMessage("map.Themes.execute()","... processing ...");f.stopPropagation();f.preventDefault()};Map.Themes.prototype.changeChartOpacity=function(f,c,g){if(c=this.getTheme(c.split(":")[0]))c.fOpacity=g,executeWithMessage("map.Themes.execute()","... processing ...");f.stopPropagation();f.preventDefault()};
Map.Themes.prototype.changeChartOffset=function(f,c,g){if((f=this.getTheme(c.split(":")[0]))&&f.leadOffset&&(g=SVGDocument.getElementById(g))){g.fu=new Methods(g);c=g.fu.getPosition();var e=g.fu.getGroupScale();f.fOffset=new point(c.x-f.leadOffset.x,c.y-f.leadOffset.y);g.fu.setPosition(f.leadOffset.x,f.leadOffset.y);f.fOffset.x/=map.Zoom.nZoom/e.x;f.fOffset.y/=map.Zoom.nZoom/e.y;f.offset(f.fOffset);f.fOffset=!1;f.leadOffset=!1}};
Map.Themes.prototype.tellChartOffset=function(f,c,g){(f=this.getTheme(c.split(":")[0]))&&!f.leadOffset&&this.enableChartOffset&&(g=SVGDocument.getElementById(g))&&(g.fu=new Methods(g),f.leadOffset=g.fu.getPosition())};
Map.Themes.prototype.initChartOffset=function(f,c,g){if(this.getTheme(c.split(":")[0])){var e=SVGDocument.getElementById(g);e&&(e.origPosition||(e.origPosition=e.fu.getPosition()),e.onMouseMove=function(c){e.actualPosition=e.fu.getPosition();map.Themes.makeChartOffsetPointer(e)},e.widgetObj=new Widget(e,e))}};Map.Themes.prototype.endChartOffset=function(f,c,g){this.getTheme(c.split(":")[0])&&(f=SVGDocument.getElementById(g))&&f.widgetObj.remove()};
Map.Themes.prototype.makeChartOffsetPointer=function(f){f.pointerObj?(map.Dom.clearGroup(f.pointerObj),map.Dom.clearGroup(f.pointShObj)):(f.pointerObj=map.Dom.newGroup(f),f.pointShObj=map.Dom.newGroup(f),f.pointerObj.parentNode.insertBefore(f.pointerObj,f.pointerObj.parentNode.firstChild),f.pointShObj.parentNode.insertBefore(f.pointShObj,f.pointShObj.parentNode.firstChild));if(f.origPosition||f.actualPosition){var c=new box(0,0,100,75),g=new point(f.actualPosition.x-f.origPosition.x,f.actualPosition.y-
f.origPosition.y),e=map.Scale.normalX(15),h=map.Scale.normalX(5),m=map.Scale.normalX(10);map.Scale.normalX(5);h=g.y+c.height/2;e=g.x+c.width/2;Math.abs(h)+c.width/2-c.height/2>Math.abs(e)?(c.width/3>m&&(g.x>-c.width/3&&(e-=c.width/3),g.x<-c.width/3*2&&(e+=c.width/3)),0<h?(map.Dom.newShape("path",f.pointShObj,"M"+-g.x+","+-g.y+" l "+(e-map.Scale.normalX(5))+","+(g.y+map.Scale.normalX(1))+" "+map.Scale.normalX(4)+",0 z","fill:black;fill-opacity:0.5"),map.Dom.newShape("path",f.pointerObj,"M"+-g.x+","+
-g.y+" l "+(e-map.Scale.normalX(5))+","+(g.y+map.Scale.normalX(1))+" "+map.Scale.normalX(3)+",0 z","fill:red")):(map.Dom.newShape("path",f.pointShObj,"M"+-g.x+","+-g.y+" l "+(e-map.Scale.normalX(4))+","+(g.y+c.height)+" "+map.Scale.normalX(4)+",0 z","fill:black;fill-opacity:0.5"),map.Dom.newShape("path",f.pointerObj,"M"+-g.x+","+-g.y+" l "+(e-map.Scale.normalX(4))+","+(g.y+c.height)+" "+map.Scale.normalX(3)+",0 z","fill:red"))):(c.height/5>m&&(g.y>-c.height/3&&(h-=c.height/3),g.y<-c.height/3*2&&(h+=
c.height/3)),0<e?(map.Dom.newShape("path",f.pointShObj,"M"+-g.x+","+-g.y+" l "+(g.x-c.width)+","+(h-map.Scale.normalX(4))+" 0,"+map.Scale.normalX(4)+" z","fill:black;fill-opacity:0.5"),map.Dom.newShape("path",f.pointerObj,"M"+-g.x+","+-g.y+" l "+(g.x-c.width)+","+(h-map.Scale.normalX(4))+" 0,"+map.Scale.normalX(3)+" z","fill:red")):(map.Dom.newShape("path",f.pointShObj,"M"+-g.x+","+-g.y+" l "+(g.x+c.width)+","+(h-map.Scale.normalX(4))+" 0,"+map.Scale.normalX(4)+" z","fill:black;fill-opacity:0.5"),
map.Dom.newShape("path",f.pointerObj,"M"+-g.x+","+-g.y+" l "+(g.x+c.width)+","+(h-map.Scale.normalX(4))+" 0,"+map.Scale.normalX(3)+" z","fill:red")))}};
Map.Themes.prototype.setChartSizeType=function(f,c,g){if(c=this.getTheme(c.split(":")[0])){for(var e="",h=c.szFlag.split("|"),m=0;m<h.length;m++)"SIZE"==h[m]||"FIXSIZE"==h[m]||"NOSIZE"==h[m]||"HEIGHT"==h[m]||"3D"==h[m]&&"2D"==g||(e+=(e.length?"|":"")+h[m]);executeWithMessage("map.Themes.doChangeThemeStyle('"+c.szId+"','type:"+(e+("|"+g))+"')","... processing ...")}f.stopPropagation();f.preventDefault()};
Map.Themes.prototype.toggleValueDisplay=function(f,c,g){if(c=this.getTheme(c.split(":")[0])){for(var e="",h=c.szFlag.split("|"),m=0;m<h.length;m++)"VALUES"!=h[m]&&(e+=(e.length?"|":"")+h[m]);g&&(e+="|VALUES");executeWithMessage("map.Themes.doChangeThemeStyle('"+c.szId+"','type:"+e+"')","... processing ...")}f&&(f.stopPropagation(),f.preventDefault())};
Map.Themes.prototype.toggleDopacity=function(f,c,g){if(c=this.getTheme(c.split(":")[0])){for(var e="",h=c.szFlag.split("|"),m=0;m<h.length;m++)h[m].match(/DOPACITY/)||(e+=(e.length?"|":"")+h[m]);g&&(e+="|DOPACITYMAX");executeWithMessage("map.Themes.doChangeThemeStyle('"+c.szId+"','type:"+e+"')","... processing ...")}f&&(f.stopPropagation(),f.preventDefault())};
Map.Themes.prototype.changeDopacityAlphaRamp=function(f,c,g){if(c=this.getTheme(c.split(":")[0])){var e=c.szFlag;c.nDopacityScale=c.nDopacityScale||1;c.nDopacityScale*=g;executeWithMessage("map.Themes.doChangeThemeStyle('"+c.szId+"','type:"+e+"')","... processing ...")}f&&(f.stopPropagation(),f.preventDefault())};
Map.Themes.prototype.toggleChartDisplay=function(f,c,g){if(c=this.getTheme(c.split(":")[0]))c.fToggle=!0,executeWithMessage("map.Themes.execute()","... processing ...");f.stopPropagation();f.preventDefault()};Map.Themes.prototype.zoomToClass=function(f,c,g,e){setTimeout("map.Themes.doZoomToClass('"+c+"','"+g+"','"+e+"')",100)};
Map.Themes.prototype.markClass=function(f,c,g,e){var h=this.getTheme(c.split(":")[0]);h&&h.isVisible&&!h.showInfoMore&&("undefined"!=typeof h.markedClass&&h.markedClass==g?this.unmarkClass(f,c):(h.markedClass=g,h.fMarkEnable=!0,h.fUnmarkEnable=!1,this.markTimeout&&clearTimeout(this.markTimeout),this.unmarkTimeout&&clearTimeout(this.unmarkTimeout),displayMessage("...",1E3,!0),this.markTimeout=setTimeout("map.Themes.doMarkClass('"+c+"','"+g+"','"+e+"')",500)))};
Map.Themes.prototype.unmarkClass=function(f,c){var g=this.getTheme(c.split(":")[0]);g&&g.isVisible&&!g.showInfoMore&&(g.markedClass=null,displayMessage("...",1E3,!0),this.unmarkTimeout=setTimeout("map.Themes.doUnmarkClass('"+c+"')",500),g.fUnmarkEnable=!0,g.fMarkEnable=!1)};Map.Themes.prototype.doZoomToClass=function(f,c,g){(f=this.getTheme(f.split(":")[0]))&&f.zoomToClass(Number(c),Number(g))};
Map.Themes.prototype.doMarkClass=function(f,c,g){if(f=this.getTheme(f.split(":")[0])){f.markClass(Number(c),Number(g));try{HTMLWindow.ixmaps.htmlgui_onDrawTheme(f.szId)}catch(e){}}};Map.Themes.prototype.doUnmarkClass=function(f){if(this.subTheme)this.subTheme.removeSubTheme(),this.subTheme=null;else if(f=this.getTheme(f.split(":")[0])){f.unmarkClass();try{HTMLWindow.ixmaps.htmlgui_onDrawTheme(f.szId)}catch(c){}}};
Map.Themes.prototype.hideClass=function(f,c,g,e){(f=this.getTheme(c.split(":")[0]))&&f.isVisible&&f.showClass(Number(g),Number(e),!1)};Map.Themes.prototype.showClass=function(f,c,g,e){(f=this.getTheme(c.split(":")[0]))&&f.isVisible&&f.showClass(Number(g),Number(e),!0)};
Map.Themes.prototype.filterItems=function(f,c,g,e){(f=c?this.getTheme(c.split(":")[0]):this.activeTheme)&&f.isVisible&&!f.showInfoMore&&(f.fMarkEnable=!0,f.fUnmarkEnable=!1,this.markTimeout&&clearTimeout(this.markTimeout),this.unmarkTimeout&&clearTimeout(this.unmarkTimeout),this.opt=e,this.markTimeout=setTimeout("map.Themes.doFilterItems('"+c+"','"+g+"')",500))};Map.Themes.prototype.doFilterItems=function(f,c){executeWithMessage("map.Themes.doFilterItemsGo('"+f+"','"+c+"')","applying filter ...")};
Map.Themes.prototype.doFilterItemsGo=function(f,c){var g=this.getTheme(f.split(":")[0]);g&&(g.filterItems(c,this.opt),this.activeTheme=g)};Map.Themes.prototype.selectFilterItems=function(f,c){var g=this.getTheme(c.split(":")[0]);g&&g.selectFilterItems()};Map.Themes.prototype.chartTypeMenu=function(f,c,g,e){if(f=c?this.getTheme(c.split(":")[0]):map.Themes.activeTheme)f.szFlag.match(/CHART/),f.chartMenu(g,e,"chart")};
Map.Themes.prototype.chartColorMenu=function(f,c,g,e){(f=this.getTheme(c.split(":")[0]))&&f.chartMenu(g,e,"variation")};Map.Themes.prototype.toggleMore=function(f,c){var g=this.getTheme(c.split(":")[0]);g&&(g.showInfoMore=!g.showInfoMore,g.unmarkClass(),g.fRedrawInfo=!0,g.ptWidget&&g.ptWidget.x==g.widgetNode.fu.getPosition().x&&(g.fRepositionInfo=!0),map.Themes.execute())};
Map.Themes.prototype.exitMore=function(f,c){var g=this.getTheme(c.split(":")[0]);g&&(g.showInfoMore=!1,g.unmarkClass(),g.fRedrawInfo=!0,g.ptWidget&&g.ptWidget.x==g.widgetNode.fu.getPosition().x&&(g.fRepositionInfo=!0),map.Themes.execute())};
Map.Themes.prototype.onclickInfo=function(f,c){var g=f.target.getAttributeNS(null,"id");if(g&&g.match(/background/)){var g=SVGDocument.getElementById(c+":display:widget:infobuttons"),e=g.style.getPropertyValue("display"),h=this.getTheme(c.split(":")[0]);"none"==e?(g.style.setProperty("display","inline",""),this.fMinimized=h.szFlag.match(/MINIMIZED/),this.maximizeInfo(null,c),this.resizeInfo(null,c)):(SVGDocument.getElementById(c+":display:widget:infobuttons").style.setProperty("display","none",""),
this.fMinimized&&(this.fMinimized=null,this.minimizeInfo(null,c)),this.exitMore(null,c))}};Map.Themes.prototype.onoverInfo=function(f,c){this.onInfoOverTimeout=setTimeout("map.Themes.doOnoverInfo(null,'"+c+"')",400);this.onInfoOutTimeout&&clearTimeout(this.onInfoOutTimeout)};
Map.Themes.prototype.doOnoverInfo=function(f,c){var g=SVGDocument.getElementById(c+":display:widget:infobuttons"),e=g.style.getPropertyValue("display");g.style.setProperty("display","inline","");"none"==e&&this.resizeInfo(null,c)};Map.Themes.prototype.ondownInfo=function(f,c){this.onInfoOverTimeout&&clearTimeout(this.onInfoOverTimeout);this.onInfoOutTimeout&&clearTimeout(this.onInfoOutTimeout)};
Map.Themes.prototype.onoutInfo=function(f,c){this.onInfoOutTimeout=setTimeout("map.Themes.doOnoutInfo(null,'"+c+"')",400);this.onInfoOverTimeout&&clearTimeout(this.onInfoOverTimeout)};Map.Themes.prototype.doOnoutInfo=function(f,c){try{SVGDocument.getElementById(c+":display:widget:infobuttons").style.setProperty("display","none",""),this.exitMore(null,c)}catch(g){}};
Map.Themes.prototype.resizeInfo=function(f,c){var g=c+":display:widget",e=SVGDocument.getElementById(g+":backgroundrect:noobject"),g=SVGDocument.getElementById(g+":shadowrect:noobject"),h=e.parentNode,m=map.Dom.getBox(h),q=this.getTheme(c.split(":")[0]);q.removebutton&&q.removebutton.setPosition(m.width-map.Scale.normalX(2),map.Scale.normalY(7));q.maximizebutton&&q.maximizebutton.setPosition(m.width-map.Scale.normalX(map.Scale.nButtonSize+5),map.Scale.normalY(7));q.minimizebutton&&q.minimizebutton.setPosition(m.width-
map.Scale.normalX(map.Scale.nButtonSize+5),map.Scale.normalY(7));q.chartbutton&&q.chartbutton.setPosition(m.width-map.Scale.normalX(2),q.chartbutton.getPosition().y);q.morebutton&&q.morebutton.setPosition(m.width-map.Scale.normalX(2),q.morebutton.getPosition().y-map.Scale.normalY(.2*map.Scale.nButtonSize));m=map.Dom.getBox(h);e.setAttributeNS(null,"x",-map.Scale.normalX(5));e.setAttributeNS(null,"y",-map.Scale.normalY(5));e.setAttributeNS(null,"width",m.width+map.Scale.normalX(5)+map.Scale.normalX(2));
e.setAttributeNS(null,"height",m.height+map.Scale.normalY(5)+map.Scale.normalY(0));g.setAttributeNS(null,"x",-map.Scale.normalX(-3));g.setAttributeNS(null,"y",-map.Scale.normalY(-3));g.setAttributeNS(null,"width",m.width+map.Scale.normalX(5)+map.Scale.normalX(-3));g.setAttributeNS(null,"height",m.height+map.Scale.normalY(5)+map.Scale.normalY(-5))};
Map.Themes.prototype.autoPositionInfo=function(f,c){var g=this.getTheme(c.split(":")[0]);if(g){var e=g.widgetNode.fu.getPosition(),e=map.Scale.clipWidgetObjectToSVG(g.widgetNode,e,new point(0,0),null);g.widgetNode.fu.setPosition(e.x,e.y)}};Map.Themes.prototype.changeThemeStyle=function(f,c,g,e){executeWithMessage("map.Themes.doChangeThemeStyle('"+c+"','"+g+"','"+e+"')","... processing ...");f&&(f.stopPropagation(),f.preventDefault())};
function __calcNewValue(f,c,g){f=f||1;c=c||1;return g&&g.match(/pow/)?Math.pow(f,c):g&&g.match(/factor/)?f*c:g&&(g.match(/add/)||g.match(/delta/))?f+c:c}function __calcFactor(f,c,g){f=f||1;c=c||1;return g&&g.match(/factor/)?c:g&&g.match(/add/)?(f+c)/f:c/f}
Map.Themes.prototype.doChangeThemeStyle=function(f,c,g){var e=this.getTheme(f.split(":")[0])||this.activeTheme;if(e){if(c=__getStyleObj(c)){if(c.type){c.origType=c.type;if(g&&g.match(/add/)){var h=c.type.split("|");this.szTempStyle=e.szFlag;for(var m=0;m<h.length;m++)eval("this.szTempStyle.match(/"+h[m]+"/)")||(this.szTempStyle+="|"+h[m]);c.type=this.szTempStyle}else if(g&&g.match(/remove/)){for(var h=e.szFlag.split("|"),q="",m=0;m<h.length;m++)h[m]!=c.type&&(q+=(q.length?"|":"")+h[m]);c.type=q}else if(g&&
g.match(/toggle/)){for(var h=e.szFlag.split("|"),q="",l=!1,m=0;m<h.length;m++)h[m]!=c.type?q+=(q.length?"|":"")+h[m]:l=!0;c.type=q+(l?"":"|"+c.type)}else{if(c.type.match(/CHART/)&&!e.szFlag.match(/CHART/)||c.type.match(/CHOROPLETHE/)&&!e.szFlag.match(/CHOROPLETHE/))e.unpaintMap(),this.activateNextPaint(e);e.szFlag.match(/FRACTION/)&&(c.type+="|FRACTION");e.szFlag.match(/PERMILLE/)&&(c.type+="|PERMILLE");e.szFlag.match(/CALCVAL/)&&(c.type+="|CALCVAL");e.szFlag.match(/CALC100/)&&(c.type+="|CALC100");
e.szFlag.match(/PRODUCT/)&&(c.type+="|PRODUCT");e.szFlag.match(/RELATIVE/)&&(c.type+="|RELATIVE");e.szFlag.match(/INVERT/)&&(c.type+="|INVERT");e.szFlag.match(/INVERTSIZE/)&&(c.type+="|INVERTSIZE");e.szFlag.match(/DENSITY/)&&(c.type+="|DENSITY");e.szFlag.match(/SUM/)&&(c.type+="|SUM");e.szFlag.match(/CALCMEAN/)&&(c.type+="|CALCMEAN");e.szFlag.match(/AUTO100/)&&(c.type+="|AUTO100");if(c.type.match(/EQUIDISTANT/)||c.type.match(/LOG/)||c.type.match(/QUANTILE/))e.szOldRanges=e.szRanges?e.szRanges:e.szOldRanges,
e.szRanges=null,e.szOldLabelA=e.szLabelA?e.szLabelA:e.szOldLabelA,e.szLabelA=null;c.type.match(/RANGES/)&&(e.szRanges=e.szOldRanges?e.szOldRanges:e.szRanges,e.szRangesA=c.ranges.split(c.ranges.match(/\|/)?"|":","),e.szLabelA=e.szOldLabelA?e.szOldLabelA:e.szLabelA,Number(e.origColorScheme[0])&&e.szRanges&&(e.origColorScheme[0]=e.szRangesA.length-1))}m=e.szFlag;e.szFlag=c.type;!e.szFlag.match(/CHART/)||e.szFlag.match(/BUFFER/)||m.match(/CHART/)||(e.fShadow=e.fOrigShadow=!0);c.origType.match(/AGGREGATE/)||
c.origType.match(/RECT/)?(e.fRealize=!0,e.fRedraw=!1,e.unpaintMap(),e.themeNodesPosA=[]):(e.fRedraw=!0,e.fRedrawInfo=!0)}else if(g&&g.match(/remove/)){for(p in c)for(s in themeStyleTranslateA)themeStyleTranslateA[s].style==p&&(e[themeStyleTranslateA[s].obj]=null);map.Themes.unmarkClass(null,f);e.fReload=!0;e.fRealize=!0;executeWithMessage("map.Themes.execute()","... processing ...");return}c.classes&&(isNaN(Number(e.origColorScheme[0]))&&(e.origColorScheme[3]=e.origColorScheme[e.origColorScheme.length/
2],e.origColorScheme[4]="2colors",m=e.origColorScheme[e.origColorScheme.length-1],e.origColorScheme[1]=e.origColorScheme[0],e.origColorScheme[2]=m),e.origColorScheme[0]=Number(c.classes),e.szFlag.match(/CHART/)&&e.unpaintMap(),e.szOldRanges=e.szRanges,e.szRanges=null,e.fRealize=!0);c.ranges&&(e.szRanges=c.ranges,e.szRangesA=c.ranges.split(c.ranges.match(/\|/)?"|":","),e.fRealize=!0);c.colorstyle&&"spectrum"==e.origColorScheme[1]&&(e.origColorScheme[2]=c.colorstyle,e.szFlag.match(/CHART/)&&e.unpaintMap(),
e.fRealize=!0);c.colordef&&(e.origColorScheme=c.colordef.match(/\|/)?c.colordef.split("|"):c.colordef.split(","));if(c.colorscheme&&(h=c.colorscheme.match(/\|/)?c.colorscheme.split("|"):c.colorscheme.split(","))&&h.length){isNaN(Number(e.origColorScheme[0]))&&(e.origColorScheme[0]=e.origColorScheme.length);e.origColorScheme.length=1;for(m=0;5>m;m++)e.origColorScheme[m+1]=m<h.length?h[m]:null;try{e.colorScheme=ColorScheme.createColorScheme(e.origColorScheme[1],e.origColorScheme[2],e.origColorScheme[0],
e.origColorScheme[3],e.origColorScheme[4])}catch(r){e.colorScheme=e.defaultColorScheme}e.fRedraw=!0;e.szFlag.match(/CHART/)||(e.fRealize=!0);e.fRedrawInfo=!0;e.showInfo()}if(c.colorschemegeneration&&!isNaN(Number(e.origColorScheme[0]))){switch(c.colorschemegeneration){case "warm":e.origColorScheme[4]="#FFFDD8";break;case "cold":e.origColorScheme[4]="#FFFFFF";break;default:e.origColorScheme[4]=c.colorschemegeneration}e.szFlag.match(/CHART/)&&e.unpaintMap();try{e.colorScheme=ColorScheme.createColorScheme(e.origColorScheme[1],
e.origColorScheme[2],e.origColorScheme[0],e.origColorScheme[3],e.origColorScheme[4])}catch(w){e.colorScheme=e.defaultColorScheme}e.fRedraw=!0;e.fRedrawInfo=!0}c.symbols&&(e.szSymbolsA=c.symbols.split(c.symbols.match(/\|/)?"|":","),e.fRealize=!0);c.dominantdfilter&&(e.nDominantDFilter=Number(c.dominantdfilter),e.fRealize=!0);c.dominantfilter&&(e.szDominantFilter=String(c.dominantfilter),e.fRealize=!0);c.filter&&(g&&g.match(/remove/)?e.szFilter="":e.szFilter=String(c.filter),e.fRealize=!0,e.unpaintMap());
c.filterfield&&(e.szFilterField=String(c.filterfield),e.fRealize=!0);c.field100min&&(e.nField100Min=c.field100min,e.fRealize=!0);c.overviewchart&&!e.szFlag.match(/CHART/)&&(e.szOverviewChart=c.overviewchart,e.fRedrawInfo=!0);c.evidence&&(e.evidenceMode=c.evidence);c.aggregation&&(e.szAggregation=c.aggregation);c.opacity&&(e.fOpacity=__calcNewValue(e.fOpacity,Number(c.opacity),g));c.fillopacity&&(e.fillOpacity=__calcNewValue(e.fillOpacity,Number(c.fillopacity),g),e.fillOpacity=Math.min(Math.max(e.fillOpacity,
.001),1),e.fRedraw=!0);c.shadow&&(e.fShadow="toggle"==c.shadow?e.fOrigShadow=!e.fOrigShadow:e.fOrigShadow="false"==c.shadow?!1:!0,e.fRedraw=!0);c.blur&&("toggle"==c.blur?e.nBlur?(e.nOldBlur=e.nBlur,e.nBlur=0):e.nBlur=e.nOldBlur||1:e.nBlur=__calcNewValue(e.nBlur,Number(c.blur),g),e.fBlur=!0);c.scale&&(e.fResize=__calcFactor(e.nScale,Number(c.scale),g));c.dopacityscale&&(e.nDopacityScale=__calcNewValue(e.nDopacityScale,Number(c.dopacityscale),g),e.fRealize=!0);c.d_dopacityscale&&(e.nDopacityScale*=
Number(c.d_dopacityscale),e.fRealize=!0);c.alphafield&&(e.szAlphaField=String(c.alphafield),e.fRealize=!0);c.alphafield100&&(e.szAlphaField100=String(c.alphafield100),e.fRealize=!0);c.dopacityramp&&(e.szDopacityRamp=c.dopacityramp,e.fRealize=!0);c.dopacitypow&&(e.nDopacityPow=__calcNewValue(e.nDopacityPow,Number(c.dopacitypow),g),e.fRealize=!0);c.rangescale&&(e.nRangeScale=__calcNewValue(e.nRangeScale||1,Number(c.rangescale),g),e.fRedraw=!0);c.sizefield&&(e.szSizeField=String(c.sizefield),e.fRealize=
!0);c.labelfield&&(e.szLabelField=String(c.labelfield),e.fRealize=!0);c.valuefield&&(e.szValueField=String(c.valuefield),e.fRealize=!0);c.normalsizevalue&&(e.nNormalSizeValue||(e.nNormalSizeValue=e.szSizeField?e.nMaxSize:e.nMax),e.nNormalSizeValue=__calcNewValue(e.nNormalSizeValue,Number(c.normalsizevalue),g),e.fRedraw=!0);c.valuedecimals&&(e.szValueDecimals=c.valuedecimals,e.fRedraw=!0);c.minvaluesize&&(e.nValueSizeMin=__calcNewValue(e.nValueSizeMin,Number(c.minvaluesize),g),e.fRedraw=!0);c.clipvaluesize&&
(e.nValueSizeMin=__calcNewValue(e.nValueSizeMin,Number(c.clipvaluesize),g),e.fRedraw=!0);c.minsize&&(e.nChartSizeMin=__calcNewValue(e.nChartSizeMin,Number(c.minsize),g),e.fRedraw=!0);c.minchartsize&&(e.nChartSizeMin=__calcNewValue(e.nChartSizeMin,Number(c.minchartsize),g),e.fRedraw=!0);c.clipsize&&(e.nChartSizeMin=__calcNewValue(e.nChartSizeMin,Number(c.clipsize),g),e.fRedraw=!0);c.clipparts&&(e.nClipParts=Number(c.clipparts),e.fRedraw=!0);c.showparts&&(e.szShowParts=c.showparts,e.szShowPartsA=c.showparts.split(c.showparts.match(/\|/)?
"|":","),map.Themes.unmarkClass(null,f),e.fRedraw=!0);c.gridx&&(e.nGridX=Number(c.gridx)||7,e.fRedraw=!0);c.gridwidth&&(e.szAggregationField=null,"auto"==c.gridwidth?e.nGridWidthPx=e.nGridWidthPx||50:c.gridwidth.match(/px/)?e.nGridWidthPx=__calcNewValue(e.nGridWidthPx||1,Number(c.gridwidth),g):(e.nGridWidthPx=null,e.nGridWidth=__calcNewValue(e.nGridWidth||1,Number(c.gridwidth),g)),e.fRealize=!0,e.fRedraw=!0,e.unpaintMap(),e.themeNodesPosA=[]);c.gridmatrix&&(e.szAggregationField=null,e.nGridMatrix=
__calcNewValue(e.nGridMatrix||1,Number(c.gridmatrix),g),e.fRealize=!0,e.fRedraw=!0,e.unpaintMap(),e.themeNodesPosA=[]);c.gridwidthpx&&(e.szAggregationField=null,e.nGridWidthPx=__calcNewValue(e.nGridWidthPx||50,Number(c.gridwidthpx),g),e.fRealize=!0,e.fRedraw=!0,e.unpaintMap(),e.themeNodesPosA=[]);c.aggregationfield&&(e.szAggregationField=c.aggregationfield,e.fRealize=!0,e.fRedraw=!0,e.unpaintMap(),e.themeNodesPosA=[]);c.snippet&&(e.szSnippet=unescape(c.snippet),e.fRealize=!0);c.title&&(e.szTitle=
unescape(c.title),e.fRealize=!0)}e.fRedrawInfo=!0;executeWithMessage("map.Themes.execute()","... processing ...")}};Map.Themes.prototype.getThemeLayerList=function(){for(var f=[],c,g=0;g<this.themesA.length;g++)if(this.themesA[g].objThemesA&&!this.themesA[g].fRemove)for(c in this.themesA[g].objThemesA)f[f.length]=c;return f};Map.Themes.prototype.isThemeLayerUsed=function(f){for(var c=this.getThemeLayerList(),g=0;g<c.length;g++)if(f==c[g])return!0;return!1};
Map.Themes.prototype.isNodePartOfAnyTheme=function(f){if(f=map.Layer.getLayerObjOfNode(f))for(var c=map.Themes.getThemeLayerList(),g=0;g<c.length;g++)if(f.szName==c[g])return!0;return!1};Map.Themes.prototype.resetThemeNodesCache=function(){this.themeNodesA=[];this.themeNodes=0};
Map.Themes.prototype.addToThemeNodesCache=function(f){var c=0;nodeA=f.getElementsByTagName("g");for(n=0;n<nodeA.length;n++)if(f=String(map.Tiles.getMasterId(nodeA.item(n).getAttributeNS(null,"id"))))map.Themes.themeNodesA[f]||(map.Themes.themeNodesA[f]=[]),map.Themes.themeNodesA[f].push(nodeA.item(n)),map.Themes.themeNodes++,c++};
Map.Themes.prototype.removeFromThemeNodesCache=function(f){var c=0;nodeA=f.getElementsByTagName("g");for(n=0;n<nodeA.length;n++)if((f=String(map.Tiles.getMasterId(nodeA.item(n).getAttributeNS(null,"id"))))&&map.Themes.themeNodesA[f]){var g=map.Themes.themeNodesA[f].indexOf(nodeA.item(n));-1<g&&(map.Themes.themeNodesA[f].splice(g,1),c++)}};Map.Themes.prototype.setActive=function(f){this.activeTheme=f};
Map.Themes.prototype.minimizeInfo=function(f,c){var g=this.getTheme(c.split(":")[0]);if(g){var e=g.widgetNode.firstChild;if(e){var h=Number(e.getAttributeNS(szMapNs,"titleheight"));0>=h&&(h=420);for(var e=e.childNodes,m=0;m<e.length;m++){var q=e.item(m),l=q.getAttributeNS(null,"id");l.match(/body/)&&q.style.setProperty("display","none","");l.match(/footer/)&&q.style.setProperty("display","none","");l.match(/backgroundrect/)&&(q.setAttributeNS(szMapNs,"maxheight",q.getAttributeNS(null,"height")),q.setAttributeNS(null,
"height",h));l.match(/shadowrect/)&&(q.setAttributeNS(szMapNs,"maxheight",q.getAttributeNS(null,"height")),q.setAttributeNS(null,"height",String(h-100)));l.match(/minimizebutton/)&&q.style.setProperty("display","none","")}g.minimizebutton.nodeObj.style.setProperty("display","none","");g.morebutton.nodeObj.style.setProperty("display","none","");g.addDefinitionToFlag("MINIMIZED")}}};
Map.Themes.prototype.maximizeInfo=function(f,c){var g=this.getTheme(c.split(":")[0]);if(g){var e=g.widgetNode.firstChild;if(e){for(var e=e.childNodes,h=0;h<e.length;h++){var m=e.item(h),q=m.getAttributeNS(null,"id");q.match(/body/)&&m.style.setProperty("display","inline","");q.match(/footer/)&&m.style.setProperty("display","inline","");q.match(/backgroundrect/)&&m.setAttributeNS(null,"height",m.getAttributeNS(szMapNs,"maxheight"));q.match(/shadowrect/)&&m.setAttributeNS(null,"height",m.getAttributeNS(szMapNs,
"maxheight"));q.match(/minimizebutton/)&&m.style.setProperty("display","inline","")}g.minimizebutton.nodeObj.style.setProperty("display","inline","");g.morebutton.nodeObj.style.setProperty("display","inline","");g.removeDefinitionFromFlag("MINIMIZED")}}};
Map.Themes.prototype.getChartAll=function(f,c,g){for(var e=c.getAttributeNS(null,"id"),h=0,m=0;m<this.themesA.length;m++){var q=map.Dom.newGroup(c,e+":C1");this.getChart(f,q,g,this.themesA[m]);var l=map.Dom.getBox(q);0>l.width&&(l=new box(0,0,0,0));q.fu.setPosition(0,h);h+=l.height+map.Scale.normalY(10)}};
Map.Themes.prototype.getChart=function(f,c,g,e){e||(e=this.activeTheme);if(!e)return null;f&&":paint"==f.substr(f.length-6,6)&&(f=f.substr(0,f.length-6));if(e.szFlag.match(/CHOROPLETHE/)&&e.szFlag.match(/DOMINANT/)){var h=30;2<e.nOrigSumA.length&&(h=15*e.nOrigSumA.length/Math.log(e.nOrigSumA.length));g=map.Dom.newGroup(c,c.getAttributeNS(null,"id")+":1");if(e.szFlag.match(/PERCENTOFMEAN/)||e.szFlag.match(/PERCENTOFMEDIAN/)||e.szFlag.match(/DEVIATION/)){e.drawChart(g,f,h,"CHART|BAR|VALUES|ZOOM",f&&
e.itemA[f]?e.itemA[f].nDominant:null);var m=map.Dom.getBox(g);0>m.width&&(m=new box(0,0,0,0));g=map.Dom.newGroup(c,c.getAttributeNS(null,"id")+":2");e.drawChart(g,f,h,"VALUES|ZOOM");f=map.Dom.getBox(g);c=1<e.nOrigSumA.length?m.width/f.width*1.015:f.width/f.height;g.fu.setPosition(f.x-m.x,m.height+m.y+Math.min(map.Scale.normalY(200),Math.max(map.Scale.normalY(10),-f.y+map.Scale.normalY(6))));g.fu.scale(c,1);e=e.szFlag.match(/PERCENTOFMEDIAN/)?"median":"mean";f=f.width;map.Dom.newText(g,f,map.Scale.normalY(.9),
"font-family:arial;font-size:"+map.Scale.normalY(4)+"px;fill:#808080",map.Dictionary.getLocalText(e));map.Dom.newText(g,f,map.Scale.normalY(5.5),"font-family:arial;font-size:"+map.Scale.normalY(4)+"px;fill:#808080",map.Dictionary.getLocalText("-"));map.Dom.newText(g,f,map.Scale.normalY(-3.7),"font-family:arial;font-size:"+map.Scale.normalY(4)+"px;fill:#808080",map.Dictionary.getLocalText("+"))}else c="CHART|BAR|SPACED|VALUES|ZOOM",e.szFlag.match(/3D/)&&(c+="|3D"),e.szFlag.match(/SORT/)&&(c+="|SORT"),
e.szFlag.match(/HORZ/)&&(c+="|HORZ|AXIS"),e.drawChart(g,f,h,c,null);return new point(0,map.Scale.normalY(30))}if(e.szFlag.match(/BUFFER/)&&e.szFlag.match(/CHART/))return null;if(e.szFlag.match(/CHOROPLETHE/)&&e.itemA[f])return h=e.itemA[f].nValuesA[0],g=__scaleStyleString(map.Scale.tStyle.Summary.szStyle,1),h=e.szFlag.match(/EXACT/)&&e.szLabelA&&e.szLabelA.length?e.szLabelA[h-1]:e.formatValue(h,2)+e.szUnit,map.Dom.newText(c,-40,0,g+";font-weight:normal;fill:#444444",h),!e.szFlag.match(/EXACT/)&&(e.szChoropletheInfoStyle.match(/HISTOGRAM/)||
e.szChoropletheInfoStyle.match(/histogram/)||e.szChoropletheInfoStyle.match(/CLASSES/)||e.szChoropletheInfoStyle.match(/classes/))&&(h=e.szChoropletheInfoStyle.match(/HISTOGRAM/)||e.szChoropletheInfoStyle.match(/histogram/),g=map.Dom.newGroup(c,c.getAttributeNS(null,"id")+":histogram"),this.getHistogram(f,g,h?"DISTRIBUTION":"CLASSES",e),g.fu.setPosition(0,map.Scale.normalY(4))),new point(0,0);if(e.szFlag.match(/INFOSIZE/))return e.drawChart(c,f,30,g);h=30;e.szFlag.match(/SEQUENCE/)&&(h=25);e.szFlag.match(/BAR/)&&
(e.szFlag.match(/STACKED/)?h=30:2>=e.nOrigSumA.length?h=30:(e.szFlag.match(/UP/)||e.szFlag.match(/CENTER/)||e.szFlag.match(/SEQUENCE/),h=15*e.nOrigSumA.length/Math.log(e.nOrigSumA.length)));return e.drawChart(c,f,h,g)};
Map.Themes.prototype.getSummary=function(f,c){c||(c=this.activeTheme);if(!c||!f)return null;c.itemA[f]||(aA=f.split("::"),1<aA.length&&(f=aA[0]+"::"+String(aA[1]).toUpperCase()));if(!c.itemA[f])return null;for(var g=c.itemA[f].nOrigValuesA,e=0,h=0;h<g.length;h++)isNaN(g[h])&&(g[h]=0),e+=g[h];c.szFlag.match(/DIFFERENCE/)&&(e=g[g.length-1]);if(c.itemA[f].nValue100)return c.szUnits100=c.szUnits100||"",c.szFlag.match(/RELATIVE/)||c.szFlag.match(/DIFFERENCE/)?map.Dictionary.getLocalText("Relative to")+
": "+String(__formatValue(c.itemA[f].nValue100,2))+" "+(c.szUnits100||""):c.itemA[f].nSize?c.szAggregation.match(/sum/)?map.Dictionary.getLocalText("Counted")+": "+String(__formatValue(c.itemA[f].nSize,2))+" "+(c.szUnits100||""):map.Dictionary.getLocalText("Total")+": "+String(__formatValue(c.itemA[f].nSize,2))+" "+(c.szUnits100||""):e!=c.itemA[f].nValue100?String(__formatValue(e,2))+" / "+String(__formatValue(c.itemA[f].nValue100,2))+" "+(c.szUnits100||""):map.Dictionary.getLocalText("Total")+": "+
String(__formatValue(e,2))+" "+(c.szUnits100||"");if(c.itemA[f].nSize)return c.szFlag.match(/EXACT/)&&1==c.itemA[f].nValuesA.length&&c.szValueField?c.szLabelA[c.itemA[f].nValuesA[0]-1]:map.Dictionary.getLocalText("Total")+": "+String(__formatValue(c.itemA[f].nSize,2))+" "+(c.szSizeValueUnits||"");if(c.itemA[f].nAlpha)return map.Dictionary.getLocalText("Alpha value")+": "+String(__formatValue(c.itemA[f].nAlpha,2))+" "+(c.szAlphaValueUnits||"");!c.szFlag.match(/SUM/)||c.szFlag.match(/SEQUENCE/)||c.szFlag.match(/CLIP/);
return null};
Map.Themes.prototype.getValueComment=function(f,c){c||(c=this.activeTheme);if(!c||!f)return null;c.itemA[f]||(aA=f.split("::"),1<aA.length&&(f=aA[0]+"::"+String(aA[1]).toUpperCase()));if(!c.itemA[f])return null;for(var g=c.itemA[f].nOrigValuesA,e=0;e<g.length;e++)isNaN(g[e])&&(g[e]=0);c.szFlag.match(/DIFFERENCE/);return c.szFlag.match(/OFFSETMEAN/)?map.Dictionary.getLocalText("value")+": "+String(__formatValue(c.itemA[f].nValuesA[0],2))+" "+map.Dictionary.getLocalText("mean")+": "+String(__formatValue(c.nMeanA[0],2)):
null};Map.Themes.prototype.getTitle=function(f,c){c||(c=this.activeTheme);if(!c||!f)return null;c.itemA[f]||(aA=f.split("::"),1<aA.length&&(f=aA[0]+"::"+String(aA[1]).toUpperCase()));return c.itemA[f]?c.itemA[f].szTitle||null:null};Map.Themes.prototype.getLabel=function(f,c){c||(c=this.activeTheme);if(!c||!f)return null;c.itemA[f]||(aA=f.split("::"),1<aA.length&&(f=aA[0]+"::"+String(aA[1]).toUpperCase()));return c.itemA[f]?c.itemA[f].szLabel||null:null};
Map.Themes.prototype.getTextObjects=function(){for(var f=[],c=0;c<this.themesA.length;c++)if(this.themesA[c].szFlag.match(/TEXTONLY/)&&this.themesA[c].chartGroup)if("undefined"!=typeof this.themesA[c].markedClass&&null!=this.themesA[c].markedClass){nClass=this.themesA[c].markedClass;var g=this.themesA[c].chartGroup.getElementsByTagName("text");for(n=0;n<g.length;n++)0<g.item(n).firstChild.nodeValue.length&&Number(g.item(n).getAttributeNS(szMapNs,"class"))==nClass&&f.push(g.item(n))}else for(g=this.themesA[c].chartGroup.getElementsByTagName("text"),
n=0;n<g.length;n++)0<g.item(n).firstChild.nodeValue.length&&f.push(g.item(n));return f};
Map.Themes.prototype.getDataRow=function(f,c){c||(c=this.activeTheme);if(!c||!f||!c.fShowData)return null;c.itemA[f]||(aA=f.split("::"))&&1<aA.length&&(f=aA[0]+"::"+String(aA[1]).toUpperCase());if(!c.itemA[f]||c.szFlag.match(/AGGREGATE/)&&1<c.itemA[f].nCount)return null;var g=c.objThemesA[c.szThemesA[0]],e=[];if(c.szDataFieldsA)for(var h=0;h<c.szDataFieldsA.length;h++)for(var m=0;m<g.dbFields.length;m++)c.szDataFieldsA[h]==g.dbFields[m].id&&e.push(m);else for(m=0;m<g.dbFields.length;m++)e.push(m);
var q=[];if(g.dbRecords){if("undefined"!=typeof c.itemA[f].dbIndex){for(var h=c.itemA[f].dbIndex,l=!0,r=0,w=0,m=0;m<g.dbFields.length;m++)isNaN(g.dbRecords[h][m])&&(l=!1),r=Math.max(r,g.dbFields[m].id.length),w=Math.max(w,g.dbRecords[h][m].length);if(l||r>2*w){for(m=0;m<e.length;m++)q.push(g.dbRecords[h][e[m]]);for(m=0;m<e.length;m++)q.push(g.dbFields[e[m]].id)}else{for(m=0;m<e.length;m++)q.push(g.dbFields[e[m]].id);for(m=0;m<e.length;m++)q.push(g.dbRecords[h][e[m]])}return q}f=f.split("::")[1];for(h=
0;h<g.dbRecords.length;h++)if(g.dbRecords[h]&&g.dbRecords[h][g.nFieldSelectionIndex]&&String(g.dbRecords[h][g.nFieldSelectionIndex]).toUpperCase()==String(f).toUpperCase()){for(m=0;m<g.dbFields.length;m++)q.push(g.dbFields[m].id);for(m=0;m<g.dbFields.length;m++)q.push(g.dbRecords[h][m]);break}}return q};
Map.Themes.prototype.getFieldIndexArray=function(f){f||(f=this.activeTheme);if(!f||f.szDataFieldsA)return[];f.fieldIndexArray=[];for(var c=0;c<f.objThemesA[f.szThemesA[0]].nFieldIndexA.length;c++)f.fieldIndexArray.push(f.objThemesA[f.szThemesA[0]].nFieldIndexA[c]);0<=f.objThemesA[f.szThemesA[0]].nField100Index&&f.fieldIndexArray.push(f.objThemesA[f.szThemesA[0]].nField100Index);return f.fieldIndexArray};
Map.Themes.prototype.getScatterArray=function(f,c,g){f||(f=this.activeTheme);var e=0,h=f.nMin,m=f.nMax,q=0,l;g.match(/LOG/)&&(q=1-h,h=Math.log(h+q),m=Math.log(m+q));for(var m=(m-h)/c,r=[],w=0;w<c+1;w++)r[w]=0;for(l in f.itemA)w=f.itemA[l].nValuesA[0],"number"==typeof w&&(g.match(/LOG/)&&(w=Math.log(w+q)),nPos=Math.max(0,Math.min(c-1,Math.floor((w-h)/m))),r[nPos]++,e=Math.max(e,r[nPos]));return r};
Map.Themes.prototype.getResolutionQualityOfArray=function(f){for(var c=f.length,g=-1E6,e=0;e<c;e++)g=Math.max(g,f[e]);for(e=nCount=0;e<c;e++)f[e]>g/10&&nCount++;return nCount/c*100};Map.Themes.prototype.getDeviationOfArray=function(f){for(var c=f.length,g=-1E6,e=0,h=0,m=0,m=0;m<c;m++)g=Math.max(g,f[m]),e+=f[m];e/=c;for(m=0;m<c;m++)h+=(f[m]-e)*(f[m]-e);return m=Math.sqrt(h/c)};
Map.Themes.prototype.getHistogram=function(f,c,g,e){if(!c)return null;e||(e=this.activeTheme);if(!e||e.nMin==e.nMax||f&&(e.itemA[f]||(aA=f.split("::"),1<aA.length&&(f=aA[0]+"::"+String(aA[1]).toUpperCase())),!e.itemA[f]))return null;this.histGroup=map.Dom.newGroup(c,c.getAttributeNS(null,"id")+":group");this.histFlag=g;this.histTheme=e;c=map.Scale.normalX(70);g=map.Scale.normalY(20);map.Dom.newShape("rect",this.histGroup,0,0,c-map.Scale.normalX(.5),g,"fill:none;stroke:none;");f?setTimeout("map.Themes.makeHistogram('"+
f+"')",100):setTimeout("map.Themes.makeHistogram()",100)};
Map.Themes.prototype.makeHistogram=function(f){var c,g=this.histGroup,e=this.histFlag,h=this.histTheme;if(e.match("CLASSES")){for(var m=map.Scale.normalX(50),q=map.Scale.normalY(5),l=m/h.colorScheme.length,r=0,w=0,B=f?h.itemA[f].nValuesA[0]:0,u=0,A=0;A<h.partsA.length;A++){var l=m/h.nCount*h.partsA[A].nCount,v=map.Dom.newShape("rect",g,r,w,l,q,"fill:"+h.colorScheme[A]+";stroke:black;stroke-width:1;");v&&v.setAttributeNS(szMapNs,"tooltip",h.szLegendLabelA[A]+" ("+h.formatValue(h.partsA[A].nCount)+
" "+map.Dictionary.getLocalText("members")+")");r+=l;B>h.partsA[A].max?u+=l:B>h.partsA[A].min&&(u+=l/(h.partsA[A].max-h.partsA[A].min)*(B-h.partsA[A].min))}map.Dom.newShape("circle",g,u,-map.Scale.normalX(.1),map.Scale.normalX(1),"fill:#444444;stroke:none;")}else if(e.match("DISTRIBUTION")){u=Math.min(140,Math.max(20,h.nCount/5));u=Math.min(500,Math.max(20,h.nCount/5));m=map.Scale.normalX(70);q=map.Scale.normalY(12);e.match("INTERACTIVE")&&(q=map.Scale.normalY(20));c=m/u;var B=f?h.itemA[f].nValuesA[0]:
0,G=0,z=h.nMin,E=h.nMax,D=0,L=this.getScatterArray(h,u,""),A=this.getDeviationOfArray(L),r=this.getScatterArray(h,u,"LOG"),w=this.getDeviationOfArray(r),O=!1,la=(E-z)/u;w&&w<A&&(L=r,D=1-z,z=Math.log(z+D),E=Math.log(E+D),B=Math.log(B+D),la=(E-z)/u,O=!0);for(A=0;A<u;A++)G=Math.max(G,L[A]);r=-20;w=0;h.histogram=new Map.Histogram(h);h.histogram.fDoLog=O;h.histogram.dValue=D;h.histogram.nWidth=m;h.histogram.nMin=z;h.histogram.nMax=E;for(var J=__scaleStyleString(map.Scale.tStyle.Summary.szStyle,.4),y=0,
A=0;A<h.partsA.length;A++){l=(O?m/(E-z)*(Math.min(E,Math.log(h.partsA[A].max+D))-z):m/(E-z)*(Math.min(E,h.partsA[A].max)-z))-r;if(v=map.Dom.newShape("rect",g,r,w,l,q,"fill:"+h.colorScheme[A]+";stroke:black;stroke-width:"+map.Scale.normalX(.2)+";stroke-opacity:0.1"))v.setAttributeNS(szMapNs,"tooltip",h.szLegendLabelA[A]+" ("+h.formatValue(h.partsA[A].nCount)+" "+map.Dictionary.getLocalText("members")+")"),v.setAttributeNS(szMapNs,"onoverstyle","fill:"+h.colorScheme[A]+";stroke:black;stroke-width:"+
map.Scale.normalX(.5)+";"),v.setAttributeNS(null,"onmouseover","map.Themes.markClass(evt,'"+h.szId+"','"+A+"','1')"),v.setAttributeNS(null,"onmouseout","map.Themes.unmarkClass(evt,'"+h.szId+"')");h.histogram.classRectA[A]=v;h.histogram.classRectXA[A]=r;h.histogram.classRectWidthA[A]=l;h.histogram.classRectMaxA[A]=h.partsA[A].max;if(e.match("INTERACTIVE")){var v=map.Dom.newGroup(g,""),K=null;if(0<A){map.Dom.newShape("line",v,r,w-map.Scale.normalY(2),r,w+q,"stroke:black;stroke-width:"+map.Scale.normalX(.5)+
";stroke-opacity:0.5");if(K=map.Dom.newShape("rect",v,r-map.Scale.normalY(1.5),w-map.Scale.normalY(6),map.Scale.normalX(3),map.Scale.normalY(5),"fill:"+h.colorScheme[A]+";stroke:black;styroke-width(1);"))K.setAttributeNS(null,"rx",map.Scale.normalX(2)),K.setAttributeNS(null,"ry",map.Scale.normalY(1.5));K=map.Dom.newText(v,r,w-map.Scale.normalY(7),J+"display:none;font-weight:normal;text-anchor:middle",h.formatValue(h.partsA[A-1].max,1))}y=new Slider(v,new box(-y,0,y+l,0));y.setId(String(A));y.parent=
h.histogram;y.textObj=K;y=l}r+=l}r=c/3;w=0;nScalingFactor=.9;A=this.getResolutionQualityOfArray(L);10>A&&(nScalingFactor=10-A);for(A=0;A<u;A++){E=L[A]/G*q*nScalingFactor;l=O?Math.exp(z+A*la)-D:z+A*la;y=O?Math.exp(z+(A+1)*la)-D:z+(A+1)*la;J="black";E=E&&!isNaN(E)?Math.min(q,Math.max(map.Scale.normalY(.5),E)):0;if(J=map.Dom.newShape("line",g,r,w+q,r,w+q-E,"stroke:"+J+";stroke-width:"+c+";"))J.setAttributeNS(szMapNs,"tooltip",h.formatValue(l,2)+" ... "+h.formatValue(y,2)+h.szUnit+" ("+L[A]+" members)"),
J.setAttributeNS(szMapNs,"onoverstyle","stroke:yellow;stroke-width:"+Math.max(map.Scale.normalX(1),c)+";");r+=c}map.Dom.newShape("line",g,-map.Scale.normalX(.5),q+1,m-map.Scale.normalX(.5),q+1,"stroke:black;stroke-width:"+map.Scale.normalX(.1)+";");u=-map.Scale.normalX(.5);m-=map.Scale.normalX(.5);r=map.Scale.normalX(2);map.Dom.newShape("line",g,u,q,u,q+r,"stroke:black;stroke-width:"+map.Scale.normalX(.2)+";");map.Dom.newShape("line",g,m,q,m,q+r,"stroke:black;stroke-width:"+map.Scale.normalX(.2)+
";");l=__scaleStyleString(map.Scale.tStyle.Summary.szStyle,.4);w=.4*map.Scale.tStyle.Summary.nFontHeight;L=q+r+.8*w;A=h.formatValue(h.nMin,0);G=h.formatValue(h.nMax,0);map.Dom.newText(g,u-10,L,l+";font-weight:normal;text-anchor:start",A);0>h.nMin&&0<h.nMax&&(u=(0-z)/la*c,map.Dom.newShape("line",g,u,q,u,q+r,"stroke:black;stroke-width:"+map.Scale.normalX(.2)+";"),map.Dom.newText(g,u,L,l+";font-weight:normal;text-anchor:start","0"));E=0;for(A=10;A<h.nMax;A*=10)for(J=1;9>J&&!(A*J>h.nMax||A*J<h.nMin);J++)u=
((O?Math.log(A*J+D):A*J)-z)/la*c,y=h.formatValue(A*J,0),u>E+y.length*w*3/8?(map.Dom.newShape("line",g,u,q,u,q+r,"stroke:black;stroke-width:"+map.Scale.normalX(.2)+";"),map.Dom.newText(g,u,L,l+";font-weight:normal;text-anchor:middle",y),E=u+y.length*w*3/8):map.Dom.newShape("line",g,u,q,u,q+r/2,"stroke:black;stroke-width:"+map.Scale.normalX(.2)+";");m>E+G.length*w*3/8&&map.Dom.newText(g,m,L,l+";font-weight:normal;text-anchor:middle;",G);f&&!e.match("INTERACTIVE")&&(u=(B-z)/la*c,map.Dom.newShape("circle",
g,u,-map.Scale.normalX(.1),map.Scale.normalX(1),"fill:#dd0000;stroke:none;"),map.Dom.newShape("line",g,-10,-5,u-10,-5,"stroke:#000000;stroke-width:"+map.Scale.normalX(.5)+";stroke-opacity:0.3"))}else{m=map.Scale.normalX(70);q=map.Scale.normalY(12);l=m/700;w=r=0;E=h.nMax;f=q/E;c=Math.max(1,Math.ceil(h.nCount/700));e=[];z=0;D=[];for(B in h.itemA)D.push(h.itemA[B].nValuesA[0]);D.sort(h.sortUp);for(B in D)z%c?e[e.length-1]+=D[B]/c:e[e.length]=D[B]/c,z++;e.sort(h.sortUp);for(A=0;A<e.length;A++){B=e[A];
E=e[A]*f*.9;J="black";for(c=0;c<h.partsA.length;c++)if(e[A]<h.partsA[c].max){J=h.colorScheme[c];break}J=map.Dom.newShape("line",g,r,w,r,q,"stroke:"+J+";stroke-width:"+l+";");J.setAttributeNS(szMapNs,"tooltip",h.formatValue(B,2)+h.szUnit);isNaN(E)&&(E=0);J=map.Dom.newShape("line",g,r,w+q,r,w+q-E,"stroke:#000000;stroke-width:"+l+";");J.setAttributeNS(szMapNs,"tooltip",h.formatValue(B,2)+h.szUnit);r+=l}A=h.formatValue(h.nMin,0);G=h.formatValue(h.nMax,0);l=__scaleStyleString(map.Scale.tStyle.Summary.szStyle,
.4);map.Dom.newText(g,r+map.Scale.normalX(1),w+q,l+";font-weight:normal;text-anchor:start;stroke-opacity:0.8;",A);map.Dom.newText(g,r+map.Scale.normalX(1),w+map.Scale.normalY(3.5),l+";font-weight:normal;text-anchor:start;stroke-opacity:0.8;",G);g&&g.fu.scale(m/r,1)}return g};Map.Histogram=function(f){this.mapTheme=f;this.fDoLog=!1;this.dValue=0;this.classRectA=[];this.classRectXA=[];this.classRectWidthA=[];this.classRectMaxA=[]};Map.Histogram.prototype=new Map;
Map.Histogram.prototype.onMouseOver=function(f,c,g){g.textObj&&g.textObj.style.setProperty("display","inline","")};Map.Histogram.prototype.onMouseOut=function(f,c,g){g.textObj&&g.textObj.style.setProperty("display","none","")};
Map.Histogram.prototype.onMouseMove=function(f,c,g){if(f=this.classRectA[Number(c)])f.setAttributeNS(null,"x",this.classRectXA[Number(c)]+g.value.x),f.setAttributeNS(null,"width",this.classRectWidthA[Number(c)]-g.value.x);if(f=this.classRectA[Number(c)-1]){f.setAttributeNS(null,"width",this.classRectWidthA[Number(c)-1]+g.value.x);var e=this.nMin+(this.nMax-this.nMin)/this.nWidth*(this.classRectXA[Number(c)]+g.value.x),e=this.fDoLog?Math.exp(e)-this.dValue:e;this.classRectMaxA[Number(c)-1]=e}g.textObj&&
(g.textObj.firstChild.nodeValue=__formatValue(e,1))};Map.Histogram.prototype.onMouseUp=function(f,c,g){(g=this.classRectA[Number(c)-1])&&(this.classRectWidthA[Number(c)-1]=g.getAttributeNS(null,"width"));c="ranges:"+String(this.nMin);for(g=0;g<this.classRectMaxA.length;g++)c+=","+String(this.classRectMaxA[g]);map.Themes.changeThemeStyle(f,this.mapTheme.szId,c)};Map.Themes.prototype.showErrorInfo=function(f,c){var g=this.getTheme(c.split(":")[0]);g&&g.showErrorInfo()};
Map.Themes.prototype.actualizeActiveTheme=function(f){for(var c=0;c<this.themesA.length;c++)if(this.themesA[c].szFlag.match(/CHART/))if(f&&1!=f&&this.themesA[c].szFlag.match(/DYNAMICSCALE/)&&(this.themesA[c].nScale*=Math.sqrt(f),this.themesA[c].fRealize=!0,this.themesA[c].fRedraw=!1,this.themesA[c].unpaintMap()),f&&1!=f&&(this.themesA[c].nChartSizeMin||this.themesA[c].nValueSizeMin||this.themesA[c].szAggregationFieldA||this.themesA[c].nGridWidth||this.themesA[c].nGridMatrix||this.themesA[c].nGridWidthPx||
this.themesA[c].nChartUpper||this.themesA[c].nValueUpper||this.themesA[c].nLabelUpper))if(this.themesA[c].fRealizeDone&&(this.themesA[c].szFlag.match(/AUTOGRID/)||this.themesA[c].nGridWidthPx||this.themesA[c].szAggregationFieldA)){this.themesA[c].fRealize=!0;this.themesA[c].fRedraw=!1;this.themesA[c].unpaintMap();this.themesA[c].themeNodesPosA=[];if(this.themesA[c].szAggregationFieldA)for(var g=0;g<this.themesA[c].szAggregationFieldA.length;g++){var e=Number(this.themesA[c].szAggregationFieldA[g].split(":")[1]);
e&&map.Scale.getTrueMapScale()*map.Scale.nZoomScale>e&&(isNaN(parseFloat(this.themesA[c].szAggregationFieldA[g+1]))?this.themesA[c].szAggregationField=this.themesA[c].szAggregationFieldA[g+1]:(e=map.Scale.getDistanceInMeter(1E3,1E3,1E3+map.Scale.normalX(this.themesA[c].nGridWidthPx),1E3),this.themesA[c].nGridWidth=e/map.Scale.nZoomScale,this.themesA[c].szAggregationField=null));g++}this.themesA[c].nGridWidthPx?(e=map.Scale.getDistanceInMeter(1E3,1E3,1E3+map.Scale.normalX(this.themesA[c].nGridWidthPx),
1E3),this.themesA[c].nGridWidth=e/map.Scale.nZoomScale):(g=map.Zoom.getBox(),e=map.Scale.getDistanceInMeter(1E3,1E3,1E3+g.width,1E3),this.themesA[c].nGridWidth=e/(this.themesA[c].nGridMatrix||20)/map.Scale.nZoomScale)}else this.themesA[c].fRealizeDone&&1>f&&(this.themesA[c].nChartSizeMin||this.themesA[c].nValueSizeMin)&&this.themesA[c].unpaintMap(),this.themesA[c].fRedraw=!0;else this.themesA[c].szFlag.match(/AGGREGATE/)?this.themesA[c].fRedraw=!0:this.themesA[c].fActualize=!0;else this.themesA[c].isChecked&&
!this.themesA[c].fMarkClass&&(this.themesA[c].fRedraw=!0);executeWithMessage("map.Themes.execute()","... actualize ...",100);return null};Map.Themes.prototype.resortCharts=function(f){var c=!1;if(this.themesA.length){for(var g=0;g<this.themesA.length;g++)this.themesA[g].fDone&&(c=this.themesA[g].fResort=!0);c&&map.Themes.execute()}f&&(f.stopPropagation(),f.preventDefault())};Map.Themes.prototype.clear=function(){this.themesA.length=0};
function ObjTheme(f,c,g,e,h){this.szName=f;this.coTable=g;this.szSelectionField=e;this.szItemField=h;this.nIndex=c;this.nFieldIndexA=[];this.nFieldSelectionIndex=this.nField100Index=-1;this.nFieldSelectionIndexA=[];this.nLabelFieldIndex=this.nValueFieldIndex=this.nFieldItemIndex=-1;this.leadOffset=!1}
ObjTheme.prototype.getFields=function(){this.szFields=this.theme.szFields;this.szFieldsA=this.theme.szFields.split("|");this.szField100=this.theme.szField100;this.szValueField=this.theme.szValueField;this.szLabelField=this.theme.szLabelField;this.szTitleField=this.theme.szTitleField;this.szSnippetField=this.theme.szSnippetField;this.szSizeField=this.theme.szSizeField;this.szAlphaField=this.theme.szAlphaField;this.szAlphaField100=this.theme.szAlphaField100;this.szFilterField=this.theme.szFilterField;
this.szAggregationField=this.theme.szAggregationField;this.szSelectionFieldsA=(this.theme.szSelectionField||"").split("|");this.nFieldIndexA[0]=-1;this.nFieldSelectionIndexA[0]=-1;var f,c;c=this.coTable?this.coTable:this.szName;if(!this.szFields||""==this.szFields)return!0;try{eval("this.dbTable = "+c+".table")}catch(g){try{eval("this.dbTable = "+c+"_table")}catch(e){}}if(this.coTable&&!this.dbTable)return displayMessage("Data not loaded!",1E3,!0),!1;if(this.dbTable){try{eval("this.dbFields = "+c+
".fields")}catch(h){try{eval("this.dbFields = "+c+"_fields")}catch(m){}}try{this.szSelectionField||(this.szSelectionField=map.Layer.getLayerObj(this.szName).szSelection)}catch(q){return alert("no selection field found !!"),!1}for(f=0;f<this.dbTable.fields;f++)if(!this.dbFields||0==this.dbFields.length||!this.dbFields[f]||!this.dbFields[f].id)return alert("ERROR: theme '"+this.szName+"' - table '"+c+".js' - object 'fields' incorrect !"),!1;for(f=0;f<this.dbFields.length;f++){"undefined"!=typeof this.szItemField&&
String(this.dbFields[f].id).toLowerCase()==String(this.szItemField).toLowerCase()&&(this.nFieldItemIndex=f);"undefined"!=typeof this.szSelectionField&&String(this.dbFields[f].id).toLowerCase()==String(this.szSelectionField).toLowerCase()&&(this.nFieldSelectionIndex=f);for(c=0;c<this.szSelectionFieldsA.length;c++)this.dbFields[f].id==this.szSelectionFieldsA[c]&&(this.nFieldSelectionIndexA[c]=f);for(c=0;c<this.szFieldsA.length;c++)"!"==this.szFieldsA[c].substr(0,1)?this.dbFields[f].id==this.szFieldsA[c].substr(1,
this.szFieldsA[c].length-1)&&(this.nFieldIndexA[c]=f):this.dbFields[f].id==this.szFieldsA[c]&&(this.nFieldIndexA[c]=f);this.szField100&&this.dbFields[f].id==this.szField100&&(this.nField100Index=f);this.szValueField&&this.dbFields[f].id==this.szValueField&&(this.nValueFieldIndex=f);this.szLabelField&&this.dbFields[f].id==this.szLabelField&&(this.nLabelFieldIndex=f);this.szTitleField&&this.dbFields[f].id==this.szTitleField&&(this.nTitleFieldIndex=f);this.szSnippetField&&this.dbFields[f].id==this.szSnippetField&&
(this.nSnippetFieldIndex=f);this.szSizeField&&this.dbFields[f].id==this.szSizeField&&(this.nSizeFieldIndex=f);this.szAlphaField&&this.dbFields[f].id==this.szAlphaField&&(this.nAlphaFieldIndex=f);this.szAlphaField100&&this.dbFields[f].id==this.szAlphaField100&&(this.nAlphaField100Index=f);this.szFilterField&&this.dbFields[f].id==this.szFilterField&&(this.nFilterFieldIndex=f);this.szAggregationField&&this.dbFields[f].id==this.szAggregationField&&(this.nAggregationFieldIndex=f)}-1==this.nFieldSelectionIndex&&
-1==this.nFieldSelectionIndexA[0]&&(this.szSelectionField&&this.szSelectionField.length?alert("ERROR: theme '"+this.szName+"' selection field '"+this.szSelectionField+"' not found !"):alert("ERROR: theme '"+this.szName+"', selection not defined !"));for(c=0;c<this.szFieldsA.length;c++)if("undefined"==typeof this.nFieldIndexA[c])return alert("ERROR: theme '"+this.szName+"' value field '"+this.szFieldsA[c]+"' not found !"),!1}else{f=SVGDocument.getElementById(this.szName);null==f&&(c=map.Tiles.getTileNodes(this.szName))&&
(f=c[0]);if(!f)return this.szName="",!1;f=f.getAttributeNS(szMapNs,"info");if(null==f||""==f)return this.szName="",!1;var l=f.split("|");for(f=0;f<l.length;f++){for(c=0;c<this.szFieldsA.length;c++)"!"==this.szFieldsA[c].substr(0,1)?l[f]==this.szFieldsA[c].substr(1,this.szFieldsA[c].length-1)&&(this.nFieldIndexA[c]=f):l[f]==this.szFieldsA[c]&&(this.nFieldIndexA[c]=f);this.szField100&&l[f]==this.szField100&&(this.nField100Index=f);this.szValueField&&l[f]==this.szValueField&&(this.nValueFieldIndex=f);
this.szLabelField&&l[f]==this.szLabelField&&(this.nLabelFieldIndex=f);this.szSizeField&&l[f]==this.szSizeField&&(this.nSizeFieldIndex=f);this.szAlphaField&&l[f]==this.szAlphaField&&(this.nAlphaFieldIndex=f);this.szAlphaField100&&l[f]==this.szAlphaField100&&(this.nAlphaField100Index=f)}}for(c=0;c<this.szFieldsA.length;c++)0>this.nFieldIndexA[c]&&("$item$"!=this.szFieldsA[c]&&"$index$"!=this.szFieldsA[c]&&_ERROR("error: "+this.szFieldsA[c]+" not found in "+this.szName+" !"),this.szName="");return!0};
function MapTheme(f,c,g,e,h,m,q){this.fDone=!1;this.nMin=3E8;this.nNoData=this.nCount=this.nSum=this.nMax=0;this.szThemes=f;this.szThemesA=f.split("|");this.checkTheme();this.objThemesA=[];this.szFields=c;this.szFieldsA=c.split("|");this.szField100=g;this.nFieldsA=[];this.nFields100A=[];this.nFieldsSelectionA=[];this.nMinA=[];this.nMaxA=[];this.nSumA=[];this.nMeanA=[];this.nMedianA=[];this.nDeviationA=[];this.nOrigMinA=[];this.nOrigMaxA=[];this.nOrigSumA=[];for(g=0;g<this.szFieldsA.length;g++)this.nMinA[g]=
3E8,this.nMaxA[g]=0,this.nSumA[g]=0,this.nOrigMinA[g]=3E8,this.nOrigMaxA[g]=0,this.nOrigSumA[g]=0,this.nMedianA[g]=0,this.nMeanA[g]=0;this.nMin100=3E8;this.nSum100=this.nMax100=0;this.nMinSize=3E8;this.nSumSize=this.nMaxSize=0;this.nMinAlpha=3E8;this.nSumAlpha=this.nMaxAlpha=0;this.nDominantDFilter=this.szDominantFilter=null;this.nFilterA=[];this.dbTableA=[];this.dbFieldsA=[];this.dbRecordsA=[];if(h)for(g in this.origColorScheme=[],h)this.origColorScheme[g]=h[g];else this.origColorScheme=null;this.defaultColorScheme=
["#008888","#00aaaa","#00cccc","#00eeee","#00ffff"];this.szTitle=m?m:f+" ["+c+"]";this.szTitle=map.Dictionary.getLocalText(this.szTitle);this.szTitle=60<this.szTitle.length?this.szTitle.slice(0,50)+" ...":this.szTitle;this.szUnits="";this.szXaxisA=this.szAlphaValueUnits=this.szSizeValueUnits=null;this.szOrigLabelA=this.szLabelA=q;this.szLegendLabelA=[];this.szLegendStyle="";this.evidenceMode="isolate";this.szAggregation="mean";this.nValuesA=[];this.szExactA=this.szRangesA=this.szValuesA=null;this.itemA=
[];this.fDataCache=!0;this.fNegativeValuePossible=this.fNullIsValue=this.fEditor=!1;this.nStringToValue=1;this.nStringToValueA=[];this.szOrigFlag=this.szFlag=e?e:"CHOROPLETHE";this.nScale=1;this.nRefreshTimeout=0;this.szId="theme"+String(Math.random());this.szShapeType="polygon";if(f=map.Layer.getLayerObj(this.szThemesA[0]))this.szShapeType=f.szType,"line"==this.szShapeType&&this.szOrigFlag.match(/BUFFER/)&&(this.szShapeType+="+buffer");this.hiddenLayerA=[];this.szFlag.match(/CHART/)||(this.szFlag.match(/PIE/)?
this.szOverviewChart="PIE":this.szFlag.match(/DONUT/)&&(this.szOverviewChart="DONUT"));this.szFlag.match(/ZEROISVALUE/)&&(this.fNullIsValue=!0);this.szFlag.match(/NEGATIVEISVALUE/)&&(this.fNegativeValuePossible=!0);this.szFlag.match(/SUM/)&&(this.szAggregation="sum");if(this.szFlag.match(/CHART/)){if(this.szFlag.match(/EXACT/)||1<this.szFieldsA.length)this.fNullIsValue=!0;this.szFlag.match(/BUFFER/)||(this.fShadow=this.fOrigShadow=!0)}this.szFlag.match(/EXACT/)&&!this.szLabelA&&(this.szLabelA=[]);
this.fGrayNoMember=this.fSortBeforeDraw=this.fClipCharts=!0;this.nClipTimeout=1E3;this.paintedShapeNodesA=[];this.szChoropletheInfoStyle=map.Themes.szChoropletheInfoStyle;this.nMaxThemeCharts=map.Themes.nMaxThemeCharts;this.nMaxShadowCharts=map.Themes.nMaxShadowCharts;this.nflushPaintShape=map.Themes.nflushPaintShape;this.nflushChartDraw=map.Themes.nflushChartDraw;this.themeNodesPosA=[]}
MapTheme.prototype.checkTheme=function(){if(!this.szThemesA)return!1;for(var f=0;f<this.szThemesA.length;f++)if("generic"==this.szThemesA[f]||map.Layer.isLoaded(this.szThemesA[f]))return!0;for(f=0;f<this.szThemesA.length;)return!0;this.ErrorMessage="theme layer not loaded ! zoom in ?";return!1};MapTheme.prototype.def=function(){return map.Themes.getMapThemeDefinitionObj(this.szId)};MapTheme.prototype.getDefinitionObject=function(){return map.Themes.getMapThemeDefinitionObj(this.szId)};
MapTheme.prototype.initValues=function(){this.nMin=3E8;for(var f=this.nNoData=this.nCount=this.nSum=this.nMax=0;f<this.szFieldsA.length;f++)this.nMinA[f]=3E8,this.nMaxA[f]=0,this.nSumA[f]=0,this.nOrigMinA[f]=3E8,this.nOrigMaxA[f]=0,this.nOrigSumA[f]=0,this.nMedianA[f]=0,this.nMeanA[f]=0,this.nDeviationA[f]=0;this.nMin100=3E8;this.nSum100=this.nMax100=0;this.itemA=[];this.posItemA=[];this.chartPosA=[];this.exactCountA=[];this.exactSizeA=[];this.szAggregation||(this.szAggregation=this.szField100?"mean":
"sum");if(this.szAggregationFieldA)for(f=0;f<this.szAggregationFieldA.length;f++){var c=Number(this.szAggregationFieldA[f].split(":")[1]);c&&map.Scale.getTrueMapScale()*map.Scale.nZoomScale>c&&(isNaN(parseFloat(this.szAggregationFieldA[f+1]))?this.szAggregationField=this.szAggregationFieldA[f+1]:(this.nGridWidth=map.Scale.getDistanceInMeter(1E3,1E3,1E3+map.Scale.normalX(parseFloat(this.szAggregationFieldA[f+1])),1E3)/map.Scale.nZoomScale,this.szAggregationField=null));f++}this.nWrongRecordLengthCount=
0};MapTheme.prototype.realize=function(){var f=new Date;this.fShowProgressBar=!1;this.initValues();this.getFields()?this.loadValues()?(this.timeLoading=new Date-f,this.fAggregate=!0,(1E3<this.timeLoading||this.szFlag.match(/VERBOSE/))&&!this.szFlag.match(/SILENT/)?executeWithMessage("map.Themes.continueExecute();",this.szFlag.match(/AGGREGATE/)?"aggregating":"parsing data"):map.Themes.continueExecute()):this.fRemove=!0:this.fRemove=!0};
MapTheme.prototype.realize_aggregate=function(){var f=new Date;this.distributeValues();this.timeAggregating=new Date-f;this.fDraw=!0;(1E3<this.timeLoading||this.szFlag.match(/VERBOSE/))&&!this.szFlag.match(/SILENT/)?executeWithMessage("map.Themes.continueExecute();","drawing"):map.Themes.continueExecute()};
MapTheme.prototype.realize_draw=function(){this.nMissingPositionCount=this.nMissingRangeCount=this.nZeroValueCount=this.nRealizedCount=this.nSkipCount=this.nDoneCount=0;this.missedA=[];this.nActualFrame=0;var f=this.szFlag.match(/VERBOSE/)?"drawing":"";this.mapSleep=new Map.Sleep("map.Themes.continueExecute",this.nflushPaintShape,map.Dictionary.getLocalText(f));this.mapSleep.nCount=this.nCount;this.mapSleep.szCancel="map.Themes.cancelExecute()";this.szFlag.match(/CLIP/)&&(this.mapSleep=null,this.nClipIncr=
1);this.szFlag.match(/CHART/)?(this.mapSleep&&this.mapSleep.initCheckSleep(this.nflushChartDraw,f),this.chartMap()):(this.unlabelMap(),this.paintMap(),this.makeVisible());this.isChecked=!0;this.szFlag.match(/BUFFER/)?map.Themes.activeBuffer=this:map.Themes.activeTheme=this;try{HTMLWindow.ixmaps.htmlgui_setActualTheme(this.szId)}catch(c){}!this.szFlag.match(/CHART/)||this.szFlag.match(/BUBBLE/)||this.szFlag.match(/SQUARE/)||this.szFlag.match(/SYMBOL/)||this.szFlag.match(/BAR/)&&this.colorScheme&&this.nOrigSumA&&
this.nOrigSumA.length!=this.colorScheme.length?this.isMarkable=!0:this.isMarkable=!1};MapTheme.prototype.realizeContinue=function(f){this.fMakeLabel?this.labelMap(f):this.szFlag.match(/CHART/)?this.chartMap(f):this.paintMap(f)};
MapTheme.prototype.realizeNextClipFrame=function(){this.fClipPause||(this.nActualFrame+=this.nClipIncr,this.nActualFrame>=this.nClipFrames?this.szFlag.match(/BACK/)?(this.nClipIncr=-this.nClipIncr,this.clipTimeout=setTimeout("map.Themes.nextClipFrame('"+this.szId+"')",2E3)):this.szFlag.match(/LOOP/)?(this.nActualFrame=-1,this.clipTimeout=setTimeout("map.Themes.nextClipFrame('"+this.szId+"')",2E3)):(this.nActualFrame=this.nClipFrames-1,this.pauseClip()):0>this.nActualFrame?this.szFlag.match(/BACK/)?
(this.nClipIncr=-this.nClipIncr,this.clipTimeout=setTimeout("map.Themes.nextClipFrame('"+this.szId+"')",10)):(this.nActualFrame=0,this.pauseClip()):(displayMessage("... "+this.nActualFrame+" ...",5E3),this.mapSleep=null,this.szFlag.match(/CHART/)?(this.chartPosA=[],this.posItemA=[],this.fRedraw=!0,this.chartMap()):this.paintMap(),this.fRedrawInfo=!0))};
MapTheme.prototype.setClipFrame=function(f){this.fClipPause=!0;this.nActualFrame=Math.min(f,this.nClipFrames);this.mapSleep=null;this.szFlag.match(/CHART/)?(this.chartPosA=[],this.posItemA=[],this.unpaintMap(),this.chartMap()):this.paintMap();this.fRedrawInfo=!0};
MapTheme.prototype.startClip=function(){var f=SVGDocument.getElementById(this.szId+":display:widget:clippausebutton:button");f&&f.style.setProperty("display","inline","");(f=SVGDocument.getElementById(this.szId+":display:widget:clipstartbutton:button"))&&f.style.setProperty("display","none","");this.fClipPause=!1;this.nActualFrame=0;this.realizeNextClipFrame()};
MapTheme.prototype.pauseClip=function(){var f=SVGDocument.getElementById(this.szId+":display:widget:clippausebutton:button");f&&f.style.setProperty("display","none","");(f=SVGDocument.getElementById(this.szId+":display:widget:clipstartbutton:button"))&&f.style.setProperty("display","inline","");this.fClipPause=!0};
MapTheme.prototype.realizeDone=function(){this.nRefreshTimeout&&setTimeout("map.Themes.refreshTheme('"+this.szId+"')",this.nRefreshTimeout);this.szFlag.match(/CLIP/)&&(this.clipTimeout&&clearTimeout(this.clipTimeout),this.clipTimeout=setTimeout("map.Themes.nextClipFrame('"+this.szId+"')",this.nActualFrame?this.nClipTimeout:2E3));clearMessage();this.nWrongRecordLengthCount&&fDebug&&displayMessage("Data Error:  "+this.nWrongRecordLengthCount+" items have wrong record length",1E4,"notify");this.fRealize=
this.fRedraw=!1;this.fDone=!0;map.Themes.realizeDone(this)};MapTheme.prototype.beginDraw=function(){this.fOverviewMap||(this.fOverviewMap=map.Zoom.hideOverviewMap())};MapTheme.prototype.endDraw=function(){this.fOverviewMap&&(map.Zoom.showOverviewMap(),this.fOverviewMap=!1)};
MapTheme.prototype.redraw=function(f){this.clipTimeout&&clearTimeout(this.clipTimeout);this.fDataIncomplete&&this.__themeNodes!=map.Themes.themeNodes&&(this.fDataIncomplete=!1,this.initValues(),this.loadValues(),this.distributeValues());if(this.szFlag.match(/CHART/)){if(this.fClipCharts&&this.nSkipCount||this.fRedraw)this.nMissingPositionCount=this.nMissingRangeCount=this.nZeroValueCount=this.nRealizedCount=this.nDoneCount=this.nSkipCount=0,this.chartMap()}else if(this.isChecked){if(this.partsA)for(i=
0;i<this.partsA.length;i++)this.partsA[i].nCount=0,this.partsA[i].nSum=0;this.mapSleep&&this.mapSleep.initCheckSleep(this.nflushPaintShape,"painting map");this.makeVisible();this.paintMap()}f&&this.enable()};
MapTheme.prototype.toFront=function(){if(this.szFlag.match(/CHART/))this.chartGroup.parentNode.appendChild(this.chartGroup),(matrixA=getMatrix(this.chartGroup))&&setMatrix(this.chartGroup,matrixA),this.enable();else if(this.isChecked){for(i=0;i<this.partsA.length;i++)this.partsA[i].nCount=0,this.partsA[i].nSum=0;this.mapSleep&&this.mapSleep.initCheckSleep(this.nflushPaintShape,"painting map");this.paintMap()}else this.enable()};
MapTheme.prototype.getFields=function(){for(var f=0;f<this.szThemesA.length;f++){var c=this.szThemesA[f];this.objThemesA[c]=new ObjTheme(c,f,this.coTable,this.szSelectionField,this.szItemField);this.objThemesA[c].theme=this;if(!this.objThemesA[c].getFields()){try{HTMLWindow.ixmaps.htmlgui_onErrorTheme(c)}catch(g){}return!1}}return!0};
MapTheme.prototype.addItemValues=function(f,c,g,e,h){if(!this.szFlag.match(/RAW/)||g|e|h){var m;if(this.szExcludeA)for(m=0;m<this.szExcludeA.length;m++)if(f.split("::")[1]==this.szExcludeA[m])return;if(!(this.nField100Min&&g&&g<this.nField100Min)){if(this.nMinValue&&c&&!g){var q=!1;for(m=c.length-1;0<=m;m--)c[m]>=this.nMinValue&&(q=!0);if(!q)return}q=1;if(this.__fDensity||this.__fDensityAlpha)if(q=this.getNodeArea(f),!q&&this.__fTiledLayer){this.fDataIncomplete=!0;return}if(this.szWeights)for(m=0;m<
c.length;m++)c[m]*=this.szWeightsA[m]||this.szWeightsA[0];if(this.__fAuto100){for(m=g=0;m<c.length;m++)g+=c[m]||0;this.fField100=!0}this.itemA[f]={nOrigValuesA:[],nValuesA:c,nValue100:g,nValueSum:0};for(m=0;m<c.length;m++){this.itemA[f].nOrigValuesA[m]=isNaN(c[m])?0:c[m];this.itemA[f].nValueSum+=c[m];if(this.fField100)if(g){var l=c[m];0!=l||this.szFlag.match(/ZEROISVALUE/)?"!"==this.szFieldsA[m].substr(0,1)?(l=g-l,this.itemA[f].nOrigValuesA[m]=l):this.szFlag.match(/CALCVAL/)||this.szFlag.match(/CALC100/)?
(l=g?Math.round(l*g/100):l,this.itemA[f].nOrigValuesA[m]=l):this.szFlag.match(/PRODUCT/)?l=g?l*g:l:this.szFlag.match(/DIFFERENCE/)&&1==c.length&&!this.szFlag.match(/RELATIVE/)?(g=0<m?c[m-1]:this.itemA[f].nValue100,l-=g):(l=g?l/g:1,this.szFlag.match(/FRACTION/)?l*=this.nFractionScale||1:this.szFlag.match(/PERMILLE/)?l*=1E3:(l*=100,0<l&&this.szFlag.match(/RELATIVE/)?l-=100:0<l&&this.szFlag.match(/INVERT/)&&(l=100-l))):l=0;c[m]=l}else c[m]=0;this.__fDensity&&(c[m]/=q)}if(this.__fDifference&&1<c.length){for(m=
0;m<c.length;m++)m<c.length-1?(l=c[m],c[m]=c[m+1]-c[m],this.szFlag.match(/RELATIVE/)&&(c[m]*=100/l)):this.szFlag.match(/STACKED/)||(c[m]=0);c.pop()}for(m=0;m<c.length;m++){if(!this.nSumA)return;isNaN(c[m])||(this.nMin=Math.min(this.nMin,c[m]),this.nMax=Math.max(this.nMax,c[m]),this.nSum+=c[m],this.nMinA[m]=Math.min(this.nMinA[m],c[m]),this.nMaxA[m]=Math.max(this.nMaxA[m],c[m]),this.nSumA[m]+=c[m],this.nOrigMinA[m]=Math.min(this.nOrigMinA[m],this.itemA[f].nOrigValuesA[m]),this.nOrigMaxA[m]=Math.max(this.nOrigMaxA[m],
this.itemA[f].nOrigValuesA[m]),this.nOrigSumA[m]+=this.itemA[f].nOrigValuesA[m]);0>c[m]&&(this.fNegativeValues=!0)}isNaN(g)||(this.nMin100=Math.min(this.nMin100,g),this.nMax100=Math.max(this.nMax100,g),this.nSum100+=g);e&&this.szSizeField&&!isNaN(e)&&(this.itemA[f].nSize=e,this.nMinSize=Math.min(this.nMinSize,e),this.nMaxSize=Math.max(this.nMaxSize,e),this.nSumSize+=e);this.szAlphaField&&null!=h&&!isNaN(h)&&(this.__fDensityAlpha&&(h=q?Math.min(h/q,5E4):0),this.itemA[f].nAlpha=h,this.nMinAlpha=Math.min(this.nMinAlpha,
h),this.nMaxAlpha=Math.max(this.nMaxAlpha,h),this.nSumAlpha+=h);if(this.__fExact&&this.exactCountA)for(m=0;m<c.length;m++)c[m]&&(this.exactCountA[c[m]-1]?(this.exactCountA[c[m]-1]++,this.exactSizeA[c[m]-1]+=this.itemA[f].nSize||1):(this.exactCountA[c[m]-1]=1,this.exactSizeA[c[m]-1]=this.itemA[f].nSize||1));this.nCount++}}else{this.itemA[f]={nOrigValuesA:[],nValuesA:c,nValue100:g,nValueSum:0};if(!this.szFlag.match(/AGGREGATE/))for(m=0;m<c.length;m++)this.nMin=Math.min(this.nMin,c[m]),this.nMax=Math.max(this.nMax,
c[m]),this.nSum+=c[m],this.__fExact&&this.exactCountA&&c[m]&&(this.exactCountA[c[m]-1]?(this.exactCountA[c[m]-1]++,this.exactSizeA[c[m]-1]+=this.itemA[f].nSize||1):(this.exactCountA[c[m]-1]=1,this.exactSizeA[c[m]-1]=this.itemA[f].nSize||1));this.nCount++}};
MapTheme.prototype.getStringValueIndex=function(f,c){if(0==f.length||" "==f)if(this.szFlag.match(/UNDEFINEDISVALUE/))f="undefined";else return-1;this.szFlag.match(/IGNORECASE/)&&(f=f.toUpperCase());"undefined"!=typeof this.nStringToValueA[f]||this.szValuesA&&this.szValuesA.length&&"set"!=c||(this.szLabelA=this.szLabelA||[],this.szExactA=this.szExactA||[],this.nStringToValueA[f]=this.nStringToValue,this.szLabelA[this.nStringToValue-1]=this.szLabelA[this.nStringToValue-1]||f,this.szExactA.push(this.nStringToValue),
this.nStringToValue++);return this.nStringToValueA[f]};MapTheme.prototype.checkHiddenLayerState=function(){for(i=0;i<this.szThemesA.length;i++)if(map.Layer.isScaleDependentLayer(this.szThemesA[i])&&(this.hiddenLayerA[this.szThemesA[i]]&&map.Layer.isScaleDependentLayerOn(this.szThemesA[i])||!this.hiddenLayerA[this.szThemesA[i]]&&!map.Layer.isScaleDependentLayerOn(this.szThemesA[i])))return!0;return!1};__scanValue=function(f){return parseFloat(String(f).replace(/ /gi,"").replace(/,/gi,"."))};
MapTheme.prototype.loadValues=function(){this.__fExact=this.szFlag.match(/EXACT/);this.__fDifference=this.szFlag.match(/DIFFERENCE/);this.__fFilter=this.szFilter&&this.szFilter.length;this.__fDensity=this.szFlag.match(/DENSITY/);this.__fDensityAlpha=this.szAlphaField100&&this.szAlphaField100.match(/\$density\$/i);this.__fAuto100=this.szFlag.match(/AUTO100/)&&!this.szFlag.match(/AGGREGATE/);this.__fTiledLayer=map.Layer.getLayerObj(this.szThemesA[0])?map.Layer.getLayerObj(this.szThemesA[0]).szFlag.match(/tiled/):
!1;this.__themeNodes=map.Themes.themeNodes;for(i=0;i<this.szThemesA.length;i++)if(map.Layer.isScaleDependentLayer(this.szThemesA[i])&&!map.Layer.isScaleDependentLayerOn(this.szThemesA[i]))this.fReload=this.hiddenLayerA[this.szThemesA[i]]=!0;else{this.hiddenLayerA[this.szThemesA[i]]=!1;if(!this.objThemesA[this.szThemesA[i]].dbTable)return this.loadValuesFromMap();if(!this.loadValuesOfTheme(this.szThemesA[i]))return!1}return!0};
MapTheme.prototype.filterValues=function(f){if(this.szFilter.match(/WHERE/)){if(!this.objTheme.filterQueryA){var c=this.szFilter.split("AND"),g=[],e={};1<c.length&&3>c[1].split(" ").length&&(c=[this.szFilter]);this.objTheme.filterQueryA=[];for(i=0;i<c.length;i++){c[i].match(/\'/)?(g=c[i].split("'"),e={},e.szFilterField=g[1],g=g[2].split(" "),e.szFilterOp=g[1],e.szFilterValue=g[2].replace(".","\\.").replace(/\//gi,"\\/"),"BETWEEN"==e.szFilterOp&&"AND"==g[3]&&(e.szFilterValue2=g[4].replace(".","\\.").replace(/\//gi,
"\\/"))):c[i].match(/\"/)?(g=c[i].split('"'),e={},e.szFilterField=g[1],g=g[2].split(" "),e.szFilterOp=g[1],e.szFilterValue=g[2].replace(".","\\.").replace(/\//gi,"\\/"),"BETWEEN"==e.szFilterOp&&"AND"==g[3]&&(e.szFilterValue2=g[4].replace(".","\\.").replace(/\//gi,"\\/"))):(g=c[i].split(" "),e={},e.szFilterField=g[1],e.szFilterOp=g[2],e.szFilterValue=g[3].replace(".","\\.").replace(/\//gi,"\\/"),"BETWEEN"==e.szFilterOp&&"AND"==g[4]&&(e.szFilterValue2=g[5].replace(".","\\.").replace(/\//gi,"\\/")));
for(g=0;g<this.objTheme.dbFields.length;g++)this.objTheme.dbFields[g].id==e.szFilterField&&(e.nFilterFieldIndex=g);this.objTheme.filterQueryA.push(e)}}for(i in this.objTheme.filterQueryA)if(this.__szValue=String(this.objTheme.dbRecords[f][this.objTheme.filterQueryA[i].nFilterFieldIndex]),this.__szFilterOp=this.objTheme.filterQueryA[i].szFilterOp,this.__szFilterValue=this.objTheme.filterQueryA[i].szFilterValue,this.__szFilterValue2=this.objTheme.filterQueryA[i].szFilterValue2,c=!0,c=parseFloat(this.__szValue),
c="="==this.__szFilterOp?this.__szValue==this.__szFilterValue||c==Number(this.__szFilterValue):"<>"==this.__szFilterOp?!(this.__szValue==this.__szFilterValue||c==Number(this.__szFilterValue)):">"==this.__szFilterOp?c>Number(this.__szFilterValue):"<"==this.__szFilterOp?c<Number(this.__szFilterValue):">="==this.__szFilterOp?c>=Number(this.__szFilterValue):"<="==this.__szFilterOp?c<=Number(this.__szFilterValue):"LIKE"==this.__szFilterOp?eval("this.__szValue.match(/"+this.__szFilterValue+"/i)"):"IN"==
this.__szFilterOp?eval("this.__szFilterValue.match(/\\("+this.__szValue+"\\,/)")||eval("this.__szFilterValue.match(/\\,"+this.__szValue+"\\,/)")||eval("this.__szFilterValue.match(/\\,"+this.__szValue+"\\)/)"):"BETWEEN"==this.__szFilterOp?c>=Number(this.__szFilterValue)&&c<=Number(this.__szFilterValue2):eval("this.__szValue.match(/"+this.__szFilterValue+"/i)"),!c)return!1}else if(this.__szValue=this.objTheme.dbRecords[f].join(" "),!eval("this.__szValue.match(/"+this.szFilter+"/i)"))return!1;return!0};
MapTheme.prototype.getSelectionId=function(f,c){if(this.fSelection){if(this.fSelection.match(/LatLon/)){var g=this.objTheme.dbRecords[c][this.objTheme.nFieldSelectionIndexA[0]],e=this.objTheme.dbRecords[c][this.objTheme.nFieldSelectionIndexA[1]];return g&&e?isNaN(g)||isNaN(e)?null:f+"::"+(this.objTheme.dbRecords[c][this.objTheme.nFieldSelectionIndexA[0]]+","+this.objTheme.dbRecords[c][this.objTheme.nFieldSelectionIndexA[1]])+(this.szSelectionFieldSuffix||""):null}if(this.fSelection.match(/MultiPoint/))return szId=
this.objTheme.dbRecords[c][this.objTheme.nFieldSelectionIndex],g=null,(g=szId.match(positionRegExp))?f+"::"+(g[2]+","+g[1])+(this.szSelectionFieldSuffix||""):null;szId=__mpap_decode_utf8(String(this.objTheme.dbRecords[c][this.objTheme.nFieldSelectionIndex]));this.fSelectionFieldToUpper&&(szId=String(szId).toUpperCase());return f+"::"+szId+(this.szSelectionFieldSuffix||"")}if(this.objTheme.nFieldSelectionIndexA&&1<this.objTheme.nFieldSelectionIndexA.length){if(this.objTheme.dbRecords[c][this.objTheme.nFieldSelectionIndexA[0]].length)for(szId=
String(__scanValue(this.objTheme.dbRecords[c][this.objTheme.nFieldSelectionIndexA[0]])),k=1;k<this.objTheme.nFieldSelectionIndexA.length;k++)szId+=","+String(__scanValue(this.objTheme.dbRecords[c][this.objTheme.nFieldSelectionIndexA[k]]));else szId="undefined";this.fSelection="LatLon"}else{szId=__mpap_decode_utf8(String(this.objTheme.dbRecords[c][this.objTheme.nFieldSelectionIndex]));if(szId.match(/MultiPoint/)){if(g=szId.match(positionRegExp))szId=g[2]+","+g[1];this.fSelection="MultiPoint"}this.fSelectionFieldToUpper&&
(szId=String(szId).toUpperCase())}return f+"::"+szId+(this.szSelectionFieldSuffix||"")};
MapTheme.prototype.loadValuesOfTheme=function(f){var c,g,e,h,m;this.fNegativeValues=this.fField100=!1;this.szUnit=" "+(this.szUnits||"");var q=!0;this.objTheme=this.objThemesA[f];0<this.objTheme.nField100Index&&(this.fField100=!0);if(this.objTheme.dbTable&&f&&f.length){if(this.coTable){try{eval("this.objTheme.dbRecords = "+this.coTable+".records")}catch(l){eval("this.objTheme.dbRecords = "+this.coTable+"_records")}if(!this.objTheme.dbRecords)return displayMessage("Data "+this.coTable+" could not be loaded!",
2E3,!0),!1}else try{eval("this.objTheme.dbRecords = "+f+".records")}catch(r){eval("this.objTheme.dbRecords = "+f+"_records")}this.objTheme.nFieldSelectionIndexA.length||null==this.objTheme.nFieldSelectionIndexA;if("$item$"!=this.szFieldsA[0]&&!this.szFlag.match(/EXACT/))for(h=Math.min(40,this.objTheme.dbRecords.length),c=0;c<h;c++)if(this.objTheme.dbRecords[c])for(g=0;g<this.szFieldsA.length;g++)if(e=this.objTheme.dbRecords[c][this.objTheme.nFieldIndexA[g]],__scanValue(e)!=parseFloat(e)){this.__fScanValue=
!0;c=h;break}for(c=0;c<this.objTheme.dbRecords.length;c++)if(!this.objTheme.dbRecords[c]||this.objTheme.dbRecords[c].length<this.objTheme.dbFields.length)this.nWrongRecordLengthCount++;else if(!this.__fFilter||this.filterValues(c)){h=[];if("$item$"==this.szFieldsA[0])h[0]=1;else if("$index$"==this.szFieldsA[0])h[0]=c+1;else for(g=0;g<this.szFieldsA.length;g++)e=this.objTheme.dbRecords[c][this.objTheme.nFieldIndexA[g]],e=this.__fExact?this.getStringValueIndex(String(e)):this.__fScanValue?__scanValue(e):
parseFloat(e),isNaN(e)||0==e&&!this.fNullIsValue||0>e&&!this.fNegativeValuePossible||(h[g]=e);h.length=this.szFieldsA.length;m=0>this.objTheme.nField100Index?0:__scanValue(this.objTheme.dbRecords[c][this.objTheme.nField100Index]);0!=m||this.fNullIsValue||(m=null);0>m&&!this.fNegativeValuePossible&&(m=null);var w=null;this.szSizeField&&(w=__scanValue(this.objTheme.dbRecords[c][this.objTheme.nSizeFieldIndex]));var B=null;this.szAlphaField&&(B=__scanValue(this.objTheme.dbRecords[c][this.objTheme.nAlphaFieldIndex]),
isNaN(B)&&(B=0));this.szAlphaField100&&this.objTheme.nAlphaField100Index&&(B*=100/__scanValue(this.objTheme.dbRecords[c][this.objTheme.nAlphaField100Index]),isNaN(B)&&(B=0));if(e=g=this.getSelectionId(f,c)){0<=this.objTheme.nFieldItemIndex&&this.objTheme.nFieldItemIndex!=this.objTheme.nFieldSelectionIndex&&(g=__mpap_decode_utf8(String(this.objTheme.dbRecords[c][this.objTheme.nFieldItemIndex])),this.fSelectionFieldToUpper&&(g=String(g).toUpperCase()),g=f+"::"+g);if(this.itemA[g]&&(g+="*"+Math.random(),
this.itemA[g]))continue;this.addItemValues(g,h,m,w,B);this.itemA[g]&&(this.szValueField&&(this.itemA[g].szValue="$index$"==this.szValueField?c+1:__mpap_decode_utf8(this.objTheme.dbRecords[c][this.objTheme.nValueFieldIndex])),this.szLabelField&&(this.itemA[g].szLabel="$index$"==this.szValueField?c+1:__mpap_decode_utf8(this.objTheme.dbRecords[c][this.objTheme.nLabelFieldIndex])),this.szTitleField&&(this.itemA[g].szTitle=__mpap_decode_utf8(this.objTheme.dbRecords[c][this.objTheme.nTitleFieldIndex])),
this.szSnippetField&&(this.itemA[g].szSnippet=__mpap_decode_utf8(this.objTheme.dbRecords[c][this.objTheme.nSnippetFieldIndex])),this.itemA[g].szSelectionId=e?e:g,this.szAggregationField&&(this.itemA[g].szAggregation=__mpap_decode_utf8(this.objTheme.dbRecords[c][this.objTheme.nAggregationFieldIndex])),this.itemA[g].dbIndex=c)}}}else q=!1;if(q)return!0};
MapTheme.prototype.loadValuesFromMap=function(){var f,c,g,e;this.fNegativeValues=this.fField100=!1;this.szUnit=" "+(this.szUnits||"");var h=[],m=[];for(f=0;f<this.szThemesA.length;f++){this.objTheme=this.objThemesA[this.szThemesA[f]];var q=map.Layer.getLayerObj(this.szThemesA[f]);if(null==q)return alert("MapTheme error: no layer like '"+this.szThemesA[f]+"'"),!1;if(q.szFlag.match(/tiled/)){m[0]=map.Scale.canvasNode;m.length=1;this.fDataIncomplete=!map.Tiles.allTilesLoaded();break}else m[m.length]=
SVGDocument.getElementById(q.szName)}q=!0;for(c=0;c<m.length;c++){e=m[c].getElementsByTagName("path");var l=m[c].getElementsByTagName("use"),r=m[c].getElementsByTagName("circle");for(f=0;f<e.length;f++)h[h.length]=e.item(f);for(f=0;f<l.length;f++)h[h.length]=l.item(f);for(f=0;f<r.length;f++)h[h.length]=r.item(f)}if(0==h.length)for(q=!1,c=0;c<m.length;c++)for(e=m[c].getElementsByTagName("g"),f=0;f<e.length;f++)h[h.length]=e.item(f);for(f=0;f<h.length;f++)if(1==h[f].nodeType&&h[f].hasAttributeNS(szMapNs,
"info")){e=q?h[f].parentNode.getAttributeNS(null,"id"):h[f].getAttributeNS(null,"id");m=-1;if(e&&0!==e.length)for(l=map.Tiles.getMasterId(e).split(":")[0],c=0;c<this.szThemesA.length;c++)l==this.szThemesA[c]&&(m=c);l=map.Tiles.getMasterId(e);if(!this.itemA[l]&&0<=m){r=h[f].getAttributeNS(szMapNs,"info").split("|");c=[];e=0>this.objTheme.nField100Index?0:Number(r[this.objThemesA[this.szThemesA[m]].nField100Index]);0!=e||this.fNullIsValue||(e=null);0>e&&!this.fNegativeValuePossible&&(e=null);if(this.szFlag.match(/CHART/)&&
this.szFlag.match(/BUFFER/))this.szFields&&this.szRangesA&&this.szRangesA.length?c[0]=r[this.objThemesA[this.szThemesA[m]].nFieldIndexA[0]]:(c[0]=this.nBufferSize,this.nCount=1);else{for(g=0;g<this.szFieldsA.length;g++){var w=nValue=r[this.objThemesA[this.szThemesA[m]].nFieldIndexA[g]];nValue=Number(nValue);if(isNaN(nValue))if(this.szFlag.match(/EXACT/))nValue=this.getStringValueIndex(w);else continue;if(0!=nValue||this.fNullIsValue)0>nValue&&!this.fNegativeValuePossible||(c[g]=nValue)}c.length=this.szFieldsA.length}g=
null;this.szSizeField&&(g=Number(r[this.objThemesA[this.szThemesA[m]].nSizeFieldIndex]));w=null;this.szAlphaField&&(w=Number(r[this.objThemesA[this.szThemesA[m]].nAlphaFieldIndex]));this.szAlphaField100&&this.objTheme.nAlphaField100Index&&(w*=100/Number(r[this.objThemesA[this.szThemesA[m]].nAlphaField100Index]),isNaN(w)&&(w=0));l=__mpap_decode_utf8(l);this.itemA[l]||(this.addItemValues(l,c,e,g,w),this.itemA[l]&&(this.szValueField&&(this.itemA[l].szValue=r[this.objThemesA[this.szThemesA[m]].nValueFieldIndex]),
this.szLabelField&&(this.itemA[l].szLabel=r[this.objThemesA[this.szThemesA[m]].nLabelFieldIndex]),this.szTitleField&&(this.itemA[l].szTitle=r[this.objThemesA[this.szThemesA[m]].nTitleFieldIndex]),this.szSnippetField&&(this.itemA[l].szSnippet=r[this.objThemesA[this.szThemesA[m]].nSnippetFieldIndex]),this.itemA[l].szSelectionId=l))}}return!0};
MapTheme.prototype.aggregateValues=function(){var f=[],c=[],g=[],e=[],h=[],m=null,q=0;this.nTopicsSkipedByZeroExclusion=0;if(this.nGridWidthPx){var l=map.Scale.getDistanceInMeter(1E3,1E3,1E3+map.Scale.normalX(this.nGridWidthPx),1E3);this.nGridWidth=l}this.nGridMatrix&&(l=map.Zoom.getBox(),l=map.Scale.getDistanceInMeter(1E3,1E3,1E3+l.width,1E3),this.nGridWidth=l/(this.nGridMatrix||20)/map.Scale.nZoomScale);l=this.nGridWidth?map.Scale.getDeltaXofDistanceInMeter(this.nGridWidth)*map.Scale.nZoomScale:
0;l=Math.floor(1E4*l)/1E4;for(a in this.itemA){var r="undefined",m=m||a;if(this.szAggregationField){r=this.itemA[a].szAggregation;f[r]||(f[r]=[],e[r]=new point(0,0),c[r]=0,g[r]=0,q++);f[r][a]=this.itemA[a];f[r][a].nSize=this.itemA[a].nSize||1;f[r][a].szTitle=r;g[r]+=f[r][a].nSize;var w=this.getNodePosition(this.itemA[a].szSelectionId);w&&(e[r].x+=w.x,e[r].y+=w.y,c[r]++)}else if(w=this.getNodePosition(this.itemA[a].szSelectionId))if(this.szFlag.match(/DIFFUSE/)&&this.nGridWidth){var B=[],u=[];B[0]=
new point(Math.ceil(w.x/l)*l,Math.ceil(w.y/l)*l);B[1]=new point(Math.ceil(w.x/l)*l,Math.floor(w.y/l)*l);B[2]=new point(Math.floor(w.x/l)*l,Math.floor(w.y/l)*l);B[3]=new point(Math.floor(w.x/l)*l,Math.ceil(w.y/l)*l);var A=Math.pow(l,2)+Math.pow(l,2);u[0]=A-(Math.pow(B[0].x-w.x,2)+Math.pow(B[0].y-w.y,2));u[1]=A-(Math.pow(B[1].x-w.x,2)+Math.pow(B[1].y-w.y,2));u[2]=A-(Math.pow(B[2].x-w.x,2)+Math.pow(B[2].y-w.y,2));u[3]=A-(Math.pow(B[3].x-w.x,2)+Math.pow(B[3].y-w.y,2));for(var w=u[0]+u[1]+u[2]+u[3],v,
A=0;4>A;A++){v=a+"-"+A;this.themeNodesPosA[v]=B[A];r=String(this.themeNodesPosA[v].x)+","+String(this.themeNodesPosA[v].y);f[r]||(f[r]=[],c[r]=0,q++);for(var G={nValuesA:[],nOrigValuesA:[]},z=0;z<this.itemA[a].nValuesA.length;z++)G.nValuesA[z]=this.itemA[a].nValuesA[z]*(this.szFlag.match(/EXACT/)?1:u[A]/w),G.nOrigValuesA[z]=this.itemA[a].nOrigValuesA[z]*(this.szFlag.match(/EXACT/)?1:u[A]/w);G.nValue100=(this.itemA[a].nValue100||100)*(this.szFlag.match(/EXACT/)?1:u[A]/w);f[r][v]=G;f[r][v].nSize=(this.itemA[a].nSize||
1)/w*u[A];c[r]++}}else this.nGridWidth?(v=null,this.szFlag.match(/RECT/)?v=new point(Math.round(w.x/l)*l,Math.round(w.y/l)*l):(this.szFlag.match(/PLOTY/)?(B=Math.round(w.y/l)*l,u=Math.round(B/l)%2?1.15*l/2:0,v=new point(1.15*Math.round((w.x+u)/(1.15*l))*l-u,B)):(A=Math.round(w.x/l)*l,r=Math.round(A/l)%2?1.15*l/2:0,v=new point(A,1.15*Math.round((w.y+r)/(1.15*l))*l-r)),Math.abs(A-w.x)>l/4&&(B=[],u=[],r=Math.round(A/l)%2?0:1.15*l/2,A>w.x?(B[0]=new point(v.x-l,v.y-1.15*l/2),B[1]=new point(v.x-l,v.y+1.15*
l/2)):(B[0]=new point(v.x+l,v.y-1.15*l/2),B[1]=new point(v.x+l,v.y+1.15*l/2)),u[0]=Math.sqrt(Math.pow(B[0].x-w.x,2)+Math.pow(B[0].y-w.y,2)),u[1]=Math.sqrt(Math.pow(B[1].x-w.x,2)+Math.pow(B[1].y-w.y,2)),u[3]=Math.sqrt(Math.pow(v.x-w.x,2)+Math.pow(v.y-w.y,2)),u[0]<u[3]?v=new point(Math.round(B[0].x/l)*l,1.15*Math.round((B[0].y+r)/(1.15*l))*l-r):u[1]<u[3]&&(v=new point(Math.round(B[1].x/l)*l,1.15*Math.round((B[1].y+r)/(1.15*l))*l-r)))),r=String(v.x)+","+String(v.y),this.szFlag.match(/RELOCATE/)||(this.themeNodesPosA[a]=
v)):r=this.itemA[a].szSelectionId,f[r]||(f[r]=[],e[r]=new point(0,0),c[r]=0,q++),f[r][a]=this.itemA[a],f[r][a].nSize=this.itemA[a].nSize||1,w&&(e[r].x+=w.x,e[r].y+=w.y),c[r]++;else f[r]||(f[r]=[],e[r]=new point(0,0),c[r]=0,this.fDataIncomplete=fTilesLoaded,q++),f[r][a]=this.itemA[a],f[r][a].nSize=this.itemA[a].nSize||1,c[r]++}if(this.szFlag.match(/EXACT/))for(t in this.szSizeField||(this.szSizeField="aggregation"),f){q=f[t];h[t]=0;B=[];l=[];for(a in q)B[q[a].szTitle]||(B[q[a].szTitle]=1,h[t]++),l[q[a].nValuesA[0]]||
(l[q[a].nValuesA[0]]={itemA:[]}),l[q[a].nValuesA[0]].itemA[a]=q[a];for(z in l)for(a in q=l[z].itemA,q)if(q[a])for(b in q[a].nCount=1,q)q[b]&&b!=a&&(q[a].nCount+=1,q[a].nSize=(q[a].nSize||1)+(q[b].nSize||1),q[a].nAlpha=(q[a].nAlpha||1)+(q[b].nAlpha||1),q[a].szValue=String(q[a].nSize),q[b]=null,f[t][b]=null)}else for(t in f){q=f[t];if(!this.szFlag.match(/SUM/)&&!this.szFlag.match(/ZEROISVALUE/)){B=[];u=0;for(a in q)if(u++,q[a])for(z=0;z<q[a].nValuesA.length;z++)if(0==q[a].nOrigValuesA[z]){B[a]=a;break}if(1<
u)for(a in B)q[a]=null,this.nTopicsSkipedByZeroExclusion++}for(a in q)if(q[a]){q[a].nCount=1;for(b in q)if(q[b]&&b!=a){for(z=0;z<q[a].nValuesA.length;z++)q[a].nValuesA[z]=(q[a].nValuesA[z]||0)+(q[b].nValuesA[z]||0),q[a].nOrigValuesA[z]=(q[a].nOrigValuesA[z]||0)+(q[b].nOrigValuesA[z]||0);q[a].nCount+=1;q[a].nValue100+=q[b].nValue100;q[a].nSize=(q[a].nSize||1)+(q[b].nSize||1);q[a].nAlpha=(q[a].nAlpha||1)+(q[b].nAlpha||1);q[a].szValue=String(q[a].nSize);l&&!this.szAggregationField&&q[a].szTitle&&q[b].szTitle&&
q[a].szTitle!=q[b].szTitle&&(q[a].szTitle=q[a].szTitle+","+q[b].szTitle);q[b]=null}l&&!this.szAggregationField&&(!q[a].szTitle||3<q[a].nCount)&&(q[a].szTitle=this.formatValue(q[a].nCount,2)+" "+map.Dictionary.getLocalText("items aggregated"))}}if(this.szAggregationField||this.szFlag.match(/RELOCATE/)){var E=new point(0,0),D=0,z=1E6,l=0;for(t in f)z=Math.min(z,e[t].x/c[t]),D=Math.max(D,e[t].y/c[t]),E.x+=e[t].x*(g[t]||1),E.y+=e[t].y*(g[t]||1),l+=c[t]*(g[t]||1);E.x/=l;E.y/=l;new point(z,E.y);D=new point(E.x,
D)}this.nMin=3E8;this.nMax=-3E8;this.nMinSize=3E8;this.nSumSize=this.nMaxSize=0;this.nMinAlpha=3E8;this.nSumAlpha=this.nMaxAlpha=0;this.szFlag.match(/EXACT/)&&(this.nMinA=[],this.nMaxA=[],this.nSumA=[],this.nOrigMinA=[],this.nOrigMaxA=[],this.nOrigSumA=[],this.nMedianA=[],this.nMeanA=[],this.nCountA=[]);g="[";l=this.nStringToValue-1;for(z=0;z<l;z++)g+="0,";g+="]";this.itemA=[];l=0;B=Math.max(this.szRangesA?this.szRangesA.length:0,this.szExactA?this.szExactA.length:0)-(this.szFlag.match(/EXACT/)?0:
1);for(t in f)if(l++,"undefined"!=t)if(q=f[t],this.szFlag.match(/EXACT/)&&(this.szFlag.match(/PIE/)||this.szFlag.match(/BAR/)||this.szFlag.match(/SEQUENCE/)||this.szFlag.match(/DOMINANT/))){for(a in q){A=a;break}this.itemA[A]={};eval("var nValuesA = "+g+";");this.itemA[A].szSelectionId=A;this.itemA[A].szTitle=q[A].szTitle;if(this.szAggregationField||this.szFlag.match(/RELOCATE/))this.szFlag.match(/ALIGN/)?(this.itemA[A].szSelectionId=m,this.szFlag.match(/UP/)?this.themeNodesPosA[A]=new point(D.x,
D.y):this.themeNodesPosA[A]=new point(E.x,E.y)):this.themeNodesPosA[A]=new point(e[t].x/c[t],e[t].y/c[t]);u=z=0;for(a in q)q[a]&&q[a].nValuesA&&(nValuesA[q[a].nValuesA[0]-1]=q[a].nSize/(this.szFlag.match(/SUM/)?1:q[a].nCount),z+=q[a].nSize,u+=q[a].nCount);this.itemA[A].nValuesA=this.itemA[A].nOrigValuesA=nValuesA;this.itemA[A].nMinA=[];this.itemA[A].nMaxA=[];this.itemA[A].nSize=z/(this.szFlag.match(/SUM/)?1:u);this.itemA[A].szTitle=this.nGridWidth&&!this.szAggregationField&&1<h[t]?__formatValue(h[t],
2)+" item(s) aggregated":this.itemA[A].szTitle||t;this.itemA[A].szValue=this.itemA[A].szTitle;this.itemA[A].szLabel=this.itemA[A].szTitle;this.nMin=this.nMinSize=Math.min(this.nMinSize,this.itemA[A].nSize);this.nMax=this.nMaxSize=Math.max(this.nMaxSize,this.itemA[A].nSize);this.nSumSize+=z/(this.szFlag.match(/SUM/)?1:u);this.nMinAlpha=Math.min(this.nMinAlpha,this.itemA[A].nAlpha);this.nMaxAlpha=Math.max(this.nMaxAlpha,this.itemA[A].nAlpha);this.nSumAlpha+=this.itemA[A].nAlpha;if(this.szFlag.match(/AUTO100/)){for(z=
nValue100=0;z<this.itemA[A].nValuesA.length;z++)nValue100+=this.itemA[A].nValuesA[z]||0;this.itemA[A].nValue100=nValue100;this.fField100=!0;for(z=0;z<this.itemA[A].nValuesA.length;z++)this.itemA[A].nValuesA[z]=this.itemA[A].nOrigValuesA[z]/this.itemA[A].nValue100*100}if(this.szFlag.match(/EXACT/)){if(!this.nMinA.length)for(z=0;z<this.itemA[A].nValuesA.length;z++)this.nMinA[z]=3E8,this.nMaxA[z]=-3E8,this.nSumA[z]=0,this.nOrigMinA[z]=3E8,this.nOrigMaxA[z]=-3E8,this.nOrigSumA[z]=0,this.nMedianA[z]=0,
this.nMeanA[z]=0,this.nCountA[z]=0;for(z=0;z<this.itemA[A].nValuesA.length;z++)this.nMinA[z]=Math.min(this.nMinA[z],this.itemA[A].nValuesA[z]||3E8),this.nMaxA[z]=Math.max(this.nMaxA[z],this.itemA[A].nValuesA[z]||-3E8),this.nSumA[z]+=this.itemA[A].nValuesA[z],this.nOrigMinA[z]=Math.min(this.nOrigMinA[z],this.itemA[A].nOrigValuesA[z]||3E8),this.nOrigMaxA[z]=Math.max(this.nOrigMaxA[z],this.itemA[A].nOrigValuesA[z]||-3E8),this.nOrigSumA[z]+=this.itemA[A].nOrigValuesA[z],this.itemA[A].nValuesA[z]&&this.nCountA[z]++}this.nCount=
l*B}else for(a in q)if(q[a]){this.itemA[a]=q[a];q[a].szValue=q[a].szValue||1;u=this.szFlag.match(/SUM/)||this.szFlag.match(/EXACT/)?1:q[a].nCount;this.itemA[a].nValue100/=u;this.nMinSize=Math.min(this.nMinSize,this.itemA[a].nSize);this.nMaxSize=Math.max(this.nMaxSize,this.itemA[a].nSize);this.nSumSize+=this.itemA[a].nSize;this.nMinAlpha=Math.min(this.nMinAlpha,this.itemA[a].nAlpha);this.nMaxAlpha=Math.max(this.nMaxAlpha,this.itemA[a].nAlpha);this.nSumAlpha+=this.itemA[a].nAlpha;if(this.nGridWidth||
this.szAggregationField)for(this.itemA[a].szSelectionId=a,z=0;z<this.itemA[a].nValuesA.length;z++)this.itemA[a].nValuesA[z]/=u,this.itemA[a].nOrigValuesA[z]/=u,this.itemA[a].nValue100&&(this.itemA[a].nValuesA[z]=this.itemA[a].nOrigValuesA[z]/this.itemA[a].nValue100,this.szFlag.match(/FRACTION/)||(this.itemA[a].nValuesA[z]*=this.szFlag.match(/PERMILLE/)?1E3:100),this.szFlag.match(/INVERT/)&&(this.itemA[a].nValuesA[z]=100-this.itemA[a].nValuesA[z])),this.nMin=Math.min(this.itemA[a].nValuesA[z]||3E8,
this.nMin||3E8),this.nMax=Math.max(this.itemA[a].nValuesA[z]||-3E8,this.nMax||-3E8);else this.nMin=Math.min(this.itemA[a].nSize,this.nMin||3E8),this.nMax=Math.max(this.itemA[a].nSize,this.nMax||-3E8);if(this.szAggregationField||this.szFlag.match(/RELOCATE/))this.szFlag.match(/ALIGN/)?this.szFlag.match(/UP/)?this.themeNodesPosA[a]=new point(D.x,D.y):this.themeNodesPosA[a]=new point(E.x,E.y):this.themeNodesPosA[a]=new point(e[t].x/c[t],e[t].y/c[t])}u=0;for(a in this.itemA)u++;if(this.nMinAggregation)for(a in this.itemA)this.itemA[a].nCount<
this.nMinAggregation&&delete this.itemA[a];this.fSorted=!0};
MapTheme.prototype.distributeValues=function(){if(0==this.nCount)return!1;this.szFlag.match(/AGGREGATE/)?this.aggregateValues():"aggregation"==this.szSizeField&&(this.szSizeField=null);if(this.szFlag.match(/EXACT/)&&(!this.szExactA||!this.szExactA.length)&&(this.szExactA=this.szExactA||[],this.nStringToValueA))for(a in this.nStringToValueA)this.szExactA.push(this.nStringToValueA[a]);!this.szFlag.match(/EXACT/)||this.szLabelA&&this.szLabelA.length||!this.szValuesA||(this.szLabelA=this.szValuesA);this.origColorScheme||
(this.origColorScheme=this.colorScheme=this.defaultColorScheme);if(isNaN(Number(this.origColorScheme[0])))this.colorScheme=this.origColorScheme;else{!this.szFlag.match(/SEQUENCE/)&&this.szFieldsA.length>this.origColorScheme[0]&&(this.origColorScheme[0]=this.szFieldsA.length);this.szFlag.match(/EXACT/)&&(this.origColorScheme[0]=this.szExactA.length);try{this.colorScheme=ColorScheme.createColorScheme(this.origColorScheme[1],this.origColorScheme[2],this.origColorScheme[0],this.origColorScheme[3],this.origColorScheme[4])}catch(f){this.colorScheme=
this.defaultColorScheme}}try{HTMLWindow.ixmaps.htmlgui_colorScheme(this)}catch(c){}if(this.szFlag.match(/DOMINANT/))for(;this.colorScheme.length<this.szFieldsA.length;)this.colorScheme[this.colorScheme.length]="#dddddd";if(this.szFlag.match(/INVERTSIZE/)&&this.szSizeField){for(a in this.itemA)this.itemA[a].nSize=this.nMaxSize-this.itemA[a].nSize;this.nNormalSizeValue=this.nNormalSizeValue||this.nMaxSize}if(!this.szFlag.match(/EXACT/)){var g=[];for(a in this.itemA)this.itemA[a].nValuesA[0]&&g.push(this.itemA[a].nValuesA[0]);
"$item$"!=this.szFieldsA[0]&&g.sort(this.sortUp);this.nMedianA[0]=g[Math.round(g.length/2)]}var e=this.colorScheme.length,h=this.nMax-this.nMin,m=this.nMin,q=this.nMax;null==this.nRangeCenterValue||isNaN(this.nRangeCenterValue)||(q=Math.max(Math.abs(this.nRangeCenterValue-m),Math.abs(q-this.nRangeCenterValue)),m=this.nRangeCenterValue-q,q=this.nRangeCenterValue+q,h=q-m);if(this.szFlag.match(/INTEGER/))e>h?e=h:e>h/2?e=Math.floor(h/2):h+=e-h%e;else{var l=1;for(this.szField100&&(l=.01);h>1E3*l;)l*=10;
1<l?(m=Math.floor(m/l)*l,q=Math.ceil(q/l)*l):q+=q/1E5;h=q-m}if((this.nRangesA=this.szRangesA||this.szExactA)&&this.nRangesA.length){e=this.nRangesA.length-(this.szFlag.match(/EXACT/)?0:1);if(this.szSymbolsA&&this.szSymbolsA.length)for(;this.szSymbolsA.length<e;)this.szSymbolsA[this.szSymbolsA.length]="no";if(this.colorScheme&&this.colorScheme.length)for(;this.colorScheme.length<e;)this.colorScheme[this.colorScheme.length]="#dddddd";this.partsA=[];for(l=0;l<e;l++)m=Number(this.nRangesA[l]),q=Number(this.nRangesA[l+
(this.szFlag.match(/EXACT/)?0:1)])+1E-9,this.partsA[this.partsA.length]={min:m,max:q,color:this.colorScheme[l],nCount:0,nSum:0};if(this.szFlag.match(/EXACT/)&&this.exactCountA)for(l=0;l<e;l++)this.partsA[l].nCount=this.exactCountA[l];if(this.szFlag.match(/PLOTVAR/)){for(l=0;l<e;l++){g=[];for(a in this.itemA)g.push(this.itemA[a].nValuesA[l]);m=Math.round(g.length/2);this.nMedianA[l]=g[m];this.nMeanA[l]=this.nSumA[l]/this.nCountA[l]}for(l=0;l<e;l++){g=[];for(a in this.itemA)this.itemA[a].nValuesA[l]&&
g.push(this.itemA[a].nValuesA[l]);this.nDeviationA[l]=this.parent.getDeviationOfArray(g)}}}else{h/=e;h>l&&(h=Math.floor(h/l)*l);this.partsA=[];for(l=0;l<e;l++)this.partsA[this.partsA.length]={min:m+l*h,max:m+(l+1)*h,color:this.colorScheme[l],nCount:0,nSum:0};this.partsA[this.partsA.length-1].max=q;if(this.szFlag.match(/QUANTILE/)){g[g.length]=q;m=Math.round(g.length/e);for(l=0;l<this.partsA.length;l++)this.partsA[l].min=g[l*m],this.partsA[l].max=g[(l+1)*m];this.partsA[this.partsA.length-1].max=q}if(this.szFlag.match(/LOG/)){m=
Math.log(this.nMin?this.nMin:1);h=Math.log(this.nMax?this.nMax:1)-Math.log(this.nMin?this.nMin:1);h/=e;this.partsA=[];for(l=0;l<e;l++)this.partsA[this.partsA.length]={min:Math.exp(m+l*h),max:Math.exp(m+(l+1)*h),color:this.colorScheme[l],nCount:0,nSum:0};this.partsA[this.partsA.length-1].max=this.nMax}if(this.szFlag.match(/DOMINANT/)||this.szFlag.match(/OFFSETMEAN/)||this.szFlag.match(/OFFSETMEDIAN/)||this.szFlag.match(/DEVIATION/)||this.szFlag.match(/PLOTVAR/))for(l=0;l<this.szFieldsA.length;l++){g=
[];for(a in this.itemA)this.itemA[a].nValuesA[l]&&g.push(this.itemA[a].nValuesA[l]);"$item$"!=this.szFieldsA[l]&&g.sort(this.sortUp);this.nMedianA[l]=g[Math.round(g.length/2)];this.nSum100?this.szFlag.match(/DIFFERENCE/)?this.nMeanA[l]=this.nSumA[l]/this.nCount:(this.nMeanA[l]=this.nOrigSumA[l]/this.nSum100,this.szFlag.match(/FRACTION/)?this.nMeanA[l]*=this.nFractionScale||1:this.szFlag.match(/PERMILLE/)?this.nMeanA[l]*=1E3:(this.nMeanA[l]*=100,this.szFlag.match(/RELATIVE/)?this.nMeanA[l]-=100:this.szFlag.match(/INVERT/)&&
(this.nMeanA[l]=100-this.nMeanA[l]))):this.nMeanA[l]=this.nSumA[l]/this.nCount;this.szDominantFilter=this.szDominantFilter||"mean";this.nDominantDFilter=this.nDominantDFilter||0;this.szDominantFilter.match(/min/)?this.nFilterA[l]=this.nMinA[l]+(this.nMaxA[l]-this.nMinA[l])/100*this.nDominantDFilter:this.szDominantFilter.match(/max/)?this.nFilterA[l]=this.nMinA[l]+(this.nMaxA[l]-this.nMinA[l])/100*this.nDominantDFilter:this.szDominantFilter.match(/mean/)?this.nFilterA[l]=this.nMeanA[l]+(this.nMaxA[l]-
this.nMeanA[l])/100*this.nDominantDFilter:this.szDominantFilter.match(/median/)&&(this.nFilterA[l]=this.nMedianA[l]+(this.nMaxA[l]-this.nMedianA[l])/100*this.nDominantDFilter)}if(this.szFlag.match(/DEVIATION/)||this.szFlag.match(/PLOTVAR/))for(l=0;l<this.szFieldsA.length;l++){g=[];for(a in this.itemA)this.itemA[a].nValuesA[l]&&g.push(this.itemA[a].nValuesA[l]);this.nDeviationA[l]=this.parent.getDeviationOfArray(g)}}this.partsA[this.partsA.length-1].max+=.001;return!0};
MapTheme.prototype.sortUp=function(f,c){return f>c?1:-1};MapTheme.prototype.sortIndexUp=function(f,c){return f.value>c.value?1:-1};MapTheme.prototype.sortIndexDown=function(f,c){return f.value<c.value?1:-1};MapTheme.prototype.sortPartsUp=function(f,c){return f.nCount>c.nCount?1:-1};MapTheme.prototype.sortMeanUp=function(f,c){return f.mean>c.mean?1:-1};
MapTheme.prototype.shuffleArray=function(f,c){for(var g=f.length-1;0<g;g--){var e=Math.floor((c&&c[g]?c[g]:Math.random())*g+1),h=f[g];f[g]=f[e];f[e]=h}};MapTheme.prototype.getRandomNumberArray=function(f){for(var c=[],g=0;g<f;g++)c.push(Math.random());return c};
MapTheme.prototype.paintMap=function(f){this.beginDraw();this.mapSleep&&(this.mapSleep.checkSleepMessage="painting map");var c=0,g=0,e=0,h=0,m=0,q=0,l="",r="";map.Dictionary.getLocalText("of mean");map.Dictionary.getLocalText("of median");var w=!1,B=0,u=e=l=0,h=null;this.fillOpacity=this.fillOpacity?this.fillOpacity:this.nOpacity;this.szStyle="fill-opacity:"+String(this.fillOpacity?this.fillOpacity:fTransparentMap?.6:1);this.autoOpacity&&(this.szStyle="fill-opacity:"+String(Math.max(.3,Math.min(1,
.3+.5/Math.max(1,Math.log(map.Zoom.nZoom))))));this.szShapeType.match(/line/)&&(this.szStyle=this.fillOpacity?"stroke-opacity:"+this.fillOpacity+";":"stroke-opacity:1");if(!f||0==f){f=0;this.indexA=[];for(u in this.itemA)this.indexA[this.indexA.length]=u,this.itemA[u].todo=!0;this.nDoneCount=0}for(;f<this.indexA.length;f++){if(this.mapSleep&&(this.mapSleep.nDoneCount=this.nDoneCount,this.mapSleep.checkSleep(f,10))){this.fContinue=!0;this.continueIndex=f;return}u=this.indexA[f];this.nDoneCount++;w=
!1;B=0;if(this.szFlag.match(/COMPOSECOLOR/))__maptheme_getComposedColor(this.itemA[u].nValuesA,this.colorScheme);else if(this.szFlag.match(/DOMINANT/)){w=!0;nIndex=-1;for(l=0;l<this.itemA[u].nValuesA.length;l++)c=this.itemA[u].nValuesA[l],g=100/this.nMeanA[l]*c,e=100/this.nMedianA[l]*c,h=(c-this.nMeanA[l])/this.nDeviationA[l],m=c,this.szFlag.match(/PERCENTOFMEAN/)&&(m=g),this.szFlag.match(/PERCENTOFMEDIAN/)&&(m=e),this.szFlag.match(/DEVIATION/)&&(m=h),c>this.nFilterA[l]&&m>B&&(this.itemA[u].nClass=
l,B=m,nIndex=l);if(0<=nIndex){this.itemA[u].nDominant=nIndex;c=this.itemA[u].nValuesA[nIndex];l=" "+this.szFieldsA[nIndex]+" ";this.szLabelA&&this.szLabelA[nIndex]&&(l=" "+this.szLabelA[nIndex]+" ");if(this.szFlag.match(/PERCENTOFMEAN/)||this.szFlag.match(/DEVIATION/))r=map.Dictionary.getLocalText(" ( mean: ")+this.formatValue(this.nMeanA[nIndex],1)+this.szUnit+")";this.szFlag.match(/PERCENTOFMEDIAN/)&&(r=map.Dictionary.getLocalText(" ( median: ")+this.formatValue(this.nMedianA[nIndex],1)+this.szUnit+
")");this.itemA[u].nValue=this.itemA[u].nValuesA[nIndex];this.itemA[u].szLabel=l;this.itemA[u].szColor=this.colorScheme[nIndex];h=this.getItemNodes(u);for(e=0;e<h.length;e++)if(m=this.paintShape(h[e],this.colorScheme[nIndex]),m.setAttributeNS(szMapNs,"tooltip",this.formatValue(c,2)+this.szUnit+l+r),this.szFlag.match(/DOPACITY/)){var A=B=0,B=isNaN(this.itemA[u].nValuesA[nIndex])?0:this.itemA[u].nValuesA[nIndex],A=isNaN(this.nMaxA[nIndex])?0:this.nMaxA[nIndex];this.szAlphaField?(q=0,"undefined"!=typeof this.itemA[u].nAlpha&&
(q=1/(this.nDopacityPow||1),q=(this.nDopacityScale||1)/Math.pow(this.nMaxAlpha,q)*Math.pow(this.itemA[u].nAlpha,q))):this.szFlag.match(/DOPACITYLOGMEAN/)?q=Math.log((this.nDopacityScale||1)*(g-100))/Math.log(100):this.szFlag.match(/DOPACITYPOWMEAN/)?(q=1/(this.nDopacityPow||1),q=Math.pow((this.nDopacityScale||1)*(g-100),q)/Math.pow(100,q)):this.szFlag.match(/DOPACITYMEAN/)?q=(this.nDopacityScale||1)*(g-100)/100:this.szFlag.match(/DOPACITYLOGMAX/)?q=Math.log(B)/Math.log(A):this.szFlag.match(/DOPACITYPOWMAX/)?
(q=1/(this.nDopacityPow||1),q=(this.nDopacityScale||1)*Math.pow(B,q)/Math.pow(A,q)):q=this.szFlag.match(/DOPACITYMAX/)?(this.nDopacityScale||2)/A*B:Math.log((this.nDopacityScale||1)*B)/Math.log(A);q=1E-4>q?0:q;q=Math.min(this.nOpacity||.9,q);this.autoOpacity&&(q*=Math.max(.3,Math.min(1,.3+.7/Math.max(1,Math.log(map.Zoom.nZoom)))));m.style.setProperty("fill-opacity",String(q),"")}this.partsA[nIndex].nCount++}else for(h=this.getItemNodes(u),e=0;e<h.length;e++)this.unPaintShape(h[e]),h[e].removeAttributeNS(szMapNs,
"tooltip")}else for(c=this.szFlag.match(/CLIP/)&&this.nClipFrames?this.nClipFrames==this.itemA[u].nValuesA.length?Number(this.itemA[u].nValuesA[this.nActualFrame]):this.itemA[u].nValuesA[0]*(this.nClipFrames-1-this.nActualFrame)/(this.nClipFrames-1)+this.itemA[u].nValuesA[1]*this.nActualFrame/(this.nClipFrames-1):this.itemA[u].nValuesA[0],l=0;l<this.partsA.length;l++)if(c<this.partsA[l].max){this.itemA[u].nValue=c;this.itemA[u].szColor=this.partsA[l].color;if(this.itemA[u].todo){h=this.getItemNodes(u);
for(e=0;e<h.length;e++)m=this.paintShape(h[e],this.partsA[l].color,c),this.szLabelA&&this.szLabelA[l]&&this.szFlag.match(/EXACT/)?m.setAttributeNS(szMapNs,"tooltip",this.szLabelA[l]):m.setAttributeNS(szMapNs,"tooltip",this.formatValue(c,2)+this.szUnit),this.szFlag.match(/DOPACITY/)&&(this.szAlphaField?(q=0,"undefined"!=typeof this.itemA[u].nAlpha&&(q=1/(this.nDopacityPow||1),q=(this.nDopacityScale||1)/Math.pow(this.nMaxAlpha,q)*Math.pow(this.itemA[u].nAlpha,q))):0>this.nMin&&0<this.nMax?this.szFlag.match(/DOPACITYMAX/)?
(q=1/(this.nDopacityPow||1),q=Math.pow(Math.abs(c),q)/Math.pow(this.nMedianA[0]-this.nMin,q)*(this.fillOpacity||1)*(this.nDopacityScale||1)):q=this.szFlag.match(/DOPACITYLOG/)?Math.log(Math.abs(c))/Math.log(this.nMedianA[0]-this.nMin)*.5*(this.fillOpacity||1)*(this.nDopacityScale||1):Math.abs(c)/(this.nMedianA[0]-this.nMin)*.5*(this.fillOpacity||1)*(this.nDopacityScale||1):this.szFlag.match(/BIPOLAR/)||this.szFlag.match(/DOPACITYMINMAX/)?this.szFlag.match(/DOPACITYMAX/)?(q=1/(this.nDopacityPow||1),
q=c>=this.nMeanA[0]?Math.pow(Math.abs(c-this.nMeanA[0]),q)/Math.pow(Math.abs(this.nMax-this.nMeanA[0]),q)*(this.fillOpacity||1)*(this.nDopacityScale||1):Math.pow(Math.abs(this.nMeanA[0]-c),q)/Math.pow(Math.abs(this.nMeanA[0]-this.nMin),q)*(this.fillOpacity||1)*(this.nDopacityScale||1)):this.szFlag.match(/DOPACITYLOG/)?q=c>=this.nMedianA[0]?Math.log(Math.abs(c-this.nMedianA[0]))/Math.log(this.nMax-this.nMedianA[0])*(this.fillOpacity||1)*(this.nDopacityScale||1):Math.log(Math.abs(c-this.nMedianA[0]))/
Math.log(this.nMedianA[0]-this.nMin)*(this.fillOpacity||1)*(this.nDopacityScale||1):(q=1/(this.nDopacityPow||1),q=c>=this.nMedianA[0]?Math.pow(Math.abs(c-this.nMedianA[0]),q)/Math.pow(this.nMax-this.nMedianA[0],q)*(this.fillOpacity||1)*(this.nDopacityScale||1):Math.pow(Math.abs(c-this.nMedianA[0]),q)/Math.pow(this.nMedianA[0]-this.nMin,q)*(this.fillOpacity||1)*(this.nDopacityScale||1)):this.szFlag.match(/DOPACITYMIN/)?(q=1/(this.nDopacityPow||1),q=Math.pow(this.nMax-c,q)/Math.pow(this.nMax-this.nMin,
q)*(this.fillOpacity||1)*(this.nDopacityScale||1)):this.szFlag.match(/DOPACITYMAX/)?(q=1/(this.nDopacityPow||1),q=Math.pow(c-this.nMin,q)/Math.pow(this.nMax-this.nMin,q)*(this.fillOpacity||1)*(this.nDopacityScale||1)):this.szFlag.match(/DOPACITYLOG/)?q=Math.log(c-this.nMin)/Math.log(this.nMedianA[0]-this.nMin)*.5*(this.fillOpacity||1)*(this.nDopacityScale||1):this.szFlag.match(/DOPACITY/)&&(q=(c-this.nMin)/(this.nMedianA[0]-this.nMin)*.5*(this.fillOpacity||1)*(this.nDopacityScale||1)),q=1E-4>q?0:
q,q=Math.min(this.nOpacity||.9,q),this.autoOpacity&&(q*=Math.max(.3,Math.min(1,.3+.7/Math.max(1,Math.log(map.Zoom.nZoom))))),m.style.setProperty("fill-opacity",String(q),""));this.itemA[u].todo=!1}this.partsA[l].nCount++;this.partsA[l].nSum+=c;w=!0;break}if(!w)for(this.itemA[u].szColor=this.szNoDataColor?this.szNoDataColor:"white",h=this.getItemNodes(u),e=0;e<h.length;e++)m=this.paintShape(h[e],this.szNoDataColor?this.szNoDataColor:"white",-1),m.setAttributeNS(szMapNs,"tooltip","no value"),this.szFlag.match(/DOPACITY/)&&
m.style.setProperty("fill-opacity","0",""),this.nNoData++}this.isVisible=!0;this.realizeDone();this.fShowProgressBar=!1;this.showInfo();this.endDraw();this.szFlag.match(/CLIP/)?this.nClipFrames==this.itemA[u].nValuesA.length?this.szXaxisA&&this.szXaxisA[this.nActualFrame]?displayMessage(this.szXaxisA[this.nActualFrame],3E3,"big"):this.szLabelA&&this.szLabelA[this.nActualFrame]&&displayMessage(this.szLabelA[this.nActualFrame],3E3,"big"):(c=this.szXaxisA||this.szLabelA)&&(0==this.nActualFrame?displayMessage(c[0],
3E3,"big"):this.nActualFrame==this.nClipFrames-1?displayMessage(c[1],3E3,"big"):displayMessage(" ... ",3E3,"big")):this.ErrorMessage?(displayMessage(this.ErrorMessage,1E4,"notify"),this.ErrorMessage=null):clearMessage();this.szFlag.match(/VALUES/)&&(!this.szValueUpper||map.Scale.getTrueMapScale()*map.Scale.nZoomScale<=this.nValueUpper)?(this.mapSleep&&this.mapSleep.initCheckSleep(25),this.fContinue=this.fMakeLabel=!0,this.nActualFrame=this.nMissingPositionCount=this.nMissingRangeCount=this.nZeroValueCount=
this.nRealizedCount=this.nSkipCount=this.nDoneCount=this.continueIndex=0,setTimeout("map.Themes.continueExecute()",250)):this.unlabelMap()};
MapTheme.prototype.unpaintMap=function(){if(this.szFlag.match(/CHART/)){if(this.chartGroup){if(0==this.chartGroup.childNodes.length&&this.itemA){var f=null;for(a in this.itemA)(f=SVGDocument.getElementById(this.szId+":"+a+":chartgroup"))&&f.parentNode.removeChild(f)}f=this.chartGroup.getAttributeNS(null,"id");this.szFlag.match(/CLIP/)||this.szFlag.match(/CLEAR/)?map.Dom.removeElementById(f):executeWithMessage("map.Dom.removeElementById('"+f+"');","cleaning up ...");this.chartGroup=null}}else{this.beginDraw();
for(f=0;f<this.paintedShapeNodesA.length;f++)this.unPaintShape(this.paintedShapeNodesA[f]),this.paintedShapeNodesA[f].removeAttributeNS(szMapNs,"tooltip");this.paintedShapeNodesA.length=0;this.unlabelMap();this.endDraw();this.isVisible=!1;this.checkVisible();setTimeout("map.Layer.adaptLabel(null)",10)}};
MapTheme.prototype.paintShape=function(f,c,g){this.paintedShapeNodesA.push(f);switch(this.szShapeType){case "line":f.setAttributeNS(null,"style","stroke:"+c+";"+this.szStyle);break;case "line+buffer":var e=f.getAttributeNS(null,"id");if(!e.match(":paint")){var h=SVGDocument.getElementById(e+":paint");h||(h=f.cloneNode(1E3),f.parentNode.insertBefore(h,f),h.setAttributeNS(null,"id",e+":paint"));f=h}e=4;if(this.nBufferSize)if(this.nBufferSize.match(/\$value\$/)){g=this.nBufferSize.split("$value$");e=
"";for(h=0;h<g.length;h++)e+=g[h],h<g.length-1&&(e+="nValue");e=eval(e)}else e=this.nBufferSize.match(/value/)?1E3<100/(this.nMin+1E-9)*(this.nMax-this.nMin)?6+Math.log(g/this.nMax):10*g/(this.nMax-this.nMin):this.nBufferSize;e*=Math.log(1+1/__featureScaling_lastScale);f.setAttributeNS(null,"style","stroke:"+c+";stroke-width:"+map.Scale.normalX(e)*map.Scale.nZoomScale+";"+this.szStyle+";stroke-linecap:butt;");break;default:f.setAttributeNS(null,"style","fill:"+c+";"+this.szStyle)}return f};
MapTheme.prototype.unPaintShape=function(f){if("line+buffer"==this.szShapeType){var c=f.getAttributeNS(null,"id");(c=SVGDocument.getElementById(c+":paint"))&&c.parentNode.removeChild(c)}f.removeAttributeNS(null,"style")};
MapTheme.prototype.zoomToClass=function(f,c){var g=0;if(this.szFlag.match(/DOMINANT/))for(a in this.itemA)this.itemA[a].nClass==f&&g++;else g=this.partsA[f].nCount;if(0==g)displayMessage("No members !");else{var e=null;if(this.szFlag.match(/CHART/))for(var h=this.chartGroup.childNodes,g=0;g<h.length;g++){var m=h.item(g);if("seechilds"==m.getAttributeNS(szMapNs,"value"))for(var m=m.firstChild.childNodes,q=0;q<m.length;q++)m.item(q).getAttributeNS(szMapNs,"class");else m.getAttributeNS(szMapNs,"class")}else if(this.szFlag.match(/DOMINANT/))for(a in this.itemA)if(this.itemA[a].nClass==
f&&"highlight"==this.evidenceMode)for(e=this.getItemNodes(a),g=0;g<e.length;g++);else{if(this.itemA[a].nClass!=f&&"highlight"!=this.evidenceMode)for(e=this.getItemNodes(a),g=0;g<e.length;g++);}else{for(var h=new point(1E5,1E5),m=new point(-1E5,-1E5),q=this.partsA[f].min,l=this.partsA[f].max,g=1;g<c;g++)q=Math.min(q,this.partsA[f+g].min),l=Math.max(l,this.partsA[f+g].max);this.szFlag.match(/EXACT/)&&(q++,l++);for(a in this.itemA)if(this.itemA[a].nValuesA[0]>q&&this.itemA[a].nValuesA[0]<l)for(e=this.getItemNodes(a),
g=0;g<e.length;g++){bBox=map.Dom.getBox(e[g]);if(0==bBox.width||0==bBox.height){var r=getMatrix(e[g]);bBox.x+=r[4];bBox.y+=r[5];bBox.width=map.Scale.viewBox.width/20;bBox.height=map.Scale.viewBox.height/20;bBox.x-=bBox.width/2;bBox.y-=bBox.height/2}r=map.Scale.getMapOffset(e[g]);bBox.x+=r.x;bBox.y+=r.y;h.x=Math.min(h.x,bBox.x);h.y=Math.min(h.y,bBox.y);m.x=Math.max(m.x,bBox.x+bBox.width);m.y=Math.max(m.y,bBox.y+bBox.height)}g=new box(h.x,h.y,m.x-h.x,m.y-h.y);g.scale(1.2);g=map.Zoom.clipArea(g);map.Zoom.setNewArea(g)}}};
MapTheme.prototype.markClass=function(f,c){if(0!=this.fMarkEnable)if(map.Themes.enableSubThemes&&this.szFields.match(/\|/)&&this.szFlag.match(/DOMINANT/)&&!this.szFlag.match(/CHART/))this.createSubTheme(f);else{var g=this.szItemFilter&&this.szItemFilter.length;if(!this.szFlag.match(/CHART/)||g)this.fUnmarkEnable=!0,this.unmarkClass(),this.fUnmarkEnable=!1;if(0!=this.fMarkEnable){var e=0;if(this.szFlag.match(/DOMINANT/)&&!this.szFlag.match(/CHART/))for(a in this.itemA)this.itemA[a].nClass==f&&e++;
else e=this.partsA[f].nCount;if(500<e&&"highlight"==this.evidenceMode)displayMessage("Sorry ! to many members");else if(0==e)displayMessage("No members !");else{clearMessage();highLightList.removeAll();var h,e=null;if(this.szFlag.match(/CHART/))for(var m=this.chartGroup.childNodes,e=0;e<m.length;e++)if(h=m.item(e),"seechilds"==h.getAttributeNS(szMapNs,"value")){h=h.getElementsByTagName("g");for(var q=0;q<h.length;q++)for(var l=h.item(q).childNodes,r=0;r<l.length;r++){var w=l.item(r);if(w.getAttributeNS&&
w.getAttributeNS(szMapNs,"class")){if(this.szFlag.match(/SEQUENCE/)&&!this.szFlag.match(/PLOT/)){var B=w.getAttributeNS(null,"transform");B&&B.length&&(w.setAttributeNS(szMapNs,"transform",B),w.setAttributeNS(null,"transform",""))}B=Number(w.getAttributeNS(szMapNs,"class"));this.szFlag.match(/PIE/)&&(1<this.szFieldsA.length||this.szFlag.match(/AGGREGATE/)&&this.szFlag.match(/EXACT/))?B==f?((this.szFlag.match(/VALUES/)||DonutCharts.partDrawOut(w))&&w.style.setProperty("opacity","1",""),w.style.setProperty("display",
"inline","")):DonutCharts.partDrawIn(w)||w.style.setProperty("display","none",""):this.szFlag.match(/BAR/)&&this.szFlag.match(/3D/)&&!this.szFlag.match(/STACKED/)&&(1<this.szFieldsA.length||this.szFlag.match(/AGGREGATE/)&&this.szFlag.match(/EXACT/))?B==f?(w.setAttributeNS(null,"transform","matrix(1 0 0 1 -10 6.6)"),w.style.setProperty("fill-opacity","1","")):(w.setAttributeNS(null,"transform","matrix(1 0 0 1 0 0)"),w.style.setProperty("fill-opacity","0.85","")):B==f?g||w.style.setProperty("display",
"inline",""):w.style.setProperty("display","none","")}}}else B=Number(h.getAttributeNS(szMapNs,"class")),B==f?g||h.style.setProperty("display","inline",""):h.style.setProperty("display","none","");else{this.beginDraw();if(this.szFlag.match(/DOMINANT/))for(a in this.itemA)if(this.itemA[a].nClass==f&&"highlight"==this.evidenceMode)for(e=this.getItemNodes(a),h=0;h<e.length;h++)highLightList.addItem(e[h]);else{if(this.itemA[a].nClass!=f&&"highlight"!=this.evidenceMode)for(e=this.getItemNodes(a),h=0;h<
e.length;h++)e[h].setAttributeNS(szMapNs,"themestyle",e[h].getAttributeNS(null,"style")),e[h].style.setProperty("display","none","")}else{g=this.partsA[f].min;m=this.partsA[f].max;for(e=1;e<c;e++)g=Math.min(g,this.partsA[f+e].min),m=Math.max(m,this.partsA[f+e].max);for(a in this.itemA)if(this.szFlag.match(/EXACT/)&&this.itemA[a].nValuesA[0]==g){if("highlight"==this.evidenceMode)for(e=this.getItemNodes(a),h=0;h<e.length;h++)highLightList.addItem(e[h])}else if(this.itemA[a].nValuesA[0]>g&&this.itemA[a].nValuesA[0]<
m){if("highlight"==this.evidenceMode)for(e=this.getItemNodes(a),h=0;h<e.length;h++)highLightList.addItem(e[h])}else if("highlight"!=this.evidenceMode)for(e=this.getItemNodes(a),h=0;h<e.length;h++)if(this.szFlag.match(/BUFFER/))(q=SVGDocument.getElementById(e[h].getAttributeNS(null,"id")+":paint"))&&q.style.setProperty("display","none","");else{e[h].setAttributeNS(szMapNs,"themestyle",e[h].getAttributeNS(null,"style"));e[h].setAttributeNS(null,"style",e[h].getAttributeNS(szMapNs,"origthemestyle"));
if(q=SVGDocument.getElementById(e[h].firstChild.nextSibling.getAttribute("id")+"L"))q.setAttributeNS(szMapNs,"display",q.style.getPropertyValue("display")),q.style.setProperty("display","none","");if(q=SVGDocument.getElementById(e[h].firstChild.nextSibling.getAttribute("id")+"L:bg"))q.setAttributeNS(szMapNs,"display",q.style.getPropertyValue("display")),q.style.setProperty("display","none","")}}this.endDraw();this.fMarkClass=!0}}}}};
MapTheme.prototype.unmarkClass=function(f){if(0!=this.fUnmarkEnable)if(this.subTheme)this.removeSubTheme();else if(this.szItemFilter&&this.szItemFilter.length)this.fMarkEnable=!0,this.filterItems(this.szItemFilter,this.itemFilterOpt);else if(clearMessage(),this.szFlag.match(/CHART/)){f=this.chartGroup.childNodes;for(var c=0;c<f.length;c++){var g=f.item(c);if("seechilds"==g.getAttributeNS(szMapNs,"value"))for(var g=g.getElementsByTagName("g"),e=0;e<g.length;e++)for(var h=g.item(e).childNodes,m=0;m<
h.length;m++){var q=h.item(m);if(q.getAttributeNS&&q.getAttributeNS(szMapNs,"class")){if(this.szFlag.match(/SEQUENCE/)){var l=q.getAttributeNS(szMapNs,"transform");l&&l.length&&q.setAttributeNS(null,"transform",l)}this.szFlag.match(/PIE/)&&(DonutCharts.partDrawIn(q),q.style.setProperty("opacity","1",""));this.szFlag.match(/BAR/)&&this.szFlag.match(/3D/)&&!this.szFlag.match(/STACKED/)&&(q.setAttributeNS(null,"transform","matrix(1 0 0 1 0 0)"),q.style.setProperty("fill-opacity","1",""));q.style&&q.style.setProperty("display",
"inline","")}}else g.style.setProperty("display","inline","")}this.szFlag.match(/TEXTONLY/)&&setTimeout("map.Layer.adaptLabel()",10)}else{this.beginDraw();if("highlight"!=this.evidenceMode)for(a in this.itemA)for(f=this.getItemNodes(a),c=0;c<f.length;c++)this.szFlag.match(/BUFFER/)?(g=SVGDocument.getElementById(f[c].getAttributeNS(null,"id")+":paint"))&&g.style.setProperty("display","inline",""):(g=f[c].getAttributeNS(szMapNs,"themestyle"))&&g.length&&"null"!=g&&(f[c].setAttributeNS(null,"style",
g),f[c].removeAttributeNS(szMapNs,"themestyle"),(g=SVGDocument.getElementById(f[c].firstChild.nextSibling.getAttribute("id")+"L"))&&g.style.setProperty("display",g.getAttributeNS(szMapNs,"display"),""),(g=SVGDocument.getElementById(f[c].firstChild.nextSibling.getAttribute("id")+"L:bg"))&&g.style.setProperty("display",g.getAttributeNS(szMapNs,"display"),""));else highLightList.removeAll();this.endDraw();this.fMarkClass=!1}};
MapTheme.prototype.showClass=function(f,c,g){var e=0;if(this.szFlag.match(/DOMINANT/))for(a in this.itemA)this.itemA[a].nClass==f&&e++;clearMessage();var h=null,e=g?"inline":"none";if(this.szFlag.match(/CHART/))for(g=this.chartGroup.childNodes,h=0;h<g.length;h++){var m=g.item(h);if("seechilds"==m.getAttributeNS(szMapNs,"value"))for(m=m.firstChild.childNodes,c=0;c<m.length;c++){var q=m.item(c),l=Number(q.getAttributeNS(szMapNs,"class"));l==f&&q.style.setProperty("display",e,"")}else l=Number(m.getAttributeNS(szMapNs,
"class")),l==f&&m.style.setProperty("display",e,"")}else{this.beginDraw();if(this.szFlag.match(/DOMINANT/))for(a in this.itemA){if(this.itemA[a].nClass==f)for(h=this.getItemNodes(a),c=0;c<h.length;c++)h[c].setAttributeNS(szMapNs,"themestyle",h[c].getAttributeNS(null,"style")),h[c].style.setProperty("display",e,"")}else{l=this.partsA[f].min;m=this.partsA[f].max;for(h=1;h<c;h++)l=Math.min(l,this.partsA[f+h].min),m=Math.max(m,this.partsA[f+h].max);this.szFlag.match(/EXACT/)&&(l++,m++);for(a in this.itemA)if(this.szFlag.match(/EXACT/)&&
this.itemA[a].nValuesA[0]==l||this.itemA[a].nValuesA[0]>l&&this.itemA[a].nValuesA[0]<m)for(h=this.getItemNodes(a),c=0;c<h.length;c++)this.szFlag.match(/BUFFER/)?(f=SVGDocument.getElementById(h[c].getAttributeNS(null,"id")+":paint"))&&f.style.setProperty("display",e,""):g?(f=h[c].getAttributeNS(szMapNs,"themestyle"))&&f.length&&"null"!=f&&(h[c].setAttributeNS(null,"style",f),h[c].removeAttributeNS(szMapNs,"themestyle")):(h[c].setAttributeNS(szMapNs,"themestyle",h[c].getAttributeNS(null,"style")),h[c].setAttributeNS(null,
"style",h[c].getAttributeNS(szMapNs,"origthemestyle")))}this.endDraw()}};
MapTheme.prototype.createSubTheme=function(f){this.subTheme&&this.removeSubTheme();var c="",g="",e="",h="",m="",q="",l="",r="";this.coTable&&"undefined"!=typeof this.coTable&&(c="dbtable:"+this.coTable+";");this.szSelectionField&&"undefined"!=typeof this.szSelectionField&&(g="lookupfield:"+this.szSelectionField+";");this.szAlphaField&&"undefined"!=typeof this.szAlphaField&&(e="alphafield:"+this.szAlphaField+";");this.szAlphaField100&&"undefined"!=typeof this.szAlphaField100&&(h="alphafield100:"+this.szAlphaField100+
";");this.nDopacityScale&&"undefined"!=typeof this.nDopacityScale&&(m="dopacityscale:"+this.nDopacityScale+";");this.nDopacityPow&&"undefined"!=typeof this.nDopacityPow&&(q="dopacitypow:"+this.nDopacityPow+";");this.szFlag.match(/DOPACITY/)&&(l+="DOPACITYMAX|");this.szFlag.match(/AGGREGATE/)&&(l+="AGGREGATE|");this.szFlag.match(/SUM/)&&(l+="SUM|");this.szFlag.match(/ZEROISVALUE/)&&(l+="ZEROISVALUE|");this.szFlag.match(/VALUES/)&&(l+="VALUES|");this.szAggregationField&&"undefined"!=typeof this.szAggregationField&&
(r+="aggregationfield:"+this.szAggregationField+";");this.szUnits&&"undefined"!=typeof this.szUnits&&(r+="units:"+this.szUnits+";");map.Themes.enableMultiChoroplethe=!0;this.subTheme=map.Themes.newTheme2(this.szThemes,this.szFields.split("|")[f],this.szField100,"type:CHOROPLETHE|QUANTILE|NOINFO|SUBTHEME|"+l+";colorscheme:7|white|"+this.colorScheme[f]+";"+c+g+e+h+m+q+r,this.szLabelA[f],"");map.Themes.subTheme=this};
MapTheme.prototype.removeSubTheme=function(){map.Themes.enableMultiChoroplethe=!1;this.subTheme&&(map.Themes.subTheme=!1,map.Themes.removeTheme(null,this.subTheme.szId),this.subTheme=null,map.Themes.realizeDone(this))};
MapTheme.prototype.isItemInFilter=function(f,c,g,e){if(!(0!=g.length||e&&e.field))return!0;if("undefined"!=typeof c.dbIndex)if(c=c.dbIndex,this.__szValue=f.dbRecords[c].join(" "),g.length){if(eval("this.__szValue.match(/"+g.replace(/\//gi,"\\/")+"/i)"))return!0}else if(e&&e.field){for(g=0;g<f.dbFields.length;g++)if(f.dbFields[g].id==e.field&&(e.min&&f.dbRecords[c][g]<e.min||e.max&&f.dbRecords[c][g]>e.max))return!1;return!0}return!1};
MapTheme.prototype.filterItems=function(f,c){if(0!=this.fMarkEnable){this.szItemFilter=f;this.itemFilterOpt=c;this.filterNodesA=f.length||c&&c.field?[]:null;for(var g=null,e=0;e<this.szThemesA.length&&(!(g=this.objThemesA[this.szThemesA[e]])||!g.dbRecords);e++);if(g&&g.dbRecords){if(this.szFlag.match(/CHART/))for(var h=this.chartGroup.childNodes,e=0;e<h.length;e++){var m=[],q=h.item(e);m.push(q);for(var l=0;l<m.length;l++)szId=m[l].getAttributeNS(null,"id"),szId=szId.split(":")[1]+"::"+szId.split(":")[3],
this.itemA[szId]?this.isItemInFilter(g,this.itemA[szId],f,c)?(q.style.setProperty("display","inline",""),this.filterNodesA&&this.filterNodesA.push(szId)):q.style.setProperty("display","none",""):q.style.setProperty("display","inline","")}else{this.beginDraw();for(a in this.itemA)if(this.itemA[a]&&"undefined"!=typeof this.itemA[a].dbIndex)if(this.isItemInFilter(g,this.itemA[a],f,c))for(this.filterNodesA&&this.filterNodesA.push(a),tilesNodesA=this.getItemNodes(a),j=0;j<tilesNodesA.length;j++)this.szFlag.match(/BUFFER/)?
(e=SVGDocument.getElementById(tilesNodesA[j].getAttributeNS(null,"id")+":paint"))&&e.style.setProperty("display","inline",""):(e=tilesNodesA[j].getAttributeNS(szMapNs,"themestyle"))&&e.length&&"null"!=e&&(tilesNodesA[j].setAttributeNS(null,"style",e),tilesNodesA[j].removeAttributeNS(szMapNs,"themestyle"),(e=SVGDocument.getElementById(tilesNodesA[j].firstChild.nextSibling.getAttribute("id")+"L"))&&e.style.setProperty("display",e.getAttributeNS(szMapNs,"display"),""),(e=SVGDocument.getElementById(tilesNodesA[j].firstChild.nextSibling.getAttribute("id")+
"L:bg"))&&e.style.setProperty("display",e.getAttributeNS(szMapNs,"display"),""));else for(tilesNodesA=this.getItemNodes(a),j=0;j<tilesNodesA.length;j++)if(this.szFlag.match(/BUFFER/))(e=SVGDocument.getElementById(tilesNodesA[j].getAttributeNS(null,"id")+":paint"))&&e.style.setProperty("display","none","");else{tilesNodesA[j].getAttributeNS(szMapNs,"themestyle")||tilesNodesA[j].setAttributeNS(szMapNs,"themestyle",tilesNodesA[j].getAttributeNS(null,"style"));tilesNodesA[j].setAttributeNS(null,"style",
tilesNodesA[j].getAttributeNS(szMapNs,"origthemestyle"));if(e=SVGDocument.getElementById(tilesNodesA[j].firstChild.nextSibling.getAttribute("id")+"L"))e.setAttributeNS(szMapNs,"display",e.style.getPropertyValue("display")),e.style.setProperty("display","none","");if(e=SVGDocument.getElementById(tilesNodesA[j].firstChild.nextSibling.getAttribute("id")+"L:bg"))e.setAttributeNS(szMapNs,"display",e.style.getPropertyValue("display")),e.style.setProperty("display","none","")}this.endDraw()}this.fMarkClass=
!0}}};MapTheme.prototype.selectFilterItems=function(){map.Selections.newSelection("generic",this.filterNodesA,"type:queryresult",this.szItemFilter)};
MapTheme.prototype.labelMap=function(f){var c=map.Zoom.getBox(),g=null;this.szValuesTextStyle="font-family:verdana;font-size:"+map.Scale.normalX(11)+"px;pointer-events:none";if(!f||0==f){var e=0;f=0;this.indexA=[];var h=0,m=0;if(this.fClipCharts)for(e in this.itemA){if(m++,this.itemA[e].nValuesA&&0<this.itemA[e].nValuesA.length&&(g=this.getNodePosition(this.itemA[e].szSelectionId)))if(g.x<c.x||g.x>c.x+c.width||g.y<c.y||g.y>c.y+c.height){if(this.nSkipCount++,chartGroup=SVGDocument.getElementById(this.szId+
":"+e+":chart"))chartGroup.parentNode.removeChild(chartGroup),this.chartPosA[this.itemA[e].szSelectionId]=null,this.posItemA[this.itemA[e].szSelectionId]=null}else this.indexA[this.indexA.length]=e,h++}else for(e in this.itemA)this.indexA[this.indexA.length]=e,m++,h++;h>this.nMaxThemeCharts&&(this.indexA.length=0,this.nSkipCount=h);this.mapSleep&&(this.mapSleep.nCount=h);this.fEnableProgressBar=!1}for(;f<this.indexA.length;f++){if(this.fCancel){displayMessage("Canceled by user",1E3,!0);this.fCancel=
!1;return}if(this.mapSleep&&(this.mapSleep.nDoneCount=this.nDoneCount,this.mapSleep.checkSleep(f,10))){this.fContinue=!0;this.continueIndex=f;return}e=this.indexA[f];this.nDoneCount++;if(this.itemA[e].nValuesA&&0<this.itemA[e].nValuesA.length)if(g=this.getNodePosition(this.itemA[e].szSelectionId))if(this.fClipCharts&&!this.szFlag.match(/BUFFER/)&&(g.x<c.x||g.x>c.x+c.width||g.y<c.y||g.y>c.y+c.height))this.nSkipCount++;else for(g=this.getItemNodes(e),j=0;j<g.length;j++)this.labelShape(g[j],this.itemA[e].szColor,
this.itemA[e].szLabel?this.itemA[e].szLabel:this.itemA[e].nValue);else this.nMissingPositionCount++}this.fMakeLabel=!1;setTimeout("map.Layer.adaptLabel(null)",10)};MapTheme.prototype.unlabelMap=function(){for(a in map.Layer.generatedLabelA)map.Dom.removeElementById(a),map.Layer.generatedLabelA[a]=null};
MapTheme.prototype.labelShape=function(f,c,g){if(this.szFlag.match(/VALUES/)&&"undefined"!=g&&"undefined"!=typeof g&&(!this.szFlag.match(/NOZERO/)||0!=g)){var e=f.parentNode.getAttributeNS(null,"id"),h=SVGDocument.getElementById(e+":label");if(h){var m=SVGDocument.getElementById(e+":values:bg");m||(m=map.Dom.newGroup(h.parentNode,e+":values:bg"),map.Layer.generatedLabelA[e+":values:bg"]=m);var q=SVGDocument.getElementById(e+":values");q||(q=map.Dom.newGroup(h.parentNode,e+":values"),map.Layer.generatedLabelA[e+
":values"]=q);try{var l=f.firstChild.nextSibling.getAttributeNS(null,"id").split("#"),r=l[0]+"L"+(l[1]?"#"+l[1]:"")}catch(w){r=f.getAttributeNS(null,"id")+":::value"}SVGDocument.getElementById(r)||(c=__maptheme_getChartColors(c),g="string"==typeof g?g:this.formatValue(g,1)+(this.szUnit.match(/\%/)?"%":""),e=c.lowColor,h=1,c="1",this.szFlag.match(/DOPACITY/)&&(c=f.style.getPropertyValue("fill-opacity"),h=Math.min(1.3,3*Number(c))),h=map.Scale.normalX(11)*map.Scale.nZoomScale*h*map.Scale.nLabelScaling*
(this.nLabelScale||1),m=map.Dom.newText(m,0,0,"font-family:verdana;font-weight:normal;font-size:"+h+"px;text-anchor:middle;fill:none;stroke:"+e+";stroke-width:"+map.Scale.normalX(4)*map.Scale.nZoomScale+";stroke-opacity:0.5;pointer-events:none;display:none;stroke-linejoin:bevel;",g),q=map.Dom.newText(q,0,0,"font-family:verdana;font-weight:normal;font-size:"+h+"px;text-anchor:middle;fill:#ffffff;stroke:none;pointer-events:none;display:none;",g),q.setAttributeNS(null,"id",r),m.setAttributeNS(null,"id",
r+":bg"),this.szFlag.match(/DOPACITY/)&&(q.style.setProperty("fill-opacity",c,""),m.style.setProperty("stroke-opacity",c,"")),(r=f.getAttributeNS(szMapNs,"center"))?(f=r.split(","),f=new point(Number(f[0].split(":")[1]),Number(f[1].split(":")[1]))):f=this.getNodePosition(f.getAttributeNS(null,"id")),f&&(q.fu.setPosition(f.x,f.y),m.fu.setPosition(f.x,f.y)))}}};
MapTheme.prototype.chartMap=function(f){var c;if(!this.nChartUpper||map.Scale.getTrueMapScale()*map.Scale.nZoomScale<=this.nChartUpper){this.chartGroup&&!f&&(this.chartPosA=[]);var g=this.nChartSize?this.nChartSize:30,e=map.Zoom.getBox();c=this.szFlag.match(/AGGREGATE/)?map.Scale.getDeltaXofDistanceInMeter(this.nGridWidth)*map.Scale.nZoomScale:map.Scale.normalX(30)*map.Scale.nZoomScale;e.x-=c/2;e.y-=c/2;e.width+=c;e.height+=c;var h=null,m="#777777",q=8;if(!f||0==f){if(!this.partsA)return;var l=0;
f=0;this.indexA=[];this.szValuesLineStyle="stroke:white;stroke-width:"+map.Scale.normalX(1.5)+";opacity:0.5;";this.szValuesLineBgStyle="stroke:#888888;stroke-width:"+map.Scale.normalX(.5)+";opacity:1;";this.szValuesTextStyle="font-family:"+(this.szTextFont||"arial")+";font-size:"+map.Scale.normalX(q)+"px;fill:"+m+";pointer-events:none";var r=map.Layer.objectGroup;if(!this.chartGroup&&(this.chartGroup=map.Dom.newGroup(r,this.szId+":chartgroup"),this.chartGroup.style.setProperty("opacity",String(this.nOpacity?
this.nOpacity:1),""),this.szFlag.match(/NOSCALE/)&&antiZoomAndPanList.addGroup(this.chartGroup),this.szFlag.match(/AGGREGATE/)&&(this.szFlag.match(/AUTOSIZE/)||this.szFlag.match(/GRIDSIZE/))&&antiZoomAndPanList.addGroup(this.chartGroup),this.szFlag.match(/BUFFER/))){this.szFlag.match(/OVERLAY/)&&!this.szShapeType.match(/line/)&&this.chartGroup.style.setProperty("opacity","1","");map.Layer.getLayerObj(this.szThemesA[0]);this.chartGroup.style.setProperty("pointer-events","none","");antiZoomAndPanList.addGroup(this.chartGroup);
m=this.colorScheme[0];q=this.colorScheme[1]?this.colorScheme[1]:"red";"undefined"!=typeof this.szBorderColor&&(q=this.szBorderColor);var w="stroke-width:0;";if("undefined"!=typeof this.szBorderStyle)switch(this.szBorderStyle){case "dotted":w="stroke-width:"+map.Scale.normalX(1)+";stroke-linecap:round;stroke-dasharray:1,50;";break;case "dashed":w="stroke-width:"+map.Scale.normalX(1)+";stroke-linecap:butt;stroke-dasharray:30,30;";break;case "solid":w="stroke-width:"+map.Scale.normalX(1)+";";break;case "none":w=
"stroke-width:0;"}if("undefined"!=typeof this.szBorderWidth)switch(this.szBorderWidth){case "thin":w+="stroke-width:"+map.Scale.normalX(.5)+";";break;case "thick":w+="stroke-width:"+map.Scale.normalX(1.5)+";"}this.chartGroup.setAttributeNS(null,"style","fill:"+m+";fill-opacity:"+(this.fillOpacity?this.fillOpacity:this.nOpacity?this.nOpacity:0)+";stroke:"+q+";"+w+";")}this.blur(this.nBlur);this.mapSleep&&(this.mapSleep.checkSleepMessage="creating charts");r=getRotateAttributeValue(map.Scale.canvasNode);
if(this.szFlag.match(/CHART/)&&!this.szFlag.match(/EXACT/)){for(s=0;s<this.partsA.length;s++)this.partsA[s].nCount=0,this.partsA[s].nSum=0;this.fRedrawInfo=!0;this.szFlag.match(/SEQUENCE/)&&(this.nFadeNegative=this.nFadeNegative||1)}w=q=0;if(this.fClipCharts&&!this.szFlag.match(/BUFFER/)){for(c=0;c<this.partsA.length;c++)this.partsA[c].nSum=0;for(l in this.itemA)if(w++,this.itemA[l].nValuesA&&0<this.itemA[l].nValuesA.length)if(h=this.getNodePosition(this.itemA[l].szSelectionId))if(h.x<e.x||h.x>e.x+
e.width||h.y<e.y||h.y>e.y+e.height){if(this.nSkipCount++,chartGroup=SVGDocument.getElementById(this.szId+":"+l+":chart"))chartGroup.parentNode.removeChild(chartGroup),this.chartPosA[this.itemA[l].szSelectionId]=null,this.posItemA[this.itemA[l].szSelectionId]=null}else{this.indexA[this.indexA.length]=l;if(this.szFlag.match(/CHART/)&&!this.szFlag.match(/EXACT/))for(c=0;c<this.partsA.length;c++)this.partsA[c].nCount++,this.partsA[c].nSum+=isNaN(this.itemA[l].nValuesA[c])?0:this.itemA[l].nValuesA[c];
else this.szFlag.match(/CHART/)&&this.partsA[this.itemA[l].nValuesA[0]-1]&&(this.partsA[this.itemA[l].nValuesA[0]-1].nSum+=isNaN(this.itemA[l].nSize)?1:this.itemA[l].nSize);q++}else this.missedA[l]=l}else for(l in this.itemA){this.indexA[this.indexA.length]=l;if(this.szFlag.match(/CHART/)&&!this.szFlag.match(/EXACT/))for(c=0;c<this.partsA.length;c++)this.partsA[c].nCount++,this.partsA[c].nSum+=isNaN(this.itemA[l].nValuesA[c])?0:this.itemA[l].nValuesA[c];w++;q++}if(q>this.nMaxThemeCharts)for(l in this.ErrorMessage=
"max charts ("+this.nMaxThemeCharts+") exceeded; please zoom in",this.indexA.length=0,this.nSkipCount=q,this.itemA)(chartGroup=SVGDocument.getElementById(this.szId+":"+l+":chart"))&&chartGroup.parentNode.removeChild(chartGroup);this.fRedrawAllCharts=!1;q>this.nMaxShadowCharts?(this.fShadow&&(this.fRedrawAllCharts=!0),this.fShadow=!1):(this.fOrigShadow&&!this.fShadow&&(this.fRedrawAllCharts=!0),this.fShadow=this.fOrigShadow);this.mapSleep&&(this.mapSleep.nCount=q);this.fSorted=!1;if(this.fSortBeforeDraw&&
!this.szFlag.match(/NOSRT/)&&(!this.szFlag.match(/NOSIZE/)||this.szFlag.match(/3D/)||this.szFlag.match(/SORT/))&&(!this.szFlag.match(/EXACT/)||this.szFlag.match(/AGGREGATE/)||this.szSizeField)){q=[];if((this.szFlag.match(/3D/)||this.szFlag.match(/BOX/)||this.szFlag.match(/POINTER/))&&(!this.szFlag.match(/MULTIPLE/)&&!this.szFlag.match(/MULTIGRID/)||this.szFlag.match(/AGGREGATE/)))for(c=0;c<this.indexA.length;c++)(h=this.getNodePosition(this.itemA[this.indexA[c]].szSelectionId))?q[c]=r?{a:this.indexA[c],
y:h.x*Math.sin(r)+h.y*Math.cos(r)}:{a:this.indexA[c],y:h.y}:q[c]={a:this.indexA[c],y:0};else for(c=0;c<this.indexA.length;c++)h=this.itemA[this.indexA[c]].nValuesA[this.nActualFrame||0],this.itemA[this.indexA[c]].nSize?h=this.itemA[this.indexA[c]].nSize:this.szFlag.match(/SIZE/)&&this.itemA[this.indexA[c]].nValueSum&&(h=this.itemA[this.indexA[c]].nValueSum),isNaN(h)||q.push({a:this.indexA[c],y:h});this.szFlag.match(/SORT/)&&this.szFlag.match(/DOWN/)&&!this.szFlag.match(/SEQUENCE/)&&!this.szFlag.match(/3D/)?
q.sort(this.sortDownChartObjectsCompare):q.sort(this.sortChartObjectsCompare);for(c=0;c<q.length;c++)this.indexA[c]=q[c].a;this.fSorted=!0}}this.chart={szColor:this.colorScheme[0],szLineColor:this.colorScheme[1]?this.colorScheme[1]:"none",szTextColor:this.colorScheme[1]?this.colorScheme[1]:"none"};if(2<this.colorScheme.length||this.szFlag.match(/EXACT/))this.chart.szColor=this.colorScheme[this.colorScheme.length-1],this.chart.szLineColor=this.colorScheme[0];this.szFlag.match(/NOLINES/)?this.chart.szLineColor=
"none":"none"==this.chart.szLineColor&&(c=__maptheme_getChartColors(m),this.chart.szLineColor=c.textColor);for(;f<this.indexA.length;f++){if(this.fCancel){displayMessage("Canceled by user",1E3,!0);this.fCancel=!1;return}if(this.mapSleep&&(this.mapSleep.nDoneCount=this.nDoneCount,this.mapSleep.checkSleep(f,10))){this.fContinue=!0;this.continueIndex=f;this.szItemFilter&&this.szItemFilter.length&&this.filterItems(this.szItemFilter,this.itemFilterOpt);null!=this.markedClass&&this.markClass(this.markedClass,
1);return}c=null;l=this.indexA[f];this.nDoneCount++;if(this.itemA[l].nValuesA&&0<this.itemA[l].nValuesA.length)if(m=this.itemA[l].szSelectionId,h=this.getNodePosition(m))if(this.fClipCharts&&!this.szFlag.match(/BUFFER/)&&(h.x<e.x||h.x>e.x+e.width||h.y<e.y||h.y>e.y+e.height))this.nSkipCount++;else{this.fRedraw&&(this.itemA[l].chartNode=this.itemA[l].chartNode||SVGDocument.getElementById(this.szId+":"+l+":chart"));if(this.itemA[l].chartNode&&this.itemA[l].chartNode.parentNode)if(this.fRedraw||this.fRedrawAllCharts||
this.szFlag.match(/BUFFER/)&&this.szShapeType.match(/line/))this.itemA[l].chartNode.parentNode.removeChild(this.itemA[l].chartNode),this.itemA[l].chartNode=null;else{this.itemA[l].chartNode.parentNode.appendChild(this.itemA[l].chartNode);this.nRealizedCount++;continue}q=new point(0,0);c=null;if(m)if(c=SVGDocument.getElementById(this.szId+":"+m+":chart"))c.fu=new Methods(c);else if(c=map.Dom.newGroup(this.chartGroup,this.szId+":"+m+":chart"),this.szFlag.match(/BOX/)){q="#bbbbbb";"undefined"!=typeof this.szBorderColor&&
(q=this.szBorderColor);w="stroke-width:"+map.Scale.normalX(.5)+";stroke-opacity:0.3;";if("undefined"!=typeof this.szBorderStyle)switch(this.szBorderStyle){case "dotted":w="stroke-width:"+map.Scale.normalX(1)+";stroke-linecap:round;stroke-dasharray:1,50;";break;case "dashed":w="stroke-width:"+map.Scale.normalX(1)+";stroke-linecap:butt;stroke-dasharray:30,30;";break;case "solid":w="stroke-width:"+map.Scale.normalX(1)+";";break;case "none":w="stroke-width:0;"}if("undefined"!=typeof this.szBorderWidth)switch(this.szBorderWidth){case "thin":w+=
"stroke-width:"+map.Scale.normalX(.3)+";";break;case "thick":w+="stroke-width:"+map.Scale.normalX(1.5)+";"}newBox=map.Dom.newShape("rect",c,0,0,1,1,"fill:"+(this.szBoxColor||"white")+";fill-opacity:"+(this.nBoxOpacity||1)+";stroke:"+q+";"+w);newBox.setAttributeNS(null,"id",this.szId+":"+m+":chart:box");switch(this.szSymbolBoxStyle){case "frame":this.boxShape.setAttributeNS(null,"fill-opacity",0);break;case "field":this.boxShape.setAttributeNS(null,"fill-opacity",1)}}this.itemA[l].chartNode=c;c.setAttributeNS(szMapNs,
"value",String(this.itemA[l].nValuesA[0]));(q=this.drawChart(c,l,g,this.szFlag+"|SILENT"))&&h&&c&&(w=this.szFlag.match(/BUFFER/)?1:map.Scale.nObjectScaling,this.szFlag.match(/NOSCALE/)?(c.fu.setPosition(h.x-q.x,h.y-q.y*this.nScale),c.fu.scale(this.nScale,this.nScale)):fObjectScaling?(c.fu.setPosition(h.x-q.x,h.y-q.y*map.Layer.nObjectScale*this.nScale),c.fu.scale(this.nScale*map.Layer.nObjectScale*w,this.nScale*map.Layer.nObjectScale*w)):(c.fu.setPosition(h.x-q.x,h.y-q.y*map.Scale.nFeatureScaling*
w*this.nScale),c.fu.scale(this.nScale*map.Scale.nFeatureScaling*w,this.nScale*map.Scale.nFeatureScaling*w)));if(q){if((this.szFlag.match(/MULTIPLE/)||this.szFlag.match(/ALIGN/))&&c.lastChild.firstChild){h=map.Dom.getBox(c.lastChild);q=this.szFlag.match(/UP/)?h.height:h.width;if(this.chartPosA[m]){this.chartPosA[m]+=this.szFlag.match(/TEXTONLY/)?5:.5*q;var w=c.lastChild.fu.getPosition(),B=q*(this.nGridX||10);this.szFlag.match(/UP/)?c.lastChild.fu.setPosition(w.x+h.width*Math.floor(this.chartPosA[m]/
B),w.y-this.chartPosA[m]%B):c.lastChild.fu.setPosition(w.x+this.chartPosA[m]%B,w.y-h.height*Math.floor(this.chartPosA[m]/B));this.chartPosA[m]+=this.szFlag.match(/TEXTONLY/)?q:.5*q}else this.chartPosA[m]=this.szFlag.match(/TEXTONLY/)?q:.5*q;this.posItemA&&(this.posItemA[m]||(this.posItemA[m]=[]),this.posItemA[m].push(this.itemA[l]))}else if((this.szFlag.match(/MULTIFIX/)||this.szFlag.match(/MULTIGRID/))&&c.lastChild){var q=1,h=map.Scale.normalX(15),u=map.Scale.normalX(15);if(this.chartPosA[m]){var w=
c.lastChild.fu.getPosition(),A=this.chartPosA[m],B=this.nGridX||7;this.szFlag.match(/UP/)?c.lastChild.fu.setPosition(w.x+h*Math.floor(A/B),w.y-A%B*u):c.lastChild.fu.setPosition(w.x+A%B*h,w.y-u*Math.floor(A/B));this.chartPosA[m]+=q}else this.chartPosA[m]=q;this.posItemA&&(this.posItemA[m]||(this.posItemA[m]=[]),this.posItemA[m].push(this.itemA[l]))}this.szFlag.match(/TEXTONLY/)&&fCheckLabelOverlap&&(h=SVGDocument.getElementById(this.szId+":"+l+":text"))&&(new Map.Label.Item(h)).setDisplay("none");
r&&setRotate(c,-Number(r));1==this.fShadow&&SVGDocument.getElementById(szShadowFilterId)?c.style.setProperty("filter","url(#"+szShadowFilterId+")",""):1==this.fShadow&&(m=map.Dom.newNode("filter",this.chartGroup.parentNode),m.setAttributeNS(null,"id",szShadowFilterId),m.setAttributeNS(null,"filterUnits","objectBoundingBox"),m.setAttributeNS(null,"x","-50%"),m.setAttributeNS(null,"y","-50%"),m.setAttributeNS(null,"width","200%"),m.setAttributeNS(null,"height","200%"),h=map.Dom.newNode("feGaussianBlur",
m),h.setAttributeNS(null,"stdDeviation","15"),h.setAttributeNS(null,"result","BlurAlpha"),h=map.Dom.newNode("feOffset",m),h.setAttributeNS(null,"in","BlurAlpha"),h.setAttributeNS(null,"dx","20"),h.setAttributeNS(null,"dy","20"),h.setAttributeNS(null,"result","OffsetBlurAlpha"),h=map.Dom.newNode("feColorMatrix",m),h.setAttributeNS(null,"in","OffsetBlurAlpha"),h.setAttributeNS(null,"type","matrix"),h.setAttributeNS(null,"values","0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 1 0"),h.setAttributeNS(null,"result",
"matrixOut"),h=map.Dom.newNode("feMerge",m),m=map.Dom.newNode("feMergeNode",h),m.setAttributeNS(null,"in","matrixOut"),m=map.Dom.newNode("feMergeNode",h),m.setAttributeNS(null,"in","SourceGraphic"),h=map.Dom.getBox(c.lastChild),h.width&&h.height&&c.style.setProperty("filter","url(#"+szShadowFilterId+")",""))}}else this.nMissingPositionCount++}if(this.szFlag.match(/BOX/))for(f=0;f<this.indexA.length;f++)if(l=this.indexA[f],this.itemA[l].fDone&&(e=this.itemA[l].szSelectionId,c=SVGDocument.getElementById(this.szId+
":"+e+":chart"),e=SVGDocument.getElementById(this.szId+":"+e+":chart:box"),c&&e&&!e.getAttributeNS(szMapNs,"boxed"))){h=map.Dom.getBox(c);r=map.Scale.normalX(this.nBoxMargin||2);r=Math.min(2*r,r*(h.width/map.Scale.normalX(g)));if(this.szFlag.match(/TITLE/)&&this.szTitleField){q=Math.max(h.width/10,map.Scale.normalX(4));m=this.itemA[l].szTitle;try{m=HTMLWindow.ixmaps.htmlgui_onInfoTitle(this.itemA[l].szTitle)}catch(v){}m=map.Dom.newText(c,h.x,h.y-1*q,"font-family:arial;font-size:"+q+"px;text-anchor:start;fill:"+
(this.szTextColor||"#888888")+";stroke:none;pointer-events:none;",String(m||" "));this.szFlag.match(/LONGTITLE/)?(h=map.Dom.getBox(c),h.y+=.1*q,h.height-=.1*q):(c=h.height,h.height+=1.8*q,h.y-=h.height-c,map.Dom.setClipRect(m,new G(h.x,h.y-10*q,h.width-q/3,20*q)))}this.szFlag.match(/PLOTX/)?(h.height=map.Scale.normalX(g),h.y=-map.Scale.normalX(g/2),h.width=this.nMax*map.Scale.normalX(1.1*g)/this.nMax*5*(this.nRangeScale||1)):this.szFlag.match(/PLOTY/)&&(c=h.height,m=h.width,h.width=map.Scale.normalX(g),
h.height=this.nMax*map.Scale.normalX(1.1*g)/this.nMax*5*(this.nRangeScale||1),h.x-=(h.width-m)/2,h.y-=(h.height-c)/2);e.setAttributeNS(null,"x",h.x-r);e.setAttributeNS(null,"y",h.y-r);e.setAttributeNS(null,"width",h.width+2*r);e.setAttributeNS(null,"height",h.height+2*r);"undefined"!=typeof this.nBorderRadius&&(r=Math.min(map.Scale.normalX(this.nBorderRadius),map.Scale.normalX(this.nBorderRadius*(h.width/map.Scale.normalX(g)))),e.setAttributeNS(null,"rx",r),e.setAttributeNS(null,"ry",r));e.setAttributeNS(szMapNs,
"boxed","1")}this.szItemFilter&&this.szItemFilter.length&&this.filterItems(this.szItemFilter,this.itemFilterOpt);null!=this.markedClass&&this.markClass(this.markedClass,1);this.isVisible=!0;this.realizeDone();this.fShowProgressBar=!1;this.showInfo();this.szFlag.match(/SHOWSTATISTIC/)&&this.showErrorInfo();this.szFlag.match(/CLIP/)?this.nClipFrames==this.itemA[l].nValuesA.length?this.szXaxisA&&this.szXaxisA[this.nActualFrame]?displayMessage(this.szXaxisA[this.nActualFrame],3E3,"big"):this.szLabelA&&
this.szLabelA[this.nActualFrame]&&displayMessage(this.szLabelA[this.nActualFrame],3E3,"big"):(G=this.szXaxisA||this.szLabelA)&&(0==this.nActualFrame?displayMessage(G[0],3E3,"big"):this.nActualFrame==this.nClipFrames-1?displayMessage(G[1],3E3,"big"):displayMessage(" ... ",3E3,"big")):this.ErrorMessage?(displayMessage(this.ErrorMessage,1E4,"notify"),this.ErrorMessage=null):clearMessage();this.fSorted||(this.fResort=!0,map.Themes.execute());if(this.szFlag.match(/DECLUTTER/)&&(g=this.chartGroup.childNodes,
!g[0].actualPosition)){l=g[0].fu.getPosition();for(c=0;c<g.length;c++)e=g[c].fu.getPosition(),e.y<l.y&&(l.x=e.x,l.y=e.y);l.y-=map.Scale.normalX(50)*map.Scale.nZoomScale;var G=g[0].fu.getBox(),r=[];for(c=0;c<g.length;c++)r[c]={node:g[c],y:g[c].fu.getPosition().x};r.sort(this.sortChartObjectsCompare);e=r[0].node.fu.getPosition();for(c=0;c<r.length;c++)r[c].node.origPosition=r[c].node.fu.getPosition(),r[c].node.fu.setPosition(e.x+1.2*G.width*c,l.y),r[c].node.actualPosition=new point(e.x+1.2*G.width*
c,l.y),scale=r[c].node.fu.getScale().x,r[c].node.actualPosition.x=r[c].node.origPosition.x-(r[c].node.origPosition.x-r[c].node.actualPosition.x)/scale,r[c].node.actualPosition.y=r[c].node.origPosition.y-(r[c].node.origPosition.y-r[c].node.actualPosition.y)/scale,map.Themes.makeChartOffsetPointer(r[c].node)}}else this.unpaintMap(),this.realizeDone()};
MapTheme.prototype.sortChartObjects=function(){if(!(!this.chartGroup||this.szFlag.match(/NOSRT/)||this.szFlag.match(/NOSIZE/)&&!this.szFlag.match(/3D/)||this.szFlag.match(/EXACT/)&&!this.szFlag.match(/AGGREGATE/)&&!this.szSizeField)){var f=null,c=[],g=this.chartGroup.childNodes;if(this.szFlag.match(/BUBBLE/)||this.szFlag.match(/SQUARE/)||this.szFlag.match(/BUFFER/)||this.szFlag.match(/TEXTONLY/))for(var e=0;e<g.length;e++)f=g.item(e),c[e]={node:f,y:Math.abs(Number(f.getAttributeNS(szMapNs,"value")))};
else for(var h=getRotateAttributeValue(map.Scale.canvasNode)/180*Math.PI,e=0;e<g.length;e++)f=g.item(e),c[e]=h?{node:f,y:getTranslate(f).x*Math.sin(h)+getTranslate(f).y*Math.cos(h)}:{node:f,y:getTranslate(f).y};this.szFlag.match(/SORT/)&&this.szFlag.match(/DOWN/)&&!this.szFlag.match(/SEQUENCE/)?c.sort(this.sortDownChartObjectsCompare):c.sort(this.sortChartObjectsCompare);for(e=0;e<c.length;e++)c[e].node.parentNode.appendChild(c[e].node);(matrixA=getMatrix(this.chartGroup))&&setMatrix(this.chartGroup,
matrixA)}};MapTheme.prototype.sortChartObjectsCompare=function(f,c){return f.y>c.y?1:-1};MapTheme.prototype.sortDownChartObjectsCompare=function(f,c){return f.y<c.y?1:-1};
MapTheme.prototype.getChartSize=function(f,c,g,e){if(g.match(/NOSIZE/))return Math.max(5,c/4);e=Math.abs(e);var h=Math.max(5,c/2),m=this.nMax-this.nMin;this.nNormalSizeValue&&(m=this.nMaxSize=this.nNormalSizeValue);var q=this.itemA[f].nValue100;g.match(/SIZE/)&&!g.match(/NORMSIZE/)&&this.szSizeField&&f&&this.itemA[f]?h=g.match(/LINEAR/)?h/this.nMaxSize*this.itemA[f].nSize:g.match(/SIZELOG/)?h/Math.log(this.nMaxSize)*Math.log(this.itemA[f].nSize):g.match(/SIZEP4/)?h/Math.pow(this.nMaxSize,.25)*Math.pow(this.itemA[f].nSize,
.25):g.match(/3D/)||g.match(/SIZEP3/)||g.match(/SIZEVOLUME/)?h/Math.pow(this.nMaxSize,1/3)*Math.pow(this.itemA[f].nSize,1/3):h/Math.sqrt(this.nMaxSize)*Math.sqrt(this.itemA[f].nSize):g.match(/SIZE/)&&!g.match(/NORMSIZE/)&&(h=g.match(/LINEAR/)?h/m*e:g.match(/SIZELOG/)?h/Math.log(m)*Math.log(e):g.match(/SIZEP4/)?h/Math.pow(m,.25)*Math.pow(e,.25):g.match(/3D/)||g.match(/SIZEP3/)||g.match(/SIZEVOLUME/)?h/Math.pow(m,1/3)*Math.pow(e,1/3):h/Math.sqrt(m)*Math.sqrt(e));map.Scale.normalX(10);g.match(/HEIGHT/)&&
!g.match(/NORMSIZE/)&&(g.match(/SIZE/)?this.szSizeField&&f&&this.itemA[f]?Math.pow(10/m*this.itemA[f].nSize,1/3):Math.pow(10/m*e,1/3):q&&this.nMax100&&this.nMin100&&g.match(/FRACTION/));g.match(/ZOOM/)&&(this.origSize=h*=map.Scale.nObjectScaling,h=c/10+1*h/Math.log(Math.abs(m))*Math.log(Math.abs(e)),h=Math.min(h,c),h=Math.max(h,c/5));return h};
MapTheme.prototype.checkChartSize=function(f,c,g,e){return this.nChartSizeMin&&!g.match(/ZOOM/)&&this.getChartSize(f,c,g,e)/map.Layer.nObjectScale<this.nChartSizeMin?!1:!0};
MapTheme.prototype.drawChart=function(f,c,g,e,h){var m,q,l=null,r=0,w=0;this.szChartFlag=e;if(c){if(!this.itemA[c])return null;this.itemA[c].fDone=!1;var l=this.itemA[c].nValuesA,r=this.itemA[c].nValue100,w=Math.max(this.nMax,Math.abs(this.nMin)),B=0;if(!this.szFlag.match(/BUFFER/))for(var u=0;u<l.length;u++)isNaN(l[u])&&(l[u]=0),B+=l[u];if(this.szFlag.match(/MORPH/)&&this.szFlag.match(/CLIP/)&&this.nClipFrames){for(var l=[],A=this.itemA[c].nValuesA,u=0;u<A.length/2;u++){var v=A[u]*(this.nClipFrames-
1-this.nActualFrame)/(this.nClipFrames-1)+A[u+A.length/2]*this.nActualFrame/(this.nClipFrames-1);l[u]=v}for(u=B=0;u<l.length;u++)isNaN(l[u])&&(l[u]=0),B+=l[u]}var G=this.getChartSize(c,g,e,B);if(this.nChartSizeMin&&!e.match(/ZOOM/)){if(G/map.Layer.nObjectScale<this.nChartSizeMin)return null}else if(!this.szFlag.match(/MULTIFIX/)&&!this.szFlag.match(/MULTIGRID/)&&(isNaN(G)||0==G))return null;if(e.match(/DOT/)){v=l[0];if(e.match(/EXACT/)||2<this.colorScheme.length||this.szRanges&&this.szRanges.length)for(db=
!1,u=0;u<this.partsA.length;u++)if(v<this.partsA[u].max){this.chart.szColor=this.colorScheme[u];var z=__maptheme_getChartColors(K);e.match(/NOLINES/)?this.chart.szLineColor="none":this.chart.szLineColor=z.textColor;e.match(/RANGE/)&&!e.match(/RANGES/)&&(G=map.Scale.normalX(2+5*(u+1)/this.partsA.length));e.match(/ZOOM/)||e.match(/MENUSIZE/)||e.match(/NORMSIZE/)||this.partsA[u].nCount++;f.setAttributeNS(szMapNs,"value","seechilds");W=u;db=!0;break}var E=map.Scale.normalX((this.nLineWidth||.1)/g*G);
e.match(/OUTLINE/)&&(E=map.Scale.normalX(Math.min(1,1/g*G)));var D=map.Dom.newGroup(f,this.szId+":"+c+(c?":chartgroup":":ochrtgroup"));if(H=map.Dom.newShape("circle",D,0,0,map.Scale.normalX(G),"fill:"+this.chart.szColor+";stroke:"+(this.szLineColor||this.chart.szLineColor)+";stroke-width:"+(this.szTextColor||this.chart.szLineColor)+";"))H.setAttributeNS(szMapNs,"tooltip",this.formatValue(l[0],2)+this.szUnit+" "+this.szTitle+""),null!=W&&(H.setAttributeNS(szMapNs,"value",String(v)),H.setAttributeNS(szMapNs,
"class",String(W)));return new point(0,0)}}else{l=[];B=0;if(this.szOrigFlag.match(/AGGREGATE/)&&this.szOrigFlag.match(/EXACT/))for(u=0;u<this.colorScheme.length;u++)l[u]=this.nOrigSumA[u],w=Math.max(w,this.nOrigSumA[u]),B+=l[u];else for(u=0;u<this.szFieldsA.length;u++)l[u]=this.nOrigSumA[u],w=Math.max(w,this.nOrigSumA[u]),B+=l[u];if(r=this.nSum100){w=0;B=r;for(u=l.length-1;0<=u;u--)this.szFlag.match(/DIFFERENCE/)?r=0<u?l[u-1]:this.nSum100:this.szFlag.match(/CALCVAL/)||this.szFlag.match(/CALC100/)?
l[u]=l[u]:this.szFlag.match(/PRODUCT/)?l[u]=l[u]:(l[u]/=r,w=Math.max(w,l[u]),this.szFlag.match(/PERMILLE/)?l[u]*=1E3:this.szFlag.match(/FRACTION/)||(l[u]*=100),this.szFlag.match(/RELATIVE/)&&(l[u]-=100),this.szFlag.match(/INVERT/)&&(l[u]=100-l[u]));if(this.szFlag.match(/STACKED/)){if(w=100,this.szFlag.match(/NORMSIZE/)||e.match(/NORMSIZE/))for(u=w=0;u<l.length;u++)w+=l[u]}else w*=100,w+=w/10,w=this.nMax}else{if(this.szFlag.match(/DIFFERENCE/))for(u=l.length-1;0<=u;u--)0<u?l[u]-=l[u-1]:this.szFlag.match(/STACKED/)||
(l[u]=0);if(this.szAggregation&&this.szAggregation.match(/mean/)){for(u=0;u<l.length;u++)l[u]/=this.nCount;w=this.szFlag.match(/MENUSIZE/)?w/this.nCount:this.nMax}if(this.szFlag.match(/STACKED/)&&(this.szFlag.match(/NORMSIZE/)||e.match(/NORMSIZE/)||this.szFlag.match(/MENUSIZE/)||e.match(/MENUSIZE/)))for(u=w=0;u<l.length;u++)w+=l[u]}}var L=new point(0,0);if(!e)e=this.szFlag;else if(!e.match(/CHART/)&&e.match(/VALUES/)||e.match(/NORMSIZE/)||e.match(/MENUSIZE/))e=this.szFlag+"|"+e;e.match(/DOMINANT/)&&
!e.match(/CHART/)&&(e=e.match(/PERCENTOFMEAN/)?"BAR|OFFSETMEAN|POINTER|VALUES|ZOOM":e.match(/PERCENTOFMEDIAN/)?"BAR|OFFSETMEDIAN|POINTER|VALUES|ZOOM":e.match(/DEVIATION/)?"BAR|DEVIATION|POINTER|VALUES|ZOOM":"BAR|3D|VALUES|ZOOM");e.match(/ZOOM/)&&e.match(/BAR/)&&e.match(/POINTER/)&&1<l.length&&(e=this.removeDefinition(e,"SIZE")+"|COMPRESSMAX");if(1==l.length&&0==l[0]&&!e.match(/ZEROISVALUE/)&&!e.match(/EXACT/))return this.nZeroValueCount++,null;e.match(/VALUES/)&&(this.fHideValues=this.szValueUpper&&
map.Scale.getTrueMapScale()*map.Scale.nZoomScale>this.nValueUpper);var D=map.Dom.newGroup(f,this.szId+":"+c+(c?":chartgroup":":ochrtgroup")),O=null,la=null;e.match(/MOVABLE/)&&(D.setAttributeNS(null,"id",D.getAttributeNS(null,"id")+":movable"),D.setAttributeNS(null,"onmousedown",'map.Themes.initChartOffset(evt,"'+this.szId+'","'+this.szId+":"+c+':chartgroup:movable")'),D.setAttributeNS(null,"onmouseup",'map.Themes.endChartOffset(evt,"'+this.szId+'","'+this.szId+":"+c+':chartgroup:movable")'));if(e.match(/CHOROPLETHE/)){var J=
map.Scale.normalX(g/2),y=2*J/3,K=this.colorScheme[0],P=this.colorScheme[1]?this.colorScheme[1]:"none",E=map.Scale.normalX(.1)*map.Scale.nFeatureScaling*map.Scale.nObjectScaling,H=map.Dom.constructNode("use",D,{"xlink:href":"#choroplethe_icon"});H.fu.scale(2,2);g=2*y/map.Scale.normalX(1);L.x=0;L.y=y+map.Scale.normalY(5)}if(e.match(/USER/))try{var qb=this.objThemesA[this.szThemesA[0]],eb=HTMLWindow.ixmaps.htmlgui_drawChart(SVGDocument,{target:D,theme:this,item:c,values:l,maxSize:g,flag:e,mark:h,dbRecord:qb.dbRecords?
qb.dbRecords[this.itemA[c].dbIndex]:null});if(eb)return D.fu.setPosition(D.fu.getPosition().x-eb.x,D.fu.getPosition().y-eb.y),eb.x=0,eb.y=0,eb}catch(Mc){}if(e.match(/PIE/)){if(0==B&&!e.match(/AUTOCOMPLETE/))return null;if(e.match(/CENTER/)){for(var Vb=this.nCenter=0,nc=-3E7,oc=3E7,oa=0;oa<l.length;oa++)Vb+=l[oa],l[oa]<oc&&(oc=l[oa],this.nCenterMin=oa),l[oa]>nc&&(nc=l[oa],this.nCenterMax=oa);this.szCenterPart=this.szCenterPart||"max","first"==this.szCenterPart?this.nCenter=0:"last"==this.szCenterPart?
this.nCenter=l.length-1:"min"==this.szCenterPart?this.nCenter=this.nCenterMin:"max"==this.szCenterPart?this.nCenter=this.nCenterMax:Number(this.szCenterPart)&&(this.nCenter=Number(this.szCenterPart));this.nCenterValue=l[this.nCenter];this.nCenterSize=this.nCenterValue/Vb*100}var qa=0,G=Math.max(5,g/2),ua=this.nMax-this.nMin,Fb=this.nMax100-this.nMin100;this.nNormalSizeValue&&(ua=Fb=this.nMaxSize=this.nNormalSizeValue);e.match(/SIZE/)&&!e.match(/NORMSIZE/)&&this.szSizeField&&c&&this.itemA[c]?G=e.match(/SIZELOG/)?
G/Math.log(this.nMaxSize)*Math.log(this.itemA[c].nSize):e.match(/SIZEP4/)?G/Math.pow(this.nMaxSize,.25)*Math.pow(this.itemA[c].nSize,.25):e.match(/3D/)||e.match(/SIZEP3/)||e.match(/SIZEVOLUME/)?G/Math.pow(this.nMaxSize,1/3)*Math.pow(this.itemA[c].nSize,1/3):G/Math.sqrt(this.nMaxSize)*Math.sqrt(this.itemA[c].nSize):e.match(/SIZE/)&&!e.match(/NORMSIZE/)&&(G=e.match(/SIZELOG/)?G/Math.log(ua)*Math.log(B):e.match(/SIZEP4/)?G/Math.pow(ua,.25)*Math.pow(B,.25):e.match(/3D/)||e.match(/SIZEP3/)||e.match(/SIZEVOLUME/)?
G/Math.pow(ua,1/3)*Math.pow(B,1/3):G/Math.sqrt(ua)*Math.sqrt(B));qa=map.Scale.normalX(10);e.match(/HEIGHT/)&&!e.match(/NORMSIZE/)&&(qa=e.match(/SIZE/)?this.szSizeField&&c&&this.itemA[c]?qa*Math.pow(10/ua*this.itemA[c].nSize,1/3)*3:qa*Math.pow(10/ua*B,1/3)*3:r&&this.nMax100&&this.nMin100&&!e.match(/FRACTION/)?10*qa/Fb*r:10*qa/ua*B);e.match(/ZOOM/)&&(this.origSize=G*=map.Scale.nObjectScaling,G=g/10+3*G/Math.log(ua)*Math.log(B)*map.Layer.nDynamicObjectScale,G=Math.min(G,1.2*g),G=Math.max(G,g/2));var Z=
DonutCharts.newChart(SVGDocument,D,0,0,map.Scale.normalX(G),0);L.x=0;L.y=map.Scale.normalY(G)+map.Scale.normalY(5);Z.setStyle("flat");Z.setLine("#555566");Z.setLineWidth(map.Scale.normalX(.1));e.match(/NOLINES/)&&Z.setLine("none");e.match(/WHITELINES/)&&Z.setLine("white");this.szLineColor&&Z.setLine(this.szLineColor);if(e.match(/3D/)){Z.setStyle("3D");var na=.5;e.match(/P3/)?na=1/3:e.match(/P4/)&&(na=.25);e.match(/SIZE/)&&!e.match(/NORMSIZE/)&&this.szSizeField&&c&&this.itemA[c]?qa=qa/Math.pow(this.nMaxSize,
na)*Math.pow(this.itemA[c].nSize,na):e.match(/SIZE/)&&!e.match(/NORMSIZE/)&&(qa=qa/Math.pow(ua,na)*Math.pow(B,na));e.match(/ZOOM/)&&(qa*=map.Scale.nObjectScaling,qa=qa/this.origSize*G);L.y*=.7}e.match(/VOLUME/)&&Z.addStyle("VOLUME");if(e.match(/CENTER/)){var zc=Math.sqrt(Math.pow(map.Scale.normalX(G),2)/100*this.nCenterSize);Z.setRadInner(zc)}else e.match(/DONUT/)&&(e.match(/3D/)?Z.setRadInner(map.Scale.normalX(.5*G)):e.match(/THIN/)?Z.setRadInner(map.Scale.normalX(.66*G)):e.match(/THICK/)?Z.setRadInner(map.Scale.normalX(.33*
G)):Z.setRadInner(map.Scale.normalX(.42*G)));e.match(/STARBURST/)&&(Z.addStyle("STARBURST"),L.y*=.8);if(e.match(/XSFLOWER/)||e.match(/XSRAYS/))Z.addStyle("XSRAYS"),L.y*=.8;else if(e.match(/SFLOWER/)||e.match(/SRAYS/))Z.addStyle("SRAYS"),L.y*=.8;else if(e.match(/FLOWER/)||e.match(/RAYS/))Z.addStyle("RAYS"),L.y*=.8;e.match(/SILENT/)&&Z.addStyle("SILENT");e.match(/AUTOCOMPLETE/)&&Z.addStyle("AUTOCOMPLETE");e.match(/BIGTOTOP/)&&Z.addStyle("BIGTOTOP");e.match(/NOROTATE/)&&Z.addStyle("NOROTATE");var $a=
0,pc=0,Q=0;if(e.match(/DONUT/))for(u=0;u<l.length;u++)l[u]>l[$a]&&($a=u),l[u]<l[pc]&&(pc=u);if(e.match(/SORT/)){this.sortedIndex=[];for(u=0;u<l.length;u++)this.sortedIndex[u]={index:u,value:l[u]};this.sortedIndex.sort(this.sortIndexDown)}else this.sortedIndex=null;for(u=0;u<(this.nClipParts?Math.min(this.nClipParts,l.length):l.length);u++){var ma="",va=u;this.sortedIndex&&(va=this.sortedIndex[va].index);if(!e.match(/CENTER/)||va!=this.nCenter){ma=this.szLabelA&&this.szLabelA[va]?"  "+this.szLabelA[va]:
"  "+this.szFieldsA[va];K=this.colorScheme[va];if(1==l.length)for(x=0;x<this.partsA.length;x++)if(e.match(/EXACT/)&&l[va]==this.partsA[x].min||!e.match(/EXACT/)&&l[va]<this.partsA[x].max){K=this.colorScheme[x];f.setAttributeNS(szMapNs,"class",String(x));break}var qc=(e.match(/AUTOCOMPLETE/)&&!this.szUnit.match(/%/)?" % ":"")+this.szUnit;if(this.szShowParts){var Ac=K,K="none";for(oa in this.szShowPartsA)this.szShowPartsA[oa]==va&&(K=Ac)}Z.addPart(l[va],qa,K,0,(this.szAggregation&&this.szAggregation.match(/sum/),
this.formatValue(l[va],this.szValueDecimals||0,"FLOOR")+qc),this.formatValue(l[va],2)+qc+ma);"none"==this.colorScheme[u]&&Z.setLine("black")}}Z.realize();if(e.match(/CENTER/)&&!e.match(/DONUT/)&&(y=Math.sqrt(Math.pow(map.Scale.normalX(G),2)/100*this.nCenterSize),K=this.colorScheme[this.nCenter],map.Dom.newShape("circle",D,0,0,.95*y,"fill:"+K+";"),e.match(/CENTERVALUE/)||e.match(/ZOOM/))){var aa=this.formatValue(this.nCenterValue,this.szValueDecimals||0,"FLOOR")+(5>=this.szUnit.length?this.szUnit:
""),z=__maptheme_getChartColors(K),Ca=z.textColor,ba=String(Math.min(.8*y,2.5/aa.length*y));map.Dom.newText(D,0,.33*ba,"font-family:arial;font-size:"+ba+"px;font-weight:bold;text-anchor:middle;fill:"+Ca+";opacity:"+String(this.nOpacity?this.nOpacity:1)+";stroke:none;pointer-events:none",aa)}if(e.match(/VALUES/)&&(e.match(/ZOOM/)||!this.szValueUpper||map.Scale.getTrueMapScale()*map.Scale.nZoomScale<=this.nValueUpper))if(ba=Math.min(.8*G,3.4/Z.partsA[0].szText.length*G),1<l.length||e.match(/NOINLINETEXT/)||
e.match(/ZOOM/)&&6>ba)this.drawDonutText(Z,map.Scale.normalX(11)/(e.match(/ZOOM/)||e.match(/NORMSIZE/)?1.6:2));else{var aa=Z.partsA[0].szText,z=__maptheme_getChartColors(K),Ca=this.szTextColor||z.textColor,y=map.Scale.normalX(G),ba=String(Math.min(.8*y,3.4/aa.length*y)),wa=this.nValueSizeMin?ba/map.Scale.normalX(5):1;e.match(/VOLUME/)&&(qa=Z.donutPartsA[0].nHeight);e.match(/3D/)||(qa=.6*y);var I=map.Dom.newText(D,0,-qa+y/2+.45*ba,"font-family:arial;font-size:"+ba+"px;text-anchor:middle;fill:"+Ca+
";opacity:"+wa+";stroke:none;pointer-events:none",aa);e.match(/3D/)&&(I.fu.setPosition(0,-y/2+ba*(e.match(/VOLUME/)?.5:.25)),I.fu.scale(1,.5))}this.fillOpacity&&D.setAttributeNS(null,"opacity",String(this.fillOpacity));this.nOpacity&&(D.setAttributeNS(null,"fill-opacity",String(this.nOpacity)),D.setAttributeNS(null,"stroke-opacity",String(this.nOpacity)));if(e.match(/FADEDEVIATION/)){var Gb=(l[0]-this.nMeanA[0])/this.nDeviationA[0];10<Gb&&(wa=Math.pow(10,.5)/Math.pow(Gb,.5),D.setAttributeNS(null,
"opacity",String(wa)))}else e.match(/LIMITDEVIATION/)&&(Gb=(l[0]-this.nMeanA[0])/this.nDeviationA[0],10<Gb&&D.setAttributeNS(null,"opacity","0"));if(1==l.length&&e.match(/EXACT/))Z.donutPartsA[0].objNode.setAttributeNS(szMapNs,"class",f.getAttributeNS(szMapNs,"class")),Z.donutPartsA[0].textNode&&Z.donutPartsA[0].textNode.setAttributeNS(szMapNs,"class",f.getAttributeNS(szMapNs,"class"));else for(u=0;u<Z.donutPartsA.length;u++)Z.donutPartsA[u].objNode.setAttributeNS(szMapNs,"class",String(this.sortedIndex?
this.sortedIndex[u].index:u)),Z.donutPartsA[u].textNode&&Z.donutPartsA[u].textNode.setAttributeNS(szMapNs,"class",String(this.sortedIndex?this.sortedIndex[u].index:u));1<l.length&&f.setAttributeNS(szMapNs,"value","seechilds");this.nRealizedCount++}else if(e.match(/BUBBLE/)||e.match(/SQUARE/)||e.match(/LABEL/)){J=map.Scale.normalX(g/2);Q=this.nMaxA[0];this.nNormalSizeValue&&(this.nMaxSize=Q=this.nNormalSizeValue);v=l[0];if(this.szFlag.match(/CLIP/)&&!this.szFlag.match(/MORPH/)&&this.nClipFrames&&(this.nClipFrames==
l.length?(v=Number(l[this.nActualFrame]),Q=this.nMaxA[this.nActualFrame]):v=l[0]*(this.nClipFrames-1-this.nActualFrame)/(this.nClipFrames-1)+l[l.length-1]*this.nActualFrame/(this.nClipFrames-1),0==v&&!e.match(/ZEROISVALUE/))||e.match(/INVERTSIZE/)&&0==Q-l[0]&&!e.match(/ZEROISVALUE/))return null;var fb=c&&this.itemA[c]&&this.szSizeField?this.itemA[c].nSize||0:v,gb=c&&this.itemA[c]&&this.szSizeField?this.nMaxSize:Q;if(e.match(/MENUSIZE/))y=map.Scale.normalX(g/2.5);else if(y=J/Math.sqrt(gb)*Math.sqrt(Math.abs(fb)),
e.match(/LINEAR/))y=J/gb*Math.abs(fb);else if(e.match(/SIZEP3/))y=J/Math.pow(gb,1/3)*Math.pow(Math.abs(fb),1/3);else if(e.match(/SIZEP4/))y=J/Math.pow(gb,.25)*Math.pow(Math.abs(fb),.25);else if(e.match(/SIZELOG/))y=J/Math.log(gb)*Math.log(Math.abs(fb));else if(e.match(/EXACT/)&&!this.szSizeField)y=J/3;else if(e.match(/NOSIZE/))y=J/2;else if(e.match(/FIXSIZE/))y=J/2/(this.nNormalSizeValue||1);else if(e.match(/ZOOM/))y=3*J/3;else if(e.match(/NORMSIZE/))y=2*J/3/(e.match(/EXACT/)?1:Math.log(gb)*Math.log(Math.abs(fb)));
else if(e.match(/MENUSIZE/)||e.match(/SUM/)&&!c)y=2*J/3;var db=!0,W=null,da=H=null,Ia=I=null,K=this.colorScheme[0],Ca=P=this.colorScheme[1]?this.colorScheme[1]:"none";if(2<this.colorScheme.length||e.match(/EXACT/))K=this.colorScheme[this.colorScheme.length-1],P=this.colorScheme[0];e.match(/NOLINES/)?P="none":"none"==P&&(z=__maptheme_getChartColors(K),P=z.textColor);if(2<this.colorScheme.length||e.match(/EXACT/)||this.szRanges&&this.szRanges.length)if(db=!1,this.szFlag.match(/DOMINANT/)){for(var Da=
0,rb=0,M=-1,u=0;u<this.itemA[c].nValuesA.length;u++){var v=this.itemA[c].nValuesA[u],Wb=100/this.nMeanA[u]*v,Xb=100/this.nMedianA[u]*v,Yb=(v-this.nMeanA[u])/this.nDeviationA[u],Da=v;this.szFlag.match(/PERCENTOFMEAN/)&&(Da=Wb);this.szFlag.match(/PERCENTOFMEDIAN/)&&(Da=Xb);this.szFlag.match(/DEVIATION/)&&(Da=Yb);v>this.nFilterA[u]&&Da>rb&&(this.itemA[c].nClass=u,rb=Da,M=u)}if(0<=M){this.itemA[c].nDominant=M;v=this.itemA[c].nValuesA[M];ma=" "+this.szFieldsA[M]+" ";this.szLabelA&&this.szLabelA[M]&&(ma=
" "+this.szLabelA[M]+" ");if(this.szFlag.match(/PERCENTOFMEAN/)||this.szFlag.match(/DEVIATION/))szRelevanz=map.Dictionary.getLocalText(" ( mean: ")+this.formatValue(this.nMeanA[M],1)+this.szUnit+")";this.szFlag.match(/PERCENTOFMEDIAN/)&&(szRelevanz=map.Dictionary.getLocalText(" ( median: ")+this.formatValue(this.nMedianA[M],1)+this.szUnit+")");this.itemA[c].nValue=this.itemA[c].nValuesA[M];this.itemA[c].szLabel=ma;K=this.colorScheme[M];z=__maptheme_getChartColors(K);P=e.match(/NOLINES/)?"none":z.textColor;
f.setAttributeNS(szMapNs,"value","seechilds");W=M;db=!0}}else for(u=0;u<this.partsA.length;u++)if(v<this.partsA[u].max){K=this.colorScheme[u];z=__maptheme_getChartColors(K);P=e.match(/NOLINES/)?"none":z.textColor;e.match(/RANGE/)&&!e.match(/RANGES/)&&(y=map.Scale.normalX(2+5*(u+1)/this.partsA.length));e.match(/ZOOM/)||e.match(/MENUSIZE/)||e.match(/NORMSIZE/)||this.partsA[u].nCount++;f.setAttributeNS(szMapNs,"value","seechilds");W=u;db=!0;break}Ca=this.szTextColor||P;P=this.szLineColor||P;if(db){E=
this.nLineWidth||.1;E=e.match(/OUTLINE/)?map.Scale.normalX(Math.min(1,1/J*y)):map.Scale.normalX(E/J*y);if(e.match(/BUBBLE/))!this.fShadow&&this.fOrigShadow&&y>map.Scale.normalX(5)&&(H=map.Dom.newShape("circle",D,.02*y,.02*y,1.01*y,"fill:#000000;stroke:none;opacity:"+.6*(this.fillOpacity?this.fillOpacity:1)),H.setAttributeNS(szMapNs,"class",String(W)),H=map.Dom.newShape("circle",D,.03*y,.03*y,1.04*y,"fill:"+K+";stroke:none;opacity:"+.2*(this.fillOpacity?this.fillOpacity:1)),H.setAttributeNS(szMapNs,
"class",String(W))),e.match(/GLOW/)&&!e.match(/ZOOM/)&&(!this.szGlowUpper||map.Scale.getTrueMapScale()*map.Scale.nZoomScale<=this.nGlowUpper)&&((H=map.Dom.newShape("circle",D,0,0,6*y,"fill:"+K+";stroke:none;fill-opacity:0.05;"))&&H.setAttributeNS(szMapNs,"class",String(W)),(H=map.Dom.newShape("circle",D,0,0,2*y,"fill:"+K+";stroke:none;fill-opacity:0.1;"))&&H.setAttributeNS(szMapNs,"class",String(W))),H=map.Dom.newShape("circle",D,0,0,y,"fill:"+K+";stroke:"+P+";stroke-width:"+E+";");else if(e.match(/SQUARE/))H=
map.Dom.newShape("rect",D,-y,-y,2*y,2*y,"fill:"+K+";stroke:"+P+";stroke-width:"+E+";");else if(e.match(/TEXTONLY/))H=map.Dom.newShape("rect",D,-y,-8,2.05*y,8,"fill:none;stroke:none;");else if(e.match(/LABEL/)){aa=this.formatValue(v,this.szValueDecimals||(1>v||10>Q?1:0),"FLOOR")+(5>=this.szUnit.length?this.szUnit:"");0<v&&(this.szFlag.match(/DIFFERENCE/)||this.szFlag.match(/RELATIVE/))&&(aa="+"+aa);var hb=Math.min(.8*y,3.4/aa.length*y);if(!this.fShadow&&this.fOrigShadow&&y>map.Scale.normalX(5)){if(H=
map.Dom.newShape("rect",D,-y+.02*y,.83*-hb+.02*y,2.05*y,1.6*hb,"fill:#000000;stroke:none;opacity:"+.4*(this.fillOpacity?this.fillOpacity:1)))H.setAttributeNS(null,"rx",map.Scale.normalX(2*y/J)),H.setAttributeNS(null,"ry",map.Scale.normalX(2*y/J));if(H=map.Dom.newShape("rect",D,-y+.03*y,.83*-hb+.03*y,2.05*y,1.6*hb,"fill:"+K+";stroke:none;opacity:"+.2*(this.fillOpacity?this.fillOpacity:1)))H.setAttributeNS(null,"rx",map.Scale.normalX(2*y/J)),H.setAttributeNS(null,"ry",map.Scale.normalX(2*y/J))}if(H=
map.Dom.newShape("rect",D,-y,.83*-hb,2.05*y,1.6*hb,"fill:"+K+";stroke:"+P+";stroke-width:"+E+";"))H.setAttributeNS(null,"rx",map.Scale.normalX(2*y/J)),H.setAttributeNS(null,"ry",map.Scale.normalX(2*y/J))}if(H){e.match(/SILENT/)||(e.match(/EXACT/)&&this.szLabelA&&this.szLabelA[u]?H.setAttributeNS(szMapNs,"tooltip",this.szLabelA[u]+" "+this.szTitle+""):H.setAttributeNS(szMapNs,"tooltip",this.formatValue(v,2)+this.szUnit+" "+this.szTitle+""));I=null;if(e.match(/VALUES/)&&(!this.szValueUpper||map.Scale.getTrueMapScale()*
map.Scale.nZoomScale<=this.nValueUpper))if(aa=null,this.szValueField&&this.itemA[c]?aa=this.formatValue(this.itemA[c].szValue,this.szValueDecimals||(1>za||10>Q?1:0),"FLOOR")+(5>=this.szUnit.length?this.szUnit:""):e.match(/EXACT/)&&this.szLabelA?aa=this.szLabelA[v-1]||"?":(aa=this.formatValue(v,this.szValueDecimals||(1>v||10>Q?1:0),"FLOOR")+(5>=this.szUnit.length?this.szUnit:""),0<v&&(this.szFlag.match(/DIFFERENCE/)||this.szFlag.match(/RELATIVE/))&&(aa="+"+aa)),ba=String(Math.min(.8*y,3.3/aa.length*
y)),e.match(/TEXTONLY/)){Ca=z.textColor;ba=String(Math.max(Math.min(.8*y,map.Scale.normalX(500)),map.Scale.normalX(2)));if(this.nValueSizeMin&&!e.match(/ZOOM/)&&ba*map.Layer.nDynamicObjectScale<map.Scale.normalX(this.nValueSizeMin))return null;var sb=this.szTextFont||"arial",Ia=map.Dom.newText(D,0,0,"font-family:"+sb+";font-size:"+ba+"px;font-weight:normal;text-anchor:middle;fill:none;stroke:"+K+";stroke-width:"+ba/7+";stroke-opacity:0.5;pointer-events:none;stroke-linejoin:bevel;",aa);Ia.setAttributeNS(null,
"id",this.szId+":"+c+":text:bg");I=map.Dom.newText(D,0,0,"font-family:"+sb+";font-size:"+ba+"px;font-weight:normal;text-anchor:middle;fill:"+(this.szTextColor||"#000000")+";opacity:"+wa+";stroke:none;",aa);I.setAttributeNS(null,"id",this.szId+":"+c+":text");H.parentNode.removeChild(H)}else if(e.match(/ZOOM/)&&ba<map.Scale.normalX(6))Ca="black",I=map.Dom.newText(D,y+.1*J,-y/2,this.szValuesTextStyle,aa);else if(e.match(/LABEL/)||ba>map.Scale.normalX(1))wa=this.nValueSizeMin?ba/map.Scale.normalX(5):
1,I=map.Dom.newText(D,0,.33*ba,"font-family:arial;font-size:"+ba+"px;font-weight:bold;text-anchor:middle;fill:"+Ca+";opacity:"+wa+";stroke:none;pointer-events:none",aa);if(e.match(/DTEXT/)&&c&&!e.match(/ZOOM/)){var Ja=Math.pow(Math.abs(y),1/3)/Math.pow(J,1/3);H.style.setProperty("fill-opacity",String(Ja),"");H.style.setProperty("stroke-opacity",String(Ja),"");I&&I.style.setProperty("fill-opacity",String(Ja),"")}else H.style.setProperty("fill-opacity",String(this.fillOpacity?this.fillOpacity:1),""),
e.match(/OUTLINE/)||this.szLineColor?H.style.setProperty("stroke-opacity","1",""):H.style.setProperty("stroke-opacity",String(this.fillOpacity&&.5>this.fillOpacity?1:.3),"")}null!=W&&(H&&(H.setAttributeNS(szMapNs,"value",String(v)),H.setAttributeNS(szMapNs,"class",String(W))),I&&(I.setAttributeNS(szMapNs,"value",String(v)),I.setAttributeNS(szMapNs,"class",String(W))),Ia&&(Ia.setAttributeNS(szMapNs,"value",String(v)),Ia.setAttributeNS(szMapNs,"class",String(W))));g=2*y/map.Scale.normalX(1);L.x=0;L.y=
y+map.Scale.normalY(5);this.nRealizedCount++}else return this.nMissingRangeCount++,null}else if(e.match(/SYMBOL/)){if("undefined"!=typeof this.szSymbolBoxStyle){P="#dddddd";"undefined"!=typeof this.szBorderColor&&(P=this.szBorderColor);var tb="stroke-width:0;";if("undefined"!=typeof this.szBorderStyle)switch(this.szBorderStyle){case "dotted":tb="stroke-width:"+map.Scale.normalX(1)+";stroke-linecap:round;stroke-dasharray:1,50;";break;case "dashed":tb="stroke-width:"+map.Scale.normalX(1)+";stroke-linecap:butt;stroke-dasharray:30,30;";
break;case "solid":tb="stroke-width:"+map.Scale.normalX(1)+";";break;case "none":tb="stroke-width:0;"}var ab=map.Dom.newShape("rect",D,0,0,1,1,"fill:white;stroke:"+P+";"+tb);switch(this.szSymbolBoxStyle){case "frame":ab.setAttributeNS(null,"fill-opacity",0);break;case "field":ab.setAttributeNS(null,"fill-opacity",1)}}var rc=0,ra=0,ha=0;if(!this.szSymbolsA||this.szSymbolsA.length<l.length)for(this.szSymbolsA=[],u=0;u<l.length;u++)this.szSymbolsA.push("circle");f.setAttributeNS(szMapNs,"value","seechilds");
var Ka=null;e.match(/VALUES/)&&(Ka=map.Dom.newGroup(D,this.szId+":"+c+":textgroup"));this.initAngle=0;if(e.match(/SORT/))if(e.match(/MEAN/)){this.sortedIndex=[];for(u=this.sortedMax=0;u<l.length;u++)this.sortedIndex[u]={index:u,value:l[u],tvalue:l[u],mean:this.nMeanA[u]},this.sortedMax=Math.max(this.sortedMax,l[u]);this.sortedIndex.sort(this.sortMeanUp);this.initAngle=0}else if(e.match(/MEDIAN/)){this.sortedIndex=[];for(u=this.sortedMax=0;u<l.length;u++)this.sortedIndex[u]={index:u,value:l[u],tvalue:l[u],
mean:this.nMedianA[u]},this.sortedMax=Math.max(this.sortedMax,l[u]);this.sortedIndex.sort(this.sortMeanUp);this.initAngle=0}else if(e.match(/UP/)){this.sortedIndex=[];for(u=this.sortedMax=0;u<l.length;u++)this.sortedIndex[u]={index:u,value:l[u],tvalue:l[u]},this.sortedMax=Math.max(this.sortedMax,l[u]);this.sortedIndex.sort(this.sortIndexUp);this.initAngle=0}else if(e.match(/DOWN/)){this.sortedIndex=[];for(u=this.sortedMax=0;u<l.length;u++)this.sortedIndex[u]={index:u,value:l[u],tvalue:l[u]},this.sortedMax=
Math.max(this.sortedMax,l[u]);this.sortedIndex.sort(this.sortIndexDown);this.initAngle=0}else{if(e.match(/RANDOM/)){this.sortedIndex=[];this.sortedMax=0;if(this.nClipParts&&this.nClipParts<l.length){for(var Zb=[],u=0;u<l.length;u++)Zb[u]={index:u,value:l[u],tvalue:l[u]};Zb.sort(this.sortIndexDown);for(u=0;u<this.nClipParts;u++){var $b=Zb[u].index;this.sortedIndex[u]={index:$b,value:l[$b],tvalue:l[$b]};this.sortedMax=Math.max(this.sortedMax,l[u])}}else for(u=0;u<l.length;u++)this.sortedIndex[u]={index:u,
value:l[u],tvalue:l[u]},this.sortedMax=Math.max(this.sortedMax,l[u]);c?(this.itemA[c].randomA||(this.itemA[c].randomA=this.getRandomNumberArray(l.length+1)),this.shuffleArray(this.sortedIndex,this.itemA[c].randomA),this.initAngle=Math.floor(360*this.itemA[c].randomA[0])):this.initAngle=0}}else this.sortedIndex=null;if(e.match(/RINGS/)){if(this.sortedIndex)for(var ub=0,u=0;u<this.sortedIndex.length;u++)this.sortedIndex[u].value+=ub,ub=this.sortedIndex[u].value;else for(ub=0,this.sortedIndex=[],u=0;u<
l.length;u++)this.sortedIndex[u]={index:u,value:l[u],tvalue:l[u]},this.sortedIndex[u].value+=ub,ub=this.sortedIndex[u].value;this.sortedIndex.sort(this.sortIndexDown)}var Hb=null,Ib=null,Ea=W=0,ib=0,jb=0,ac=0,sc=0,kb=!1,Ra=0,$a=l.length;this.nClipParts&&this.nClipParts<l.length&&(e.match(/UP/)?Ra=l.length-this.nClipParts:$a=this.nClipParts);if(this.szFlag.match(/DOMINANT/)){for(var rb=Da=0,Jb=-1,u=0;u<this.itemA[c].nValuesA.length;u++)v=this.itemA[c].nValuesA[u],Wb=100/this.nMeanA[u]*v,Xb=100/this.nMedianA[u]*
v,Yb=(v-this.nMeanA[u])/this.nDeviationA[u],Da=v,this.szFlag.match(/PERCENTOFMEAN/)&&(Da=Wb),this.szFlag.match(/PERCENTOFMEDIAN/)&&(Da=Xb),this.szFlag.match(/DEVIATION/)&&(Da=Yb),v>this.nFilterA[u]&&Da>rb&&(this.itemA[c].nClass=u,rb=Da,Jb=u);0<=Jb&&(Ra=this.itemA[c].nDominant=Jb,$a=Ra+1,W=Jb)}for(u=Ra;u<$a;u++)ac+=0!=l[u],ib=Math.max(ib,this.nMaxA[u]),jb=Math.max(jb,l[u]);for(u=Ra;u<$a;u++){var M=u,v=l[M],Sa=l[M];this.sortedIndex&&(v=this.sortedIndex[M].value,Sa=this.sortedIndex[M].tvalue,M=this.sortedIndex[M].index);
this.szValueField&&this.itemA[c]&&(Sa=__scanValue(this.itemA[c].szValue));if(this.szShowParts){var vb=!0;for(oa in this.szShowPartsA)this.szShowPartsA[oa]==M%(this.nGridX||1E6)&&(vb=!1);if(vb)continue}W=M;if(e.match(/EXACT/)&&!e.match(/AGGREGATE/)){var ea="";if(this.nRangesA&&this.nRangesA.length)for(ii=0;ii<this.nRangesA.length;ii++)if(v==this.nRangesA[ii]||Number(v)==Number(this.nRangesA[ii])){ea=this.szSymbolsA[ii]||this.szSymbolsA[0]||"circle";W=ii;break}var Fa=String(v),ma=String(v);this.szLabelA&&
this.szLabelA[W]&&(Fa=this.szLabelA[W],ma=this.szLabelA[W]);ea.length||0!=M||(ea="empty",Fa=ma="no data",W=0);if(ea.length){rc++;H=null;K=this.colorScheme[W];if(e.match(/NOLINES/))P="none";else if(P=this.colorScheme[W],"white"==K||"#ffffff"==K)P="gray";if("circle"==ea||"square"==ea||"carot"==ea||"diamond"==ea||"triangle"==ea||"hexagon"==ea||"empty"==ea){y=map.Scale.normalX(g/3);this.szSizeField&&c&&this.itemA[c]&&(y=y/Math.sqrt(this.nMaxSize)*Math.sqrt(this.itemA[c].nSize));switch(ea){case "empty":H=
map.Dom.newShape("circle",D,0,0,y,"fill:#888888;fill-opacity:0;stroke:#888888;stroke-width:"+map.Scale.nFeatureScaling*map.Scale.nObjectScaling+";");break;case "circle":H=map.Dom.newShape("circle",D,0,0,y,"fill:"+K+";stroke:"+P+";stroke-width:"+map.Scale.nFeatureScaling*map.Scale.nObjectScaling+";");break;case "square":H=map.Dom.newShape("rect",D,.8*-y,.8*-y,1.6*y,1.6*y,"fill:"+K+";stroke:"+P+";stroke-width:"+map.Scale.nFeatureScaling*map.Scale.nObjectScaling+";");break;case "diamond":case "carot":(H=
map.Dom.newShape("rect",D,.8*-y,.8*-y,1.6*y,1.6*y,"fill:"+K+";stroke:"+P+";stroke-width:"+map.Scale.nFeatureScaling*map.Scale.nObjectScaling+";"))&&H.setAttributeNS(null,"transform","rotate(45)");break;case "triangle":H=map.Dom.newShape("path",D,"M 0,"+y+" l"+1.2*y+",-"+2*y+" -"+2.4*y+",0 "+1.2*y+","+2*y+"z","fill:"+K+";stroke:"+P+";stroke-width:"+map.Scale.nFeatureScaling*map.Scale.nObjectScaling+";");break;case "hexagon":var La=y/2,Ma=y*Math.sin(60/180*Math.PI),wb=y,H=map.Dom.newShape("path",D,
"M -"+y+",0 l "+La+",-"+Ma+" "+wb+",0 "+La+","+Ma+" -"+La+","+Ma+" -"+wb+",0 -"+La+",-"+Ma+" z","fill:"+K+";stroke:"+P+";stroke-width:"+E+";")}if(e.match(/HORZ/)){e.match(/VALUES/)&&(z=__maptheme_getChartColors(K),P=z.textColor,I=map.Dom.newText(Ka,0,0,"font-family:arial;font-size:"+String(y/2)+"px;text-anchor:start;baseline-shift:-90%;fill:#bbbbbb;stroke:none;pointer-events:none",ma),I.fu.setPosition(M*y*2,-y-map.Scale.normalX(5)),1<l.length&&setRotate(I,-45));if(e.match(/AXIS/)&&this.szXaxisA){var z=
__maptheme_getChartColors(K),P=z.textColor,Kb=this.szXaxisA[u],I=map.Dom.newText(Ka,0,0,"font-family:arial;font-size:"+String(y/2)+"px;text-anchor:start;baseline-shift:-90%;fill:#bbbbbb;stroke:none;pointer-events:none",Kb);I.fu.setPosition(M*y*2+map.Scale.normalX(2),y+map.Scale.normalX(1));1<l.length&&setRotate(I,45)}H.setAttributeNS(szMapNs,"tooltip",Fa);H.fu.setPosition(M*y*2,0)}else e.match(/VALUES/)&&(z=__maptheme_getChartColors(K),P=z.textColor,I=map.Dom.newText(Ka,0,0,"font-family:arial;font-size:"+
String(y/2)+"px;text-anchor:start;baseline-shift:-45%;fill:#bbbbbb;stroke:none;pointer-events:none",ma),I.fu.setPosition(y+map.Scale.normalX(3),-M*(2*y-map.Scale.normalY(0)))),H.setAttributeNS(szMapNs,"tooltip",Fa),H.fu.setPosition(0,-M*(2*y-map.Scale.normalY(0)))}else{y=map.Scale.normalX(.4*g);H=map.Dom.constructNode("use",D,{"xlink:href":"#"+ea+":antizoomandpan"});H.setAttributeNS(null,"style","fill:"+K+";stroke:"+P);if(this.szSizeField&&c&&this.itemA[c]){var N=1/Math.sqrt(this.nMaxSize)*Math.sqrt(this.itemA[c].nSize);
H.fu.scale(N,N)}H.fu.setPosition(map.Scale.normalX(0)+M*map.Scale.normalX(20),map.Scale.normalY(0));0<M&&(map.Dom.newText(D,map.Scale.normalX(-9)+M*map.Scale.normalX(20),0,"font-family:arial;font-size:360px;text-anchor:middle;baseline-shift:-50%;fill:none;stroke:black;stroke-width:60;pointer-events:none;opacity:0.3;","+"),map.Dom.newText(D,map.Scale.normalX(-9)+M*map.Scale.normalX(20),0,"font-family:arial;font-size:360px;text-anchor:middle;baseline-shift:-50%;fill:white;stroke:none;pointer-events:none;opacity:0.8;",
"+"));e.match(/VALUES/)&&(z=__maptheme_getChartColors(K),P=z.textColor,I=map.Dom.newText(Ka,0,0,"font-family:arial;font-size:"+String(y/2)+"px;text-anchor:start;baseline-shift:-45%;fill:#bbbbbb;stroke:none;pointer-events:none",ma),I.fu.setPosition(y/2+map.Scale.normalX(3),2*-M*y),this.szSizeField&&c&&this.itemA[c]&&(I=map.Dom.newText(Ka,0,0,"font-family:arial;font-size:"+String(y/2)+"px;text-anchor:start;baseline-shift:-45%;fill:#bbbbbb;stroke:none;pointer-events:none",String(this.itemA[c].nSize)+
this.szSizeValueUnits),I.fu.setPosition(y/2+map.Scale.normalX(3),2*-M*y+y/2)))}H.setAttributeNS(szMapNs,"value",String(v));H.setAttributeNS(szMapNs,"class",String(W%(this.nGridX||1E6)));this.nRealizedCount++}else this.nMissingRangeCount++}else{J=map.Scale.normalX(g/2);Q=ib;e.match(/MENUSIZE/)?Q=5*jb:!this.nNormalSizeValue||e.match(/SEQUENCE/)&&this.szSizeField||(this.nMaxSize=Q=this.nNormalSizeValue);e.match(/ZOOM/)&&e.match(/SEQUENCE/)&&(Q=jb/2+jb/2*Math.pow(Q,.5)/Math.pow(jb,.5));if(e.match(/INVERTSIZE/)&&
0==Q-v&&!e.match(/ZEROISVALUE/))return null;this.szFlag.match(/CLIP/)&&!this.szFlag.match(/MORPH/)&&this.nClipFrames&&(v=this.nClipFrames==l.length?Number(l[this.nActualFrame]):l[M]*(this.nClipFrames-1-this.nActualFrame)/(this.nClipFrames-1)+l[l.length-1]*this.nActualFrame/(this.nClipFrames-1));y=0;if(e.match(/AUTOSIZE/))var xb=map.Layer.nDynamicObjectScale,yb=e.match(/RECT/)?2:e.match(/GAP/)?1.6:1.5,Q=Math.max(ib,this.nMax),J=this.nGridWidthPx?map.Scale.normalX(this.nGridWidthPx)/yb/xb:this.nGridWidth?
map.Scale.getDeltaXofDistanceInMeter(this.nGridWidth)/yb/xb:J;e.match(/GRIDSIZE/)?(xb=map.Layer.nDynamicObjectScale,yb=e.match(/RECT/)?2:e.match(/GAP/)?1.6:1.5,y=this.nGridWidthPx?map.Scale.normalX(this.nGridWidthPx)/yb/this.nScale/xb:this.nGridWidth?map.Scale.getDeltaXofDistanceInMeter(this.nGridWidth)/yb/this.nScale/xb:map.Scale.normalX(g/3)):y=e.match(/NOSIZE/)?map.Scale.normalX(g/3):e.match(/FIXSIZE/)?map.Scale.normalX(g/3)/(this.nNormalSizeValue||1):e.match(/LINEAR/)?J/Q*v:e.match(/SIZELOG/)?
J/Math.log(Q)*Math.log(v):e.match(/SIZEP4/)?J/Math.pow(Q,.25)*Math.pow(v,.25):e.match(/SIZEP3/)||e.match(/SIZEVOLUME/)?J/Math.pow(Q,1/3)*Math.pow(v,1/3):J/Math.sqrt(Q)*Math.sqrt(v);e.match(/SEQUENCE/)?e.match(/MENUSIZE/)||e.match(/SUM/)&&!c?y*=this.szField100?1:2:e.match(/ZOOM/)&&!e.match(/PLOT/)?y*=2:e.match(/AGGREGATE/)&&e.match(/EXACT/)||!this.szSizeField||!c||!this.itemA[c]||(y=e.match(/SIZELOG/)?y/Math.log(this.nMaxSize)*Math.log(this.itemA[c].nSize):e.match(/SIZEP4/)?y/Math.pow(this.nMaxSize,
.25)*Math.pow(this.itemA[c].nSize,.25):e.match(/SIZEP3/)||e.match(/SIZEVOLUME/)?y/Math.pow(this.nMaxSize,1/3)*Math.pow(this.itemA[c].nSize,1/3):y/Math.sqrt(this.nMaxSize)*Math.sqrt(this.itemA[c].nSize)):e.match(/MENUSIZE/)||e.match(/SUM/)&&!c?y=1.5*J:e.match(/ZOOM/)&&!e.match(/PLOT/)?y=Math.max(y,2*J/3):this.szSizeField&&c&&this.itemA[c]&&(y=J/Math.sqrt(this.nMaxSize)*Math.sqrt(this.itemA[c].nSize));if(isNaN(y)||!y)if(y=0,!e.match(/STAR/)&&!e.match(/STACKED/))continue;ea=this.szSymbolsA[M];this.szValueField&&
e.match(/EXACT/)&&this.szValuesA&&(Sa=this.szValuesA[M]);if((e.match(/SEQUENCE/)||e.match(/DOMINANT/))&&this.colorScheme.length==this.partsA.length)K=this.colorScheme[M],P=this.colorScheme[M];else if(K=this.colorScheme[0],P=this.colorScheme[1]?this.colorScheme[1]:"none",2<this.colorScheme.length&&(K=this.colorScheme[this.colorScheme.length-1],P=this.colorScheme[0]),e.match(/NOLINES/)?P="none":"none"==P&&(z=__maptheme_getChartColors(K),P=z.textColor),2<this.colorScheme.length||this.szRanges&&this.szRanges.length){for(ii=
0;ii<this.partsA.length;ii++)if(e.match(/EXACT/)&&v==this.partsA[ii].min||!e.match(/EXACT/)&&v<this.partsA[ii].max){K=this.colorScheme[ii];z=__maptheme_getChartColors(K);P=z.textColor;e.match(/RANGE/)&&!e.match(/RANGES/)&&(y=map.Scale.normalX(2+5*(ii+1)/this.partsA.length));W=ii;f.setAttributeNS(szMapNs,"class",String(W%(this.nGridX||1E6)));break}e.match(/NOLINES/)&&(P="none")}if("circle"==ea||"square"==ea||"carot"==ea||"diamond"==ea||"triangle"==ea||"hexagon"==ea||"empty"==ea||"label"==ea){P=this.szLineColor||
P;E=(this.nLineWidth||1)*map.Scale.normalX(Math.min(2*y/J,.2));switch(ea){case "empty":H=map.Dom.newShape("circle",D,0,0,y,"fill:#888888;fill-opacity:0;stroke:#888888;stroke-width:"+E+";");break;case "circle":!this.fShadow&&this.fOrigShadow&&(da=map.Dom.newShape("circle",D,map.Scale.normalX(.5)+.02*y,map.Scale.normalX(.5)+.02*y,1.02*y,"fill:#000000;stroke:none;opacity:"+.6*(this.fillOpacity?this.fillOpacity:1)));H=map.Dom.newShape("circle",D,0,0,y,"fill:"+K+";stroke:"+P+";stroke-width:"+E+";");break;
case "square":H=map.Dom.newShape("rect",D,-y,-y,2*y,2*y,"fill:"+K+";stroke:"+P+";stroke-width:"+E+";");break;case "carot":case "diamond":(H=map.Dom.newShape("rect",D,-y,-y,2*y,2*y,"fill:"+K+";stroke:"+P+";stroke-width:"+E+";"))&&H.setAttributeNS(null,"transform","rotate(45)");break;case "triangle":H=map.Dom.newShape("path",D,"M 0,"+y+" l"+1.2*y+",-"+2*y+" -"+2.4*y+",0 "+1.2*y+","+2*y+"z","fill:"+K+";stroke:"+P+";stroke-width:"+E+";");break;case "hexagon":La=y/2;Ma=y*Math.sin(60/180*Math.PI);wb=y;
H=map.Dom.newShape("path",D,"M -"+y+",0 l "+La+",-"+Ma+" "+wb+",0 "+La+","+Ma+" -"+La+","+Ma+" -"+wb+",0 -"+La+",-"+Ma+" z","fill:"+K+";stroke:"+P+";stroke-width:"+E+";");break;case "label":if(aa=this.formatValue(Sa,this.szValueDecimals||(1>Sa||10>Q?1:0),"FLOOR")+(5>=this.szUnit.length?this.szUnit:""),e.match(/TEXTONLY/)){Ca=__maptheme_getChartColors(K).textColor;ba=String(Math.max(Math.min(.8*y,map.Scale.normalX(500)),map.Scale.normalX(2)));if(this.nValueSizeMin&&!e.match(/ZOOM/)&&ba*map.Layer.nDynamicObjectScale<
map.Scale.normalX(this.nValueSizeMin)){H=map.Dom.newShape("rect",D,0,0,0,0,"fill:none;");da=map.Dom.newShape("rect",D,0,0,0,0,"fill:none;");break}sb=this.szTextFont||"arial";da=map.Dom.newText(D,0,0,"font-family:"+sb+";font-size:"+ba+"px;font-weight:bold;text-anchor:middle;fill:none;stroke:"+K+";stroke-width:"+ba/7+";stroke-opacity:0.5;pointer-events:none;stroke-linejoin:bevel;",aa);da.setAttributeNS(null,"id",this.szId+":"+c+":text:bg");H=map.Dom.newText(D,0,0,"font-family:"+sb+";font-size:"+ba+
"px;font-weight:bold;text-anchor:middle;fill:#000000;opacity:"+wa+";stroke:none;",aa);H.setAttributeNS(null,"id",this.szId+":"+c+":text")}else{ba=String(Math.max(1,Math.min(.8*y,3.4/aa.length*y)));if(this.nValueSizeMin&&!e.match(/ZOOM/)&&ba*map.Layer.nDynamicObjectScale<map.Scale.normalX(this.nValueSizeMin)){H=map.Dom.newShape("rect",D,0,0,0,0,"fill:none;");break}H=map.Dom.newShape("rect",D,-y,.83*-ba,2.05*y,1.6*ba,"fill:"+K+";stroke:"+P+";stroke-width:"+E+";");H.setAttributeNS(null,"rx",map.Scale.normalX(2*
y/J));H.setAttributeNS(null,"ry",map.Scale.normalX(2*y/J))}}if(H){e.match(/OUTLINE/)?(H.style.setProperty("stroke-width",String(map.Scale.normalX(.5))),H.style.setProperty("stroke-opacity","1"),H.style.setProperty("fill-opacity","0.7")):e.match(/RANDOM/)?(H.style.setProperty("stroke-opacity",String(this.nOpacity?this.nOpacity:1),""),H.style.setProperty("fill-opacity",String(this.fillOpacity?this.fillOpacity:this.nOpacity?this.nOpacity:1),""),e.match(/DOPACITY/)&&(na=1/(this.nDopacityPow||1),wa=Math.pow(v,
na)/Math.pow(this.sortedMax,na)*(this.nOpacity||1)*(this.nDopacityScale||1),H.style.setProperty("fill-opacity",String(wa),""))):e.match(/SORT/)&&e.match(/DOPACITY/)?(H.style.setProperty("stroke-opacity",String(this.nOpacity?this.nOpacity:1),""),na=1/(this.nDopacityPow||1),wa=Math.pow(v,na)/Math.pow(this.sortedMax,na)*(this.nOpacity||1)*(this.nDopacityScale||1),H.style.setProperty("fill-opacity",String(wa),"")):e.match(/DOPACITY/)&&this.szAlphaField?c&&"undefined"!=typeof this.itemA[c].nAlpha&&(na=
1/(this.nDopacityPow||1),wa=(this.nDopacityScale||1)/Math.pow(this.nMaxAlpha,na)*Math.pow(this.itemA[c].nAlpha,na),H.style.setProperty("fill-opacity",String(wa),"")):e.match(/DOPACITY/)?(na=1/(this.nDopacityPow||1),wa=(this.nDopacityScale||1)/Math.pow(Q,na)*Math.pow(v,na),H.style.setProperty("fill-opacity",String(wa),"")):H.style.setProperty("fill-opacity",String(this.fillOpacity?this.fillOpacity:this.nOpacity?this.nOpacity:1),"");this.chartGroup&&this.chartGroup.style.setProperty("opacity","1","");
if((e.match(/ZOOM/)||e.match(/NORMSIZE/))&&this.szLabelA){var za=this.formatValue(Sa,2),Fa=za+this.szUnit,Fa=Fa+(" - "+this.szLabelA[M%(this.nGridX||1E7)]);this.szXaxisA&&this.szXaxisA.length&&(Fa+=" ("+this.szXaxisA[Math.floor(M/(this.nGridX||1))]+")")}else za=this.formatValue(Sa,2),Fa=" "+za+this.szUnit;H.setAttributeNS(szMapNs,"tooltip",Fa)}}else if(!e.match(/MULTIPLE/)||e.match(/NORMSIZE/)||e.match(/MENUSIZE/))H=map.Dom.constructNode("use",D,{"xlink:href":"#"+ea+":antizoomandpan"}),map.Dom.newShape("circle",
D,0,0,.5*y,"fill:white;stroke:none;opacity:0"),H.fu.scale(y/J,y/J),H.setAttributeNS(null,"style","fill:"+K+";stroke:"+P);else for(var H=map.Dom.newGroup(D,D.getAttributeNS(null,"id")+":multiple"),Lb=0;Lb<v;Lb++){var bc=map.Dom.constructNode("use",H,{"xlink:href":"#"+ea+":antizoomandpan"});bc.fu.setPosition(Lb*(J+map.Scale.normalX(1)),0);bc.fu.scale(1,1);bc.setAttributeNS(null,"style","fill:"+K+";stroke:"+P);map.Dom.newShape("circle",H,Lb*J,0,.5*y,"fill:white;stroke:none;opacity:0")}if(H&&e.match(/VALUES/)){var I=
null,aa=this.formatValue(Sa,this.szValueDecimals||"")+(5>=this.szUnit.length?this.szUnit:""),Bc=this.formatValue(ib,this.szValueDecimals||"")+(5>=this.szUnit.length?this.szUnit:""),z=__maptheme_getChartColors(K),Ca=this.szTextColor||z.textColor,ba=String(Math.min(.5*y,3.2/Bc.length*y));if(e.match(/ZOOM/)&&e.match(/LINES/)&&(null==this.nGridX||1>=this.nGridX||e.match(/STACKED/)))Ca="black",O||(O=map.Dom.newGroup(f,this.szId+":"+c+":chartontop")),ba=4+.5*l.length/(this.nGridX?2*this.nGridX:1),I=this.createTextLabel(SVGDocument,
O,"",aa,ba,"",z.lowColor,"white"),I.setAttributeNS(null,"opacity","0.5");else if(e.match(/ZOOM/)&&!e.match(/SEQUENCE/))Ca="black",I=map.Dom.newText(D,.5*y+.2*J,-y/2,this.szValuesTextStyle,aa);else if("circle"==ea||"square"==ea||"triangle"==ea||"hexagon"==ea||"label"==ea||"empty"==ea)if(e.match(/CENTER/)||e.match(/TOP/)||e.match(/BOTTOM/)){if(v){var R=6;this.szChartFlag+="|VALUEBACKGROUND";O||(O=map.Dom.newGroup(f,this.szId+":"+c+":chartontop"));Ea=Ea?Ea:y;q=-map.Scale.normalX(1);m=-map.Scale.normalX(1.33*
R)*(ac-sc-1);I=this.createTextLabel(SVGDocument,O,"",aa,R,"",K);I.fu.setPosition(q,m);if(c&&(e.match(/ZOOM/)||e.match(/NORMSIZE/))&&this.szLabelA){var Cc=I.fu.getBox().width,I=map.Dom.newText(O,0,0,this.szValuesTextStyle+";color:#000;",this.szLabelA[M]);I.fu.setPosition(q+Cc+map.Scale.normalX(6),m-map.Scale.normalX(-1));I.fu.scale(.6,.6)}I.setAttributeNS(szMapNs,"class",String(W%(this.nGridX||1E6)));I=null;sc++}}else I=map.Dom.newText(D,0,.33*ba,"font-family:arial;font-size:"+ba+"px;text-anchor:middle;fill:"+
Ca+";stroke:none;pointer-events:none",aa);else ba=String(Math.min(.8*y,y/2)),ba=Math.max(ba,1),I=this.createTextLabel(SVGDocument,D,"",aa,ba/map.Scale.normalX(1),"",K),I.fu.setPosition(map.Scale.normalX(0)+ra,map.Scale.normalY(0)+ha)}if(H&&(H.setAttributeNS(szMapNs,"class",String(W%(this.nGridX||1E6))),I&&I.setAttributeNS(szMapNs,"class",String(W%(this.nGridX||1E6))),da&&da.setAttributeNS(szMapNs,"class",String(W%(this.nGridX||1E6))),!e.match(/CENTER/)))if(e.match(/STAR/)){if(0==u&&(Hb=H,Ib=I,Ea=
y,e.match(/EXPAND/)&&e.match(/SORT/)&&e.match(/UP/)&&(Ea=e.match(/LINEAR/)?(e.match(/EXPANDMAX/)?2:.5)*J/Q*this.sortedIndex[l.length-1].value:(e.match(/EXPANDMAX/)?2:.5)*J/Math.sqrt(Q)*Math.sqrt(this.sortedIndex[l.length-1].value)),e.match(/ZOOM/)&&e.match(/STAR/)&&e.match(/UP/)?Ea*=2:e.match(/COMPRESS/)&&(Ea*=e.match(/COMPRESSMAX/)?.25:.5)),(0<u||e.match(/UP/))&&y){var Dc=this.nClipParts&&this.nClipParts<this.partsA.length?this.nClipParts:this.partsA.length,cc=y,tc=Ea+y,Ec=Math.sqrt(Math.pow(tc,
2)-Math.pow(cc,2)),Mb=90-Math.asin(cc*Ec/tc/cc)/Math.PI*180,Ta=Ea+y;e.match(/UP/)&&(5<u&&(Mb/=1+y/J*2),Ta=Ea*(1+Dc/5));e.match(/ZOOM/)||(Ta=this.nRangeScale?Ta*this.nRangeScale:e.match(/EXPANDMAX/)?2*Ta:e.match(/EXPAND/)?1.5*Ta:Ta);this.initAngle+=Mb;ra=Math.cos(this.initAngle/180*Math.PI)*Ta;ha=Math.sin(this.initAngle/180*Math.PI)*Ta;this.initAngle+=Mb;H.fu.setPosition(map.Scale.normalX(0)+ra,map.Scale.normalY(0)+ha);da&&da.fu.setPosition(map.Scale.normalX(0)+ra,map.Scale.normalY(0)+ha);I&&I.fu.setPosition(map.Scale.normalX(0)+
ra,map.Scale.normalY(0)+ha)}}else if(e.match(/RANDOM/)){var Nb=e.match(/EXPANDMAX/)?2*y:e.match(/EXPAND/)?1.5*y:y;e.match(/ZOOM/)&&(J*=2,Nb*=2);ra=Math.cos(this.initAngle+360/this.partsA.length*u/180*Math.PI)*Math.min(J,Nb);ha=Math.sin(this.initAngle+360/this.partsA.length*u/180*Math.PI)*Math.min(J,Nb);H.fu.setPosition(map.Scale.normalX(0)+ra,map.Scale.normalY(0)+ha);da&&da.fu.setPosition(map.Scale.normalX(0)+ra,map.Scale.normalY(0)+ha);I&&I.fu.setPosition(map.Scale.normalX(0)+ra,map.Scale.normalY(0)+
ha)}else if(e.match(/HORZ/))ra+=y,H.fu.setPosition(map.Scale.normalX(0)+ra,map.Scale.normalY(0)+ha),da&&da.fu.setPosition(map.Scale.normalX(0)+ra,map.Scale.normalY(0)+ha),I&&I.fu.setPosition(map.Scale.normalX(0)+ra,map.Scale.normalY(0)+ha),ra+=y;else if(e.match(/BOTTOM/))H.fu.setPosition(map.Scale.normalX(0),-y),da&&da.fu.setPosition(map.Scale.normalX(0),-y),I&&I.fu.setPosition(map.Scale.normalX(0),-y);else if(e.match(/TOP/))H.fu.setPosition(.3*-y,.7*y-J),da&&da.fu.setPosition(.3*-y,.7*y-J),I&&I.fu.setPosition(.3*
-y,.7*y-J);else if(e.match(/CONE/))H.fu.setPosition(map.Scale.normalY(.33*u),-map.Scale.normalY(1*u)),da&&da.fu.setPosition(map.Scale.normalY(.33*u),-map.Scale.normalY(1*u)),I&&I.fu.setPosition(map.Scale.normalY(.33*u),-map.Scale.normalY(1*u));else if(e.match(/BASE/))H.fu.setPosition(map.Scale.normalX(0),ha-y),da&&da.fu.setPosition(map.Scale.normalX(0),ha-y),I&&I.fu.setPosition(map.Scale.normalX(0),ha-y),ha-=y;else if(e.match(/PLOT/)){0!=v||e.match(/STACKED/)||(H.parentNode.removeChild(H),da&&da.parentNode.removeChild(da),
I&&I.parentNode.removeChild(I));var F=map.Scale.normalX(g)*(e.match(/LINES/)?1:2/3),Y=u*F;this.nGridX&&(Y=e.match(/PLOTVAR/)?Math.floor(u%this.nGridX)*F:Math.floor(u/this.nGridX)*F);var Q=this.nMaxValue||Math.max(this.nMax,ib),N=map.Scale.normalX(g)/Q*(e.match(/ZOOM/),5)*(this.nRangeScale||1),pa=map.Dom.newGroup(D,"");pa.parentNode.insertBefore(pa,pa.parentNode.firstChild);O||(O=map.Dom.newGroup(f,this.szId+":"+c+":chartontop"));la=map.Dom.newGroup(O,"");if(e.match(/PLOTYX/))H.fu.setPosition((Q+Math.abs(Q-
v))*N,Y),da&&da.fu.setPosition((Q+Math.abs(Q-v))*N,Y),I&&I.fu.setPosition((Q+Math.abs(Q-v))*N,Y);else if(e.match(/PLOTY/)){H.fu.setPosition(0,(-Q+Math.abs(Q-v))*N);da&&da.fu.setPosition(0,(-Q+Math.abs(Q-v))*N);I&&I.fu.setPosition(0,(-Q+Math.abs(Q-v))*N);var ga=1,ga=Q/5,ga=10*Math.ceil(ga/(10*Math.floor(Math.log(ga))))*Math.floor(Math.log(ga))||1,Q=Math.ceil(Q/ga)*ga;if(!kb&&(kb=!0,e.match(/BOX/)&&e.match(/GRID/)))for(var ca=map.Scale.normalX(g)/2;ca<Q*N;ca+=N*ga)map.Dom.newShape("line",pa,-20,-ca,
20,-ca,"stroke:#444444;stroke-width:"+map.Scale.normalX(1)+";")}else if(e.match(/PLOTX/)){if(H.fu.setPosition((Q-Math.abs(Q-v))*N,0),da&&da.fu.setPosition((Q-Math.abs(Q-v))*N,0),I&&I.fu.setPosition((Q-Math.abs(Q-v))*N,0),ga=1,ga=Q/5,ga=10*Math.ceil(ga/(10*Math.floor(Math.log(ga))))*Math.floor(Math.log(ga))||1,Q=Math.ceil(Q/ga)*ga,!kb&&(kb=!0,e.match(/BOX/)&&e.match(/GRID/)))for(ca=map.Scale.normalX(g);ca<Q*N+map.Scale.normalX(g);ca+=N*ga)map.Dom.newShape("line",pa,ca,-20,ca,20,"stroke:#444444;stroke-width:"+
map.Scale.normalX(1)+";")}else{ga=1;ga=Math.ceil(Q)/5.1;1<ga&&(ga=10*Math.ceil(ga/(10*Math.floor(Math.log(ga))))*Math.floor(Math.log(ga))||1);Q=Math.ceil(Q/ga)*ga;if(!kb){kb=!0;this.plot_last_last_position=[];this.plot_last_position=[];this.plot_last_value=[];this.plot_last_stacked_value=[];this.plot_last_shape=[];this.plot_last_mean=[];this.plot_last_areaValue=[];this.plot_area_points=[];this.plot_area_shapes=[];this.plot_area_shapes[0]=map.Dom.newShape("path",D,"M0,0","fill:"+K+";fill-opacity:"+
(this.fillOpacity||1)+";stroke:none");var lb=map.Scale.normalX(e.match(/ZOOM/)?7:10);if(e.match(/BOX/)&&e.match(/GRID/)){for(ca=0;ca<=Q*N;ca+=N*ga){var dc=-F/(e.match(/LINES/)?3:1),uc=F*(this.nGridX?l.length/this.nGridX-1:l.length-1);e.match(/PLOTVAR/)&&1<l.length/this.nGridX&&(uc=F*this.nGridX);map.Dom.newShape("line",pa,dc,-ca,uc,-ca,"stroke:#aaaaaa;stroke-width:"+(0==ca?map.Scale.normalX(.5):map.Scale.normalX(.2))+";");5<Q?map.Dom.newText(pa,1.1*dc,-ca+.3*lb,"font-family:arial;font-size:"+lb+"px;text-anchor:end;fill:#888888;stroke:none;pointer-events:none;",
String(Math.round(e.match(/INVERT/)?Q-ca/N:ca/N))):map.Dom.newText(pa,1.1*dc,-ca+.3*lb,"font-family:arial;font-size:"+lb+"px;text-anchor:end;fill:#888888;stroke:none;pointer-events:none;",this.formatValue(Math.round(e.match(/INVERT/)?Q-ca/N:ca/N*10)/10,1));this.nPlotHeight=ca}map.Dom.newShape("line",pa,Y,0,Y,-Q*N,"stroke:#aaaaaa;stroke-width:"+map.Scale.normalX(.1)+";");if(this.szXaxisA&&this.szXaxisA.length)for(ca=0;ca<this.szXaxisA.length;ca++)map.Dom.newShape("line",pa,F*ca,100,F*ca,-Q*N,"stroke:#444444;stroke-width:"+
map.Scale.normalX(.5)+";stroke-dasharray:10 80;"),map.Dom.newText(pa,F*ca,250,"font-family:arial;font-size:"+lb+"px;text-anchor:middle;fill:#888888;stroke:none;pointer-events:none;",this.szXaxisA[ca]);if(this.szXaxisA&&this.szXaxisA.length)for(ca=0;ca<this.szXaxisA.length;ca++)map.Dom.newText(la,F*ca,250,"font-family:arial;font-size:"+lb+"px;text-anchor:middle;fill:#888888;stroke:none;pointer-events:none;",this.szXaxisA[ca]),e.match(/AREA/)&&e.match(/GAP/)&&map.Dom.newShape("line",la,F*(ca+.5),0,
F*(ca+.5),-Q*N,"stroke:#ffffff;stroke-width:"+map.Scale.normalX(1)+";")}}var Ua=this.nGridX?Math.floor(u/this.nGridX)+1:1,T=this.nGridX?u%this.nGridX:1,xa=e.match(/INVERT/)?Q-v:v,xa=xa+(e.match(/STACKED/)?this.plot_last_stacked_value[Ua]||0:0);H.fu.setPosition(Y,-xa*N);da&&da.fu.setPosition(Y,-xa*N);I&&(e.match(/LINES/)&&(null==this.nGridX||1>=this.nGridX||e.match(/STACKED/))?I.fu.setPosition(Y-map.Scale.normalX(g/4),-xa*N-map.Scale.normalY(g/4)/(this.nGridX||1)):I.fu.setPosition(Y,-xa*N));if(e.match(/LINES/)){var V=
null;if(v&&this.plot_last_position[T]&&this.plot_last_position[T].y)if(e.match(/AREA/))V=map.Dom.newShape("path",D,"M"+(this.plot_last_position[T].x-2)+","+this.plot_last_position[T].y+" L "+Y+","+-xa*N+" "+Y+","+(-xa+v)*N+" "+(this.plot_last_position[T].x-2)+","+(this.plot_last_last_position[T-1]?this.plot_last_last_position[T-1].y:0)+" z","fill:"+K+";fill-opacity:"+(this.fillOpacity||1)+";"),V.setAttributeNS(szMapNs,"value",String(v)),V.setAttributeNS(szMapNs,"class",String(W%(this.nGridX||1E6))),
V.setAttributeNS(szMapNs,"tooltip",(this.szLabelA?this.szLabelA[W%(this.nGridX||1E6)]+": ":"")+this.formatValue(this.plot_last_areaValue[T],this.szValueDecimals||2)+this.szUnit+" ... "+this.formatValue(v,this.szValueDecimals||2)+this.szUnit),V=map.Dom.newShape("line",D,this.plot_last_position[T].x,this.plot_last_position[T].y,Y,-xa*N,"stroke:"+K+";stroke-width:"+map.Scale.normalX(e.match(/STACKED/)?1:3)+";"),V.setAttributeNS(szMapNs,"value",String(v));else{V=map.Dom.newShape("line",D,this.plot_last_position[T].x,
this.plot_last_position[T].y,Y,-xa*N,"stroke:"+K+";stroke-width:"+map.Scale.normalX(3)+";stroke-linecap:round;");V.setAttributeNS(szMapNs,"value",String(v));V.setAttributeNS(szMapNs,"class",String(W%(this.nGridX||1E6)));try{D.insertBefore(V,this.plot_last_shape[T])}catch(Nc){}}if(e.match(/PLOTVAR/)){var sa=e.match(/MEDIAN/)?this.nMedianA[M]:this.nMeanA[M];this.plot_last_mean[T]&&(V=map.Dom.newShape("path",pa,"M"+this.plot_last_mean[T].x+","+(this.plot_last_mean[T].y-this.nDeviationA[M-1]*N)+" L "+
Y+","+(-sa-this.nDeviationA[M])*N+" "+Y+","+(-sa+this.nDeviationA[M])*N+" "+this.plot_last_mean[T].x+","+(this.plot_last_mean[T].y+this.nDeviationA[M-1]*N)+" z","fill:#d8d8dd;fill-opacity:0.3;stroke:none;"),V.setAttributeNS(szMapNs,"tooltip","standard deviation"),V=map.Dom.newShape("line",D,this.plot_last_mean[T].x,this.plot_last_mean[T].y,Y,-sa*N,"stroke:#888888;stroke-width:"+map.Scale.normalX(2)+";stroke-linecap:round;stroke-dasharray:10 80;"),V.setAttributeNS(szMapNs,"tooltip","mean"),V=map.Dom.newShape("line",
D,this.plot_last_mean[T].x,this.plot_last_mean[T].y-this.nDeviationA[M-1]*N,Y,(-sa-this.nDeviationA[M])*N,"stroke:#ffffff;stroke-opacity:0.5;stroke-width:"+map.Scale.normalX(1)+";stroke-linecap:round;stroke-dasharray:10 80;"),V.setAttributeNS(szMapNs,"tooltip","standard deviation"),V=map.Dom.newShape("line",D,this.plot_last_mean[T].x,this.plot_last_mean[T].y+this.nDeviationA[M-1]*N,Y,(-sa+this.nDeviationA[M])*N,"stroke:#ffffff;stroke-opacity:0.5;stroke-width:"+map.Scale.normalX(1)+";stroke-linecap:round;stroke-dasharray:10 80;"),
V.setAttributeNS(szMapNs,"tooltip","standard deviation"));this.plot_last_mean[T]=new point(Y,-sa*N)}this.plot_last_last_position[T]=e.match(/STACKED/)?this.plot_last_position[T]||new point(0,0):new point(0,0);this.plot_last_position[T]=new point(Y,-xa*N);this.plot_last_shape[T]=H;this.plot_last_areaValue[T]=v;this.plot_area_points.push(new point(Y,-xa*N))}else 1<l.length/this.nGridX?e.match(/PLOTVAR/)?(H.style.setProperty("fill-opacity",Ua==l.length/this.nGridX?"1":"0.2",""),H.style.setProperty("stroke-width",
Ua==l.length/this.nGridX?"0":"3",""),V=null,this.plot_last_position[T]&&(e.match(/PLOTVAR/)?(V=map.Dom.newShape("line",D,this.plot_last_position[T].x,this.plot_last_position[T].y,Y,-xa*N,"stroke:"+K+";stroke-width:"+map.Scale.normalX(2)+";"),V.setAttributeNS(szMapNs,"value",String(v)),V.setAttributeNS(szMapNs,"class",String(W%(this.nGridX||1E6))),D.insertBefore(V,this.plot_last_shape[T]),V=map.Dom.newShape("line",D,this.plot_last_position[T].x-40,this.plot_last_position[T].y,this.plot_last_position[T].x+
40,this.plot_last_position[T].y,"stroke:"+K+";stroke-width:"+map.Scale.normalX(3)+";"),V.setAttributeNS(szMapNs,"value",String(v)),V.setAttributeNS(szMapNs,"class",String(W%(this.nGridX||1E6))),D.insertBefore(V,this.plot_last_shape[T]),V=map.Dom.newShape("line",D,Y,0,Y,-this.nPlotHeight,"stroke:#dddddd;stroke-width:"+map.Scale.normalX(.25)+";")):V=map.Dom.newShape("line",D,this.plot_last_position[T].x,this.plot_last_position[T].y,Y,-xa*N,"stroke:"+K+";stroke-width:"+map.Scale.normalX(3)+";"),V.setAttributeNS(szMapNs,
"value",String(v)),V.setAttributeNS(szMapNs,"class",String(W%(this.nGridX||1E6))),D.insertBefore(V,this.plot_last_shape[T])),this.plot_last_last_position[T]=this.plot_last_position[T]||new point(0,0),this.plot_last_position[T]=new point(Y,-xa*N),this.plot_last_shape[T]=H):e.match(/BOX/)&&map.Dom.newShape("line",pa,Y,0,Y,-this.nPlotHeight,"stroke:#dddddd;stroke-width:"+map.Scale.normalX(.25)+";"):e.match(/PLOTVAR/)?(V=null,sa=e.match(/MEDIAN/)?this.nMedianA[M]:this.nMeanA[M],V=map.Dom.newShape("line",
pa,Y,-(sa-this.nDeviationA[M])*N,Y,-(sa+this.nDeviationA[M])*N,"stroke:#aaaaaa;stroke-width:"+map.Scale.normalX(1)+";"),V.setAttributeNS(szMapNs,"value",String(v)),V.setAttributeNS(szMapNs,"class",String(W%(this.nGridX||1E6))),V=map.Dom.newShape("line",pa,Y-40,-sa*N,Y+40,-sa*N,"stroke:#aaaaaa;stroke-width:"+map.Scale.normalX(2)+";"),V.setAttributeNS(szMapNs,"value",String(v)),V.setAttributeNS(szMapNs,"class",String(W%(this.nGridX||1E6))),V=map.Dom.newShape("line",pa,Y-80,-(sa-this.nDeviationA[M])*
N,Y+80,-(sa-this.nDeviationA[M])*N,"stroke:#aaaaaa;stroke-width:"+map.Scale.normalX(1)+";"),V.setAttributeNS(szMapNs,"value",String(v)),V.setAttributeNS(szMapNs,"class",String(W%(this.nGridX||1E6))),V=map.Dom.newShape("line",pa,Y-80,-(sa+this.nDeviationA[M])*N,Y+80,-(sa+this.nDeviationA[M])*N,"stroke:#aaaaaa;stroke-width:"+map.Scale.normalX(1)+";"),V.setAttributeNS(szMapNs,"value",String(v)),V.setAttributeNS(szMapNs,"class",String(W%(this.nGridX||1E6))),map.Dom.newShape("line",pa,Y,0,Y,-this.nPlotHeight,
"stroke:#dddddd;stroke-width:"+map.Scale.normalX(.25)+";"),this.plot_last_position[T]&&(V=map.Dom.newShape("line",pa,this.plot_last_position[T].x,this.plot_last_position[T].y,Y,-sa*N,"stroke:#888888;stroke-width:"+map.Scale.normalX(1)+";")),this.plot_last_last_position[T]=this.plot_last_position[T]||new point(0,0),this.plot_last_position[T]=new point(Y,-sa*N)):e.match(/BOX/)&&map.Dom.newShape("line",pa,Y,0,Y,-this.nPlotHeight,"stroke:#dddddd;stroke-width:"+map.Scale.normalX(.25)+";");this.plot_last_value[Ua]=
v;this.plot_last_stacked_value[Ua]=xa}ha=0}else"label"==ea&&(ha-=1.2*ba),H.fu.setPosition(map.Scale.normalX(0)+ra,map.Scale.normalY(0)+ha),da&&da.fu.setPosition(map.Scale.normalX(0)+ra,map.Scale.normalY(0)+ha),I&&I.fu.setPosition(ra,map.Scale.normalY(0)+ha),ha="label"==ea?ha-.33*ba:ha-y}}Ka&&Ka.parentNode.appendChild(Ka);Hb&&Hb.parentNode.appendChild(Hb);Ib&&Ib.parentNode.appendChild(Ib);la&&la.parentNode.appendChild(la);if(e.match(/AREA/)&&!this.nGridX&&this.plot_area_points&&this.plot_area_points.length){var vc=
this.plot_area_points.length;d="M"+this.plot_area_points[0].x+","+this.plot_area_points[0].y+" L ";for(oa=1;oa<vc;oa++)d+=this.plot_area_points[oa].x+","+this.plot_area_points[oa].y+" ";d+=this.plot_area_points[vc-1].x+",0 ";d+="0,0 ";d+="z ";this.plot_area_shapes[0].setAttributeNS(null,"d",d)}"undefined"!=typeof this.szSymbolBoxStyle&&(map.Dom.getBox(D),ab.setAttributeNS(null,"x",-map.Scale.normalX(15)),ab.setAttributeNS(null,"y",-map.Scale.normalY(15)),ab.setAttributeNS(null,"width",map.Scale.normalX(30*
rc)),ab.setAttributeNS(null,"height",map.Scale.normalY(30)),ab.setAttributeNS(null,"fill-opacity",1));L.x=map.Scale.normalY(0);L.y=map.Scale.normalY(e.match(/ZOOM/)||e.match(/MENUSIZE/)?20:0)}else if(e.match(/BUFFER/)){Q=this.nMaxA[0];v=l[0];y=this.nBufferSize?this.nBufferSize:1E3;this.szShapeType.match(/line/)&&(y*=this.nScale);y=map.Scale.getDeltaXofDistanceInMeter(y);K=this.colorScheme[0];if(this.szFields&&this.szFields.length&&this.nRangesA&&this.nRangesA.length&&(K=null,this.nRangesA.length==
this.colorScheme.length))for(u=0;u<this.nRangesA.length;u++)if(v==this.nRangesA[u]||Number(v)==Number(this.nRangesA[u])){K=this.colorScheme[u];z=__maptheme_getChartColors(K);P="undefined"!=typeof this.szBorderColor?this.szBorderColor:.8>this.fillOpacity?"#888888":z.textColor;break}if(this.szShapeType.match(/point/))if(K){g=2*y/map.Scale.normalX(1);L.x=0;L.y=y+map.Scale.normalY(5);this.szFlag.match(/OVERLAY/);H=map.Dom.newShape("circle",D,0,0,y,"");if(this.szFlag.match(/VALUE/))var mb="font-family:arial;font-size:"+
map.Scale.normalX(5)+"px;fill:#222222;stroke-dasharray:none;pointer-events:none;",I=map.Dom.newText(D,y-map.Scale.normalX(5),0,mb,Map.Scale.prototype.formatDistanceString(this.nBufferSize));this.nRealizedCount++}else return new point(0,0);if(this.szShapeType.match(/line/)){var Ob=SVGDocument.getElementById(c),ec=Ob.getAttributeNS(null,"id");if(!ec.match(":paint")){var zb=SVGDocument.getElementById(ec+":paint");zb||(zb=Ob.cloneNode(1E3),D.appendChild(zb),zb.setAttributeNS(null,"id",ec+":paint"));Ob=
zb;this.nRealizedCount++}var Fc=2*y/map.Scale.normalX(1);Ob.setAttributeNS(null,"style","fill:none;stroke:"+K+";stroke-linejoin:round;stroke-linecap:round;stroke-width:"+map.Scale.normalX(Fc)*map.Scale.nZoomScale+";stroke-opacity:"+String(this.fillOpacity?this.fillOpacity:this.nOpacity?this.nOpacity:0)+"");return null}}else if(e.match(/BAR/)||e.match(/BARS/)){var S=0,ia=0,Gc=g,Ga=1,qa=0,G=1,ua=this.nMax-this.nMin,Fb=this.nMax100-this.nMin100;this.nNormalSizeValue&&(ua=Fb=this.nMaxSize=this.nNormalSizeValue);
if(e.match(/SIZE/)&&!e.match(/NORMSIZE/)&&this.szSizeField&&c&&this.itemA[c])Ga=e.match(/SIZELOG/)?1/Math.log(this.nMaxSize)*Math.log(this.itemA[c].nSize):e.match(/SIZEP4/)?1/Math.pow(this.nMaxSize,.25)*Math.pow(this.itemA[c].nSize,.25):e.match(/3D/)||e.match(/SIZEP3/)||e.match(/SIZEVOLUME/)?1/Math.pow(this.nMaxSize,1/3)*Math.pow(this.itemA[c].nSize,1/3):1/Math.sqrt(this.nMaxSize)*Math.sqrt(this.itemA[c].nSize);else if(e.match(/SIZE/)&&!e.match(/NORMSIZE/)){var Na=B;e.match(/POINTER/)&&(Na/=l.length);
Ga=e.match(/SIZELOG/)?1/Math.log(ua)*Math.log(Math.abs(Na)):e.match(/SIZEP4/)?1/Math.pow(ua,.25)*Math.pow(Math.abs(Na),.25):e.match(/3D/)||e.match(/SIZEP3/)||e.match(/SIZEVOLUME/)?1/Math.pow(ua,1/3)*Math.pow(Math.abs(Na),1/3):1/Math.pow(ua,.5)*Math.pow(Math.abs(Na),.5)}0==Ga&&0!=B&&(Ga=30/g);g*=Ga;var C=map.Scale.normalX(g/l.length*.66);e.match(/STACKED/)&&(C=map.Scale.normalX(g/3),this.nGridX&&!e.match(/MULTI/)&&(C/=2));e.match(/MENUSIZE/)&&1==l.length&&(C=map.Scale.normalX(g/2));R=C<map.Scale.normalX(5)?
4*C/5:5*C/5;Ja=1;e.match(/COLUMN/)&&(C*=e.match(/THICK/)?2:e.match(/THIN/)?1:1.5);e.match(/THIN/)&&(C*=.6,R*=.75);e.match(/THICK/)&&(C*=1.5,R*=1.5);e.match(/STACKED/)?R=map.Scale.normalX(5):(e.match(/ZOOM/)||e.match(/NORMSIZE/))&&1==l.length&&(R*=2.5);e.match(/ZOOM/)||(R*=Ga);mb="font-family:arial;font-size:"+.95*R+"px;fill:#606060;pointer-events:none;";mb=map.Scale.tStyle.Values.szStyle+"font-size:"+.95*R+"px";e.match(/NORMSIZE/)||e.match(/MENUSIZE/)||this.szFlag.match(/NORMSIZE/)||this.szFlag.match(/MENUSIZE/)||
!this.nNormalSizeValue||this.szField100&&!e.match(/POINTER/)||(w=this.nNormalSizeValue);this.nOverrideMax&&(w=this.nOverrideMax);F=map.Scale.normalX(Gc)/w;if(e.match(/OFFSETMEAN/)||e.match(/OFFSETMEDIAN/)||e.match(/DEVIATION/))F=map.Scale.normalX(g)/300;e.match(/SIZE/)&&e.match(/SEQUENCE/)&&c&&1<l.length&&!this.szSizeField&&!this.szField100?F=F*l.length/Ga:e.match(/SIZE/)&&c&&1<l.length&&!e.match(/EXPAND/)&&(F=this.szField100||e.match(/POINTER/)?F*Ga:F/(e.match(/SIZEP4/)?Ga*Ga:Ga));!this.nRangeScale||
e.match(/ZOOM/)&&e.match(/HORZ/)||(F*=this.nRangeScale);e.match(/COMPRESSMAX/)?F/=4:e.match(/COMPRESSMORE/)?F/=3:e.match(/COMPRESS/)?F/=2:e.match(/EXPANDMAX/)?F*=4:e.match(/EXPANDMORE/)?F*=3:e.match(/EXPAND/)&&(F*=2);e.match(/POINTER/)&&!e.match(/NORMSIZE/)&&(F*=1.2);var fc=map.Dom.newGroup(D,"");if(e.match(/SORT/)){this.sortedIndex=[];for(u=0;u<l.length;u++)this.sortedIndex[u]={index:u,value:l[u]};this.sortedIndex.sort(e.match(/STACKED/)?this.sortIndexUp:this.sortIndexDown)}else this.sortedIndex=
null;Ra=0;e.match(/UP/)&&(Ra=l.length-1);var fa=1;e.match(/CENTER/)&&(fa=2);for(var bb=new point(0,0),Pb=null,Ha=null,Oa=null,Pa=null,Aa=null,gc=null,Qb=Na=0,W=null,Hc=F,u=this.nClipParts&&this.nClipParts<l.length?l.length-this.nClipParts:0;u<l.length;u++){if(this.szShowParts){vb=!0;for(oa in this.szShowPartsA)this.szShowPartsA[oa]==u&&(vb=!1);if(vb)continue}F=Hc;M=Math.abs(Ra-u);this.sortedIndex&&(M=this.sortedIndex[M].index);W=M;v=l[M];this.szFlag.match(/CLIP/)&&!this.szFlag.match(/MORPH/)&&this.nClipFrames&&
(v=this.nClipFrames==l.length?Number(l[this.nActualFrame]):l[0]*(this.nClipFrames-1-this.nActualFrame)/(this.nClipFrames-1)+l[l.length-1]*this.nActualFrame/(this.nClipFrames-1),M=this.nActualFrame,u=l.length);var Ba=v;e.match(/INVERT/)&&(0!=v||e.match(/ZEROISVALUE/))&&(v=this.nMax-v);e.match(/DIFFERENCE/)&&e.match(/SUM/)&&(Ba=Na+=v);za=this.formatValue(v,this.szValueDecimals||2);e.match(/OFFSETMEAN/)||e.match(/OFFSETMEDIAN/)?(e.match(/OFFSETMEAN/)&&(v*=100/this.nMeanA[M]),e.match(/OFFSETMEDIAN/)&&
(v*=100/this.nMedianA[M]),v-=100,Ba=v=isFinite(v)&&!isNaN(v)?v:0,w=100,za=this.formatValue(v,this.szValueDecimals||2),0<v&&(za="+"+za)):e.match(/DEVIATION/)&&(v=(v-this.nMeanA[M])/this.nDeviationA[M],Ba=v=isFinite(v)&&!isNaN(v)?v:0,v*=100,za=this.formatValue(v,this.szValueDecimals||2),0<v&&(za="+"+za));var ja=this.colorScheme[M];if((e.match(/SEQUENCE/)||1==l.length)&&2<=this.colorScheme.length)for(ja=this.colorScheme[this.partsA.length-1],ii=0;ii<this.partsA.length;ii++)if(v<this.partsA[ii].max){ja=
this.colorScheme[ii];this.partsA[ii].nCount++;W=ii;break}e.match(/LEFT/)&&e.match(/HORZ/)&&(v=-v);0>v&&!e.match(/STACKED/)&&(ia=-v*F,v=-v);e.match(/VOLUME/)&&e.match(/3D/)?(F=1,v=this.szSizeField&&c?C=map.Scale.normalX(g/3*2)*Math.pow(1/this.nMaxSize*this.itemA[c].nSize,1/3):C=map.Scale.normalX(g/3*2)*Math.pow(1/w*v,1/3)):(e.match(/POINTER/)&&e.match(/SIZE/)&&c&&(C=e.match(/WIDTH/)&&r&&(!(e.match(/DIFFERENCE/)||e.match(/RELATIVE/)||e.match(/FRACTION/))||e.match(/OFFSETMEAN/)||e.match(/OFFSETMEDIAN/)||
e.match(/DEVIATION/))?map.Scale.normalX(g)*Math.pow(Math.abs(1/this.nMax100*r),.5):map.Scale.normalX(g)*Math.pow(Math.abs(1/w*v),1/3),R=.6*C,this.nValueSizeMin&&!e.match(/ZOOM/)&&(R=R*map.Layer.nDynamicObjectScale>map.Scale.normalX(this.nValueSizeMin)?R:0),e.match(/ZOOM/)||(Ja=Math.pow(Math.abs(v),.5)/Math.pow(w,.5),this.szFadeValuePow&&Number(this.szFadeValuePow)&&(Ja=Math.pow(Math.abs(v),Number(this.szFadeValuePow))/Math.pow(w,Number(this.szFadeValuePow))))),e.match(/DTEXT/)&&c&&!e.match(/ZOOM/)?
(R=map.Scale.normalX(g/3*2)*Math.pow(Math.abs(1/w*v),.5)*.75,this.nValueSizeMin&&!e.match(/ZOOM/)&&(R=R*map.Layer.nDynamicObjectScale>map.Scale.normalX(this.nValueSizeMin)?R:0),Ja=Math.pow(Math.abs(v),1/3)/Math.pow(w,1/3)):this.nValueSizeMin&&!e.match(/ZOOM/)&&(R=R*map.Layer.nDynamicObjectScale>map.Scale.normalX(this.nValueSizeMin)?R:0));v=isFinite(v)&&!isNaN(v)?v:0;if(0==v&&e.match(/NOZERO/))ia=0;else if(0>Ba&&e.match(/NONEGATIVE/))ia=0;else if(0<Ba&&e.match(/ONLYNEGATIVE/))ia=0;else{var U=map.Dom.newGroup(fc,
"");f.setAttributeNS(szMapNs,"value","seechilds");this.szFlag.match(/MENUSIZE/)&&1==l.length&&!e.match(/VOLUME/)&&(C*=.8,v=C/F*1.7,map.Dom.newShape("rect",U,0,-map.Scale.normalY(.75*g),map.Scale.normalX(.5*g),map.Scale.normalY(.75*g),"fill:red;stroke:none;fill-opacity:0"));var ka=v;if(e.match(/COLUMN/))0<v*F&&(Z=DonutCharts.newChart(SVGDocument,U,S+C/2,0,C/2,0),Z.setStyle("3D"),Z.addStyle("SILENT"),Z.addPart(100,v*F*2-(e.match(/SPACED/)?C/2:C/5),ja,0,(this.szAggregation&&this.szAggregation.match(/sum/),
this.formatValue(l[va],this.szValueDecimals||(5>l[va]?1:0),"FLOOR")+this.szUnit),this.formatValue(l[va],2)+this.szUnit+ma),Z.realize());else if(e.match(/3D/)){z=__maptheme_getChartColors(ja);if(e.match(/VOLUME/)&&Ha){var ta=(v*F-Ha)/15,ia=ia+ta,K="white",K="#444444",K=gc.borderColor;szFillColor=gc.mainColor;szFillOpacity=.3;Ha<v*F&&(szFillOpacity=.2);map.Dom.newShape("line",U,Oa+Aa,Pa-ta,S,ia-ta,"stroke:"+K+";stroke-width:"+map.Scale.normalX(.25)+";");map.Dom.newShape("line",U,Oa+Aa,Pa-Ha-ta,S,ia-
v*F-ta,"stroke:"+K+";stroke-width:"+map.Scale.normalX(.25)+";");map.Dom.newShape("line",U,Oa+Aa+Aa/3,Pa-Aa/4-ta,S+C/3,ia-C/4-ta,"stroke:"+K+";stroke-width:"+map.Scale.normalX(.25)+";");map.Dom.newShape("line",U,Oa+Aa+Aa/3,Pa-Ha-Aa/4-ta,S+C/3,ia-v*F-C/4-ta,"stroke:"+K+";stroke-width:"+map.Scale.normalX(.25)+"");map.Dom.newShape("path",U,"M"+(Oa+Aa)+","+(Pa-ta)+" L "+S+","+(ia-ta)+" "+S+","+(ia-v*F-ta)+" "+(Oa+Aa)+","+(Pa-Ha-ta)+" z","fill:"+szFillColor+";stroke:"+K+";stroke-width:"+map.Scale.normalX(.05)+
";fill-opacity:"+szFillOpacity);Ha-v*F>-C/4&&map.Dom.newShape("path",U,"M"+(Oa+Aa)+","+(Pa-Ha-ta)+" L "+S+","+(ia-v*F-ta)+" "+(S+C/3)+","+(ia-v*F-C/4-ta)+" "+(Oa+Aa+Aa/3)+","+(Pa-Ha-Aa/4-ta)+" z","fill:"+szFillColor+";stroke:"+K+";stroke-width:"+map.Scale.normalX(.05)+";fill-opacity:"+szFillOpacity)}Ha=v*F;Oa=S;Pa=ia;Aa=C;gc=z;if(ka=this.nFilterA[M]){var Ab="fill:#FFFFFF;stroke:gray;stroke-width:"+map.Scale.normalX(.5)+";fill-opacity:0.1;stroke-opacity:0.1";map.Dom.newShape("path",U,"M"+S+",0 l "+
C+",0 "+C/3+","+-C/4+" "+-C+" 0 z",Ab);map.Dom.newShape("rect",U,S+C/3,-ka*F/fa-C/4,C,ka*F,Ab);map.Dom.newShape("path",U,"M"+S+",0 l 0,"+-ka*F/fa+" "+C/3+","+-C/4+" 0,"+ka*F+" z",Ab);map.Dom.newShape("rect",U,S,-ka*F/fa,C,ka*F,Ab);map.Dom.newShape("path",U,"M"+(S+C)+",0 l 0,"+-ka*F/fa+" "+C/3+","+-C/4+" 0,"+ka*F+" z",Ab);z.highColor=ColorScheme.getDerivateColor(ja,.9)}0>=ia||e.match(/LEFT/)||e.match(/VOLUME/)?(v&&(0==v&&(z=__maptheme_getChartColors("none")),map.Dom.newShape("rect",U,S,-v*F/fa,C,v*
F,"fill:"+z.mainColor+";stroke:"+z.borderColor+";stroke-width:"+map.Scale.normalX(.05)+";stroke-opacity:0.3"),map.Dom.newShape("path",U,"M"+(S+C)+",0 l 0,"+-v*F/fa+" "+C/3+","+-C/4+" 0,"+v*F+" z","fill:"+z.lowColor+";stroke:"+z.borderColor+";stroke-width:"+map.Scale.normalX(.05)+""),z.highColor=ColorScheme.getDerivateColor(ja,.9)),map.Dom.newShape("path",U,"M"+S+","+-v*F/fa+" l "+C+",0 "+C/3+","+-C/4+" "+-C+" 0 z","fill:"+z.highColor+";stroke:"+z.borderColor+";stroke-width:"+map.Scale.normalX(.05)+
";stroke-opacity:1")):(map.Dom.newShape("path",U,"M"+S+",0 l "+C+",0 "+C/3+","+-C/4+" "+-C+" 0 z","fill:"+z.highColor+";stroke:"+z.borderColor+";stroke-width:"+map.Scale.normalX(.05)+";fill-opacity:0.2"),map.Dom.newShape("rect",U,S+C/3,-v*F/fa-C/4,C,v*F,"fill:"+z.mainColor+";stroke:"+z.borderColor+";stroke-width:"+map.Scale.normalX(.05)+";fill-opacity:0.4"),map.Dom.newShape("path",U,"M"+S+",0 l 0,"+-v*F/fa+" "+C/3+","+-C/4+" 0,"+v*F+" z","fill:"+z.lowColor+";stroke:"+z.borderColor+";stroke-width:"+
map.Scale.normalX(.05)+";fill-opacity:0.4"),z.highColor=ColorScheme.getDerivateColor(ja,.9),map.Dom.newShape("rect",U,S,-v*F/fa,C,v*F,"fill:"+z.mainColor+";stroke:"+z.borderColor+";stroke-width:"+map.Scale.normalX(.05)+";fill-opacity:0.4"),map.Dom.newShape("path",U,"M"+(S+C)+",0 l 0,"+-v*F/fa+" "+C/3+","+-C/4+" 0,"+v*F+" z","fill:"+z.lowColor+";stroke:"+z.borderColor+";stroke-width:"+map.Scale.normalX(.05)+";fill-opacity:0.4"),z.highColor=ColorScheme.getDerivateColor(ja,.9));ka&&(map.Dom.newShape("rect",
U,S,-ka*F/fa,C,ka*F,"fill:#FFFFFF;stroke:none;stroke-width:"+map.Scale.normalX(.05)+";fill-opacity:0.25"),ka>v?map.Dom.newShape("path",U,"M"+S+","+-ka*F/fa+" l "+C+",0 "+C/3+","+-C/4+" "+-C+" 0 z","fill:#8888FF;stroke:#444488;stroke-width:"+map.Scale.normalX(.1)+";fill-opacity:0.2"):map.Dom.newShape("path",U,"M"+S+","+-ka*F/fa+" l "+C+",0 "+C/3+","+-C/4+" "+-C+" 0 z","fill:#8888FF;stroke:"+z.borderColor+";stroke-width:"+map.Scale.normalX(.1)+";fill-opacity:0.1;stroke-opacity:0.4"))}else if(e.match(/Border/)){map.Dom.newShape("rect",
U,S,-v*F/fa,C,v*F,"fill:"+ja+";stroke:none;");var nb=S+2,ob=S+C-2,Bb=2-v*F/fa,Rb=Bb+v*F-2,z=__maptheme_getChartColors(ja);map.Dom.newShape("line",U,nb,Bb,nb,Rb,"stroke:white;stroke-width:"+map.Scale.normalX(.001)+";stroke-opacity:1.0");map.Dom.newShape("line",U,nb,Bb,ob,Bb,"stroke:white;stroke-width:"+map.Scale.normalX(.001)+";stroke-opacity:1.0");map.Dom.newShape("line",U,nb,Rb,ob,Rb,"stroke:black;stroke-width:"+map.Scale.normalX(.001)+";stroke-opacity:0.9");map.Dom.newShape("line",U,ob,Bb,ob,Rb,
"stroke:black;stroke-width:"+map.Scale.normalX(.001)+";stroke-opacity:0.9")}else if(e.match(/POINTER/)&&v){(e.match(/OFFSETMEAN/)||e.match(/OFFSETMEDIAN/)||e.match(/DEVIATION/))&&1E3<Math.abs(v*F)&&(F=(1E3+(Math.abs(v*F)-1E3)/10+Math.abs(v*F)%1E3)/Math.abs(v));var Cb="fill:"+ja+";fill-opacity:"+(this.fillOpacity||1)+";stroke:black;stroke-opacity:0.5;stroke-width:"+map.Scale.normalX(.25)+"";0>=ia?(!this.fShadow&&this.fOrigShadow&&map.Dom.newShape("path",U,"M"+(S+C/7+10)+","+(-v*F/fa+10)+" l "+-C/7+
",0 0,"+-C/15+" "+C/2+","+-C/3+" "+C/2+","+C/3+" 0,"+C/15+" "+-C/7+",0 0,"+v*F+" "+5*-C/7+",0 z","fill:000000;fill-opacity:0.5;stroke:none;"),map.Dom.newShape("path",U,"M"+(S+C/7)+","+-v*F/fa+" l "+-C/7+",0 0,"+-C/15+" "+C/2+","+-C/3+" "+C/2+","+C/3+" 0,"+C/15+" "+-C/7+",0 0,"+v*F+" "+5*-C/7+",0 z",Cb)):e.match(/NONEGATIVE/)||(e.match(/LEFT/)||(e.match(/ZOOM/)||e.match(/NORMSIZE/)?Cb="fill:"+ja+";stroke:"+ja+";stroke-width:"+map.Scale.normalX(.25)+";fill-opacity:0.5":2<this.partsA.length?(z=__maptheme_getChartColors(ja),
Cb="fill:"+ja+";stroke:"+z.lowColor+";stroke-width:"+map.Scale.normalX(.25)+";fill-opacity:"+(this.nFadeNegative||.1)+";stroke-opacity:0.8"):(z=__maptheme_getChartColors(ja),Cb="fill:"+ja+";stroke:"+z.highColor+";stroke-width:"+map.Scale.normalX(.5)+";fill-opacity:"+(this.nFadeNegative||.1)+";stroke-opacity:1")),map.Dom.newShape("path",U,"M"+(S+C/7)+","+-v*F/fa+" l "+5*C/7+",0 0,"+v*F+" "+C/7+",0 "+-C/2+","+C/4+" "+-C/2+","+-C/4+" "+C/7+",0 z",Cb))}else 0>=ia||e.match(/LEFT/)?map.Dom.newShape("rect",
U,S,-v*F/fa,C,v*F,"fill:"+ja+";stroke:black;stroke-width:"+map.Scale.normalX(.05)+";stroke-opacity:0.1"):map.Dom.newShape("rect",U,S,-v*F/fa,C,v*F,"fill:"+ja+";stroke:"+ja+";stroke-width:"+map.Scale.normalX(.25)+";fill-opacity:0.3"),(ka=this.nFilterA[M])&&(0>=ia||e.match(/LEFT/)?map.Dom.newShape("rect",U,S,-ka*F/fa,C,ka*F,"fill:none;stroke:black;stroke-width:"+map.Scale.normalX(.5)+";stroke-opacity:0.1"):map.Dom.newShape("rect",U,S,-ka*F/fa,C,ka*F,"fill:none;stroke:"+ja+";stroke-width:"+map.Scale.normalX(.5)+
";fill-opacity:0.3"));if((e.match(/VALUES/)||this.szXaxisA)&&!(0<ia&&e.match(/NONEGATIVE/))&&(e.match(/ZOOM/)||!this.szValueUpper||map.Scale.getTrueMapScale()*map.Scale.nZoomScale<=this.nValueUpper)){v||(v=0);if(e.match(/AXIS/)&&!e.match(/STACKED/)&&(this.szLabelA||this.szXaxisA)){var Ua=M,Kb=this.szXaxisA?this.szXaxisA[Ua]:this.szLabelA?this.szLabelA[Ua]:"",wc=.8*R;e.match(/UP/)&&(wc=.9*R);var I=map.Dom.newText(U,0,0,mb+";fill:#666666;text-anchor:end;font-size:"+wc+"px"," "+Kb+" "),X=new point(map.Scale.normalX(.8),
C/2+R/5*2);this.fNegativeValues?I.setAttributeNS(null,"transform","translate("+(S+X.y)+","+(-X.x+.9*R)+") rotate(270)"):e.match(/CENTER/)?I.setAttributeNS(null,"transform","translate("+(S+X.y)+","+(map.Scale.normalX(g/2)+.9*R)+") rotate(270)"):e.match(/HORZ/)?I.setAttributeNS(null,"transform","translate("+(S+X.y)+","+(-X.x+.9*R)+") rotate(270)"):(I.style.setProperty("text-anchor","end",""),1==l.length?I.setAttributeNS(null,"transform","translate("+(S+(e.match(/VOLUME/)?1.3*C:1.5*X.y))+","+-X.x+") "):
1<Kb.length?I.setAttributeNS(null,"transform","translate("+(S+X.y)+","+(-X.x+.8*R)+") rotate(315)"):I.setAttributeNS(null,"transform","translate("+(S+.1*X.y)+","+(-X.x+R)+")"))}if(e.match(/VALUES/)&&0<R&&!(this.nGridX&&2<this.partsA.length/this.nGridX)){aa=this.formatValue(Ba,this.szValueDecimals||(10>this.nMax?1:0));e.match(/POINTER/)&&0<Ba&&(0>this.nMin||e.match(/OFFSETMEAN/)||e.match(/OFFSETMEDIAN/))&&(aa="+"+aa);e.match(/VOLUME/)||(aa+=this.szUnit?" "+this.szUnit+" ":"");!e.match(/STACKED/)||
0==Ba||r||this.nGridX||(aa=aa+" ("+Math.round(Ba/B*100)+"%)");var Db=aa.length*R*4/8,I=this.createTextLabel(SVGDocument,U,"",aa,R/map.Scale.normalX(1),null,0<Ba&&(e.match(/CTEXT/)||e.match(/VALUEBACKGROUND/))?ja:null,this.szTextColor);I.style.setProperty("opacity",String(Ja),"");var hc=Ia=null;this.szXaxisA&&e.match(/EXACT/)&&!e.match(/AXIS/)&&(hc=map.Dom.newTSpan(I,"fill:fill:#444444;font-size:"+R+"px"," "+this.szXaxisA[u]));var pb=I.fu.getBox().width,X=new point(map.Scale.normalX(-4),C/2+.15*R),
xc=!0;if(e.match(/DOINLINETEXT/)&&!e.match(/ZOOM/)&&!e.match(/NORMSIZE/)||!e.match(/VALUE/)||e.match(/VOLUME/)&&!e.match(/ZOOM/)||!(e.match(/THIN/)||e.match(/NOINLINETEXT/)||e.match(/DTEXT/)||e.match(/SIZE/)||pb+map.Scale.normalX(1)>v*F/fa||e.match(/STACKED/)||e.match(/NORMSIZE/)||e.match(/ZOOM/))){z=__maptheme_getChartColors(ja);I.removeChild(I.firstChild);I.firstChild.style.setProperty("fill",z.textColor,"");hc&&hc.style.setProperty("fill",z.textColor,"");Ia&&Ia.parentNode.removeChild(Ia);var Ic=
map.Scale.normalX(0),cb=map.Scale.normalY(.5);e.match(/VOLUME/)?(N=v*F/(pb+map.Scale.normalX(2)),I.parentNode.removeChild(I),I=map.Dom.newText(U,S+v*F/2,R*N/4-v*F/2,"font-family:arial;font-size:"+R*N+"px;text-anchor:middle;fill:"+z.textColor+";opacity:"+wa+";stroke:none;pointer-events:none",aa)):(N=Math.min(1,v*F/pb),.33>N?I.parentNode.removeChild(I):(0<Ba&&(X.x+=v*F-(pb+map.Scale.normalX(3))*N),cb/=N,I.firstChild.style.setProperty("font-size",String(R*N)),I.firstChild.setAttributeNS(null,"transform",
"translate("+(S+X.y-cb)+","+(-X.x-Ic)+") rotate(270)\t")));bb.x=Math.max(0,bb.x-v*F)}else if(xc=!1,e.match(/STACKED/))if(0!=v||e.match(/ZEROISVALUE/)){X.x=0;e.match(/3D/)&&(X.x+=C/4,X.y+=C/3);var Sb=v*F/(e.match(/SUM/),2);bb.x=Math.max(0,bb.x+(.75*R-Sb));var Tb=new point(bb.x+X.x+Sb-R/3,0),Qa=map.Scale.normalX(1.5),Va=S+X.y+C/3,Wa=S+X.y+7*C/8,Xa=-X.x-Sb,Ya=-Tb.x-R/3;if(this.nGridX&&Qb<this.nGridX){X.y-=2*C+I.fu.getBox().width;var Jc=Wa,Wa=Va-(e.match(/3D/)?1.5*C:1.4*C),Va=Jc-(e.match(/3D/)?7*C/4:
1.4*C);e.match(/3D/)&&(Xa+=C/5,Ya+=C/5,Tb.x-=C/7);Qa=-Qa}I.setAttributeNS(null,"transform","translate("+(S+X.y+C+Qa-R)+","+(-Tb.x-.25*R)+") ");var ic=map.Dom.newGroup(U,""),jc=map.Dom.newGroup(U,"");map.Dom.newShape("line",ic,Va,Xa,Va+Qa,Xa,"stroke-width:"+map.Scale.normalX(1.5)+";stroke:white;opacity:0.2;");map.Dom.newShape("line",jc,Va,Xa,Va+Qa,Xa,"stroke-width:"+map.Scale.normalX(.5)+";stroke:#888888;");map.Dom.newShape("line",ic,Va+Qa,Xa,Wa,Ya,"stroke-width:"+map.Scale.normalX(1.5)+";stroke:white;opacity:0.2;stroke-linecap:round;");
map.Dom.newShape("line",jc,Va+Qa,Xa,Wa,Ya,"stroke-width:"+map.Scale.normalX(.5)+";stroke:#888888;");map.Dom.newShape("line",ic,Wa,Ya,Wa+Qa,Ya,"stroke-width:"+map.Scale.normalX(1.5)+";stroke:white;opacity:0.2;");map.Dom.newShape("line",jc,Wa,Ya,Wa+Qa,Ya,"stroke-width:"+map.Scale.normalX(.5)+";stroke:#888888;");bb.x=Math.max(0,bb.x+(2*R/3-(v*F-Sb)))}else I.parentNode.removeChild(I);else{X.x+=C/4;e.match(/3D/)&&(X.x+=C/4,X.y=.3*C+R/2);e.match(/POINTER/)&&0<Ba&&(X.x+=.25*C);var Za=v;pb+map.Scale.normalX(1)>
(ka-v)*F/fa&&(Za=Math.max(v,ka),ka>v&&(Za+=C/F*.2,map.Dom.newShape("line",U,S+.6*C,-X.x-v*F/fa+C/3,S+.6*C,-X.x-ka*F/fa-.4*C,"stroke:white;")));e.match(/VOLUME/)&&(Za+=C/5);if(1!=l.length||e.match(/HORZ/)||e.match(/VOLUME/))e.match(/VOLUME/)?I.setAttributeNS(null,"transform","translate("+(S+X.y)+","+(-X.x-Za*F/fa)+")  scale(0.9,0.9)"):I.setAttributeNS(null,"transform","translate("+(S+X.y)+","+(-0-Za*F/fa)+") rotate(270) scale(0.9,0.9)");else{if(e.match(/ZOOM/)||e.match(/NORMSIZE/)){X.y+=e.match(/3D/)?
.75*C:.5*C;var Kc=Math.min(0,.55*R-v*F),yc=R;!e.match(/3D/)&&!e.match(/ZOOM/)||e.match(/SIZE/)||(yc=0);I.setAttributeNS(null,"transform","translate("+(S+yc)+","+(Kc-.5*R)+")")}else X.y+=e.match(/3D/)?e.match(/VOLUME/)?.75*C:.6*C:.2*C,I.setAttributeNS(null,"transform","translate("+(S-.8*C)+","+(-Za*F/fa-.8*R-(e.match(/POINTER/)&&0<Ba?.3*C:0))+")");0>Ba&&I.style.setProperty("opacity",String(.75*Ja),"")}I.style.setProperty("fill","#404040","")}}}null!=h&&u==h&&(G=2*R,z=__maptheme_getChartColors(ja),
map.Dom.newShape("path",U,"M5,0 l 35,-45 -25,0 0,-30 -20,0 0,30 -25,0 35,45","fill:#404040;stroke:white;stroke-width:"+map.Scale.normalX(.2)+"").fu.setPosition(u*(C+1.5)+.5*C,-v*F+(xc?-map.Scale.normalX(3):-pb-map.Scale.normalX(5.5))));e.match(/TRENDLINE/)&&(cb=Math.min(v*F/2,map.Scale.normalY(1.5)),z=__maptheme_getChartColors(ja),K=z.lowColor,G=R/5,0<u&&(nb=(u-1)*(C+(e.match(/SPACED/)?C/5:1))+C/2,ob=u*(C+(e.match(/SPACED/)?C/5:1))+C/2,K="white",K=Pb>v?"#CC3333":Pb<v?"#22BB22":z.lowColor,map.Dom.newShape("line",
U,nb,-Pb*F+cb,ob,-v*F+cb,"stroke:#666666;stroke-width:"+map.Scale.normalX(1/l.length*1.2)+";opacity:0.8")),map.Dom.newShape("circle",U,0,0,G,"fill:"+K+";stroke:none;opacity:0.8").fu.setPosition(u*(C+(e.match(/SPACED/)?C/5:0))+C/2,-v*F+cb));e.match(/SILENT/)||(this.szFlag.match(/SEQUENCE/)?U.setAttributeNS(szMapNs,"tooltip",za+" ("+(this.szLabelA?this.szLabelA[W]:"")+") ["+this.szFieldsA[M]+"]"):(ma=this.szFieldsA[M],this.szLabelA&&this.szLabelA[M]&&(ma=this.szLabelA[M]),!B||this.szField100&&!this.szFlag.match(/FRACTION/)||
(za=za+" ("+this.formatValue(100/B*v,2)+"%)"),U.setAttributeNS(szMapNs,"tooltip",za+this.szUnit+" "+ma+"")));e.match(/FADEIN/)&&(2==l.length&&0==u?U.style.setProperty("opacity","0.6",""):e.match(/NORMSIZE/)||(na=e.match(/FADEINP4/)?10:3,U.style.setProperty("opacity",String(.1+.9*Math.pow(u+1,na)/Math.pow(l.length,na)),"")));e.match(/FADENEGATIVE/)&&0>Ba&&U.style.setProperty("opacity","0.5","");U.setAttributeNS(szMapNs,"class",String(W));U.fu.setPosition(0,ia);e.match(/STACKED/)?ia-=v*F:(ia=0,S+=C,
e.match(/VOLUME/)&&e.match(/SPACED/)?S+=C/(2==l.length?2:4):e.match(/SPACED/)?S+=C/5:e.match(/UP/)||(S+=1));Qb++;e.match(/STACKED/)&&!e.match(/MULTI/)&&this.nGridX&&0==Qb%this.nGridX&&(ia=0,S+=C+C/20);Pb=v}}e.match(/HOR/)&&fc.setAttributeNS(null,"transform","rotate(90) translate("+-S+",0)");L.y=0;L.x=0;e.match(/HOR/)?(L.y-=1*C/2,e.match(/3D/)&&(L.y-=1*C/3)):e.match(/STACKED/)?L.x=C/2:e.match(/Up/)||e.match(/HOR/)?L.x=0:L.x=C*Qb/2;e.match(/MENUSIZE/)&&(L.x+=C*(e.match(/HORZ/)?1:0),L.y+=C*(e.match(/HORZ/)?
.3:0),L.y+=C*(e.match(/HORZ/)&&e.match(/3D/)?1:e.match(/VOLUME/)?.3:.6));this.nRealizedCount++;var kc=map.Dom.newGroup(D,"");kc.appendChild(fc);e.match(/ZOOM/)&&(N=240/R/(1<l.length?2:1),kc.fu.scale(N,N));kc.fu.setPosition(D.fu.getPosition().x-L.x,-L.y);L.x=0;L.y=0;e.match(/HOR/)&&(L.y=1*C/2)}if(e.match(/EXTEND/)&&HTMLWindow.ixmaps.htmlgui_drawChartAfter)try{qb=this.objThemesA[this.szThemesA[0]],HTMLWindow.ixmaps.htmlgui_drawChartAfter(SVGDocument,{target:D,theme:this,item:c,values:l,maxSize:g,flag:e,
mark:h,dbRecord:qb.dbRecords?qb.dbRecords[this.itemA[c].dbIndex]:null})}catch(Oc){}if(!e.match(/NORMSIZE/)){var ya=new point(L.x,L.y);L.y=0;L.x=0;this.szAlign&&(this.szAlign.match(/center/)&&(L.y=0),this.szAlign.match(/top/)&&(L.y=ya.y?ya.y:map.Scale.normalX(g/5)),this.szAlign.match(/above/)&&(L.y=ya.y?ya.y:map.Scale.normalX(g/2)),this.szAlign.match(/2above/)&&(L.y+=map.Scale.normalX(g/2)),this.szAlign.match(/below/)&&(L.y=-(ya.y?ya.y:map.Scale.normalX(g/2))),this.szAlign.match(/2below/)&&(L.y-=map.Scale.normalX(g/
2)),this.szAlign.match(/bottom/)&&(L.y=-(ya.y?ya.y:map.Scale.normalX(g/2))),this.szAlign.match(/2bottom/)&&(L.y-=map.Scale.normalX(g/2)),this.szAlign.match(/right/)&&(L.x=-(ya.y?ya.y:map.Scale.normalX(g/2))),this.szAlign.match(/2right/)&&(L.x-=map.Scale.normalX(g/2)),this.szAlign.match(/left/)&&(L.x=ya.y?ya.y:map.Scale.normalX(g/2)),this.szAlign.match(/2left/)&&(L.x+=map.Scale.normalX(g/2)))}if(c&&this.szLabelField&&!e.match(/NORMSIZE/)&&!e.match(/ZOOM/)&&(!this.nLabelUpper||map.Scale.getTrueMapScale()*
map.Scale.nZoomScale<=this.nLabelUpper)){var ma=(ma=this.itemA[c].szLabel)?isNaN(__scanValue(ma))?ma+(this.szLabelUnits||""):this.formatValue(__scanValue(ma),2)+(this.szLabelUnits||""):this.szLabelField+"?",R=map.Scale.normalX(6),mb="opacity:0.7;font-family:arial;font-size:"+R+"px;text-anchor:middle;fill:#000000;pointer-events:none",Lc="opacity:0.75;fill:white;stroke:#000000;stroke-width:"+map.Scale.normalX(1)+"pointer-events:none;",Db=(ma.length+2)*R*.66,Eb=map.Dom.newGroup(D,"");Eb.parentNode.insertBefore(Eb,
Eb.parentNode.firstChild);var lc=map.Dom.newShape("rect",Eb,-Db/2,-R,Db,1.2*R,Lc);lc.setAttributeNS(null,"rx",.66*R);lc.setAttributeNS(null,"ry",.66*R);I=map.Dom.newText(Eb,0,0,mb,ma);lc.fu.setPosition(Db/2+map.Scale.normalX(1)+.6*ya.y,R/2+.66*ya.y);I.fu.setPosition(Db/2+map.Scale.normalX(1)+.6*ya.y,R/2+.66*ya.y)}if(e.match(/MENU/)){var Ub=D.fu.getBox();D.fu.setPosition(-Ub.x-Ub.width/2,-Ub.y-Ub.height/2-map.Scale.normalY(g/2)-map.Scale.normalY(2))}else D.fu.setPosition(D.fu.getPosition().x-L.x,D.fu.getPosition().y-
L.y);if(e.match(/ZOOM/)){var mc=map.Dom.getBox(f);mc.height>map.Scale.normalY(150)&&(N=Math.min(1,map.Scale.normalY(150)/mc.height),N=Math.max(N,map.Scale.normalY(30)/mc.height),D.fu.scale(N,N),O&&O.fu.scale(N,N))}L.x=0;L.y=0;c&&(this.itemA[c].fDone=!0);return L};MapTheme.prototype.getShapes=function(){var f=map.Layer.getLayerObj(this.szThemesA[0]);if(!f||!f.szFlag.match(/tiled/))for(a in this.itemA)this.parent.themeNodesA[a]||(this.parent.themeNodesA[a]=this.getShapeA(a))};
MapTheme.prototype.getItemNodes=function(f){this.parent.themeNodesA[f]&&this.parent.themeNodesA[f].length||(this.parent.themeNodesA[f]=this.getShapeA(f));return this.parent.themeNodesA[f]||[]};MapTheme.prototype.getShapeA=function(f){f=__mpap_decode_utf8(f);return(f=SVGDocument.getElementById(f.trim()))?Array(f):[]};MapTheme.prototype.getPositions=function(){for(a in this.itemA)this.getNodePosition(this.itemA[a].szSelectionId)};
MapTheme.prototype.getNodePosition=function(f){if("undefined"==typeof f)return null;var c=this.nGridWidth||this.szAggregationField?this.themeNodesPosA:this.parent.themeNodesPosA;if(!c[f]){if(f.match(/:clone/))return null;if(f.match(/(-?[0-9\.]+) ?, ?(-?[0-9\.]+)/)){var g=this.getMapPosition(f);c[f]=new point(g.x,g.y);return c[f]}this.parent.themeNodesA[f]||(this.parent.themeNodesA[f]=this.getShapeA(f));g=this.parent.themeNodesA[f][0];if(1<this.parent.themeNodesA[f].length)for(var e=parseFloat(g.getAttributeNS(szMapNs,
"area")),h=1;h<this.parent.themeNodesA[f].length;h++){var m=this.parent.themeNodesA[f][h],q=parseFloat(m.getAttributeNS(szMapNs,"area"));q>e&&(e=q,g=m)}g&&(this.szShapeType.match(/line/)?e=map.Dom.getBox(g):((e=g.getAttributeNS(szMapNs,"center"))||(e=g.parentNode.getAttributeNS(szMapNs,"center")),e&&2<e.length?(e=e.split(","),e=new box(Number(e[0].split(":")[1]),Number(e[1].split(":")[1]),0,0)):e=map.Dom.getBox(g)),g=map.Scale.getMapOffset(g),c[f]=new point(g.x+e.x+e.width/2,g.y+e.y+e.height/2))}return c[f]&&
"undefined"!=typeof c[f].x&&"undefined"!=typeof c[f].y?c[f]:null};
MapTheme.prototype.getNodeBox=function(f){if("undefined"==typeof f)return null;if(!this.parent.themeNodesBoxA[f]){if(f.match(/:clone/))return null;this.parent.themeNodesA[f]||(this.parent.themeNodesA[f]=this.getShapeA(f));var c=this.parent.themeNodesA[f][0];if(1<this.parent.themeNodesA[f].length)for(var g=parseFloat(c.getAttributeNS(szMapNs,"area")),e=1;e<this.parent.themeNodesA[f].length;e++){var h=this.parent.themeNodesA[f][e],m=parseFloat(h.getAttributeNS(szMapNs,"area"));m>g&&(g=m,c=h)}c&&(g=
map.Dom.getBox(c),c=map.Scale.getMapOffset(c),this.parent.themeNodesBoxA[f]=new box(c.x+g.x,c.y+g.y,g.width,g.height))}return this.parent.themeNodesBoxA[f]};MapTheme.prototype.getNodeArea=function(f){return(f=this.getItemNodes(f)[0])?Number(f.getAttributeNS(szMapNs,"area"))/1E6:0};positionRegExp=/(-?[0-9\.]+) ?, ?(-?[0-9\.]+)/;
MapTheme.prototype.getMapPosition=function(f){if(f){var c=null;if(f&&(c=f.match(positionRegExp)))return map.Scale.getMapPositionOfLatLon(parseFloat(c[1]),parseFloat(c[2])),map.Scale.getMapPositionOfLatLon(parseFloat(c[1]),parseFloat(c[2]))}return new point(0,0)};MapTheme.prototype.onClick=function(f){this.fRemove||(this.widgetNode&&this.enable(),this.fToFront=!0,executeWithMessage("map.Themes.execute()","... processing ..."),map.Themes.onclickInfo(f,this.szId))};
MapTheme.prototype.showErrorInfo=function(){if(0!=this.nMissingPositionCount){var f=this.szId+":errordisplay:widget",c=map.Dictionary.getLocalText("Chart statistic"),c=new InfoContainer(SVGDocument,this.widgetNode,f+":movable",new point(map.Scale.normalX(0),map.Scale.normalX(0)),new point(-map.Scale.normalX(15),map.Scale.normalX(80)),"fixed",c),g=c.workspaceNode,e=[map.Dictionary.getLocalText("total items"),map.Dictionary.getLocalText("charts drawn"),map.Dictionary.getLocalText("missing positions"),
map.Dictionary.getLocalText("missing value match"),map.Dictionary.getLocalText("zero values"),String(this.nCount),String(this.nRealizedCount),String(this.nMissingPositionCount),String(this.nMissingRangeCount),String(this.nZeroValueCount)],g=map.Dom.newGroup(g,"");g.fu.setPosition(0,map.Scale.normalY(3));createTextGrid(SVGDocument,g,f+":textgrid",e,2);c.reformat()}};
MapTheme.prototype.getDataGrid=function(f,c){var g=map.Themes.getDataRow(f,this);if(g&&g.length){for(var e=0;e<g.length;e++)g[e]=g[e]||"---";(e=new ScrollArea(null,c,null,10,10,10))?(e.reformat(),gridGroup=e.workspaceNode):gridGroup=c;for(var h=[],m=map.Themes.getFieldIndexArray(this),q=0;q<m.length;q++)h[m[q]]="font-weight:bold;fill:#087BBB",h[m[q+g.length/2]]="font-weight:bold;fill:#087BBB";g=createTextGrid(SVGDocument,gridGroup,":textgrid",g,2,12,h);return e?(e.setWidth(Math.min(g.fu.getBox().width/
map.Scale.normalX(1)+15,map.Scale.bBox.width/map.Scale.normalY(2.2))),e.setHeight(Math.min(g.fu.getBox().height/map.Scale.normalY(1)+15,map.Scale.bBox.height/map.Scale.normalY(2.2))),e.reformat(),e.hasScrollBars()&&e.setScrollPosition(new point(0,0)),e):g.fu}};function __sortYposUp(f,c){return f.y>c.y?1:-1}function __sortYposDown(f,c){return f.y<c.y?1:-1}
MapTheme.prototype.drawTextforOneQuadrant=function(f,c,g,e,h,m,q,l){var r=f.szStyle.match(/3D/)?2.4*g:1.2*g,w=r/2;l-=r*(c.length-2);for(i=0;i<c.length;i++){var B=c[i].y/c[i].ly,u=Math.max(w,Math.min(c[i].y,l)),w=u+r;l+=g;var A=1.2*c[i].x,A=q+map.Scale.normalX(2);u>c[i].y&&(B=Math.max(B,u/c[i].y));var v=f.mX+c[i].lx*h,G=f.mY+c[i].ly*m,z=f.mX+c[i].x*h,E=f.mY+c[i].y*m,A=f.mX+A*h,u=f.mY+u*m,D=map.Dom.newGroup(f.frameGroup,"");f.donutPartsA[c[i].index].textNode=D;var L=map.Dom.newGroup(D,""),O=map.Dom.newGroup(D,
"");B&&(map.Dom.newShape("line",L,v,G,z,E,"stroke:white;stroke-width:"+map.Scale.normalX(1.5)+";opacity:0.2;"),map.Dom.newShape("line",O,v,G,z,E,"stroke:#888888;stroke-width:"+map.Scale.normalX(.5)+";opacity:1;"),v=z,G=E);c[i].x<q-map.Scale.normalX(3)&&(map.Dom.newShape("line",L,v,G,f.mX+(q-map.Scale.normalX(3))*h,G,"stroke:white;stroke-width:"+map.Scale.normalX(1.5)+";opacity:0.2;stroke-linecap:round;"),map.Dom.newShape("line",O,v,G,f.mX+(q-map.Scale.normalX(3))*h,G,"stroke:#888888;stroke-width:"+
map.Scale.normalX(.5)+";opacity:1;"),v=f.mX+(q-map.Scale.normalX(3))*h);map.Dom.newShape("line",L,v,G,A,u,"stroke:white;stroke-width:"+map.Scale.normalX(1.5)+";opacity:0.2;stroke-linecap:round;");map.Dom.newShape("line",O,v,G,A,u,"stroke:#888888;stroke-width:"+map.Scale.normalX(.5)+";opacity:1;");v=A;A+=map.Scale.normalX(2)*h;map.Dom.newShape("line",L,v,u,A,u,"stroke:white;stroke-width:"+map.Scale.normalX(1.5)+";opacity:0.2;");map.Dom.newShape("line",O,v,u,A,u,"stroke:#888888;stroke-width:"+map.Scale.normalX(.5)+
";opacity:1;");A+=map.Scale.normalX(1.5)*h;(szText=f.partsA[c[i].index].szText?f.partsA[c[i].index].szText:null)||(szText=f.partsA[c[i].index].szInfo?f.partsA[c[i].index].szInfo:Math.round(10*f.partsA[c[i].index].nInfoValue)/10+" % ");B=this.createTextLabel(SVGDocument,D,"",szText,g/map.Scale.normalX(1),e,f.partsA[c[i].index].color,this.szChartFlag.match(/ZOOM/)?null:this.szTextColor);B.fu.setPosition(A-g,u-0*g);B.setAttributeNS(szMapNs,"tooltip",f.partsA[c[i].index].szInfo);f.szStyle.match(/3D/)&&
B.fu.scale(1,2)}};
MapTheme.prototype.drawDonutText=function(f,c){var g=0,e=0,h=0,m=[],q=[],l=[],r=[];for(i=0;i<this.partsA.length;i++){var w=f.getTextPosition(i);if(w){if(this.szShowPartsA){var B=!1;for(p in this.szShowPartsA)this.szShowPartsA[p]==i&&(B=!0);if(!B)continue}g=Math.max(g,Math.abs(w.y));e=Math.max(e,w.x);h=Math.min(h,w.x);f.szStyle.match(/STARBURST/)?(e=Math.max(e,w.x),h=Math.min(h,w.x)):(e=f.nRadOuter,h=-f.nRadOuter);0<w.x?0<w.y?q[q.length]={index:i,x:w.x,y:w.y,lx:w.lx,ly:w.ly}:m[m.length]={index:i,x:w.x,
y:-w.y,lx:w.lx,ly:-w.ly}:0<w.y?l[l.length]={index:i,x:-w.x,y:w.y,lx:-w.lx,ly:w.ly}:r[r.length]={index:i,x:-w.x,y:-w.y,lx:-w.lx,ly:-w.ly}}}m.sort(__sortYposUp);q.sort(__sortYposUp);l.sort(__sortYposUp);r.sort(__sortYposUp);c||(c=map.Scale.normalX(12));this.drawTextforOneQuadrant(f,m,c,"text-anchor:start;",1,-1,e,g);this.drawTextforOneQuadrant(f,q,c,"text-anchor:start;",1,1,e,g);this.drawTextforOneQuadrant(f,l,c,"text-anchor:end;",-1,1,-h,g);this.drawTextforOneQuadrant(f,r,c,"text-anchor:end;",-1,-1,
-h,g)};
MapTheme.prototype.createTextLabel=function(f,c,g,e,h,m,q,l){var r="#555555",w=!0,B=!0,u=1,A=" "+this.szChartFlag+"|"+this.szFlag;if(A.match(/ZOOM/)||A.match(/MENUSIZE/)||A.match(/NORMSIZE/)||A.match(/INFOSIZE/)||A.match(/AXIS/)||A.match(/SELECTION/))w=q?w:!1,B=!1;A.match(/VALUEBACKGROUND/)&&(w=!0);h||(h=12);m||(m="");q&&w?(r=l||ColorScheme.getTextColor(q),u=A.match(/ZOOM/)?.9:.5):(q="#fefeff",r=0>Number(e)?"#ee3333":r);if(f&&c)return f=map.Dom.newGroup(c,g),c=null,B&&!this.fShadow&&this.fOrigShadow&&(c=
map.Dom.newShape("rect",f,1,1,1,1,"fill:#444444;fill-opacity:0.4;stroke:none;")),q=map.Dom.newShape("rect",f,1,1,1,1,"fill:"+q+";fill-opacity:"+u+";stroke:#dddddd;stroke-width:"+map.Scale.normalX(.2)+""),m=map.Scale.tStyle.Values.szStyle+(this.szTextFont?"font-family:"+this.szTextFont:"")+";font-size:"+map.Scale.normalY(h)+"px;fill:"+r+";"+m,e=map.Dom.newText(f,map.Scale.normalX(h),map.Scale.normalY(.25*h),m,e),e=map.Dom.getBox(e),q.setAttributeNS(null,"rx",map.Scale.normalX(1)),q.setAttributeNS(null,
"ry",map.Scale.normalX(1)),q.setAttributeNS(null,"x",e.x-map.Scale.normalX(.3*h)),q.setAttributeNS(null,"y",e.y-map.Scale.normalY(0*h)),q.setAttributeNS(null,"width",e.width+map.Scale.normalX(.7*h)),q.setAttributeNS(null,"height",e.height+.1*map.Scale.normalY(h)),c&&(c.setAttributeNS(null,"rx",map.Scale.normalX(1)),c.setAttributeNS(null,"ry",map.Scale.normalX(1)),c.setAttributeNS(null,"x",e.x-map.Scale.normalX(.3*h)+map.Scale.normalX(1+.02*h)),c.setAttributeNS(null,"y",e.y+map.Scale.normalY(0*h)+
map.Scale.normalY(1+.02*h)),c.setAttributeNS(null,"width",e.width+map.Scale.normalX(.7*h)),c.setAttributeNS(null,"height",e.height+.1*map.Scale.normalY(h))),w||(q.style.setProperty("display","none",""),c&&c.style.setProperty("display","none","")),f};
MapTheme.prototype.getOverviewChart=function(f,c){f.fu=new Methods(f);var g=30;this.szChartFlag+="|MENUSIZE";if(this.szOverviewChart&&"NONE"!=this.szOverviewChart&&this.nCount){var g=map.Scale.normalX(100),e=map.Scale.normalY(100),h=map.Scale.normalX(75),m=map.Scale.normalX(50);if("undefined"!=typeof DonutCharts){var q=map.Dom.newGroup(f),g=DonutCharts.newChart(SVGDocument,q,g,e,h,m);this.szOverviewChart.match(/PIE/)&&(g.setStyle("flat"),g.setRadInner(0),g.setRadOuter(map.Scale.normalX(55)),g.setCenter(map.Scale.normalX(80),
map.Scale.normalY(55)));if(this.szOverviewChart.match(/DONUT/)||this.szOverviewChart.match(/3D/))g.setStyle("3D"),g.setCenter(map.Scale.normalX(80),map.Scale.normalY(100));g.setLine("white");g.setLineWidth(map.Scale.normalX(.1));e=map.Scale.normalY(20);for(h=0;h<this.partsA.length;h++){m=this.partsA[h].nCount/this.nCount*100;q=100/this.nSum*this.partsA[h].nSum;this.nRealizedCount&&this.szFlag.match(/CHART/)&&(m=this.partsA[h].nCount/this.nRealizedCount*100);this.nExactCount&&this.exactSizeA&&(m=this.partsA[h].nCount/
this.nExactCount*100,q=this.exactSizeA[h]);this.szOverviewChart.match(/DONUT/)&&(e=map.Scale.normalY(this.partsA[h].nSum/this.nSum*80));var l=String(this.partsA[h].nCount),r=m?String(" = "+this.formatValue(m,1)+" %"):"",w=q?String(", "+this.formatValue(q,1)+" % of value"):"";this.szOverviewChart.match(/PERCENTOFVALUE/)?(m=q,r="",l=String(this.formatValue(m,1)+" %")):this.szOverviewChart.match(/DONUT/)||(w="");this.szFlag.match(/EXACT/)?(r+=" ("+this.szLabelA[h]+")",w=""):this.szLegendLabelA&&this.szLegendLabelA.length&&
(r+=" ["+this.szLegendLabelA[h]+"])");g.addPart(m,e,this.partsA[h].color,0,l,String(this.partsA[h].nCount)+" member(s)"+r+w,"map.Themes.markClass(evt,'"+this.szId+"','"+h+"')","map.Themes.unmarkClass(evt,'"+this.szId+"')")}g.realize();this.drawDonutText(g);g=map.Dom.getBox(f);if(0<g.width&&0<g.height){w=f.fu.getPosition();q=this.szOverviewChart.match(/PERCENTOFVALUE/)?"*  value / class":"*  members / class";e=map.Scale.normalY(10);if(this.szOverviewChart.match(/DONUT/)||this.szOverviewChart.match(/3D/))e=
map.Scale.normalY(15);map.Dom.newText(f,map.Scale.normalX(80),g.y+g.height+e,map.Scale.tStyle.Note.szStyle+";text-anchor:middle;",q)}}}else{if((this.szFlag.match(/BUBBLE/)||this.szFlag.match(/SQUARE/)||this.szFlag.match(/SYMBOL/))&&(!this.szFlag.match(/EXACT/)||!this.szFlag.match(/SYMBOL/))){h=this.nMinA[0];l=this.nMaxA[0];this.szSizeField&&(h=this.nMinSize,l=this.nMaxSize);e=map.Scale.normalX(g/2);m=e/Math.sqrt(l)*Math.sqrt(h);this.szFlag.match(/LINEAR/)&&(m=e/l*h);q=this.szFlag.match(/SUM/)?"sum":
"mean";nLinePos=5;nXPos=20;var r=map.Dom.newGroup(f),B=map.Dom.newGroup(r);this.drawChart(B,null,1.5*g,"VALUES|ZOOM|NORMSIZE");this.szFlag.match(/SEQUENCE/)&&(sChartBox=map.Dom.getBox(B),w=B.fu.getPosition(),B.fu.setPosition(sChartBox.width/1.5+w.x,-sChartBox.height/2+w.y),w=map.Scale.normalX(7*g)/sChartBox.height,B.fu.scale(w,w),g*=7);map.Dom.newText(r,map.Scale.normalX(0),map.Scale.normalY(5),map.Scale.tStyle.Note.szStyle+";text-anchor:left;",map.Dictionary.getLocalText(q));r.fu.setPosition(map.Scale.normalX(nXPos),
map.Scale.normalY(g));nLinePos=g+15;this.szFlag.match(/SEQUENCE/)||(q=map.Dom.newGroup(f),sumBox=map.Dom.getBox(r),q.fu.setPosition(sumBox.x+sumBox.width+map.Scale.normalX(.66*g),map.Scale.normalY(-5)),nLinePos=0,r="fill:none;stroke:black;stroke-width:"+map.Scale.normalX(.25)+"px",w=map.Dom.newGroup(q),this.szFlag.match(/BUBBLE/)?map.Dom.newShape("circle",w,0,0,e,r):this.szFlag.match(/SQUARE/)&&map.Dom.newShape("rect",w,-e,-e,2*e,2*e,r),map.Dom.newShape("line",w,0,-e,1.1*e,-e,r),map.Dom.newText(w,
1.1*e+map.Scale.normalX(2),-e,"font-family:arial;font-size:"+map.Scale.normalX(10)+"px;text-anchor:left;baseline-shift:-10%;fill:black;stroke:none;pointer-events:none",this.formatValue(l,1)+this.szUnit),w.fu.setPosition(map.Scale.normalX(nXPos),map.Scale.normalY(nLinePos+g/2)),0<m&&(l=map.Dom.newGroup(q),this.szFlag.match(/BUBBLE/)?map.Dom.newShape("circle",l,0,0,m,r):this.szFlag.match(/SQUARE/)&&map.Dom.newShape("rect",l,-m,-m,2*m,2*m,r),map.Dom.newShape("line",l,0,-m,1.1*e,-m,r),map.Dom.newText(l,
1.1*e+map.Scale.normalX(2),-m,"font-family:arial;font-size:"+map.Scale.normalX(10)+"px;text-anchor:left;baseline-shift:-60%;fill:black;stroke:none;pointer-events:none",this.formatValue(h,1)+this.szUnit),l.fu.setPosition(map.Scale.normalX(nXPos),map.Scale.normalY(nLinePos)+2*e-m)),map.Dom.newText(q,map.Scale.normalX(nXPos),map.Scale.normalY(nLinePos+g+15),map.Scale.tStyle.Note.szStyle+";text-anchor:left;",map.Dictionary.getLocalText("min / max size-values")));f.fu.scale(1,1)}this.szFlag.match(/CHART/)&&
this.szFlag.match(/BUFFER/)&&(e=map.Scale.normalX(g/2),h=map.Dom.getBox(f.parentNode),h=0<h.width?h.width/map.Scale.normalX(1)+10:10,w=map.Dom.newGroup(f.parentNode),map.Dom.newShape("circle",w,0,0,e,"fill:none;stroke:black;"),r="fill:none;stroke:black;stroke-width:"+map.Scale.normalX(1)+";",map.Dom.newShape("line",w,0,0,e,0,r),map.Dom.newShape("line",w,0,map.Scale.normalY(-2),0,map.Scale.normalY(2.5),r),map.Dom.newShape("line",w,e,0,e+map.Scale.normalX(-3),map.Scale.normalY(-3),r),map.Dom.newShape("line",
w,e,0,e+map.Scale.normalX(-3),map.Scale.normalY(3),r),map.Dom.newText(w,1.1*e+map.Scale.normalX(2),map.Scale.normalX(-10),"font-family:arial;font-size:"+map.Scale.normalX(10)+"px;text-anchor:left;baseline-shift:-10%;fill:black;stroke:none;pointer-events:none",Map.Scale.prototype.formatDistanceString(this.nBufferSize*this.nScale)),w.fu.setPosition(map.Scale.normalX(g/2+h),map.Scale.normalY(g/2)),chartButtonObj=new Button(f.parentNode,c+":bufferselectbutton","BUTTON","#bufferselect_button","map.Selections.newSelection('activeLayer','activeBuffer','type:BUFFER;buffersize:200','test');",
"","select active layer with this buffer"),chartButtonObj.setPosition(map.Scale.normalX(g+h+10),map.Scale.normalY(g)),chartButtonObj.scale(1.4,1.4),chartButtonObj=null,_activeTheme&&map.Dom.newText(f.parentNode,map.Scale.normalX(g+h+20),map.Scale.normalY(g+6),"font-family:arial;font-size:"+map.Scale.normalX(8)+"px;text-anchor:left;baseline-shift:-10%;fill:gray;stroke:none;pointer-events:none","... "+_activeTheme+""));if(!(!this.szFlag.match(/CHART/)||this.szFlag.match(/BUBBLE/)||this.szFlag.match(/SQUARE/)||
this.szFlag.match(/EXACT/)||this.szFlag.match(/BUFFER/)||this.szFlag.match(/SYMBOL/))){e=map.Dom.getBox(f.parentNode);0>e.width&&(e=new box(0,0,0,0));g=30;this.szFlag.match(/BAR/)&&5<this.nOrigSumA.length&&!this.szFlag.match(/STACKED/)&&(g=15*this.nOrigSumA.length/Math.log(this.nOrigSumA.length));this.drawChart(f,null,g,"VALUES|NORMSIZE"+(this.szFlag.match(/STACKED/)?"|EXPANDMAX":""));g=map.Dom.getBox(f);h=1;h=Math.min(2.5,Math.max(e.height/g.height,map.Scale.normalX(100)/g.height));f.fu=new Methods(f);
f.fu.scale(h,h);summarizeGroup=map.Dom.newGroup(f,"textGroup");summarizeGroup.fu.scale(1/h,1/h);g=f.fu.getBox();this.szFlag.match(/BAR/)?f.fu.setPosition(e.width-g.x+map.Scale.normalX(10),-g.y+Math.max(10,.95*e.height-g.height)):f.fu.setPosition(e.width-g.x+map.Scale.normalX(10),-g.y+Math.max(10,e.height/2-g.height/2));q=" * overall sum";this.szAggregation&&this.szAggregation.match(/mean/)&&(q=" * arithmetic mean");e="middle";if(this.szFlag.match(/RIGHT/)||this.szFlag.match(/STACKED/)||this.szFlag.match(/CENTER/)||
this.szFlag.match(/POINTER/)||2>=this.partsA.length)e="start";map.Dom.newText(summarizeGroup,0,g.height+g.y+map.Scale.normalY(5),map.Scale.tStyle.Note.szStyle+"baseline-shift:-100%;text-anchor:"+e+";",q)}}};
MapTheme.prototype.drawColorSchemeLegend=function(f,c){var g=null,e=map.Scale.nButtonSize?.66*map.Scale.nButtonSize:12,h=map.Scale.nButtonSize||12,m=map.Scale.nButtonSize?1.2*map.Scale.nButtonSize:18,q=m,l="font-family:arial;font-size:"+map.Scale.normalY(e)+"px;fill:#666666;pointer-events:none;",r=1.2*h;this.szFlag.match(/BAR/)&&this.szFlag.match(/UP/)&&(r=h);var w=1.15*e,B=0*r,u=0;this.szFlag.match(/BAR/)&&(this.szFlag.match(/UP/)||this.szFlag.match(/STACKED/))&&(u=this.partsA.length-1);this.showInfoMore||
this.szFlag.match(/EXACT/)||this.szFlag.match(/UP/)||this.szFlag.match(/SYMBOL/)||this.szLabelA&&!this.szFlag.match(/CLIP/)||2>=this.partsA.length?this.szLegendStyle="large":this.szLegendStyle="compact";var A=new ScrollArea(null,f,null,10,10,10);A?(A.reformat(),g=A.workspaceNode):g=map.Dom.newGroup(f,c+":legend");for(var v=1,G=0;G<this.partsA.length;G++)this.partsA[G].min&&(this.partsA[G].min.toFixed(0)!=this.partsA[G].min&&(v=Math.min(v,.1)),this.partsA[G].min.toFixed(1)!=this.partsA[G].min&&(v=
Math.min(v,.01)));for(var z=[],G=0;G<this.partsA.length;G++)z[G]={},z[G].i=G,z[G].value=this.partsA[G].nCount;this.szFlag.match(/SYMBOL/)&&this.szFlag.match(/EXACT/)&&this.szFlag.match(/SORTDOWN/)&&z.sort(this.sortIndexDown);!this.szFlag.match(/POINTER/)&&!this.szFlag.match(/INVERT/)||this.szLegendStyle.match(/compact/)||z.reverse();var E=1;!this.szLabelA&&15<z.length&&(E=Math.floor(z.length/10),h*=1.5);var D=this.showInfoMore&&this.isMarkable?18:10,L=!1;if(this.szFlag.match(/CHART/)&&1<this.szFieldsA.length&&
!this.szFlag.match(/OFFSET/)&&!this.szFlag.match(/DEVIATION/)){for(var O=L=0;O<this.nOrigSumA.length;O++)this.partsA[O]&&"undefined"!=typeof this.partsA[O].nSum&&L++;L=L==this.nOrigSumA.length}for(var la=0;la<z.length;la+=E){var G=z[la].i,J=Math.min(Math.abs(u-G),this.partsA.length-E),y=null,O=null;if(this.szFlag.match(/SYMBOL/)&&this.szFlag.match(/EXACT/))m=0==this.nSkipCount?3*this.partsA[G].nCount/this.nCount*100:30/this.nCount*10*this.partsA[G].nCount;else if(L){O=m=0;if(this.szFlag.match(/MORPH/)){for(O=
0;O<this.nOrigSumA.length/2;O++)m=Math.max(m,this.nOrigSumA[O]*(this.nClipFrames-1-this.nActualFrame)/(this.nClipFrames-1)+this.nOrigSumA[O+this.nOrigSumA.length/2]*this.nActualFrame/(this.nClipFrames-1));O=(this.nOrigSumA[J]*(this.nClipFrames-1-this.nActualFrame)/(this.nClipFrames-1)+this.nOrigSumA[J+this.nOrigSumA.length/2]*this.nActualFrame/(this.nClipFrames-1))/m}else{for(O=0;O<this.nOrigSumA.length;O++)m=Math.max(m,this.partsA[O].nSum);O=this.partsA[J].nSum/m}m=60*O}m=isNaN(m)?q:m;if(this.szFlag.match(/BUBBLE/))O=
this.szFlag.match(/EXACT/)||this.szSizeField?h/2:h/4+h/4*(G+1)/this.partsA.length,O=map.Dom.newShape("circle",g,map.Scale.normalX(D+h/2),map.Scale.normalY(B+h/2),map.Scale.normalY(O),"fill:"+this.colorScheme[J]+";stroke:#eeeeee;stroke-width:"+map.Scale.normalX(.1)+";");else if(1<E)for(O=map.Dom.newGroup(g,""),y=0;y<E;y++)map.Dom.newShape("rect",O,map.Scale.normalX(D),map.Scale.normalY(B+h/E*y),map.Scale.normalX(m),map.Scale.normalY(h/E),"fill:"+this.colorScheme[J+y]+";stroke:none;");else O=map.Dom.newShape("rect",
g,map.Scale.normalX(D),map.Scale.normalY(B),map.Scale.normalX(m),map.Scale.normalY(h),"fill:"+this.colorScheme[J]+";stroke:#eeeeee;stroke-width:"+map.Scale.normalX(.1)+";");if(O){for(var K=this.partsA[J].nCount,y=1;y<E;y++)K+=this.partsA[J+y].nCount;this.isMarkable&&this.showInfoMore&&(map.Dom.newShape("rect",g,map.Scale.normalX(-5),map.Scale.normalY(B-2),map.Scale.normalX(m),map.Scale.normalY(h+4),"fill:white;stroke:none;opacity:0;").setAttributeNS(null,"id",this.szId+":widget:background:"+J),buttonObj=
new Button(g,this.szId+":class:"+J,"CHECKBOX|SELECTED","","map.Themes.showClass(evt,'"+this.szId+"','"+J+"','"+E+"')","map.Themes.hideClass(evt,'"+this.szId+"','"+J+"','"+E+"')","show/hide class"),buttonObj.setPosition(map.Scale.normalX(map.Scale.nButtonSize/2-1),map.Scale.normalY(B+map.Scale.nButtonSize/2-1)),buttonObj.scale(.75,.75));var y=this.partsA[J].min+(la?v:0),P=this.partsA[J+E-1].max,H=100<P-y?0:2;szMin=this.formatValue(y,H);szMax=this.formatValue(P,H);szMembers="";this.szFlag.match(/SHOWMEMBERS/)&&
(szMembers="  ["+K+"]");szLabel=szMin!=szMax?szMin+"..."+szMax+(this.szLegendUnits?this.szLegendUnits:"")+this.szUnit+szMembers:szMin+(this.szLegendUnits?this.szLegendUnits:"")+this.szUnit+szMembers;(!this.szFlag.match(/CLIP/)||this.szFlag.match(/MORPH/))&&this.szLabelA&&this.szLabelA[J]&&(szLabel=this.szLabelA[J]);this.szLegendLabelA[J]=szLabel;if(this.szLegendStyle.match(/compact/))this.fGrayNoMember&&0==K&&this.szFlag.match(/CHOROPLETHE/)&&this.szFlag.match(/DOMINANT/)&&(O.style.setProperty("fill-opacity",
"0.03",""),O.style.getPropertyValue("fill"),O.style.setProperty("stroke-opacity","0.2",""),O.style.setProperty("stroke","black",""),O.style.setProperty("stroke-width",map.Scale.normalX(.3),"")),this.szFlag.match(/EXACT/)||this.szFlag.match(/DOMINANT/)&&15<szLabel.length||(y=";font-size:"+map.Scale.normalX(.9*e)+"px;",0==la?(szLabel=0<szLabel.length?szMin+this.szUnit:szLabel,map.Dom.newText(g,map.Scale.normalX(D+2),map.Scale.normalY(B+w*(E+1.5)),l+y,szLabel)):la==z.length-E&&(szLabel=0<szLabel.length?
szMax+this.szUnit:szLabel,map.Dom.newText(g,map.Scale.normalX(D+2),map.Scale.normalY(B+w*(E+1.5)),l+y,szLabel)));else if(this.szFlag.match(/SYMBOL/)&&this.szFlag.match(/EXACT/))y=m+2,P=String(this.partsA[G].nCount),0==this.nSkipCount&&(P=String(Math.round(100/this.nCount*this.partsA[G].nCount))+"%"),H=5*P.length/7*e,"dynamic"==this.szTextPlacement&&H<m&&(y-=5*String(this.partsA[G].nCount).length/7*e),map.Dom.newText(g,map.Scale.normalX(D+y),map.Scale.normalY(B+w+1),l,P),y+=H,this.szSymbolsA[G]&&this.szSymbolsA[G].match(/symbol/)&&
(P=map.Dom.constructNode("use",g,{"xlink:href":"#"+this.szSymbolsA[G]+":antizoomandpan"}),P.setAttributeNS(null,"style","fill:"+this.colorScheme[J]),P.fu.scale(.5,.5),P.fu.setPosition(map.Scale.normalX(D+y+10),map.Scale.normalY(B+w-3)),y+=20),y=map.Dom.newText(g,map.Scale.normalX(D+y),map.Scale.normalY(B+w),l,"("+szLabel+")"),y.style.setProperty("fill","#bbbbdd","");else{y=m+4;if(L){P=this.partsA[J].nSum;this.szFlag.match(/MORPH/)&&(P=this.nOrigSumA[J]*(this.nClipFrames-1-this.nActualFrame)/(this.nClipFrames-
1)+this.nOrigSumA[J+this.nOrigSumA.length/2]*this.nActualFrame/(this.nClipFrames-1));if(this.szField100&&!this.szFlag.match(/SUM/)||this.szAggregation&&!this.szAggregation.match(/sum/))P/=this.partsA[J].nCount;szLabel=szLabel+"  ("+this.formatValue(P,1)+this.szUnit+")"}y=map.Dom.newText(g,map.Scale.normalX(D+y),map.Scale.normalY(B+w),l,szLabel);this.fGrayNoMember&&0==K&&this.szFlag.match(/CHOROPLETHE/)&&(y.style.setProperty("fill","#bbbbdd",""),O.style.setProperty("opacity","0.1",""))}this.szFlag.match(/BUFFER/)&&
O.style.setProperty("fill-opacity",this.fillOpacity?this.fillOpacity:this.nOpacity?this.nOpacity:0,"");1==this.szFieldsA.length||!this.szFlag.match(/CHART/)||this.szFlag.match(/SYMBOL/)&&this.szFlag.match(/EXACT/)?(this.szLegendStyle.match(/compact/)?O.setAttributeNS(szMapNs,"tooltip",szLabel+" ("+K+" member(s))"):O.setAttributeNS(szMapNs,"tooltip",K+" member(s)"),G=O.getAttributeNS(null,"style"),O.setAttributeNS(szMapNs,"onoverstyle",G+";stroke:black;stroke-width:"+map.Scale.normalX(.5)+";"),O.setAttributeNS(null,
"onmouseover","map.Themes.markClass(evt,'"+this.szId+"','"+J+"','"+E+"')"),O.setAttributeNS(null,"onmouseout","map.Themes.unmarkClass(evt,'"+this.szId+"')"),O.setAttributeNS(null,"onclick","map.Themes.zoomToClass(evt,'"+this.szId+"','"+J+"','"+E+"')"),O.setAttributeNS(null,"id",c+":widget:classrect:"+J)):this.szFlag.match(/SYMBOL/)?this.szFlag.match(/EXACT/)?O.setAttributeNS(szMapNs,"tooltip",this.partsA[G].nCount+" ("+this.formatValue(this.partsA[G].nCount/this.nCount*100,1)+" %)"):this.szFlag.match(/SEQUENCE/)&&
O.setAttributeNS(szMapNs,"tooltip",this.nOrigSumA[G]+" ("+this.formatValue(this.nOrigSumA[G]/this.nSum*100,1)+" %)"):1<this.szFieldsA.length&&!this.szFlag.match(/SEQUENCE/)&&(this.nSum100?O.setAttributeNS(szMapNs,"tooltip",this.formatValue(100/this.nSum100*this.nOrigSumA[J],1)+" %"):this.nSum&&O.setAttributeNS(szMapNs,"tooltip",this.nOrigSumA[J]+" ("+this.formatValue(100/this.nSum*this.nOrigSumA[J],1)+" %)"),O.setAttributeNS(null,"onmouseover","map.Themes.markClass(evt,'"+this.szId+"','"+J+"','"+
E+"')"),O.setAttributeNS(null,"onmouseout","map.Themes.unmarkClass(evt,'"+this.szId+"')"))}this.szLegendStyle.match(/compact/)?D+=m:B+=9*r/10}this.szLegendStyle.match(/compact/)?B+=r*E*2:this.nNoData&&(B+=1.5*r/10,O=map.Dom.newShape("rect",g,0,map.Scale.normalY(B),map.Scale.normalX(m),map.Scale.normalY(h),"fill:"+(this.szNoDataColor?this.szNoDataColor:"#ffffff")+";stroke:#000000;stroke-width:"+map.Scale.normalX(.1)+";"),O.setAttributeNS(szMapNs,"tooltip",this.nNoData+" member(s)"),O.setAttributeNS(null,
"onmouseover","map.Themes.markClass(evt,'"+this.szId+"','"+J+"')"),O.setAttributeNS(null,"onmouseout","map.Themes.unmarkClass(evt,'"+this.szId+"')"),map.Dom.newText(g,map.Scale.normalX(22),map.Scale.normalY(B+w),l,map.Dictionary.getLocalText("no data")),B+=9*r/10);A&&(A.setWidth(-1),A.setHeight(Math.min(B+r,map.Scale.bBox.height/map.Scale.normalY(2.2))),this.nClipColorLegend&&A.setHeight(this.nClipColorLegend),A.reformat(),A.hasScrollBars()&&(g.style.setProperty("display","none",""),map.Dom.newShape("rect",
f,0,0,map.Scale.normalX(A.getWidth()),map.Scale.normalY(A.getHeight()),"fill:none;stroke:none;")));return g};
MapTheme.prototype.showInfo=function(){var f;if(!this.szFlag.match(/NOINFO/)&&0!=this.nCount&&(!this.widgetNode||this.fRedrawInfo)){this.fRedrawInfo=!1;var c=12,g=SVGDocument.getElementById("legend:param");g&&(c=Number(g.getAttributeNS(szMapNs,"fontsize")),g.getAttributeNS(szMapNs,"swatchheight"),g.getAttributeNS(szMapNs,"swatchwidth"));map.Scale.normalX(1);map.Scale.normalX(5);var e="fill:white;stroke:blue;stroke-width:"+map.Scale.normalX(.1)+";opacity:0.8",h="font-family:arial;font-size:"+map.Scale.normalY(c)+
"px;fill:black;pointer-events:none;",g=this.szId+":display:widget",m=null,q=!0,l=null,r=null,w=null;this.widgetNode?(m=this.widgetNode.firstChild,map.Dom.clearGroup(m),this.fRepositionInfo||(q=!1),this.fRepositionInfo=!1,g=this.widgetNode.getAttributeNS(null,"id"),g=g.substr(0,g.length-8),this.enable()):(m=map.Dom.newGroup(SVGThemeGroup,g+":movable"),this.szFlag.match(/BUBBLE/)?m.setAttributeNS(szMapNs,"menu","thememenu"):this.szFlag.match(/DOMINANT/)?m.setAttributeNS(szMapNs,"menu","chartmenu"):
this.szFlag.match(/CHART/)?m.setAttributeNS(szMapNs,"menu","chartmenu"):m.setAttributeNS(szMapNs,"menu","thememenu"),new Widget(m,this),this.widgetNode=m,m=map.Dom.newGroup(m,g+":workspace:noobject"));var B=3*c/2,u=7*c/8,c=0*B,e=map.Dom.newShape("rect",m,0,0,1,1,e);e.setAttributeNS(null,"id",g+":backgroundrect:noobject");e.setAttributeNS(null,"rx",map.Scale.normalX(3));e.setAttributeNS(null,"ry",map.Scale.normalX(3));var A=this.szThemes;30<A.length&&(A=A.substr(0,30)+"...");var c=c+.2*B,v=map.Dom.newGroup(m,
g+":title"),h=map.Scale.tStyle?map.Scale.tStyle.ContainerTitle.szStyle:"";this.szTitle?f=map.Dom.newText(v,map.Scale.normalX(10),map.Scale.normalY(c+u),h,this.szTitle):(f=map.Dom.newText(v,map.Scale.normalX(10),map.Scale.normalY(c+u),h,"Theme: "+A),c+=B,map.Dom.newText(v,map.Scale.normalX(0),map.Scale.normalY(c+u),h,"Value: "+this.szFields));c+=B;map.Dom.newShape("rect",v,f.fu.getTextLength()+map.Scale.normalX(30),map.Scale.normalY(c+u),1,1,"fill:none;stroke:none");c+=B/5;m.setAttributeNS(szMapNs,
"titleheight",String(map.Scale.normalY(c)));this.szSnippet&&(h=map.Scale.tStyle.Snippet.szStyle,c+=1,map.Dom.newText(v,map.Scale.normalX(10),map.Scale.normalY(c+2),h,this.szSnippet),c+=map.Scale.tStyle.Snippet.nFontHeight/map.Scale.normalY(1)+1);u=map.Dom.newGroup(m,g+":body");u.fu.setPosition(0,map.Scale.normalY(c));u.fu.scale(1/map.Scale.getEmbedScale(),1/map.Scale.getEmbedScale());1<this.nOrigSumA.length&&this.szFlag.match(/BAR/)&&this.szFlag.match(/HOR/)&&!this.szFlag.match(/SPACED/)&&this.szFlag.match(/STACKED/);
c=!0;h=null;this.szFlag.match(/CHART/)&&!this.szFlag.match(/EXACT/)&&this.nOrigSumA.length!=this.colorScheme.length&&2>=this.colorScheme.length&&(c=!1);this.szFlag.match(/CHART/)&&this.szFlag.match(/OFFSETMEAN/)&&(c=!0);c&&(h=this.drawColorSchemeLegend(u,g));B=map.Dom.getBox(u);if(!c||this.showInfoMore||this.szFlag.match(/UP/)){c=new box(0,0,0,0);v=null;this.szFlag.match(/CHOROPLETHE/)&&!this.szFlag.match(/DOMINANT/)&&(v=map.Dom.newGroup(u,"histogram"+String(Math.random())),v.fu.setPosition(0<B.width?
B.width+map.Scale.normalX(15):0,map.Scale.normalY(15)),v.fu.scale(2,2),map.Themes.getHistogram(null,v,"DISTRIBUTION|INTERACTIVE",this),c=map.Dom.getBox(v),c.height+=map.Scale.normalX(30));if(!this.szFlag.match(/OFFSETMEAN/)){var G=map.Dom.newGroup(u,"donut"+String(Math.random()));G.fu.setPosition(0<B.width?B.width+map.Scale.normalX(15):map.Scale.normalX(5),map.Scale.normalX(10)+c.height);G.fu.scale(.75,.75);this.getOverviewChart(G,g)}v&&(cBox=map.Dom.getBox(G),G.fu.setPosition((0<B.width?B.width+
map.Scale.normalX(15):0)-cBox.x/2,map.Scale.normalX(10)-cBox.y+c.height))}map.Dom.getBox(m);var B=map.Dom.getBox(m),z=map.Scale.normalX(map.Scale.nButtonSize),c=map.Scale.normalY(.6*map.Scale.nButtonSize),A="font-family:arial;font-size:"+c+"px;fill:#666666;baseline-shift:-30%;pointer-events:none",G=map.Dom.newGroup(m,g+":infobuttons"),u=map.Dom.newGroup(G,g+":footer");u.fu.setPosition(0,B.height);if(this.szFlag.match(/CLIP/)){u.fu.setPosition(0,B.height+map.Scale.normalX(10));v=map.Dom.newGroup(m,
g+":frameslider");clipButtonObj=new Button(v,g+":clipstartbutton","BUTTON","#start_button","map.Themes.startClip('"+this.szId+"')","","start clip");clipButtonObj.setPosition(map.Scale.normalX(3),map.Scale.normalX(10));clipButtonObj.scale(.8,.8);clipButtonObj.nodeObj.style.setProperty("display","none","");clipButtonObj=new Button(v,g+":clippausebutton","BUTTON","#pause_button","map.Themes.pauseClip('"+this.szId+"')","","pause clip");clipButtonObj.setPosition(map.Scale.normalX(3),map.Scale.normalX(10));
clipButtonObj.scale(.8,.8);v.fu.setPosition(map.Scale.normalX(15),B.height);var E=B.width-map.Scale.normalX(30);f=map.Scale.normalY(5);map.Dom.newShape("rect",v,map.Scale.normalX(11),map.Scale.normalY(10)-.5*f,E,f,"fill:lightgray;stroke:none;");E=E/this.nClipFrames*(this.nActualFrame+1);map.Dom.newShape("rect",v,map.Scale.normalX(11),map.Scale.normalY(10)-.5*f,E,f,"fill:darkgray;stroke:none")}if(this.showInfoMore||this.parent.autoHideInfoTools){if(this.szFlag.match(/CHART/)){if(E=null,r=map.Scale.normalX(map.Scale.nButtonSize/
2),v=map.Scale.normalY(map.Scale.nButtonSize+7),f=new Button(u,this.szId,"CHECKBOX|SELECTED","","map.Themes.toggleChartDisplay(evt,'"+this.szId+"',1)","map.Themes.toggleChartDisplay(evt,'"+this.szId+"',0)","show/hide objects"),f.setPosition(r,v),f.scale(.8,.8),r+=map.Scale.normalX(25),nXoff=0,E=map.Dom.newGroup(u,"opacitybuttons"+String(Math.random())),f=new Button(E,this.szId,"BUTTON","#minus_button","map.Themes.changeChartOpacity(evt,'"+this.szId+"',0.66)","","fade out"),f.scale(1,1),f.setPosition(nXoff,
0),nXoff+=map.Scale.normalX(11),f=map.Dom.newText(E,nXoff,0,A,map.Dictionary.getLocalText("opacity")),nXoff+=f.fu.getTextLength()+map.Scale.normalX(11),f=new Button(E,this.szId,"BUTTON","#plus_button","map.Themes.changeChartOpacity(evt,'"+this.szId+"',1.5)","","fade in"),f.scale(1,1),f.setPosition(nXoff,0),nXoff+=map.Scale.normalX(10),this.szFlag.match(/PIE/)||(nXoff+=map.Scale.normalX(10),f=new Button(E,this.szId+":text","CHECKBOX"+(this.szFlag.match(/VALUES/)?"|SELECTED":""),"","map.Themes.toggleValueDisplay(evt,'"+
this.szId+":text',1)","map.Themes.toggleValueDisplay(evt,'"+this.szId+":text',0)","text values"),f.setPosition(nXoff,0),f.scale(.8,.8),nXoff+=map.Scale.normalX(12),f=map.Dom.newText(E,nXoff,0,A,map.Dictionary.getLocalText("values")),nXoff+=f.fu.getTextLength()+map.Scale.normalX(7)),E.fu.setPosition(r,v),nMinXpos=r=r+nXoff+map.Scale.normalX(6),nXoff=0,f=.9,z=1.1,this.szFlag.match(/BUFFER/)&&(z=this.nBufferSizeStep?this.nBufferSizeStep/this.nBufferSize:.1,f=1-z/this.nScale,z=1+z/this.nScale),E=map.Dom.newGroup(u,
"sizebuttons"+String(Math.random())),f=new Button(E,this.szId,"BUTTON","#minus_button","map.Themes.changeChartScaling(evt,'"+this.szId+"',"+f+")","","smaller charts"),f.scale(1,1),f.setPosition(nXoff,0),nXoff+=map.Scale.normalX(12),f=map.Dom.newText(E,nXoff,0,A,map.Dictionary.getLocalText("size")),nXoff+=f.fu.getTextLength()+map.Scale.normalX(12),f=new Button(E,this.szId,"BUTTON","#plus_button","map.Themes.changeChartScaling(evt,'"+this.szId+"',"+z+")","","bigger charts"),f.scale(1,1),f.setPosition(nXoff,
0),E.fu.setPosition(r+map.Scale.normalX(5),v),nMinXpos=r+nXoff+map.Scale.normalX(map.Scale.nButtonSize),this.showInfoMore&&!this.szFlag.match(/BUFFER/)&&!this.szFlag.match(/SYMBOL/)){v-=map.Scale.normalY(4);A=this.szFlag.match(/STARBURST/)||this.szFlag.match(/BAR/)?30:20;z=this.chartButton(u,A,"");r=z.fu.getPosition();E=z.fu.getBox();z.fu.setPosition(nMinXpos+r.x,v+r.y);r="";if(this.szFlag.match(/BUBBLE/)||this.szFlag.match(/SQUARE/)||this.szFlag.match(/LABEL/))r="FIXSIZE";z.setAttributeNS(null,"onclick",
"map.Themes.setChartSizeType(evt,'"+this.szId+"','"+r+"')");nMinXpos+=E.width+map.Scale.normalX(10);z=this.chartButton(u,A,"SIZE");r=z.fu.getPosition();E=z.fu.getBox();z.fu.setPosition(nMinXpos+r.x,v+r.y);z.setAttributeNS(null,"onclick","map.Themes.setChartSizeType(evt,'"+this.szId+"','SIZE')");nMinXpos+=E.width+map.Scale.normalX(10);if(this.szFlag.match(/BAR/)||this.szFlag.match(/PIE/)||this.szFlag.match(/DONUT/))this.szFlag.match(/3D/)?(z=this.chartButton(u,A,"HEIGHT"),r=z.fu.getPosition(),E=z.fu.getBox(),
z.fu.setPosition(nMinXpos+r.x,v+r.y),z.setAttributeNS(null,"onclick","map.Themes.setChartSizeType(evt,'"+this.szId+"','HEIGHT')"),nMinXpos+=E.width+map.Scale.normalX(10),z=this.chartButton(u,A,"2D"),r=z.fu.getPosition(),z.fu.setPosition(nMinXpos+r.x,v+r.y),z.setAttributeNS(null,"onclick","map.Themes.setChartSizeType(evt,'"+this.szId+"','2D')")):(z=this.chartButton(u,A,"3D"),r=z.fu.getPosition(),z.fu.setPosition(nMinXpos+r.x,v+r.y),z.setAttributeNS(null,"onclick","map.Themes.setChartSizeType(evt,'"+
this.szId+"','3D')"));v+=map.Scale.normalY(6)}}else{r=map.Scale.normalX(0);v=map.Scale.normalY(map.Scale.nButtonSize+7);f=null;E="TEXTBUTTON";if(this.szFlag.match(/DOMINANT/)){f=map.Dictionary.getLocalText("Filter: ");f=map.Dom.newText(u,r,v,A,f);r+=f.fu.getTextLength()+c/2;this.szFlag.match(/PERCENTOFMEAN/)?(f=map.Dictionary.getLocalText("% of mean "),f=map.Dom.newText(u,r,v,A,f),r+=f.fu.getTextLength()+c/2):this.szFlag.match(/PERCENTOFMEDIAN/)?(f=map.Dictionary.getLocalText("% of median "),f=map.Dom.newText(u,
r,v,A,f),r+=f.fu.getTextLength()+c/2):(f=map.Dictionary.getLocalText("min"),E="min"==this.szDominantFilter?"TEXTBUTTON|SELECTED":"TEXTBUTTON",f=new Button(u,this.szId,E,f,"map.Themes.changeThemeStyle(evt,'"+this.szId+"','filter:min;dfilter:0')","","change method"),f.setPosition(r,v),r+=f.bBox.width,f=map.Dictionary.getLocalText("mean"),E="mean"==this.szDominantFilter?"TEXTBUTTON|SELECTED":"TEXTBUTTON",f=new Button(u,this.szId,E,f,"map.Themes.changeThemeStyle(evt,'"+this.szId+"','filter:mean;dfilter:0')",
"","change method"),f.setPosition(r,v),r+=f.bBox.width,r+=map.Scale.normalX(2));f=map.Dictionary.getLocalText("+");f=map.Dom.newText(u,r,v,A,f);for(var r=r+(f.fu.getTextLength()+c/2),D=0;90>=D;D+=10)E=D==this.nDominantDFilter?"TEXTBUTTON|SELECTED":"TEXTBUTTON",f=new Button(u,this.szId,E,(0<D?".":"")+String(D/10),"map.Themes.changeThemeStyle(evt,'"+this.szId+"','dfilter:"+String(D)+"')","","add "+String(D/100)+"*max.value to the filter"),f.setPosition(r,v),r+=f.bBox.width;f=map.Dictionary.getLocalText("[max]");
f=map.Dom.newText(u,r,v,A,f);r+=f.fu.getTextLength()+c/2}else if(this.szFlag.match(/DOMINANTXXX/)){f=map.Dictionary.getLocalText("Filter: ")+map.Dictionary.getLocalText(this.szDominantFilter);f=map.Dom.newText(u,r,v,A,f);r+=f.fu.getTextLength()+c/2;for(D=0;90>=D;D+=10)E="TEXTBUTTON",D==this.nDominantDFilter&&(E+="|SELECTED"),f=new Button(u,this.szId,E,"."+String(D/10),"map.Themes.changeThemeStyle(evt,'"+this.szId+"','dfilter:"+String(D)+"')","","set lower limit in % of maximum"),f.setPosition(r,v),
r+=f.bBox.width;f=map.Dictionary.getLocalText("max");f=map.Dom.newText(u,r,v,A,f);r+=f.fu.getTextLength()+c/2}else if(!this.szFlag.match(/BUBBLE/)){if(Number(this.origColorScheme[0])){f=map.Dictionary.getLocalText("classes")+":";f=map.Dom.newText(u,r,v,A,f);r+=f.fu.getTextLength()+c/2;for(D=2;20>=D;D++)10<D&&0!=D%10||(E="TEXTBUTTON",D==this.partsA.length&&(E+="|SELECTED"),f=new Button(u,this.szId,E,String(D),"map.Themes.changeThemeStyle(evt,'"+this.szId+"','classes:"+String(D)+"')","","change classes"),
f.setPosition(r,v),r+=f.bBox.width);r+=c}else E=map.Dom.newGroup(u,"sizebuttons"+String(Math.random())),r=map.Scale.normalX(8),f=new Button(E,this.szId,"BUTTON","#minus_button","map.Themes.changeChartOpacity(evt,'"+this.szId+"',0.66)","","fade out"),f.scale(1,1),f.setPosition(r,v),r+=map.Scale.normalX(12),f=map.Dom.newText(E,r,v,A,map.Dictionary.getLocalText("opacity")),r+=f.fu.getTextLength()+map.Scale.normalX(12),f=new Button(E,this.szId,"BUTTON","#plus_button","map.Themes.changeChartOpacity(evt,'"+
this.szId+"',1.5)","","fade in"),f.scale(1,1),f.setPosition(r,v),r+=1.5*z;this.szFlag.match(/QUANTILE/)||this.szFlag.match(/LOG/)||this.szRanges||(this.szFlag+="|EQUIDISTANT");f=map.Dictionary.getLocalText("equidistant");E=!this.szRanges&&this.szFlag.match(/EQUIDISTANT/)?"TEXTBUTTON|SELECTED":"TEXTBUTTON";f=new Button(u,this.szId,E,f,"map.Themes.changeThemeStyle(evt,'"+this.szId+"','type:CHOROPLETHE|EQUIDISTANT')","","change method");f.setPosition(r,v);r+=f.bBox.width;f=map.Dictionary.getLocalText("log");
E=!this.szRanges&&this.szFlag.match(/LOG/)?"TEXTBUTTON|SELECTED":"TEXTBUTTON";f=new Button(u,this.szId,E,f,"map.Themes.changeThemeStyle(evt,'"+this.szId+"','type:CHOROPLETHE|LOG')","","change method");f.setPosition(r,v);r+=f.bBox.width;f=map.Dictionary.getLocalText("quantile");E=!this.szRanges&&this.szFlag.match(/QUANTILE/)?"TEXTBUTTON|SELECTED":"TEXTBUTTON";f=new Button(u,this.szId,E,f,"map.Themes.changeThemeStyle(evt,'"+this.szId+"','type:CHOROPLETHE|QUANTILE')","","change method");f.setPosition(r,
v);r+=f.bBox.width;if(this.szRanges||this.szOldRanges)f=map.Dictionary.getLocalText("ranges"),E=this.szRanges?"TEXTBUTTON|SELECTED":"TEXTBUTTON",f=new Button(u,this.szId,E,f,"map.Themes.changeThemeStyle(evt,'"+this.szId+"','type:CHOROPLETHE|RANGES')","","change method"),f.setPosition(r,v),r+=f.bBox.width}Number(this.origColorScheme[0])&&(r=map.Scale.normalX(8),v+=c+map.Scale.normalY(9),E=map.Dom.newGroup(u,"sizebuttons"+String(Math.random())),f=new Button(E,this.szId,"BUTTON","#minus_button","map.Themes.changeChartOpacity(evt,'"+
this.szId+"',0.66)","","fade out"),f.scale(1,1),f.setPosition(r,v),r+=map.Scale.normalX(11),f=map.Dom.newText(E,r,v,A,map.Dictionary.getLocalText("opacity")),r+=f.fu.getTextLength()+map.Scale.normalX(10),f=new Button(E,this.szId,"BUTTON","#plus_button","map.Themes.changeChartOpacity(evt,'"+this.szId+"',1.5)","","fade in"),f.scale(1,1),f.setPosition(r,v),r+=z);r+=map.Scale.normalX(10);f=new Button(u,this.szId+":text","CHECKBOX"+(this.szFlag.match(/VALUES/)?"|SELECTED":""),"","map.Themes.toggleValueDisplay(evt,'"+
this.szId+":text',1)","map.Themes.toggleValueDisplay(evt,'"+this.szId+":text',0)","text values");f.setPosition(r,v);f.scale(.9,.9);r+=map.Scale.normalX(12);f=map.Dom.newText(u,r,v,A,map.Dictionary.getLocalText("values"));r+=f.fu.getTextLength()+map.Scale.normalX(8);r+=map.Scale.normalX(10);f=new Button(u,this.szId+":dopacity","CHECKBOX"+(this.szFlag.match(/DOPACITY/)?"|SELECTED":""),"","map.Themes.toggleDopacity(evt,'"+this.szId+":dop',1)","map.Themes.toggleDopacity(evt,'"+this.szId+":dop',0)","dynamic opacity");
f.setPosition(r,v);f.scale(.9,.9);r+=map.Scale.normalX(12);f=map.Dom.newText(u,r,v,A,map.Dictionary.getLocalText("dyn.opacity"));r+=f.fu.getTextLength()+map.Scale.normalX(8);r+=map.Scale.normalX(5);E=map.Dom.newGroup(u,"dopacitybuttons"+String(Math.random()));f=new Button(E,this.szId,"BUTTON","#minus_button","map.Themes.changeDopacityAlphaRamp(evt,'"+this.szId+"',(2/3))","","fade out");f.scale(1,1);f.setPosition(r,v);r+=1.1*z;f=new Button(E,this.szId,"BUTTON","#plus_button","map.Themes.changeDopacityAlphaRamp(evt,'"+
this.szId+"',(3/2))","","fade in");f.scale(1,1);f.setPosition(r,v);B.width=Math.max(B.width,r+2*c-c/2)}this.szFlag.match(/DOMINANT/)?(l=new Button(u,g+":chartcolorbutton","BUTTON","#tools_button","map.Themes.chartColorMenu(evt,'"+this.szId+"','"+g+"','"+this.szOrigFlag+"')","","change chart color"),l.scale(1.2,1.2)):this.szFlag.match(/CHART/)&&this.szFlag.match(/BUFFER/)||(l=new Button(u,g+":chartselectbutton","BUTTON","#tools_button","map.Themes.chartTypeMenu(evt,'"+this.szId+"','"+g+"','"+this.szOrigFlag+
"')","","change chart type"),l.scale(1.2,1.2));this.chartbutton=l;map.Dictionary.getLocalText("close");r=new Button(u,this.szId,"BUTTON",this.showInfoMore?"#minus_button":"#plus_button","map.Themes.toggleMore(evt,'"+this.szId+"')","","hide tools");r.setPosition(B.width-map.Scale.normalX(25),f.getPosition().y-map.Scale.normalY(10));r.scale(1,1);this.morebutton=r}else v=map.Scale.normalY(0),map.Dictionary.getLocalText("more"),szButton="plus_button",nButtonOpacity=.65,w=new Button(u,this.szId,"BUTTON",
"#"+szButton,"map.Themes.toggleMore(evt,'"+this.szId+"')","","show tools"),w.scale(1,1),this.morebutton=w;this.nMissingPositionCount&&(f=map.Dictionary.getLocalText("(!)"),A=new Button(u,this.szId,"TEXTBUTTON",f,"map.Themes.showErrorInfo(evt,'"+this.szId+"')","","show warnings"),A.setPosition(B.width,A.getPosition().y-c),A.scale(1,1),A.nodeObj.style.setProperty("opacity","0.5",""));this.parent.autoHideInfoTools&&(this.showInfoMore||G.style.setProperty("display","none",""),"all"==this.parent.autoHideInfoTools&&
(m.setAttributeNS(null,"onmouseover","map.Themes.onoverInfo(null,'"+this.szId+"')"),m.setAttributeNS(null,"onmouseout","map.Themes.onoutInfo(null,'"+this.szId+"')"),m.setAttributeNS(null,"onmousedown","map.Themes.ondownInfo(null,'"+this.szId+"')")));B=map.Dom.getBox(m);B.width+=map.Scale.normalX(25);e.setAttributeNS(null,"x",-map.Scale.normalX(5));e.setAttributeNS(null,"y",-map.Scale.normalY(5));e.setAttributeNS(null,"width",B.width+map.Scale.normalX(5)+map.Scale.normalX(10));e.setAttributeNS(null,
"height",B.height+map.Scale.normalY(5)+map.Scale.normalY(5));m=e.cloneNode(1E3);e.parentNode.insertBefore(m,e);m.setAttributeNS(null,"id",g+":shadowrect:noobject");m.setAttributeNS(null,"style","fill:#444444;stroke:none;opacity:0.2");m.setAttributeNS(null,"x",Number(m.getAttributeNS(null,"x"))+map.Scale.normalX(8));m.setAttributeNS(null,"y",Number(m.getAttributeNS(null,"y"))+map.Scale.normalY(9));m.setAttributeNS(null,"width",Number(m.getAttributeNS(null,"width"))-map.Scale.normalY(5));m.setAttributeNS(null,
"height",Number(m.getAttributeNS(null,"height"))-map.Scale.normalY(6));f=this.showInfoMore?new Button(G,g+":removebutton","BUTTON","#delete_button","map.Themes.toggleMore(evt,'"+this.szId+"')","","hide tools"):new Button(G,g+":removebutton","BUTTON","#delete_button","map.Themes.removeTheme(evt,'"+g+"')","","remove map theme");f.setPosition(B.width-map.Scale.normalX(2),map.Scale.normalY(7));this.removebutton=f;f=new Button(G,g+":maximizebutton","BUTTON","#maximize_button","map.Themes.maximizeInfo(evt,'"+
g+"')","","maximize");f.setPosition(B.width-map.Scale.normalX(map.Scale.nButtonSize+5),map.Scale.normalY(7));this.maximizebutton=f;f=new Button(G,g+":minimizebutton","BUTTON","#minimize_button","map.Themes.minimizeInfo(evt,'"+g+"')","","minimize");f.setPosition(B.width-map.Scale.normalX(map.Scale.nButtonSize+5),map.Scale.normalY(7));this.minimizebutton=f;r&&l&&r.setPosition(B.width-map.Scale.normalX(1),l.getPosition().y-map.Scale.normalX(3));l&&l.setPosition(B.width-map.Scale.normalX(1),v);w&&w.setPosition(B.width-
map.Scale.normalX(1),v);this.showInfoMore&&map.Dom.newShape("line",u,0,map.Scale.normalY(8),B.width+map.Scale.normalX(2*map.Scale.nButtonSize),map.Scale.normalY(8),"stroke:black;stroke-width:"+map.Scale.normalX(.2)+";");q&&(q=this.parent.getThemeIndex(this.szId),r=new point(160,map.Scale.mapPosition.y+220),l=map.Viewport.szPopupAlignment?map.Viewport.szPopupAlignment:"",w=map.Legend?map.Legend.getPosition():new point(0,0),l.match(/LEFT/)?(r.x=0==w.x?map.Scale.mapPosition.x+map.Scale.normalX(10):map.Scale.normalX(10),
r.x+=map.Scale.normalX(10+10*(q-1))):(r=0==w.x?new point(map.Scale.viewBox.width-B.width-map.Scale.normalX(5)-map.Scale.normalX(10),map.Scale.normalY(10)):new point(map.Scale.mapPosition.x+map.Scale.bBox.width-B.width-map.Scale.normalX(5)-map.Scale.normalX(10),map.Scale.normalY(10)),r.x-=map.Scale.normalX(4),r.x-=map.Scale.normalX(10*q)),!l.match(/BOTTOM/)||this.parent.fMinimizedLegends||this.szFlag.match(/MINIMIZED/)?r.y+=map.Scale.normalY(20*q):(this.parent.minY?(r.y=this.parent.minY-map.Scale.normalY(10),
r.x+=map.Scale.normalX(10*q)):(r.y=map.Scale.mapPosition.y+map.Scale.bBox.height-B.height-map.Scale.normalX(10),r.y-=map.Scale.normalY(10*(q-1))),r.y-=map.Scale.normalY(20),0>=map.Scale.viewBox.height-(map.Scale.mapPosition.y+map.Scale.bBox.height)&&(r.y-=map.Scale.normalY(15))),this.widgetNode.fu.setPosition(r.x,r.y),this.ptWidget=this.widgetNode.fu.getPosition(),this.parent.minX=r.x,this.parent.minY=r.y);h&&h.style.setProperty("display","inline","");(this.parent.fMinimizedLegends||this.szFlag.match(/MINIMIZED/))&&
map.Themes.minimizeInfo(null,g)}};MapTheme.prototype.chartButton=function(f,c,g){f=map.Dom.newGroup(f,"chartvari"+String(Math.random()));var e=this.szFlag;"2D"==g&&this.removeDefinitionFromFlag("3D");this.szFlag+="|NORMSIZE|SILENT|MENUSIZE|"+g;this.drawChart(f,null,c);this.szFlag=e;e=map.Dom.getBox(f);this.addChartTypeSign(f,g);g=Math.min(map.Scale.normalX(c)/e.width,map.Scale.normalY(c)/e.height);f.fu.scale(g,g);f.fu.setPosition(map.Scale.normalX(c+10),map.Scale.normalY(c)*g);return f};
MapTheme.prototype.addDefinitionToFlag=function(f){return this.szFlag=this.szFlag+"|"+f};MapTheme.prototype.removeDefinitionFromFlag=function(f){for(var c="",g=this.szFlag.split("|"),e=0;e<g.length;e++)g[e]!=f&&(c+=(c.length?"|":"")+g[e]);return this.szFlag=c};MapTheme.prototype.removeDefinition=function(f,c){for(var g="",e=f.split("|"),h=0;h<e.length;h++)e[h]!=c&&(g+=(g.length?"|":"")+e[h]);return g};
MapTheme.prototype.chartMenu=function(f,c,g){g||(g="variation");var e=f+":menu",h=new point(0,0);if(!SVGDocument.getElementById(e)){var m=SVGDocument.getElementById(f+":movable");m||(m=map.Dom.newGroup(SVGThemeGroup,"chartmenu:movable"),SVGThemeGroup.style.setProperty("display","inline",""),h=new point(map.Scale.normalX(50),map.Scale.normalY(150)));var q=map.Dictionary.getLocalText("Chart toolbox");this.toolBoxContainer&&SVGDocument.getElementById(this.toolBoxContainer.szId)?this.toolBoxContainer.setTitle(q):
this.toolBoxContainer=new InfoContainer(SVGDocument,m,e,h,new point(0,0),"fixed",q);map.Dom.clearGroup(this.toolBoxContainer.workspaceNode);e=this.toolBoxContainer;h=this.toolBoxContainer.workspaceNode;e.szTabSelected=g;g=map.Scale.normalX(10);m=map.Scale.normalY(30);szText=map.Dictionary.getLocalText("chart");szType="chart"==e.szTabSelected?"TEXTBUTTON|SELECTED":"TEXTBUTTON";buttonObj=new Button(e.titleTextNode,this.szId,szType,szText,"map.Themes.getTheme('"+this.szId+"').chartMenu('"+f+"','"+c+
"','chart')","","change menu");buttonObj.setPosition(g,m);g+=buttonObj.bBox.width+map.Scale.normalX(2);szText=map.Dictionary.getLocalText("color");szType="color"==e.szTabSelected?"TEXTBUTTON|SELECTED":"TEXTBUTTON";buttonObj=new Button(e.titleTextNode,this.szId,szType,szText,"map.Themes.getTheme('"+this.szId+"').chartMenu('"+f+"','"+c+"','color')","","change menu");buttonObj.setPosition(g,m);g+=buttonObj.bBox.width+map.Scale.normalX(2);szText=map.Dictionary.getLocalText("variation");szType="variation"==
e.szTabSelected?"TEXTBUTTON|SELECTED":"TEXTBUTTON";buttonObj=new Button(e.titleTextNode,this.szId,szType,szText,"map.Themes.getTheme('"+this.szId+"').chartMenu('"+f+"','"+c+"','variation')","","change menu");buttonObj.setPosition(g,m);map.Scale.normalX(2);switch(e.szTabSelected){case "chart":this.getChartTypeMenu(h);break;default:this.getChartColorMenu(h,e.szTabSelected)}this.toolBoxContainer.reformat()}};
MapTheme.prototype.addChartTypeSign=function(f,c){var g="M0,0 l"+map.Scale.normalX(1.5)+",-"+map.Scale.normalX(1.5)+" 0,"+map.Scale.normalX(3)+" -"+map.Scale.normalX(1.5)+",-"+map.Scale.normalX(1.5)+" M"+map.Scale.normalX(2.5)+",0 l"+map.Scale.normalX(17.5)+",0 M"+map.Scale.normalX(22.5)+",0 l-"+map.Scale.normalX(1.5)+",-"+map.Scale.normalX(1.5)+" 0,"+map.Scale.normalX(3)+" "+map.Scale.normalX(1.5)+",-"+map.Scale.normalX(1.5)+"";if(c.match(/SIZE/)){var e=map.Dom.newGroup(f,"");map.Dom.newShape("path",
e,g,"stroke:white;stroke-width:"+map.Scale.normalX(4)+";stroke-opacity:0.5;stroke-linejoin:miter;");map.Dom.newShape("path",e,g,"stroke:#666666;stroke-width:"+map.Scale.normalX(1.5)+";stroke-linejoin:miter;");e.fu.setPosition(-map.Scale.normalX(10),map.Scale.normalX(-5))}c.match(/HEIGHT/)&&(e=map.Dom.newGroup(f,""),map.Dom.newShape("path",e,g,"stroke:white;stroke-width:"+map.Scale.normalX(4)+";stroke-opacity:0.5;stroke-linejoin:miter;"),map.Dom.newShape("path",e,g,"stroke:#666666;stroke-width:"+map.Scale.normalX(1.5)+
";stroke-linejoin:miter;"),e.setAttributeNS(null,"transform","translate(0,"+-map.Scale.normalX(25)+") rotate(90)"))};
MapTheme.prototype.getChartTypeMenu=function(f,c,g){"undefined"==typeof szChartTypeList&&(szChartTypeList="CHART|BAR CHART|BAR|3D CHART|BAR|3D|SORT CHART|BAR|HORZ|LEFT|UP CHART|BAR|HORZ|RIGHT|UP CHART|BAR|HORZ|LEFT|UP|COMPRESS CHART|BAR|HORZ|RIGHT|UP|COMPRESS CHART|BAR|HORZ|LEFT|UP|3D CHART|BAR|HORZ|RIGHT|UP|3D CHART|BAR|HORZ|LEFT|UP|COMPRESS|3D CHART|BAR|HORZ|RIGHT|UP|COMPRESS|3D CHART|BAR|HORZ|CENTER|UP CHART|BAR|STACKED CHART|BAR|STACKED|3D CHART|BAR|SORT|3D|COLUMNS|STACKED CHART|BAR|SORT|3D|COLUMNS|STACKED|SIZE CHART|PIE CHART|PIE|SIZE CHART|PIE|3D CHART|PIE|3D|SIZE CHART|PIE|3D|HEIGHT CHART|PIE|3D|VOLUME CHART|PIE|DONUT CHART|PIE|DONUT|SIZE CHART|PIE|DONUT|3D CHART|PIE|DONUT|3D|SIZE CHART|PIE|DONUT|3D|HEIGHT CHART|PIE|DONUT|3D|VOLUME CHART|PIE|STARBURST CHART|PIE|STARBURST|SIZE CHART|PIE|STARBURST|3D CHART|PIE|STARBURST|3D|SIZE CHART|PIE|STARBURST|3D|HEIGHT CHART|PIE|STARBURST|3D|VOLUME CHART|PIE|DONUT|STARBURST CHART|PIE|DONUT|STARBURST|SIZE CHART|PIE|DONUT|STARBURST|3D CHART|PIE|DONUT|STARBURST|3D|SIZE CHART|PIE|DONUT|STARBURST|3D|HEIGHT CHART|PIE|DONUT|STARBURST|3D|VOLUME".split(" "));"undefined"==
typeof szChartTypeListSingleValue_old&&(szChartTypeListSingleValue_old="CHART|BAR CHART|BAR|VALUES CHART|BAR|3D CHART|BAR|3D|VALUES CHART|BAR|3D|VOLUME CHART|BAR|3D|VOLUME|VALUES CHART|BAR|HORZ|RIGHT|UP CHART|BAR|HORZ|RIGHT|UP|VALUES CHART|BAR|HORZ|RIGHT|UP|3D CHART|BAR|HORZ|RIGHT|UP|VALUES|3D CHART|BAR|POINTER CHART|BAR|POINTER|VALUES CHART|BUBBLE|SURFACE CHART|BUBBLE|SURFACE|VALUES CHART|SQUARE|SURFACE CHART|SQUARE|SURFACE|VALUES".split(" "));"undefined"==typeof szChartTypeListSingleValue&&(szChartTypeListSingleValue=
"CHOROPLETHE CHART|BUBBLE CHART|SQUARE CHART|PIE|3D|SIZE CHART|PIE|3D|HEIGHT CHART|PIE|3D|SIZE|HEIGHT CHART|BAR|3D|VOLUME CHART|BAR CHART|BAR|3D CHART|BAR|3D|SIZE CHART|BAR|HORZ|RIGHT|UP CHART|BAR|HORZ|RIGHT|UP|3D CHART|BAR|POINTER CHART|BAR|POINTER|SIZE CHART|BAR|HORZ|RIGHT|UP|POINTER CHART|LABEL".split(" "));var e=this.szOrigFlag;c=szChartTypeListSingleValue;if(1<this.szFieldsA.length||this.szFlag.match(/EXACT/)&&this.szFlag.match(/AGGREGATE/))c=szChartTypeList;g=g?g/60:3;for(i=0;i<c.length;i++){merkFlag=
this.szFlag;var h=map.Dom.constructNode("a",f,{});map.Dom.newShape("rect",h,map.Scale.normalX(i%g*60),map.Scale.normalY(60*Math.floor(i/g)),map.Scale.normalX(60),map.Scale.normalY(60),"fill:#f8f8ff;stroke:lightgray;stroke-dasharray:50 50;stroke-width:"+map.Scale.normalX(1)+";");var m=map.Dom.newGroup(h,"szDisplayId:chart:"+String(Math.random()));map.Dom.setClipRect(m,new box(-map.Scale.normalX(25),-map.Scale.normalX(60),map.Scale.normalX(60),map.Scale.normalX(60)));this.szFlag=c[i]+"|NORMSIZE|SILENT|MENUSIZE";
merkFlag.match(/EXACT/)&&(this.szFlag+="|EXACT");merkFlag.match(/AGGREGATE/)&&(this.szFlag+="|AGGREGATE");merkFlag.match(/RELOCATE/)&&(this.szFlag+="|RELOCATE");merkFlag.match(/DIFFERENCE/)&&(this.szFlag+="|DIFFERENCE");merkFlag.match(/FRACTION/)&&(this.szFlag+="|FRACTION");merkFlag.match(/INVERT/)&&(this.szFlag+="|INVERT");merkFlag.match(/INVERTSIZE/)&&(this.szFlag+="|INVERTSIZE");merkFlag.match(/RELATIVE/)&&(this.szFlag+="|RELATIVE");merkFlag.match(/DENSITY/)&&(this.szFlag+="|DENSITY");merkFlag.match(/DOPACITYMAX/)?
this.szFlag+="|DOPACITYMAX":merkFlag.match(/DOPACITYLOGMAX/)?this.szFlag+="|DOPACITYLOGMAX":merkFlag.match(/DOPACITYPOWMAX/)?this.szFlag+="|DOPACITYPOWMAX":merkFlag.match(/DOPACITYMEAN/)?this.szFlag+="|DOPACITYMEAN":merkFlag.match(/DOPACITYLOGMEAN/)?this.szFlag+="|DOPACITYLOGMEAN":merkFlag.match(/DOPACITYPOWMEAN/)?this.szFlag+="|DOPACITYPOWMEAN":merkFlag.match(/DOPACITYLOG/)?this.szFlag+="|DOPACITYLOG":merkFlag.match(/DOPACITY/)&&(this.szFlag+="|DOPACITY");merkFlag.match(/AUTO100/)&&(this.szFlag+=
"|AUTO100");merkFlag.match(/AUTOCOMPLETE/)&&(this.szFlag+="|AUTOCOMPLETE");var q=this.szAggregation,l=this.drawChart(m,null,40);this.szAggregation=q;if(l){this.szFlag=merkFlag;var r=map.Scale.normalX(10);l.x-=map.Scale.normalX(60/g);m.fu.setPosition(r-l.x+i%g*map.Scale.normalX(60),map.Scale.normalY(40)+r+l.y+Math.floor(i/g)*map.Scale.normalY(60));r="";e.match(/UNDEFINEDISVALUE/)&&(r+="|UNDEFINEDISVALUE");e.match(/ZEROISVALUE/)&&(r+="|ZEROISVALUE");e.match(/NEGATIVEISVALUE/)&&(r+="|NEGATIVEISVALUE");
e.match(/NONEGATIVE/)&&(r+="|NEGATIVEISVALUE");e.match(/AGGREGATE/)&&(r+="|AGGREGATE");e.match(/RELOCATE/)&&(r+="|RELOCATE");e.match(/EXACT/)&&(r+="|EXACT");e.match(/SUM/)&&(r+="|SUM");e.match(/DIFFERENCE/)&&(r+="|DIFFERENCE");e.match(/RELATIVE/)&&(r+="|RELATIVE");e.match(/INVERT/)&&(r+="|INVERT");e.match(/INVERTSIZE/)&&(r+="|INVERTSIZE");e.match(/CALCMEAN/)&&(r+="|CALCMEAN");e.match(/CALC100/)&&(r+="|CALC100");e.match(/PRODUCT/)&&(r+="|PRODUCT");e.match(/AUTOCOMPLETE/)&&(r+="|AUTOCOMPLETE");e.match(/AUTO100/)&&
(r+="|AUTO100");e.match(/QUANTILE/)&&(r+="|QUANTILE");e.match(/DENSITY/)&&(r+="|DENSITY");e.match(/DOPACITY/)&&(r+="|DOPACITY");if(e.match(/VALUES/)||merkFlag.match(/VALUES/))r+="|VALUES";e.match(/VALUEBACKGROUND/)&&(r+="|VALUEBACKGROUND");c[i].match(/SIZE/)&&(merkFlag.match(/SIZELOG/)?r+="|SIZELOG":merkFlag.match(/SIZEP4/)?r+="|SIZEP4":merkFlag.match(/SIZEP3/)?r+="|SIZEP3":merkFlag.match(/SIZE/)&&(r+="|SIZE"));merkFlag.match(/SPACED/)&&(r+="|SPACED");h.setAttributeNS(null,"onclick","map.Themes.changeThemeStyle(evt,'"+
this.szId+"','type:"+c[i]+r+"')");this.addChartTypeSign(m,c[i])}}f=[];for(a in c)f.push(c[a]+r);return f};
MapTheme.prototype.chartColorMenu=function(f){"string"==typeof this.origColorScheme[0]&&this.origColorScheme[0].match(/#/)&&(this.origColorScheme[1]=this.origColorScheme[0],this.origColorScheme[2]=this.origColorScheme[this.origColorScheme.length-1],this.origColorScheme[0]=this.origColorScheme.length,this.origColorScheme.length=3);"undefined"==typeof szColorSchemeList&&(szColorSchemeList=[[null,"red","green","blue","cold"],[null,"blue","orange","yellow","2Colors"],[null,"spectrum","default","270",
"0"],[null,"spectrum","default","200","0"],[null,"spectrum","default","0","270"],[null,"spectrum","default","0","200"]]);"undefined"==typeof szColorSchemeVariantList&&(szColorSchemeVariantList=[[null,null,null,"linear","linear"],[null,null,null,"dynamic","dynamic"],[null,null,null,"auto","auto"],[null,null,null,"2colors","2colors"],[null,null,null,"2wide","2wide"],[null,null,null,"2narrow","2narrow"],[null,null,null,"2low","2low"],[null,null,null,"2high","2high"],[null," "," "," "," "],[null,"green",
"red","auto","cold"],[null,"red","green","auto","cold"],[null,"blue","orange","yellow","2Colors"],[null,"spectrum","default","270","0"],[null,"spectrum","default","200","0"],[null,"spectrum","default","0","270"],[null,"spectrum","default","0","200"]]);"undefined"==typeof szColorSchemeSpectrumVariantList&&(szColorSchemeSpectrumVariantList=[[null,null,"light",null,null],[null,null,"default",null,null],[null,null,"pastel",null,null],[null,null,"soft",null,null],[null,null,"pale",null,null],[null," ",
" "," "," "],[null,"spectrum","default","270","0"],[null,"spectrum","default","200","0"],[null,"spectrum","default","0","270"],[null,"spectrum","default","0","200"],[null,"green","red","auto","cold"],[null,"red","green","auto","cold"],[null,"blue","orange","yellow","2Colors"]]);var c=f+":colormenu";if(!SVGDocument.getElementById(c)&&(f=SVGDocument.getElementById(f+":movable"))){var g=map.Dictionary.getLocalText("Select color scheme variation"),c=new InfoContainer(SVGDocument,f,c,new point(0,0),new point(0,
0),"fixed",g);f=c.workspaceNode;var e=map.Scale.normalX(10),g=map.Scale.normalY(30);szText=map.Dictionary.getLocalText("chart");szType="TEXTBUTTON";buttonObj=new Button(c.titleTextNode,this.szId,szType,szText,"map.Themes.changeThemeStyle(evt,'"+this.szId+"','filter:min;dfilter:0')","","change method");buttonObj.setPosition(e,g);e+=buttonObj.bBox.width+map.Scale.normalX(2);szText=map.Dictionary.getLocalText("color");szType="TEXTBUTTON|SELECTED";buttonObj=new Button(c.titleTextNode,this.szId,szType,
szText,"map.Themes.changeThemeStyle(evt,'"+this.szId+"','filter:mean;dfilter:0')","","change method");buttonObj.setPosition(e,g);map.Scale.normalX(2);map.Dom.newShape("rect",f,0,0,350,350,"fill:white");g=szColorSchemeVariantList;"spectrum"==this.origColorScheme[1]&&(g=szColorSchemeSpectrumVariantList);var h=100,h=200;for(i=0;i<g.length;i++){map.Dom.newShape("rect",f,map.Scale.normalX(i%1*h),map.Scale.normalY(30*Math.floor(i/1)),map.Scale.normalX(h),map.Scale.normalY(30),"fill:#f8f8ff;stroke:lightgray;stroke-dasharray:50 50;stroke-width:"+
map.Scale.normalX(1)+";");for(var e=map.Dom.constructNode("a",f,{}),m=map.Dom.newGroup(e,"szDisplayId:chart:"+String(Math.random())),q=[],e=0;e<g[i].length;e++)q[e]=g[i][e]?g[i][e]:this.origColorScheme[e];for(var l=ColorScheme.createColorScheme(q[1],q[2],q[0],q[3],q[4]),r=map.Scale.normalX((h-10-10)/l.length),w=0;w<l.length;w++)e=map.Scale.normalX(10+i%1*h),map.Dom.newShape("rect",m,e+r*w,map.Scale.normalY(30*Math.floor(i/1)+10),r,map.Scale.normalY(10),"fill:"+l[w]+";stroke:lightgray;stroke-width:"+
map.Scale.normalX(1)+";");m.setAttributeNS(null,"onclick","map.Themes.changeThemeStyle(evt,'"+this.szId+"','colorscheme:"+q[1]+","+q[2]+","+q[3]+","+q[4]+"')")}c.reformat()}};
MapTheme.prototype.getChartColorMenu=function(f,c){for(var g=[],e=0;e<this.origColorScheme.length;e++)g[e]=this.origColorScheme[e];if("string"==typeof g[0]&&g[0].match(/#/)){var e=Math.min(this.origColorScheme.length,this.partsA.length),h=g[0],m=g[e-1],q=g[Math.floor((e-1)/2)];g[0]=e;g[1]=h;g[2]=m;g[3]=null;g[4]=q;g.length=5}"undefined"==typeof szColorSchemeList&&(szColorSchemeList=[[null,"#ffeeee","#dd0000","dynamic","cold"],[null,"#eeffee","#00dd00","dynamic","cold"],[null,"#eeeeff","#0000dd","dynamic",
"cold"],[null,"#FFFDD8","#952D44",null,null],[null,"#FEFDDF","#008A56",null,null],[null,"#FEFDDF","#00308F",null,null],[null,"#FEFDDF","#91308F",null,null],[null,"#FEFDDF","#E5891F",null,null],[null,"#EBF4FB","#00308F",null,null],[null,"#EBF4FB","#91308F",null,null],[null,"#FAE9D6","#E5891F",null,null],[null,"#F9DECA","#9C2700 ","2colors","#F4793B"],[null,"#9C2700","#F9DECA ","2colors","#F4793B"],[null,"#FFFDD8","#B5284B","2colors","#FCBA6C"],[null,"#FFFDB0","#800800","2colors","#F79E00"],[null,"#FFFDB0",
"#6B0601","2colors","#E69511"],[null,"#800800","#FFFDB0","2colors","#F79E00"],[null,"green","red",null,"warm"],[null,"green","#952D44",null,"warm"],[null,"#026622","#8A5195",null,null],[null,"#8A5195","#026622",null,null],[null,"green","red",null,"cold"],[null,"green","#952D44",null,"cold"],[null,"#026622","#8A5195",null,"cold"],[null,"#8A5195","#026622",null,"cold"],[null,"red","green",null,"warm"],[null,"#FF4800","#7CB832","auto","#F7FA7A"],[null,"blue","white","2colors","orange"],[null,"blue",
"red",null,null],[null,"blue","red","auto",null],[null,"blue","red","2colors","orange"],[null,"blue","orange","2low","red"],[null,"blue","#ffcc77","2low","red"],[null,"#ffcc77","blue","2high","red"],[null,"#D1EC6E","#F7C025",null,null],[null,"#D1EC6E","#FF8085",null,null],[null,"#ffffff","#444444","dynamic","cold"],[null,"#444444","#ffffff","dynamic","cold"],[null,"#444444","#444444","dynamic","cold"],[null," "," "," "," "],[null,"spectrum","default","270","0"],[null,"spectrum","default","230","0"],
[null,"spectrum","default","200","0"],[null,"spectrum","default","0","270"],[null,"spectrum","default","0","230"],[null,"spectrum","default","0","200"],[null,"office","","",""],[null,"pastel","","",""],[null,"mineral","","",""],[null,"harvest","","",""]]);"undefined"==typeof szColorSchemeVariantList&&(szColorSchemeVariantList=[[null,null,null,"linear",null],[null,null,null,"dynamic",null],[null,null,null,"auto",null],[null,null,null,"2colors",null],[null,null,null,"2wide",null],[null,null,null,"2narrow",
null],[null,null,null,"2low",null],[null,null,null,"2high",null]]);"undefined"==typeof szColorSchemeSpectrumVariantList&&(szColorSchemeSpectrumVariantList=[[null,null,"light",null,null],[null,null,"default",null,null],[null,null,"pastel",null,null],[null,null,"soft",null,null],[null,null,"pale",null,null]]);h=szColorSchemeList;switch(c){case "color":h=szColorSchemeList;break;case "variation":h=szColorSchemeVariantList,"spectrum"==g[1]&&(h=szColorSchemeSpectrumVariantList)}m=200;m=Math.min(200,15*
g[0]);for(e=0;e<h.length;e++){map.Dom.newShape("rect",f,map.Scale.normalX(e%1*m),map.Scale.normalY(30*Math.floor(e/1)),map.Scale.normalX(m),map.Scale.normalY(30),"fill:#f8f8ff;stroke:lightgray;stroke-dasharray:50 50;stroke-width:"+map.Scale.normalX(1)+";");for(var q=map.Dom.constructNode("a",f,{}),q=map.Dom.newGroup(q,"szDisplayId:chart:"+String(Math.random())),l=[],r=0;r<h[e].length;r++)l[r]=h[e][r]?h[e][r]:g[r];l[0]=Math.min(15,l[0]);for(var r=ColorScheme.createColorScheme(l[1],l[2],l[0],l[3],l[4]),
w=map.Scale.normalX((m-10-10)/r.length),B=0;B<r.length;B++){var u=map.Scale.normalX(10+e%1*m);map.Dom.newShape("rect",q,u+w*B,map.Scale.normalY(30*Math.floor(e/1)+10),w,map.Scale.normalY(10),"fill:"+r[B]+";stroke:lightgray;stroke-width:"+map.Scale.normalX(1)+";")}q.setAttributeNS(null,"onclick","map.Themes.changeThemeStyle(evt,'"+this.szId+"','colorscheme:"+l[1]+","+l[2]+","+l[3]+","+l[4]+"')");q.setAttributeNS(null,"tooltip",l[1]+","+l[2]+","+l[3]+","+l[4])}};
MapTheme.prototype.formatValue=function(f,c,g){return isNaN(f)?f:999<this.nMin&&3E3>this.nMax?__formatValue(f,c,g+"|NOBREAKS"):__formatValue(f,c,g)};MapTheme.prototype.remove=function(f){this.parent.removeTheme(f,this.szId)};MapTheme.prototype.removeElements=function(f){this.widgetNode&&(widgetList.removeWidget(this.widgetNode),this.widgetNode.parentNode.removeChild(this.widgetNode),this.widgetNode=null);this.clipTimeout&&clearTimeout(this.clipTimeout);this.unpaintMap();if(this.onremove)try{eval(this.onremove)}catch(c){}try{HTMLWindow.ixmaps.htmlgui_onRemoveTheme(this.szId)}catch(g){}};
MapTheme.prototype.removeMapThemeStyles=function(f){f=f.split("|");for(var c=SVGRootElement.getElementsByTagName("path"),g=0;g<c.length;g++)if(1==c.item(g).nodeType){var e=c.item(g).parentNode.getAttributeNS(null,"id"),h=!1;if(e&&0!==e.length)for(var e=map.Tiles.getMasterId(e).split(":")[0],m=0;m<f.length;m++)e==f[m]&&(h=!0);h&&c.item(g).parentNode.removeAttributeNS(null,"style")}};
MapTheme.prototype.disable=function(){if(!this.szFlag.match(/CHART/)&&this.widgetNode)for(var f=this.widgetNode.getElementsByTagName("g"),c=0;c<f.length;c++)f.item(c).setAttributeNS(null,"opacity","0.9")};MapTheme.prototype.enable=function(){if(this.widgetNode){for(var f=this.widgetNode.getElementsByTagName("g"),c=0;c<f.length;c++)f.item(c).setAttributeNS(null,"opacity","1.0");this.widgetNode.parentNode.appendChild(this.widgetNode)}map.Themes.setActive(this)};
MapTheme.prototype.makeVisible=function(){for(var f=0;f<this.szThemesA.length;f++)map.Layer.isLayerOn(this.szThemesA[f])||map.Layer.isScaleDependentLayer(this.szThemesA[f])||(map.Themes.switchedLayerA[this.szThemesA[f]]=!0,map.Api.switchMapTheme(this.szThemesA[f],"on")),map.Tiles.switchScaleDependentTiles()};
MapTheme.prototype.checkVisible=function(){for(var f=0;f<this.szThemesA.length;f++)map.Themes.isThemeLayerUsed(this.szThemesA[f])&&this.isVisible||!map.Themes.switchedLayerA[this.szThemesA[f]]||(map.Api.switchMapTheme(this.szThemesA[f],"off"),map.Themes.switchedLayerA[this.szThemesA[f]]=null)};
MapTheme.prototype.resize=function(f){999!=f&&(this.nScale*=f);if(this.szFlag.match(/BUFFER/)&&this.szShapeType.match(/line/))this.fRedrawInfo=this.fRedraw=!0,this.nSkipCount=1,map.Themes.execute();else{map.Layer.changeObjectScaling(null,f,this.chartGroup);if(this.szFlag.match(/BUFFER/)){var c=this.chartGroup.getElementsByTagName("circle");for(n=0;n<c.length;n++){var g=c.item(n).getAttributeNS(null,"style");g&&g.length&&(szNewStylesValue=__scaleStyleString(g,1/f),c.item(n).setAttributeNS(null,"style",
szNewStylesValue))}}this.f=!0;this.showInfo()}};MapTheme.prototype.offset=function(f){var c=this.chartGroup.fu.getPosition();this.chartGroup.fu.setPosition(c.x+f.x,c.y+f.y)};
MapTheme.prototype.opacity=function(f){this.fillOpacity=(this.fillOpacity?this.fillOpacity:1)*f;this.fillOpacity=Math.min(1,this.fillOpacity);this.fillOpacity=Math.max(0,this.fillOpacity);this.nOpacity=(this.nOpacity?this.nOpacity:1)*f;this.nOpacity=Math.min(1,this.nOpacity);this.nOpacity=Math.max(0,this.nOpacity);if(this.chartGroup)for(var c=this.chartGroup.childNodes,g=0;g<c.length;g++)map.Layer.changeNodeOpacity(c.item(g),f);else if(this.szShapeType.match(/line/))for(g=0;g<this.szThemesA.length;g++)map.Layer.changeLayerOpacity(this.szThemesA[g],
f);else for(a in this.itemA)for(c=this.getItemNodes(a),g=0;g<c.length;g++)map.Layer.changeNodeOpacity(c[g],f,"fill-opacity")};
MapTheme.prototype.blur=function(f){if(this.chartGroup)if(this.nBlur){szBlurFilterId="blur-3";var c=SVGDocument.getElementById(szBlurFilterId);c?c.firstChild.setAttributeNS(null,"stdDeviation",map.Scale.normalX(f)):(c=map.Dom.newNode("filter",this.chartGroup.parentNode),c.setAttributeNS(null,"id",szBlurFilterId),filter=map.Dom.newNode("feGaussianBlur",c),filter.setAttributeNS(null,"stdDeviation",map.Scale.normalX(f)));this.chartGroup.style.setProperty("filter","url(#"+szBlurFilterId+")","")}else this.chartGroup.style.removeProperty("filter");
else if(this.szThemesA[0]){var g=SVGDocument.getElementById("maplayer");g&&(this.nBlur?(szBlurFilterId="blur-map",(c=SVGDocument.getElementById(szBlurFilterId))?c.firstChild.setAttributeNS(null,"stdDeviation",map.Scale.normalX(f)/map.Zoom.nZoom):(c=map.Dom.newNode("filter",g.parentNode),c.setAttributeNS(null,"id",szBlurFilterId),c.setAttributeNS(null,"x",0),c.setAttributeNS(null,"y",0),c.setAttributeNS(null,"width","100%"),c.setAttributeNS(null,"height","100%"),filter=map.Dom.newNode("feGaussianBlur",
c),filter.setAttributeNS(null,"stdDeviation",map.Scale.normalX(f)/map.Zoom.nZoom)),g.style.setProperty("filter","url(#"+szBlurFilterId+")","")):g.style.removeProperty("filter"))}};
MapTheme.prototype.toggle=function(){this.chartGroup?"none"==this.chartGroup.style.getPropertyValue("display")?this.chartGroup.style.setProperty("display","inline",""):this.chartGroup.style.setProperty("display","none",""):this.isChecked?(this.unpaintMap(),this.isChecked=!1,map.Themes.activateNextPaint(this)&&(this.fToggle=!1,map.Themes.execute(),this.widgetNode&&(this.widgetNode.setAttributeNS(null,"opacity","1.0"),this.widgetNode.parentNode.appendChild(this.widgetNode)))):(this.fRedraw=this.isChecked=
!0,this.fToggle=!1,map.Themes.execute())};MapTheme.prototype.getHistogram=function(f,c,g){map.Themes.getHistogram(f,c,g,this)};var __maptheme_chartcolors=[];function __maptheme_getChartColors(f){__maptheme_chartcolors[f]||(__maptheme_chartcolors[f]=new ChartColors(f));return __maptheme_chartcolors[f]}
function ChartColors(f){"string"!=typeof f&&(f="#ffffff");this.mainColor=f;this.lowColor=ColorScheme.getDerivateColor(f,.7);this.highColor=ColorScheme.getDerivateColor(f,1.3);this.borderColor=ColorScheme.getBorderColor(f);this.textColor=ColorScheme.getTextColor(f)}function __mpap_hex2dec(f){return parseInt(f,16)}
function __mpap_decode_utf8(f){if("string"==typeof f&&f.match(/&#x/)){var c="";sA=f.split("&#x");c=sA[0];for(f=1;f<sA.length;f++)c+=String.fromCharCode(__mpap_hex2dec(sA[f].substr(0,2))),c+=sA[f].substr(3,sA[f].length-3);return c}return f};
